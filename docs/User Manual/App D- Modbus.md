## ПРИЛОЖЕНИЕ D. Работа по протоколу Modbus

В зависимости от настроек, OPCB-221 может принимать и обрабатывать запросы
Modbus по нескольким портам, в том числе:

- запросы Modbus TCP от облачного сервера через обратное подключение к облачному
  серверу;
- запросы Modbus TCP от одного или нескольких клиентов (но не больше указанного
  в технических характеристиках количества клиентов) через порт Modbus TCP (для
  которых OPCB-221 выступает сервером Modbus TCP);
- запросы Modbus RTU или Modbus ASCII от ведущего устройства или устройства
  через один или два последовательных порта (в этом случае OPCB-221 выступает
  ведомым устройством на последовательном порту).

По адресу (идентификатору) устройства в запросе определяется направление
передачи запроса для его обработки и получения ответа.

Если запрос адресован другому устройству, то, в зависимости от настроек шлюза,
он может передаваться (с преобразованием протокола там, где это требуется), на
одно из заданных направлений, в том числе:

- на один из двух последовательных портов в виде запроса Modbus RTU или Modbus
  ASCII (для устройств на этих портах OPCB-221 выступает ведущим);
- на один из двух удаленных серверов в виде запроса Modbus TCP (для которого
  OPCB-221 выступает клиентом Modbus TCP).

Если обратно получен ответ в правильном формате, он возвращается запрашивающей
стороне. Если время ожидания ответа истекло, или формат ответа неправильный, то
вместо ответа OPCB-221 генерирует и передает клиенту соответствующий код
исключения Modbus.

Если запрос адресован внутреннему виртуальному устройству OPCB-221, то он не
передается, а обрабатывается самим изделием, и ответ возвращается запрашивающей
стороне. Списки параметров, доступных в регистрах Modbus, приведены ниже.

- изделие поддерживает запросы функций чтения и/или записи в регистры хранения;
- перечисленные адреса регистров прямо соответствуют значениям поля адреса в
  запросах Modbus;
- для параметров, доступных только для чтения, диапазон допустимых значений не
  указан;
- для параметров, доступных для чтения или записи, указан диапазон допустимых
  значений;
- числовые параметры, занимающие больше одного регистра, хранят байты по два в
  каждом регистре, старшим вперед;
- параметры типа _строка символов_ хранят коды символов строки по одному в
  каждом регистре, слева направо; если строка занимает меньше регистров, чем
  указано в диапазоне адресов, то строка завершается кодом 0; если начальное
  значение не указано, то оно равно пустой строке;
- параметры типа _адрес IPv4_ и _адрес MAC-48_ хранят байты адреса по одному в
  каждом регистре, слева направо.

### Группа параметров идентификации

| Параметр       | Описание                                             | Адрес(а) |
| -------------- | ---------------------------------------------------- | -------- |
| Тип устройства | Код идентификации у производителя (42 – OPCB-221)    | 0        |
| Версия         | Версия ПО, обеспечивающего связь по протоколу Modbus | 1        |

### Группа параметров управления

| Параметр    | Допустимые значения | Начальное значение | Описание                                                                                                                       | Адрес(а) |
| ----------- | ------------------- | ------------------ | ------------------------------------------------------------------------------------------------------------------------------ | -------- |
| Команда     | 0...65535           | 0                  | Код команды (см. ниже)                                                                                                         | 50       |
| Ввод пароля | Строка символов     | –                  | Запись правильного пароля в этот параметр повышает уровень доступа данного клиента до 2, если он был меньше 2 (см. рег. 1300). | 68...99  |

#### Доступные коды команд (регистр 50):

- `3034` – запросить у облачного сервера отмену активации (отвязать устройство
  от учетной записи) и новый активационный код;
- `3036` – отключиться от облачного сервера (если подключение установлено) и
  переподключиться (если подключение разрешено);
- `43943` – перезапуск устройства;
- `43947` – перезапуск ПО;
- `52271` – запись изменений настроек в файл конфигурации;
- `52719` – сброс изменений в настройках к заводским значениям и запись в файл
  конфигурации;
- `53036` – отмена изменений в настройках и загрузка настроек из файла
  конфигурации.

### Группа параметров настройки ПО

#### Сервер WebAPI

Этот вспомогательный сервер используется Web-интерфейсом пользователя для
управления устройством.

**Изменение данных параметров не рекомендуется.**

| Параметр                                                   | Допустимые значения | Заводское значение | Описание                                                                                                                                                                                                                                                                          | Адрес(а) |
| ---------------------------------------------------------- | ------------------- | ------------------ | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | -------- |
| Интерфейс для сервера WebAPI                               | 0 / 1 / 2 / 3 / 255 | 1                  | 0 ¬– не используется;<br>1 – на локальном Loopback;<br>2 – на Ethernet;<br>3 – на Wi-Fi;<br>255 – на любом доступном                                                                                                                                                              | 250      |
| Порт сервера WebAPI                                        | 0...65535           | 8502               |                                                                                                                                                                                                                                                                                   | 251      |
| Время ожидания до повторного открытия порта сервера Web, с | 1...600             | 5                  |                                                                                                                                                                                                                                                                                   | 252      |
| Время простоя до отключения клиента Web, с                 | 15...3600           | 15                 |                                                                                                                                                                                                                                                                                   | 253      |
| Начальный уровень доступа клиента Web                      | 0 / 1 / 2           | 2                  | 0 – доступ к параметрам идентификации и вводу пароля (для чтения и записи остальных параметров требуется ввод пароля);<br>1 – полный доступ для чтения, доступ для ввода пароля (для записи остальных параметров требуется ввод пароля);<br>2 – полный доступ для чтения и записи | 254      |
| Время ожидания ответа клиенту Web, мс                      | 1...60000           | 8000               |                                                                                                                                                                                                                                                                                   | 255      |
| Максимальное количество обрабатываемых запросов            | -                   | 1                  | 1 – запросы принимаются по одному                                                                                                                                                                                                                                                 | 256      |
| Максимальное количество подключений к серверу              | 1...20              | 4                  | Максимальное количество одновременно подключенных клиентов Web. При превышении данного числа возможна генерация ошибок HTML и пустых ответов на запросы, либо отключение новых клиентов                                                                                           | 257      |
| Период между приемами данных сервером Web, мкс             | 1...65535           | 5000               | Время сна при простоях данного порта. Определяет загрузку процессора<br>1 – минимальная задержка пакетов, максимальная загрузка                                                                                                                                                   | 258      |
| Интерфейс HTML                                             | 0 / 1               | 0                  | 0 – только API (см. "Web-API");<br>1 – API и Web страницы                                                                                                                                                                                                                         | 259      |

#### Обратное подключение к облачному серверу

Подклчюение по заданному адресу устанавливается и поддерживается для приема
запросов Modbus TCP. Это позволяет удаленно управлять изделием и подключенными к
нему устройствами по правам, выдаваемым облачным сервером. В случае, если
изделие не активируется на облачном сервере (для использования удаленного
управления), подключение остается в резерве до активации.

Не рекомендуется запрещать данное подключение, даже если удаленное управление не
требуется пользователем.

| Параметр                                                              | Допустимые значения | Заводское значение   | Описание                                                                                                                                                                                                                                   | Адрес(а)  |
| --------------------------------------------------------------------- | ------------------- | -------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | --------- |
| Интерфейс для обратного подключения                                   | 0 / 1 / 2 / 3 / 255 | 255                  | 0 ­– запрещено;<br>1 – через локальный Loopback;<br>2 – через Ethernet;<br>3 – через Wi-Fi;<br>255 – через любой доступный                                                                                                                 | 300       |
| Порт облачного сервера                                                | 1...65535           | 20502                |                                                                                                                                                                                                                                            | 301       |
| Время ожидания до повторного подключения к облачному серверу, с       | 1...600             | 5                    |                                                                                                                                                                                                                                            | 302       |
| Время простоя до отключения от облачного сервера, с                   | 60...3600           | 90                   |                                                                                                                                                                                                                                            | 303       |
| Отправка идентификационных данных при подключении к облачному серверу | 0 / 1               | 1                    |                                                                                                                                                                                                                                            | 304       |
| Таймаут ожидания ответа облачному серверу, мс                         | 1...60000           | 1500                 | При отсутствии ответа дольше заданного времени вместо ответа генерируется и отправляется исключение Modbus TCP                                                                                                                             | 305       |
| Максимальное количество запросов, отправляемое облачным сервером      | 1...20              | 8                    | Параметр используется для одновременной отправки запросов и/или ответов (позволяет оптимизировать траффик, особенно для беспроводных или мобильных подключений) 1 – запросы всегда задерживаются клиентом до обработки предыдущих запросов | 306       |
| Адрес облачного сервера                                               | Строка символов     | `modbus.overvis.com` | Имя хоста или адрес IP облачного сервера                                                                                                                                                                                                   | 336...399 |

#### Шлюз Modbus

При получении любых запросов Modbus, каждый запрос проходит шлюз и передается на
первое направление, под правило которого подходит этот запрос.

| Параметр                                                   | Допустимые значения | Заводское значение | Описание                                                                                                                                           | Адрес(а) |
| ---------------------------------------------------------- | ------------------- | ------------------ | -------------------------------------------------------------------------------------------------------------------------------------------------- | -------- |
| Маршрут на виртуальное устройство                          | 0 / 1               | 1                  | 0 – внутреннее виртуальное устройство недоступно;<br>1 – виртуальное устройство доступно                                                           | 400      |
| Адрес виртуального устройства                              | 0...255             | 111                | Запросы по этому адресу обрабатываются внутренним виртуальным устройством                                                                          | 401      |
| Первый адрес маршрута на последовательный порт №0          | 0...255             | 1                  | Запросы по адресам в этом диапазоне передаются через последовательный порт №0. Если последний адрес меньше первого, то данный порт недоступен      | 402      |
| Последний адрес маршрута на последовательный порт №0       | 0...255             | 255                |                                                                                                                                                    | 403      |
| Первый адрес маршрута на последовательный порт №1          | 0...255             | 1                  | Запросы по адресам в этом диапазоне передаются через последовательный порт №1. Если последний адрес меньше первого, то данный порт недоступен      | 404      |
| Последний адрес маршрута на последовательный порт №1       | 0...255             | 0                  |                                                                                                                                                    | 405      |
| Первый адрес маршрута на клиент (удаленного сервера) №0    | 0...255             | 1                  | Запросы по адресам в этом диапазоне передаются на удаленный сервер Modbus TCP №0. Если последний адрес меньше первого, то данный сервер недоступен | 406      |
| Последний адрес маршрута на клиент (удаленного сервера) №0 | 0...255             | 255                |                                                                                                                                                    | 407      |
| Первый адрес маршрута на клиент (удаленного сервера) №1    | 0...255             | 1                  | Запросы по адресам в этом диапазоне передаются на удаленный сервер Modbus TCP №1. Если последний адрес меньше первого, то данный сервер недоступен | 408      |
| Последний адрес маршрута на клиент (удаленного сервера) №1 | 0...255             | 0                  |                                                                                                                                                    | 409      |

#### Сервер Modbus TCP

Сервер открывает порт и принимает подключения клиентов Modbus TCP. Устройства,
подключенные к изделию, становятся доступными для клиентов этого сервера.
Подключившиеся клиенты могут отправлять запросы на изделие или подключенные к
нему устройства.

| Параметр                                                                     | Допустимые значения | Заводское значение | Описание                                                                                                                                                                                                                                                                                                                                                           | Адрес(а) |
| ---------------------------------------------------------------------------- | ------------------- | ------------------ | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | -------- |
| Интерфейс для сервера Modbus TCP                                             | 0 / 1 / 2 / 3 / 255 | 255                | 0 ­– не используется;<br>1 – на локальном Loopback;<br>2 – на Ethernet;<br>3 – на Wi-Fi;<br>255 – на любом доступном                                                                                                                                                                                                                                               | 450      |
| Порт сервера Modbus TCP                                                      | 1...65535           | 502                |                                                                                                                                                                                                                                                                                                                                                                    | 451      |
| Время ожидания до повторного открытия порта сервера Modbus TCP, с            | 1...600             | 5                  |                                                                                                                                                                                                                                                                                                                                                                    | 452      |
| Время простоя до отключения удаленного клиента Modbus TCP, с                 | 15...3600           | 60                 |                                                                                                                                                                                                                                                                                                                                                                    | 453      |
| Начальный уровень доступа удаленного клиента Modbus TCP                      | 0 / 1 / 2           | 2                  | 0 – доступ к параметрам идентификации и вводу пароля (для чтения и записи остальных параметров требуется ввод пароля);<br>1 – полный доступ для чтения, доступ для ввода пароля (для записи остальных параметров требуется ввод пароля);<br>2 – полный доступ для чтения и записи                                                                                  | 454      |
| Таймаут ожидания ответа удаленному клиенту Modbus TCP, мс                    | 1...60000           | 1500               | При отсутствии ответа дольше заданного времени, вместо ответа генерируется и отправляется исключение Modbus TCP                                                                                                                                                                                                                                                    | 455      |
| Максимальное количество запросов, отправляемое удаленным клиентом Modbus TCP | 1...20              | 1                  | Параметр используется для одновременной отправки запросов и/или ответов (позволяет оптимизировать траффик, удаленный клиент может отправлять несколько запросов одновременно и должен обрабатывать по несколько ответов одновременно, либо иметь входящий буфер достаточного объема)<br>1 – запросы всегда задерживаются клиентом до обработки предыдущих запросов | 456      |
| Максимальное количество подключений к серверу                                | 1...20              | 4                  | Максимальное количество одновременно подключенных удаленных клиентов Modbus TCP. При превышении данного числа возможна генерация исключений в ответ на запросы, либо отключение новых клиентов                                                                                                                                                                     | 457      |
| Период между приемами данных через порт Modbus TCP, мкс                      | 1...65535           | 2000               | Время сна при простоях данного порта\*. Определяет загрузку процессора<br>1 – минимальная задержка пакетов, максимальная загрузка                                                                                                                                                                                                                                  | 458      |

#### Последовательный порт №0

В режиме Master изделие выступает ведущим Modbus на этом порту. Другие
устройства на этом порту считаются ведомыми, _подключенными_ к изделию. Порт
открывается как одно из направлений, на которое могут передаваться запросы,
проходящие шлюз. Принятые ответы возвращаются стороне, от которой пришел запрос.

В режиме Slave изделие выступает ведомым Modbus на этом порту. Устройства,
подключенные на других направлениях, становятся доступными для ведущего Modbus
на этом порту. Порт открывается для приема запросов на изделие или подключенные
к нему устройства.

| Параметр                                                         | Допустимые значения                                                                    | Заводское значение | Описание                                                                                                                                                                                                                                                      | Адрес(а)  |
| ---------------------------------------------------------------- | -------------------------------------------------------------------------------------- | ------------------ | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | --------- |
| Скорость, б/с                                                    | 300 / 600 / 1200 / 1800 / 2400 / 4800 / 9600 / 19200 / 38400 / 57600 / 115200 / 230400 | 9600               |                                                                                                                                                                                                                                                               | 500...501 |
| Формат байта                                                     | 1 / 2 / 3 / 4                                                                          | 3                  | 1 – бит четности отсутствует, 1 стоп-бит;<br>2 – бит четности отсутствует, 2 стоп-бита, или бит четности установлен, 1 стоп-бит (MARK);<br>3 – бит четности с проверкой на чет, 1 стоп-бит (EVEN);<br>4 – бит четности с проверкой на нечет, 1 стоп-бит (ODD) | 502       |
| Формат кадра Modbus                                              | 0 / 1 / 2 / 3                                                                          | 0                  | 0 – Modbus RTU Master;<br>1 – Modbus ASCII Master;<br>2 – Modbus RTU Slave;<br>3 – Modbus ASCII Slave                                                                                                                                                         | 503       |
| Время ожидания начала ответа Modbus, мс                          | 1...60000                                                                              | 1000               |                                                                                                                                                                                                                                                               | 504       |
| Время ожидания очередного байта в ответе Modbus RTU, мс          | 1...60000                                                                              | 50                 |                                                                                                                                                                                                                                                               | 505       |
| Время ожидания очередного символа в ответе Modbus ASCII, мс      | 1...60000                                                                              | 100                |                                                                                                                                                                                                                                                               | 506       |
| Время ожидания до повторного открытия последовательного порта, с | 1...600                                                                                | 5                  |                                                                                                                                                                                                                                                               | 507       |
| Интерфейс последовательного порта                                | Строка символов                                                                        | `ttyUSB0`          | \*\*                                                                                                                                                                                                                                                          | 530...549 |

#### Последовательный порт №1

В режиме Master изделие выступает ведущим Modbus на этом порту. Другие
устройства на этом порту считаются ведомыми, _подключенными_ к изделию. Порт
открывается как одно из направлений, на которое могут передаваться запросы,
проходящие шлюз. Принятые ответы возвращаются стороне, от которой пришел запрос.

В режиме Slave изделие выступает ведомым Modbus на этом порту. Устройства,
подключенные на других направлениях, становятся доступными для ведущего Modbus
на этом порту. Порт открывается для приема запросов на изделие или подключенные
к нему устройства.

| Параметр                                                         | Допустимые значения                                                                    | Заводское значение | Описание                                                                                                                                                                                                                                                      | Адрес(а)  |
| ---------------------------------------------------------------- | -------------------------------------------------------------------------------------- | ------------------ | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | --------- |
| Скорость, б/с                                                    | 300 / 600 / 1200 / 1800 / 2400 / 4800 / 9600 / 19200 / 38400 / 57600 / 115200 / 230400 | 9600               |                                                                                                                                                                                                                                                               | 550...551 |
| Формат байта                                                     | 1 / 2 / 3 / 4                                                                          | 3                  | 1 – бит четности отсутствует, 1 стоп-бит;<br>2 – бит четности отсутствует, 2 стоп-бита, или бит четности установлен, 1 стоп-бит (MARK);<br>3 – бит четности с проверкой на чет, 1 стоп-бит (EVEN);<br>4 – бит четности с проверкой на нечет, 1 стоп-бит (ODD) | 552       |
| Формат кадра Modbus                                              | 0 / 1 / 2 / 3                                                                          | 0                  | 0 – Modbus RTU Master;<br>1 – Modbus ASCII Master;<br>2 – Modbus RTU Slave;<br>3 – Modbus ASCII Slave                                                                                                                                                         | 553       |
| Время ожидания начала ответа Modbus, мс                          | 1...60000                                                                              | 1000               |                                                                                                                                                                                                                                                               | 554       |
| Время ожидания очередного байта в ответе Modbus RTU, мс          | 1...60000                                                                              | 50                 |                                                                                                                                                                                                                                                               | 555       |
| Время ожидания очередного символа в ответе Modbus ASCII, мс      | 1...60000                                                                              | 100                |                                                                                                                                                                                                                                                               | 556       |
| Время ожидания до повторного открытия последовательного порта, с | 1...600                                                                                | 5                  |                                                                                                                                                                                                                                                               | 557       |
| Интерфейс последовательного порта                                | Строка символов                                                                        | `ttyUSB1`          | \*\*                                                                                                                                                                                                                                                          | 580...599 |

#### Клиент Modbus TCP №0

Подключение по заданному адресу устанавливается и поддерживается как одно из
направлений, на которое могут передаваться запросы, проходящие шлюз. Принятые
ответы возвращаются стороне, от которой пришел запрос. Другие устройства,
доступные через удаленный сервер, считаются ведомыми, _подключенными_ к изделию.

| Параметр                                                            | Допустимые значения | Заводское значение | Описание                                                                                                                                                                                                                                                                                                                                                | Адрес(а)  |
| ------------------------------------------------------------------- | ------------------- | ------------------ | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | --------- |
| Интерфейс для подключения клиента к удаленному Modbus TCP серверу   | 0 / 1 / 2 / 3 / 255 | 255                | 0 ­– не используется;<br>1 – через локальный Loopback;<br>2 – через Ethernet;<br>3 – через Wi-Fi;<br>255 – через любой доступный                                                                                                                                                                                                                        | 700       |
| Порт удаленного сервера                                             | 1...65535           | 502                | \*\*\*                                                                                                                                                                                                                                                                                                                                                  | 701       |
| Время ожидания до повторного подключения к удаленному серверу, с    | 1...600             | 5                  |                                                                                                                                                                                                                                                                                                                                                         | 702       |
| Адрес Modbus для управления удаленным сервером                      | –                   | 0                  | 0 – неизвестный тип сервера, специальное управление не используется                                                                                                                                                                                                                                                                                     | 703       |
| Период молчания до отключения удаленного сервера от клиента, с      | –                   | 0                  | Служит для периодических чтений с сервера для поддержания подключения.<br>0 – не отслеживается                                                                                                                                                                                                                                                          | 704       |
| Время ожидания ответа удаленного сервера на запрос, мс              | 1...60000           | 8000               | Если ответ на запрос не получен за данный период, ожидание ответа прекращается, а клиент генерирует и возвращает ошибку                                                                                                                                                                                                                                 | 705       |
| Максимальное количество запросов, обрабатываемое удаленным сервером | 1...20              | 1                  | Параметр используется для одновременной отправки запросов и/или ответов (позволяет оптимизировать траффик, сервер может отправлять несколько ответов одновременно и должен обрабатывать по несколько запросов одновременно либо иметь входящий буфер достаточного объема)<br>1 – запросы всегда задерживаются клиентом до обработки предыдущих запросов | 706       |
| Адрес удаленного сервера Modbus TCP                                 | Адрес IPv4          | `192.168.1.121`    | \*\*\*                                                                                                                                                                                                                                                                                                                                                  | 707...710 |

#### Клиент Modbus TCP №1

Подключение по заданному адресу устанавливается и поддерживается как одно из
направлений, на которое могут передаваться запросы, проходящие шлюз. Принятые
ответы возвращаются стороне, от которой пришел запрос. Другие устройства,
доступные через удаленный сервер, считаются ведомыми, _подключенными_ к изделию.

| Параметр                                                            | Допустимые значения | Заводское значение | Описание                                                                                                                                                                                                                                                                                                                                                | Адрес(а)  |
| ------------------------------------------------------------------- | ------------------- | ------------------ | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | --------- |
| Интерфейс для подключения клиента к удаленному Modbus TCP серверу   | 0 / 1 / 2 / 3 / 255 | 255                | 0 ­– не используется;<br>1 – через локальный Loopback;<br>2 – через Ethernet;<br>3 – через Wi-Fi;<br>255 – через любой доступный                                                                                                                                                                                                                        | 750       |
| Порт удаленного сервера                                             | 1...65535           | 502                | \*\*\*                                                                                                                                                                                                                                                                                                                                                  | 751       |
| Время ожидания до повторного подключения к удаленному серверу, с    | 1...600             | 5                  |                                                                                                                                                                                                                                                                                                                                                         | 752       |
| Адрес Modbus для управления удаленным сервером                      | –                   | 0                  | 0 – неизвестный тип сервера, специальное управление не используется                                                                                                                                                                                                                                                                                     | 753       |
| Период молчания до отключения удаленного сервера от клиента, с      | –                   | 0                  | Служит для периодических чтений с сервера для поддержания подключения.<br>0 – не отслеживается                                                                                                                                                                                                                                                          | 754       |
| Время ожидания ответа удаленного сервера на запрос, мс              | 1...60000           | 8000               | Если ответ на запрос не получен за данный период, ожидание ответа прекращается, а клиент генерирует и возвращает ошибку                                                                                                                                                                                                                                 | 755       |
| Максимальное количество запросов, обрабатываемое удаленным сервером | 1...20              | 4                  | Параметр используется для одновременной отправки запросов и/или ответов (позволяет оптимизировать траффик, сервер может отправлять несколько ответов одновременно и должен обрабатывать по несколько запросов одновременно либо иметь входящий буфер достаточного объема)<br>1 – запросы всегда задерживаются клиентом до обработки предыдущих запросов | 756       |
| Адрес удаленного сервера Modbus TCP                                 | Адрес IPv4          | `192.168.1.122`    | \*\*\*                                                                                                                                                                                                                                                                                                                                                  | 757...760 |

#### Разное

| Параметр       | Допустимые значения | Заводское значение | Описание                                                                                                                      | Адрес(а)  |
| -------------- | ------------------- | ------------------ | ----------------------------------------------------------------------------------------------------------------------------- | --------- |
| Имя хоста      | Строка символов     | `OPCB-221`         |                                                                                                                               | 900...963 |
| Пароль доступа | Строка символов     | `0000`             | Параметр доступен только для записи. При чтении возвращается строка `********` (либо пустая строка, если пароль отсутствует). | 968...999 |

#### Примечания

\* – параметр используется для всех Modbus TCP совместимых портов (сервер Modbus
TCP, клиент Modbus TCP, подключение к облачному серверу)

\*\* – параметр не должен повторяться у других последовательных портов

\*\*\* – комбинация адреса и порта удаленного сервера не должна повторяться у
других клиентов Modbus TCP

### Группа параметров состояния обратного подключения к облачному серверу

Параметры используются облачным сервером для идентификации изделия при обратном
подключении.

| Параметр                    | Описание                                                                                                                                                                                                                                                       | Адрес(а)      |
| --------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------- |
| Тип устройства              | Код идентификации у производителя (42 – OPCB-221)                                                                                                                                                                                                              | 1000          |
| Версия                      | Версия ПО, обеспечивающего связь по протоколу Modbus                                                                                                                                                                                                           | 1001          |
| Уникальный адрес MAC        | Глобально уникальный адрес MAC-48, который используется для идентификации облачным сервером                                                                                                                                                                    | 1002 ... 1007 |
| Флаги обратного подключения | Бит 0 – подтверждение уникальности адреса MAC (рег. 1002..1007).<br>Бит 1 – задан код активации.<br>Бит 2 – изделие запрашивает новый код активации (например, после локальной команды деактивации обратного подключения).<br>Бит 3 – подключение активировано | 1008          |

### Группа параметров управления обратным подключением к облачному серверу

Параметры используются облачным сервером для управления обратным подключением.

| Параметр                          | Допустимые значения                         | Описание                                                                                                                                                                                                                                                                                                                                                                        | Адрес(а)      |
| --------------------------------- | ------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------- |
| Код активации на облачном сервере | 0 / 10 000 000 ... 99 999 999 / 100 000 000 | Код из 8 цифр, который передается облачным сервером при обратном подключении и может быть прочитан локально пользователем. При вводе кода пользователем на облачном сервере это обратное подключение активируется (передается данному пользователю на сервере).<br>0 – подключение активировано;<br>10 000 000 ... 99 999 999 – код активации;<br>100 000 000 – код не присвоен | 1009 ... 1010 |

### Группа параметров состояния

| Параметр                                           | Описание                                                                                                                                                                                                                                                                                                                           | Адрес(а) |
| -------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | -------- |
| Уровень доступа                                    | 0 – доступ к параметрам идентификации и вводу пароля (для чтения и записи остальных параметров требуется ввод пароля);<br>1 – полный доступ для чтения, доступ для ввода пароля (для записи остальных параметров требуется ввод пароля);<br>2 – полный доступ для чтения и записи;<br>3 – специальный доступ для облачного сервера | 1300     |
| Уровень защиты                                     | 0 – защита и шифрование не поддерживаются \*                                                                                                                                                                                                                                                                                       | 1301     |
| Количество клиентов сервера Modbus TCP             |                                                                                                                                                                                                                                                                                                                                    | 1303     |
| Интерфейс облачного сервера                        | 0 ­– не подключен;<br>1 – через локальный Loopback;<br>2 – через Ethernet;<br>3 – через Wi-Fi;<br>255 – через другой интерфейс                                                                                                                                                                                                     | 1304     |
| Интерфейс клиента удаленного сервера Modbus TCP №0 | 0 ­– не подключен;<br>1 – через локальный Loopback;<br>2 – через Ethernet;<br>3 – через Wi-Fi;<br>255 – через другой интерфейс                                                                                                                                                                                                     | 1305     |
| Интерфейс клиента удаленного сервера Modbus TCP №1 | 0 ­– не подключен;<br>1 – через локальный Loopback;<br>2 – через Ethernet;<br>3 – через Wi-Fi;<br>255 – через другой интерфейс                                                                                                                                                                                                     | 1306     |
| Текущий адрес IP интерфейса Ethernet               |                                                                                                                                                                                                                                                                                                                                    | 1310     |
| Текущий адрес IP интерфейса Wi-Fi                  |                                                                                                                                                                                                                                                                                                                                    | 1330     |

\* - канал может быть частично или полностью шифрован сторонними средствами
(например, закрытый канал Wi-Fi)

### Группа параметров настройки интерфейсов

При первоначальной настройке изделия, как правило, необходимо установить данные
параметры для обеспечения связи с изделием и подключения его к Интернет.

#### Настройки Ethernet

| Параметр           | Допустимые значения | Заводское значение                 | Описание | Адрес(а)    |
| ------------------ | ------------------- | ---------------------------------- | -------- | ----------- |
| Адрес IP           | Адрес IPv4          | 192.168.1.120                      |          | 1500...1503 |
| Маска подсети      | Адрес IPv4          | 255.255.255.0                      |          | 1504...1507 |
| Адрес шлюза        | Адрес IPv4          | 192.168.1.1                        |          | 1508...1511 |
| Адрес DNS 1        | Адрес IPv4          | 192.168.1.1                        |          | 1512...1515 |
| Адрес DNS 2        | Адрес IPv4          | 8.8.8.8                            |          | 1516...1519 |
| Использование DHCP | 0 / 1               | 1                                  |          | 1520        |
| Имя устройства     | Строка символов     | Зависит от ОС (как правило `eth0`) |          | 1530...1549 |

#### Настройки Wi-Fi

| Параметр                          | Допустимые значения | Заводское значение                  | Описание                                                                                                                      | Адрес(а)    |
| --------------------------------- | ------------------- | ----------------------------------- | ----------------------------------------------------------------------------------------------------------------------------- | ----------- |
| Адрес IP своей точки доступа      | Адрес IPv4          | `192.168.4.1`                       | Адрес используется в режиме точки доступа (вводится в браузере для подключения и настройки)                                   | 1700...1703 |
| Маска подсети своей точки доступа | Адрес IPv4          | `255.255.255.0`                     |                                                                                                                               | 1704...1707 |
| Первый адрес своего DHCP          | Адрес IPv4          | `192.168.4.100`                     | Диапазон используется в режиме точки доступа (определяет количество подключаемых устройств)                                   | 1708...1711 |
| Последний адрес своего DHCP       | Адрес IPv4          | `192.168.4.110`                     |                                                                                                                               | 1712...1715 |
| Режим Wi-Fi                       | 0 / 1 / 2           | 0                                   | 0 – Wi-Fi отключен;<br>1 – станция (клиент) Wi-Fi ;<br>2 – точка доступа (сервер) Wi-Fi                                       | 1716        |
| Код страны по ISO1366             | 1...999             | 616                                 | Перед использованием Wi-Fi необходимо правильно указать код страны размещения передатчика                                     | 1717        |
| Имя устройства                    | Строка символов     | Зависит от ОС (как правило `wlan0`) |                                                                                                                               | 1730...1749 |
| SSID своей точки доступа          | Строка символов     | -                                   | Пустая строка означает имя по-умолчанию `OPCB_XXXXXX` (где XXXXXX - последние 6 знаков адреса MAC на наклейке изделия)        | 1750...1781 |
| Пароль своей точки доступа        | Строка символов     | `12345678`                          | Параметр доступен только для записи. При чтении возвращается строка `********` (либо пустая строка, если пароль отсутствует). | 1785...1848 |
| Адрес IP                          | Адрес IPv4          | `192.168.1.121`                     |                                                                                                                               | 1850...1853 |
| Маска подсети                     | Адрес IPv4          | `255.255.255.0`                     |                                                                                                                               | 1854...1857 |
| Адрес шлюза                       | Адрес IPv4          | `192.168.1.1`                       |                                                                                                                               | 1858...1861 |
| Адрес DNS 1                       | Адрес IPv4          | `192.168.1.1`                       |                                                                                                                               | 1862...1865 |
| Адрес DNS 2                       | Адрес IPv4          | `8.8.8.8`                           |                                                                                                                               | 1866...1869 |
| Использование DHCP                | 0 / 1               | 1                                   |                                                                                                                               | 1870        |
| SSID точки доступа                | Строка символов     | `YOUR_SSID`                         |                                                                                                                               | 1900...1931 |
| Пароль точки доступа              | Строка символов     | `YOUR_PASSWORD`                     | Параметр доступен только для записи. При чтении возвращается строка `********` (либо пустая строка, если пароль отсутствует). | 1935...1998 |

### Группа пользовательских регистров

| Параметр         | Допустимые значения | Начальное значение | Описание                                                                                                                          | Адрес(а)    |
| ---------------- | ------------------- | ------------------ | --------------------------------------------------------------------------------------------------------------------------------- | ----------- |
| Пользовательский | 0...65535           | 0                  | Может использоваться для передачи данных облачным сервером и другими устройствами между собой. Данные обнуляются при перезапуске. | 5000...5999 |
