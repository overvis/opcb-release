"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[205],{7863:function(e,n,t){t.d(n,{Z:function(){return d}});var r=t(6521),i=t(2952),o=t(5388),s=t(1876),c=t(6386),a=t(8202),l=t(4821);function d(e){let{icon:n,text:t,description:d,children:u,color:p,...g}=e;return(0,r.jsx)(i.M,{h:"100%",p:"xs",...g,children:(0,r.jsxs)(o.K,{p:"sm",spacing:"xs",align:"center",justify:"center",children:[(0,r.jsxs)(s.Z,{spacing:"xs",align:"start",position:"center",children:[(0,r.jsx)(c.k,{color:p||"black",size:"md",variant:"outline",sx:{border:"none"},children:n||(0,r.jsx)(l.Z,{})}),(0,r.jsx)(a.x,{color:p||"black",align:"center",children:t})]}),d&&(0,r.jsx)(a.x,{size:"xs",color:"dimmed",align:"center",children:d}),u]})})}},1120:function(e,n,t){t.d(n,{Z:function(){return b}});var r=t(6521),i=t(2104),o=t(1876),s=t(8741),c=t(5597),a=t(5570),l=t(8861),d=t(4427),u=t(2636),p=t(4534),g=t(7357),h=t(1956),x=t(2979),m=t(8914),f=t.n(m),j=t(9296);let v=(0,i.k)(e=>({navlink:{color:e.colors.blue[6],"&:hover":{color:e.colors.dark,backgroundColor:"transparent"},"&[data-active]":{color:e.colors.dark,backgroundColor:"transparent",borderRight:"2px solid #000",pointerEvents:"none"}}}));function b(e){let{children:n,pageId:t,title:i}=e,{classes:m}=v();return(0,r.jsx)(j.Z,{pageTitle:"Connections :: ".concat(i),children:(0,r.jsxs)(o.Z,{align:"stretch",position:"left",noWrap:!0,children:[(0,r.jsx)(s.w,{width:{sm:200},ml:"-sm",mih:0,height:"auto",children:(0,r.jsxs)(s.w.Section,{children:[(0,r.jsx)(c.O,{component:f(),href:"/connections/modbus-rs485",label:"Modbus over RS-485",icon:(0,r.jsx)(l.Z,{size:16,stroke:1.5}),active:"modbus-rs485"===t,className:m.navlink}),(0,r.jsx)(c.O,{component:f(),href:"/connections/modbus-tcp-server",label:"Modbus TCP Server",icon:(0,r.jsx)(d.Z,{size:16,stroke:1.5}),active:"modbus-tcp-server"===t,className:m.navlink}),(0,r.jsx)(c.O,{component:f(),href:"/connections/modbus-tcp-client",label:"Modbus TCP Client",icon:(0,r.jsx)(u.Z,{size:16,stroke:1.5}),active:"modbus-tcp-client"===t,className:m.navlink}),(0,r.jsx)(c.O,{component:f(),href:"/connections/opcb-modbus-access",label:"OPCB Modbus Access",icon:(0,r.jsx)(p.Z,{size:16,stroke:1.5}),active:"opcb-modbus-access"===t,className:m.navlink}),(0,r.jsx)(c.O,{component:f(),href:"/connections/lora-sens",label:"LoRa Sens",icon:(0,r.jsx)(g.Z,{size:16,stroke:1.5}),active:"lora-sens"===t,className:m.navlink}),(0,r.jsx)(c.O,{component:f(),href:"/connections/mqtt",label:"MQTT Broker",icon:(0,r.jsx)(h.Z,{size:16,stroke:1.5}),active:"mqtt"===t,className:m.navlink}),(0,r.jsx)(c.O,{component:f(),href:"/connections/overvis-modbus-tcp",label:"Overvis Modbus TCP",icon:(0,r.jsx)(x.Z,{size:16,stroke:1.5}),active:"overvis-modbus-tcp"===t,className:m.navlink})]})}),(0,r.jsx)(a.x,{sx:{flexGrow:1},children:n})]})})}},2404:function(e,n,t){t.d(n,{Z:function(){return o}});var r=t(6521),i=t(7863);function o(e){let{error:n,...t}=e;return(0,r.jsx)(i.Z,{...t,p:"xs",bg:"gray.0",color:n?"red":"gray"})}},9578:function(e,n,t){var r=t(2104);n.Z=(0,r.k)(e=>({dirtyInput:{backgroundColor:e.colors.blue[0]}}))},1565:function(e,n,t){t.d(n,{Z:function(){return S}});var r=t(6521),i=t(5388),o=t(1876),s=t(8202),c=t(5885),a=t(2076),l=t(4420),d=t(7073),u=t(7272),p=t(1251),g=t(8920),h=t(5721),x=t(7856),m=t(6338),f=t(5570),j=t(681);function v(e){let{children:n,socketState:t}=e;if(t===j.kQ.UNINSTANTIATED||t===j.kQ.CONNECTING)return(0,r.jsx)(s.x,{fz:13,fs:"italic",ta:"center",c:"dimmed",p:30,children:"Connecting to log socket..."});if(t===j.kQ.CLOSING||t===j.kQ.CLOSED)return(0,r.jsx)(s.x,{fz:13,fs:"italic",ta:"center",c:"red",p:30,children:"Log socket closed."});if(n.length<1)return(0,r.jsx)(s.x,{fz:13,fs:"italic",ta:"center",c:"dimmed",p:30,children:"No entries."});let i=n.map((e,n)=>(0,r.jsx)(b,{children:e},e.id));return(0,r.jsx)(f.x,{fz:13,ff:"monospace",children:i})}let b=(0,h.memo)(function(e){let n,{children:t}=e,i="#"===t.type?"dimmed":">"===t.type?"green.4":"green.6";if("raw"===t.content.kind)n=(0,r.jsx)(s.x,{span:!0,c:"dimmed",inherit:!0,children:t.content.payload});else if("error"===t.content.kind)n=(0,r.jsx)(s.x,{span:!0,c:"red",inherit:!0,children:t.content.payload});else{let e=t.content;n=(0,r.jsxs)(r.Fragment,{children:[e.prefix&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s.x,{span:!0,c:"gray.5",inherit:!0,children:e.prefix})," "]}),(0,r.jsx)(s.x,{span:!0,c:"indigo",inherit:!0,children:e.deviceId})," ",(0,r.jsx)(s.x,{span:!0,c:e.errorFunctionCode?"red":"blue",inherit:!0,children:e.functionCode})," ",(0,r.jsxs)(s.x,{span:!0,c:e.errorFunctionCode?"red":"green",inherit:!0,children:[e.payload," "]}),e.crc&&(0,r.jsx)(s.x,{span:!0,c:"gray.6",inherit:!0,children:e.crc}),e.description&&(0,r.jsxs)(s.x,{span:!0,c:"gray.5",inherit:!0,fs:"italic",children:[" # ",e.description]})]})}return(0,r.jsxs)(f.x,{style:{whiteSpace:"nowrap"},children:[(0,r.jsx)(s.x,{span:!0,c:"gray.7",inherit:!0,children:t.date})," ",(0,r.jsx)(s.x,{span:!0,c:">"===t.type?"orange.6":"<"===t.type?"pink.6":"dimmed",inherit:!0,children:">"===t.type?"TX >":"<"===t.type?"RX <":"#"})," ",(0,r.jsx)(s.x,{span:!0,c:i,inherit:!0,children:n})]})},(e,n)=>e.children.id===n.children.id);function S(e){let{mode:n,streamName:t}=e,f=window.location.hostname,j=window.location.port,b="ws://".concat(f,":").concat(j,"/api/log/stream/").concat(t,"/"),[S,y]=(0,h.useState)([]),{lastMessage:k,readyState:C}=(0,x.useWebSocket)(b),[w,R]=(0,h.useState)(!1);(0,h.useEffect)(()=>{null===k||w||y(e=>e.concat((0,m.Gt)(k.data,n)).slice(-1e3))},[k,y]);let Z=(0,l.V)({timeout:500});return(0,r.jsx)(r.Fragment,{children:(0,r.jsxs)(i.K,{spacing:0,h:"100%",maw:"870px",children:[(0,r.jsxs)(o.Z,{sx:e=>({borderBottom:"1px solid ".concat(e.colors.gray[3])}),py:"xs",children:[(0,r.jsx)(s.x,{size:"sm",transform:"uppercase",weight:700,color:"gray.9",children:"Real-time transfer log"}),(0,r.jsxs)(c.z,{compact:!0,variant:"subtle",radius:"lg",size:"xs",onClick:()=>{Z.copy(S.map(e=>e.raw).join("\n"))},children:[(0,r.jsx)(d.Z,{size:12,style:{marginRight:4}}),"Copy"]}),(0,r.jsxs)(c.z,{compact:!0,variant:"subtle",radius:"lg",size:"xs",bg:w?"gray.3":"",onClick:()=>R(!w),children:[w?(0,r.jsx)(u.Z,{size:12,style:{marginRight:4}}):(0,r.jsx)(p.Z,{size:12,style:{marginRight:4}}),w?"Resume":"Pause"]}),(0,r.jsxs)(c.z,{compact:!0,variant:"subtle",radius:"lg",size:"xs",onClick:()=>y([]),children:[(0,r.jsx)(g.Z,{size:12,style:{marginRight:4}}),"Clear"]})]}),(0,r.jsx)(a.x,{style:{height:"550px"},sx:{flexGrow:1},children:(0,r.jsx)(v,{socketState:C,children:S})})]})})}},8581:function(e,n,t){t.d(n,{Z:function(){return x}});var r=t(6521),i=t(5721),o=t(594),s=t(7961),c=t(5388),a=t(1876),l=t(6386),d=t(8202),u=t(9011),p=t(5570),g=t(1771);function h(e){let n="connected"===e.status?"green":"warn"===e.status?"orange":"disconnected"===e.status?"red":"gray";return(0,r.jsx)(s.X,{h:"100%",withBorder:!0,children:(0,r.jsxs)(c.K,{spacing:0,h:"100%",children:[(0,r.jsxs)(a.Z,{position:"apart",align:"center",p:"xs",sx:e=>({borderBottom:"1px solid ".concat(e.colors.gray[3])}),children:[(0,r.jsxs)(a.Z,{spacing:"xs",noWrap:!0,children:[(0,r.jsx)(l.k,{color:n,variant:"light",children:e.icon}),(0,r.jsx)(d.x,{weight:500,c:n,transform:"uppercase",children:e.name}),e.addEl&&"string"==typeof e.addEl?(0,r.jsx)(d.x,{c:"dimmed",size:"sm",children:e.addEl}):e.addEl]}),(0,r.jsxs)(a.Z,{spacing:"xs",noWrap:!0,children:[e.addElRight,e.settingsAction&&(0,r.jsx)(u.A,{color:"blue",onClick:e.settingsAction,children:(0,r.jsx)(g.Z,{size:18})})]})]}),(0,r.jsx)(p.x,{bg:e.bg,h:"100%",children:e.children})]})})}function x(e){let[n,t]=(0,i.useState)(!1);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(o.Z,{...e.settings,opened:n,setOpened:t}),(0,r.jsx)(h,{...e,settingsAction:()=>t(!0),children:e.children})]})}},9016:function(e,n,t){t.d(n,{Z:function(){return c}});var r=t(6521),i=t(8202),o=t(1876),s=t(5388);function c(e){let{icon:n,name:t,nameColor:c="dimmed",mainVal:a,subVal:l,oneline:d}=e,u=!function(e){for(var n=arguments.length,t=Array(n>1?n-1:0),r=1;r<n;r++)t[r-1]=arguments[r];return"object"==typeof e&&null!==e&&t.every(n=>n in e)}(l,"value","level")?l:(0,r.jsxs)(r.Fragment,{children:[l.name&&l.name+" ",(0,r.jsx)(i.x,{span:!0,c:"good"===l.level?"green":"medium"===l.level?"orange":"bad"===l.level?"red":"dimmed",transform:"none",children:l.value})]}),p=(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(i.x,{weight:"bold",size:"xs",color:c,transform:"uppercase",children:t}),(0,r.jsx)(i.x,{fz:"xs",color:"black",children:a}),u&&(0,r.jsx)(i.x,{size:10,color:"dimmed",children:u})]});return d?(0,r.jsxs)(o.Z,{spacing:5,align:"baseline",noWrap:!0,children:[(0,r.jsx)("div",{style:{position:"relative",top:"2px",marginTop:"-5px",marginRight:"-4px"},children:n}),p]}):(0,r.jsxs)(o.Z,{spacing:0,align:"baseline",noWrap:!0,children:[(0,r.jsx)("div",{style:{position:"relative",top:"2px",marginTop:"-5px"},children:n}),(0,r.jsx)(s.K,{spacing:0,children:p})]})}t(5721)},7176:function(e,n,t){t.d(n,{M:function(){return c},u:function(){return a}});var r=t(6521),i=t(367),o=t(602),s=t(4239);async function c(e){(0,i.yK)("settings-save"),(0,i.c0)({id:"settings-save",withCloseButton:!0,autoClose:!1,loading:!0,icon:null,color:"orange",title:"Saving settings...",message:"Please wait while the new settings are applied..."});try{await e()}catch(e){(0,i.wD)({id:"settings-save",loading:!1,withCloseButton:!0,color:"red",icon:(0,r.jsx)(o.Z,{}),title:"Error saving settings",message:"There was an error saving settings. Please check form data and try again."}),console.error(e);return}(0,i.wD)({id:"settings-save",loading:!1,withCloseButton:!0,autoClose:1e3,color:"green",icon:(0,r.jsx)(s.Z,{}),title:"Settings saved",message:"Settings were saved and applied successfully."})}function a(e,n,t){return function(r){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"input";return function(e,n,t,r){let i=e.getInputProps(n,t);return{...i,classNames:{input:e.isDirty(n)&&r||void 0}}}(e,r,{...t,type:i},n)}}},6338:function(e,n,t){t.d(n,{$b:function(){return x},EH:function(){return l},Gt:function(){return f},J4:function(){return d},PW:function(){return h},_:function(){return a},aL:function(){return u},eq:function(){return s},gY:function(){return g},nM:function(){return p}});var r=t(4579),i=t(1318),o=t(5105).Buffer;let s=[{code:1,name:"Read Coils"},{code:2,name:"Read Discrete Inputs"},{code:3,name:"Read Holding Registers"},{code:4,name:"Read Input Registers"},{code:5,name:"Write Single Coil"},{code:6,name:"Write Single Register"},{code:7,name:"Read Exception Status"},{code:8,name:"Diagnostics"},{code:11,name:"Get Comm Event Counter"},{code:12,name:"Get Comm Event Log"},{code:15,name:"Write Multiple Coils"},{code:16,name:"Write Multiple Registers"},{code:17,name:"Report Server ID"},{code:20,name:"Read File Record"},{code:21,name:"Write File Record"},{code:22,name:"Mask Write Register"},{code:23,name:"Read/Write Multiple Registers"},{code:24,name:"Read FIFO Queue"},{code:43,name:"Read Device Identification"}],c=new Int32Array([0,49345,49537,320,49921,960,640,49729,50689,1728,1920,51009,1280,50625,50305,1088,52225,3264,3456,52545,3840,53185,52865,3648,2560,51905,52097,2880,51457,2496,2176,51265,55297,6336,6528,55617,6912,56257,55937,6720,7680,57025,57217,8e3,56577,7616,7296,56385,5120,54465,54657,5440,55041,6080,5760,54849,53761,4800,4992,54081,4352,53697,53377,4160,61441,12480,12672,61761,13056,62401,62081,12864,13824,63169,63361,14144,62721,13760,13440,62529,15360,64705,64897,15680,65281,16320,16e3,65089,64001,15040,15232,64321,14592,63937,63617,14400,10240,59585,59777,10560,60161,11200,10880,59969,60929,11968,12160,61249,11520,60865,60545,11328,58369,9408,9600,58689,9984,59329,59009,9792,8704,58049,58241,9024,57601,8640,8320,57409,40961,24768,24960,41281,25344,41921,41601,25152,26112,42689,42881,26432,42241,26048,25728,42049,27648,44225,44417,27968,44801,28608,28288,44609,43521,27328,27520,43841,26880,43457,43137,26688,30720,47297,47489,31040,47873,31680,31360,47681,48641,32448,32640,48961,32e3,48577,48257,31808,46081,29888,30080,46401,30464,47041,46721,30272,29184,45761,45953,29504,45313,29120,28800,45121,20480,37057,37249,20800,37633,21440,21120,37441,38401,22208,22400,38721,21760,38337,38017,21568,39937,23744,23936,40257,24320,40897,40577,24128,23040,39617,39809,23360,39169,22976,22656,38977,34817,18624,18816,35137,19200,35777,35457,19008,19968,36545,36737,20288,36097,19904,19584,35905,17408,33985,34177,17728,34561,18368,18048,34369,33281,17088,17280,33601,16640,33217,32897,16448]),a=[50,75,110,134,150,200,300,600,1200,1800,2400,4800,9600,19200,38400,57600,115200,230400,460800,5e5,576e3,921600,1e6,1152e3,15e5,2e6,25e5,3e6,35e5,4e6],l=[{label:"RTU slave",value:"rtu-slave"},{label:"ASCII slave",value:"ascii-slave"},{label:"RTU master",value:"rtu-master"},{label:"ASCII master",value:"ascii-master"}],d=[{label:"1N - 1 stop bit, no parity",value:"1N"},{label:"1E - 1 stop bit, even parity",value:"1E"},{label:"1O - 1 stop bit, odd parity",value:"1O"},{label:"2N - 2 stop bits, no parity",value:"2N"}];function u(e){let{deviceId:n,funcCode:t,customPayload:r,address:s,quantity:a,value:l,subFunction:d,payload:u}=e,p="".concat(n.toString(16).padStart(2,"0"));if(r)p+="".concat(t.toString(16).padStart(2,"0"))+"".concat((0,i.uv)(u||""));else switch(p+="".concat(t.toString(16).padStart(2,"0")),t){case 1:case 2:case 3:case 4:p+="".concat((s||0).toString(16).padStart(4,"0"))+"".concat((a||0).toString(16).padStart(4,"0"));break;case 5:case 6:p+="".concat((s||0).toString(16).padStart(4,"0"))+"".concat((l||0).toString(16).padStart(4,"0"));break;case 7:case 11:case 12:case 17:break;case 8:p+="".concat((d||0).toString(16).padStart(2,"0"))+"".concat((0,i.uv)(u||""));break;case 15:p+="".concat((s||0).toString(16).padStart(4,"0"))+"".concat((a||0).toString(16).padStart(4,"0"))+"".concat(Math.ceil((u||"").length/4).toString(16).padStart(2,"0"))+"".concat((0,i.uv)(u||""));break;case 16:p+="".concat((s||0).toString(16).padStart(4,"0"))+"".concat((a||0).toString(16).padStart(4,"0"))+"".concat(Math.ceil((u||"").length/2).toString(16).padStart(2,"0"))+"".concat((0,i.uv)(u||""));break;default:p+="".concat((0,i.uv)(u||""))}let g=function(e){let n=65535;for(let t=0;t<e.length;t++)n=(c[(n^e[t])&255]^n>>8)&65535;return n<<8&65535|n>>8}(o.from(p,"hex")),h=g.toString(16).padStart(4,"0"),x=p;return[x+h,x,h]}function p(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,t=n.toString(16).padStart(4,"0"),[r,i,o]=u(e),s=Math.ceil(i.length/2).toString(16).padStart(4,"0");return["".concat(t,"0000").concat(s).concat(i),o]}function g(e){let[n,t]=u(e),r=t.toUpperCase().split("").map(e=>e.charCodeAt(0).toString(16).padStart(2,"0")).join(""),i=function(e){let n=0;for(let t=0;t<e.length;t++)n+=255&e[t];return(255^n)+1&255}(o.from(t,"hex")),s=i.toString(16).toUpperCase().split("").map(e=>e.charCodeAt(0).toString(16).padStart(2,"0")).join("");return["3A".concat(r).concat(s,"0D0A"),s]}async function h(e,n,t,s,c){let a=t.trim().toLowerCase().split("\n").map(e=>e.trim()),l=[],d=0,u=0,p=0,g=()=>{c&&c("Requests sent: ".concat(d,"\nResponses: ").concat(u,"\nErrors: ").concat(p))};for(let t of a){if(t.startsWith("#")||0===t.length)continue;let c=(0,i.uv)(t),a={dataB64:o.from(c,"hex").toString("base64"),asIs:s,dst:n};d++,g();let h=await (0,r.ri)(e,"/api/modbus/send-request/",{method:"POST",body:JSON.stringify(a)}),x=await h.json();x.dataB64?u++:p++,g(),l.push({request:c,response:x.dataB64?o.from(x.dataB64,"base64").toString("hex"):"Error: ".concat(x.modbusErrorCode)})}let h="";for(let e of l)h+="> ".concat(e.request,"\n< ").concat(e.response,"\n");return c&&c(h),l}async function x(e,n,t,r,i){let o=[],s=r,c=t;for(;s>0;){let t=Math.min(s,125),r=await m(e,n,c,t,i);o.push(...r),s-=t,c+=t}return o}async function m(e,n,t,r,i){let[o,s,c]=u({deviceId:i,funcCode:"holding"===n?3:4,address:t,quantity:r}),a=(await h(e,"VIR",s,!1))[0].response,l=[];for(let e=0;e<r;e++)l.push(parseInt(a.slice(6+4*e,10+4*e),16));return l}function f(e,n){let t;let[r,i,o,...s]=e.split(" "),[c,a]=r.split("-"),l=1e3*Number(c)+Number(a),d=new Date(i),u="".concat(d.toLocaleTimeString(),".").concat(d.getMilliseconds().toString().padStart(3,"0")),p="<"!==o&&">"!==o?"#":o,g=s.join(" ");if("#"===p)return{id:l,raw:e,date:u,type:"#",content:{kind:"raw",payload:g}};let h=Array.from(g.match(/.{1,2}/g));if(g.length%2!=0||"rtu"===n&&(g.length<8||g.length>254)||"ascii"===n&&(g.length<18||"3a"!==h[0]||"0d"!==h[h.length-2]||"0a"!==h[h.length-1])||"tcp"===n&&g.length<16)return{id:l,raw:e,date:u,type:p,content:{kind:"error",payload:h.join(" ")}};if("rtu"===n){let e=h.splice(-2).join(" ");t=Object.assign(j(h,p),{crc:e})}else if("ascii"===n){let e=parseInt(h.slice(3,5).map(e=>String.fromCharCode(parseInt(e,16))).join(""),16);t={kind:"correct",prefix:h[0],deviceId:h.slice(1,3).join(" "),functionCode:h.slice(3,5).join(" "),errorFunctionCode:e>=128,payload:h.slice(6,-4).join(" "),crc:h.slice(-4).join(" "),description:h.slice(1,-4).map(e=>String.fromCharCode(parseInt(e,16))).join("")}}else if("rtu-no-crc"===n)t=j(h,p);else{let e=parseInt(h[8],16);t={kind:"correct",prefix:h.slice(0,6).join(" "),deviceId:h[6],functionCode:h[7],errorFunctionCode:e>=128,payload:h.slice(8).join(" ")}}return{id:l,raw:e,date:u,type:p,content:t}}function j(e,n){let t=parseInt(e[1],16),r={kind:"correct",deviceId:e[0],functionCode:e[1],errorFunctionCode:t>=128,payload:e.slice(2).join(" ")};if(">"===n&&(3===t||4===t)){let n=parseInt(e.slice(2,4).join(""),16),i=parseInt(e.slice(4,6).join(""),16),o=3===t?"holding":"input";i>1?r.description="Read ".concat(o," ").concat(n,"-").concat(n+i-1):r.description="Read ".concat(o," ").concat(n)}if("<"===n&&(3===t||4===t)){let n=e.slice(3).join(""),t=n.match(/.{1,4}/g);if(t){let e=Array.from(t).map(e=>parseInt(e,16));r.description=e.join(", ")}}return r}}}]);