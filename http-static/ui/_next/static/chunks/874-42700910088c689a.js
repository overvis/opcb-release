"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[874],{5973:function(e,t,n){n.d(t,{Z:function(){return CenteredStatusInfo}});var o=n(966),r=n(8255),s=n(462),a=n(7344),i=n(3979),c=n(9956),l=n(431);function CenteredStatusInfo(e){let{icon:t,text:n,description:d,children:u,color:p,...g}=e;return(0,o.jsx)(r.M,{h:"100%",p:"xs",...g,children:(0,o.jsxs)(s.K,{p:"sm",spacing:"xs",align:"center",justify:"center",children:[(0,o.jsxs)(a.Z,{spacing:"xs",align:"start",position:"center",children:[(0,o.jsx)(i.k,{color:p||"black",size:"md",variant:"outline",sx:{border:"none"},children:t||(0,o.jsx)(l.Z,{})}),(0,o.jsx)(c.x,{color:p||"black",align:"center",children:n})]}),d&&(0,o.jsx)(c.x,{size:"xs",color:"dimmed",align:"center",children:d}),u]})})}},6435:function(e,t,n){n.d(t,{Z:function(){return ConnectionsLayout}});var o=n(966),r=n(9025),s=n(7344),a=n(8822),i=n(5040),c=n(3127),l=n(4985),d=n(4853),u=n(937),p=n(8769),g=n(1407),m=n(8392),h=n(9640),f=n(7097),x=n.n(f),v=n(2094);let b=(0,r.k)(e=>({navlink:{color:e.colors.blue[6],"&:hover":{color:e.colors.dark,backgroundColor:"transparent"},"&[data-active]":{color:e.colors.dark,backgroundColor:"transparent",borderRight:"2px solid #000",pointerEvents:"none"}}}));function ConnectionsLayout(e){let{children:t,pageId:n,title:r}=e,{classes:f}=b();return(0,o.jsx)(v.Z,{pageTitle:"Connections :: ".concat(r),children:(0,o.jsxs)(s.Z,{align:"stretch",position:"left",noWrap:!0,children:[(0,o.jsx)(a.w,{width:{sm:200},ml:"-sm",mih:0,height:"auto",children:(0,o.jsxs)(a.w.Section,{children:[(0,o.jsx)(i.O,{component:x(),href:"/connections/modbus-rs485",label:"Modbus over RS-485",icon:(0,o.jsx)(l.Z,{size:16,stroke:1.5}),active:"modbus-rs485"===n,className:f.navlink}),(0,o.jsx)(i.O,{component:x(),href:"/connections/modbus-tcp-server",label:"Modbus TCP Server",icon:(0,o.jsx)(d.Z,{size:16,stroke:1.5}),active:"modbus-tcp-server"===n,className:f.navlink}),(0,o.jsx)(i.O,{component:x(),href:"/connections/modbus-tcp-client",label:"Modbus TCP Client",icon:(0,o.jsx)(u.Z,{size:16,stroke:1.5}),active:"modbus-tcp-client"===n,className:f.navlink}),(0,o.jsx)(i.O,{component:x(),href:"/connections/opcb-modbus-access",label:"OPCB Modbus Access",icon:(0,o.jsx)(p.Z,{size:16,stroke:1.5}),active:"opcb-modbus-access"===n,className:f.navlink}),(0,o.jsx)(i.O,{component:x(),href:"/connections/lora-sens",label:"LoRa Sens",icon:(0,o.jsx)(g.Z,{size:16,stroke:1.5}),active:"lora-sens"===n,className:f.navlink}),(0,o.jsx)(i.O,{component:x(),href:"/connections/mqtt",label:"MQTT Broker",icon:(0,o.jsx)(m.Z,{size:16,stroke:1.5}),active:"mqtt"===n,className:f.navlink}),(0,o.jsx)(i.O,{component:x(),href:"/connections/overvis-modbus-tcp",label:"Overvis Modbus TCP",icon:(0,o.jsx)(h.Z,{size:16,stroke:1.5}),active:"overvis-modbus-tcp"===n,className:f.navlink})]})}),(0,o.jsx)(c.x,{sx:{flexGrow:1},children:t})]})})}},5451:function(e,t,n){n.d(t,{Z:function(){return DisabledStatus}});var o=n(966),r=n(5973);function DisabledStatus(e){let{error:t,...n}=e;return(0,o.jsx)(r.Z,{...n,p:"xs",bg:"gray.0",color:t?"red":"gray"})}},7723:function(e,t,n){var o=n(9025);t.Z=(0,o.k)(e=>({dirtyInput:{backgroundColor:e.colors.blue[0]}}))},4101:function(e,t,n){n.d(t,{Z:function(){return ModbusStreamLog}});var o=n(966),r=n(462),s=n(7344),a=n(9956),i=n(3283),c=n(8598),l=n(5006),d=n(3636),u=n(9810),p=n(4939),g=n(9994),m=n(2383),h=n(6319),f=n(3900),x=n(9342),v=n(9416),b=n(1489);function ModbusStreamLog(e){let{mode:t,streamName:n}=e,[j,S]=(0,f.useState)(!1),[R,k]=(0,f.useState)(!1),{messageHistory:C,setMessageHistory:y,socketReadyState:w}=(0,b.Y)("/api/log/stream/".concat(n,"/"),e=>(0,x.Gt)(e,t),j),Z=(0,f.useRef)(null),I=(0,l.V)({timeout:500});return(0,o.jsx)(o.Fragment,{children:(0,o.jsxs)(r.K,{spacing:0,h:"100%",maw:"870px",children:[(0,o.jsxs)(s.Z,{sx:e=>({borderBottom:"1px solid ".concat(e.colors.gray[3])}),py:"xs",children:[(0,o.jsx)(a.x,{size:"sm",transform:"uppercase",weight:700,color:"gray.9",children:"Real-time transfer log"}),(0,o.jsxs)(i.z,{compact:!0,variant:"subtle",radius:"lg",size:"xs",onClick:()=>{I.copy(C.map(e=>e.raw).join("\n"))},children:[(0,o.jsx)(d.Z,{size:12,style:{marginRight:4}}),"Copy"]}),(0,o.jsxs)(i.z,{compact:!0,variant:"subtle",radius:"lg",size:"xs",bg:j?"gray.3":"",onClick:()=>S(!j),children:[j?(0,o.jsx)(u.Z,{size:12,style:{marginRight:4}}):(0,o.jsx)(p.Z,{size:12,style:{marginRight:4}}),j?"Resume":"Pause"]}),(0,o.jsxs)(i.z,{compact:!0,variant:"subtle",radius:"lg",size:"xs",onClick:()=>y([]),children:[(0,o.jsx)(g.Z,{size:12,style:{marginRight:4}}),"Clear"]}),(0,o.jsxs)(i.z,{compact:!0,variant:"subtle",radius:"lg",size:"xs",onClick:()=>k(!R),children:[R?(0,o.jsx)(m.Z,{size:12,style:{marginRight:4}}):(0,o.jsx)(h.Z,{size:12,style:{marginRight:4}}),R?"Resume scrolling":"Pause scrolling"]})]}),(0,o.jsx)(c.x,{h:550,sx:{flexGrow:1},viewportRef:Z,children:(0,o.jsx)(v.Z,{socketState:w,scrollLogHandler:()=>{Z.current&&!R&&Z.current.scrollTo({top:Z.current.scrollHeight,behavior:"auto"})},children:C})})]})})}},5465:function(e,t,n){n.d(t,{Z:function(){return StatusBlockWithSettings}});var o=n(966),r=n(3900),s=n(8253),a=n(4418),i=n(462),c=n(7344),l=n(3979),d=n(9956),u=n(9977),p=n(3127),g=n(8637);function StatusBlock(e){let t="connected"===e.status?"green":"warn"===e.status?"orange":"disconnected"===e.status?"red":"gray";return(0,o.jsx)(a.X,{h:"100%",withBorder:!0,children:(0,o.jsxs)(i.K,{spacing:0,h:"100%",children:[(0,o.jsxs)(c.Z,{position:"apart",align:"center",p:"xs",sx:e=>({borderBottom:"1px solid ".concat(e.colors.gray[3])}),children:[(0,o.jsxs)(c.Z,{spacing:"xs",noWrap:!0,children:[(0,o.jsx)(l.k,{color:t,variant:"light",children:e.icon}),(0,o.jsx)(d.x,{weight:500,c:t,transform:"uppercase",children:e.name}),e.addEl&&"string"==typeof e.addEl?(0,o.jsx)(d.x,{c:"dimmed",size:"sm",children:e.addEl}):e.addEl]}),(0,o.jsxs)(c.Z,{spacing:"xs",noWrap:!0,children:[e.addElRight,e.settingsAction&&(0,o.jsx)(u.A,{color:"blue",onClick:e.settingsAction,children:(0,o.jsx)(g.Z,{size:18})})]})]}),(0,o.jsx)(p.x,{bg:e.bg,h:"100%",children:e.children})]})})}function StatusBlockWithSettings(e){let[t,n]=(0,r.useState)(!1);return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(s.Z,{...e.settings,opened:t,setOpened:n}),(0,o.jsx)(StatusBlock,{...e,settingsAction:()=>n(!0),children:e.children})]})}},3610:function(e,t,n){n.d(t,{Z:function(){return ValueDisplay}});var o=n(966),r=n(9956),s=n(7344),a=n(462);function ValueDisplay(e){let{icon:t,name:n,nameColor:i="dimmed",mainVal:c,subVal:l,oneline:d}=e,u=!function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),o=1;o<t;o++)n[o-1]=arguments[o];return"object"==typeof e&&null!==e&&n.every(t=>t in e)}(l,"value","level")?l:(0,o.jsxs)(o.Fragment,{children:[l.name&&l.name+" ",(0,o.jsx)(r.x,{span:!0,c:"good"===l.level?"green":"medium"===l.level?"orange":"bad"===l.level?"red":"dimmed",transform:"none",children:l.value})]}),p=(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(r.x,{weight:"bold",size:"xs",color:i,transform:"uppercase",children:n}),(0,o.jsx)(r.x,{fz:"xs",color:"black",children:c}),u&&(0,o.jsx)(r.x,{size:10,color:"dimmed",children:u})]});return d?(0,o.jsxs)(s.Z,{spacing:5,align:"baseline",noWrap:!0,children:[(0,o.jsx)("div",{style:{position:"relative",top:"2px",marginTop:"-5px",marginRight:"-4px"},children:t}),p]}):(0,o.jsxs)(s.Z,{spacing:0,align:"baseline",noWrap:!0,children:[(0,o.jsx)("div",{style:{position:"relative",top:"2px",marginTop:"-5px"},children:t}),(0,o.jsx)(a.K,{spacing:0,children:p})]})}n(3900)},7219:function(e,t,n){n.d(t,{M:function(){return saveProcedure},u:function(){return makeInputPropsGen}});var o=n(966),r=n(6680),s=n(7017),a=n(2922);async function saveProcedure(e){(0,r.yK)("settings-save"),(0,r.c0)({id:"settings-save",withCloseButton:!0,autoClose:!1,loading:!0,icon:null,color:"orange",title:"Saving settings...",message:"Please wait while the new settings are applied..."});try{await e()}catch(e){(0,r.wD)({id:"settings-save",loading:!1,withCloseButton:!0,color:"red",icon:(0,o.jsx)(s.Z,{}),title:"Error saving settings",message:"There was an error saving settings. Please check form data and try again."}),console.error(e);return}(0,r.wD)({id:"settings-save",loading:!1,withCloseButton:!0,autoClose:1e3,color:"green",icon:(0,o.jsx)(a.Z,{}),title:"Settings saved",message:"Settings were saved and applied successfully."})}function makeInputPropsGen(e,t,n){return function(o){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"input";return function(e,t,n,o){let r=e.getInputProps(t,n);return{...r,classNames:{input:e.isDirty(t)&&o||void 0}}}(e,o,{...n,type:r},t)}}},1489:function(e,t,n){n.d(t,{Y:function(){return useWebSocketStream}});var o=n(3900),r=n(1264),s=n(9804);function useWebSocketStream(e,t,n){let a=window.location.hostname,i=window.location.port,c="https:"===window.location.protocol?"wss":"ws",l="".concat(c,"://").concat(a,":").concat(i).concat(e),[d,u]=(0,o.useState)([]),{lastMessage:p,readyState:g}=(0,r.ZP)(l,{onError:e=>console.error("Log socket closed with error: ".concat(e)),onClose:e=>{console.log("Log socket closed: "+e),u(e=>e.concat({id:Math.floor(1e9*Math.random()),raw:"Log socket interrupted.",date:(0,s.k6)(new Date),type:"close"}))},onOpen:()=>{u(e=>e.concat({id:Math.floor(1e9*Math.random()),raw:"Log socket opened.",date:(0,s.k6)(new Date),type:"open"}))},shouldReconnect:()=>!0,reconnectAttempts:5,reconnectInterval:1e3});return(0,o.useEffect)(()=>{null===p||n||u(e=>{let n=t?t(p.data):p.data;return e.find(e=>e.id===n.id)?e:e.concat(n).slice(-1e3)})},[p,u]),{messageHistory:d,setMessageHistory:u,socketReadyState:g}}},9342:function(e,t,n){n.d(t,{$b:function(){return readOpcbRegisters},EH:function(){return d},Gt:function(){return parseModbusLogRecord},J4:function(){return u},PW:function(){return sendModbusRequest},_:function(){return l},aL:function(){return genRtuRequest},eq:function(){return i},gY:function(){return genAsciiRequest},nM:function(){return genTcpRequest}});var o=n(52),r=n(9804),s=n(8431),a=n(8027).Buffer;let i=[{code:1,name:"Read Coils"},{code:2,name:"Read Discrete Inputs"},{code:3,name:"Read Holding Registers"},{code:4,name:"Read Input Registers"},{code:5,name:"Write Single Coil"},{code:6,name:"Write Single Register"},{code:7,name:"Read Exception Status"},{code:8,name:"Diagnostics"},{code:11,name:"Get Comm Event Counter"},{code:12,name:"Get Comm Event Log"},{code:15,name:"Write Multiple Coils"},{code:16,name:"Write Multiple Registers"},{code:17,name:"Report Server ID"},{code:20,name:"Read File Record"},{code:21,name:"Write File Record"},{code:22,name:"Mask Write Register"},{code:23,name:"Read/Write Multiple Registers"},{code:24,name:"Read FIFO Queue"},{code:43,name:"Read Device Identification"}],c=new Int32Array([0,49345,49537,320,49921,960,640,49729,50689,1728,1920,51009,1280,50625,50305,1088,52225,3264,3456,52545,3840,53185,52865,3648,2560,51905,52097,2880,51457,2496,2176,51265,55297,6336,6528,55617,6912,56257,55937,6720,7680,57025,57217,8e3,56577,7616,7296,56385,5120,54465,54657,5440,55041,6080,5760,54849,53761,4800,4992,54081,4352,53697,53377,4160,61441,12480,12672,61761,13056,62401,62081,12864,13824,63169,63361,14144,62721,13760,13440,62529,15360,64705,64897,15680,65281,16320,16e3,65089,64001,15040,15232,64321,14592,63937,63617,14400,10240,59585,59777,10560,60161,11200,10880,59969,60929,11968,12160,61249,11520,60865,60545,11328,58369,9408,9600,58689,9984,59329,59009,9792,8704,58049,58241,9024,57601,8640,8320,57409,40961,24768,24960,41281,25344,41921,41601,25152,26112,42689,42881,26432,42241,26048,25728,42049,27648,44225,44417,27968,44801,28608,28288,44609,43521,27328,27520,43841,26880,43457,43137,26688,30720,47297,47489,31040,47873,31680,31360,47681,48641,32448,32640,48961,32e3,48577,48257,31808,46081,29888,30080,46401,30464,47041,46721,30272,29184,45761,45953,29504,45313,29120,28800,45121,20480,37057,37249,20800,37633,21440,21120,37441,38401,22208,22400,38721,21760,38337,38017,21568,39937,23744,23936,40257,24320,40897,40577,24128,23040,39617,39809,23360,39169,22976,22656,38977,34817,18624,18816,35137,19200,35777,35457,19008,19968,36545,36737,20288,36097,19904,19584,35905,17408,33985,34177,17728,34561,18368,18048,34369,33281,17088,17280,33601,16640,33217,32897,16448]),l=[50,75,110,134,150,200,300,600,1200,1800,2400,4800,9600,19200,38400,57600,115200,230400,460800,5e5,576e3,921600,1e6,1152e3,15e5,2e6,25e5,3e6,35e5,4e6],d=[{label:"RTU slave",value:"rtu-slave"},{label:"ASCII slave",value:"ascii-slave"},{label:"RTU master",value:"rtu-master"},{label:"ASCII master",value:"ascii-master"}],u=[{label:"1N - 1 stop bit, no parity",value:"1N"},{label:"1E - 1 stop bit, even parity",value:"1E"},{label:"1O - 1 stop bit, odd parity",value:"1O"},{label:"2N - 2 stop bits, no parity",value:"2N"}];function genRtuRequest(e){let{deviceId:t,funcCode:n,customPayload:o,address:r,quantity:i,value:l,subFunction:d,payload:u}=e,p="".concat(t.toString(16).padStart(2,"0"));if(o)p+="".concat(n.toString(16).padStart(2,"0"))+"".concat((0,s.uv)(u||""));else switch(p+="".concat(n.toString(16).padStart(2,"0")),n){case 1:case 2:case 3:case 4:p+="".concat((r||0).toString(16).padStart(4,"0"))+"".concat((i||0).toString(16).padStart(4,"0"));break;case 5:case 6:p+="".concat((r||0).toString(16).padStart(4,"0"))+"".concat((l||0).toString(16).padStart(4,"0"));break;case 7:case 11:case 12:case 17:break;case 8:p+="".concat((d||0).toString(16).padStart(2,"0"))+"".concat((0,s.uv)(u||""));break;case 15:p+="".concat((r||0).toString(16).padStart(4,"0"))+"".concat((i||0).toString(16).padStart(4,"0"))+"".concat(Math.ceil((u||"").length/4).toString(16).padStart(2,"0"))+"".concat((0,s.uv)(u||""));break;case 16:p+="".concat((r||0).toString(16).padStart(4,"0"))+"".concat((i||0).toString(16).padStart(4,"0"))+"".concat(Math.ceil((u||"").length/2).toString(16).padStart(2,"0"))+"".concat((0,s.uv)(u||""));break;default:p+="".concat((0,s.uv)(u||""))}let g=function(e){let t=65535;for(let n=0;n<e.length;n++)t=(c[(t^e[n])&255]^t>>8)&65535;return t<<8&65535|t>>8}(a.from(p,"hex")),m=g.toString(16).padStart(4,"0"),h=p;return[h+m,h,m]}function genTcpRequest(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=t.toString(16).padStart(4,"0"),[o,r,s]=genRtuRequest(e),a=Math.ceil(r.length/2).toString(16).padStart(4,"0");return["".concat(n,"0000").concat(a).concat(r),s]}function genAsciiRequest(e){let[t,n]=genRtuRequest(e),o=n.toUpperCase().split("").map(e=>e.charCodeAt(0).toString(16).padStart(2,"0")).join(""),r=function(e){let t=0;for(let n=0;n<e.length;n++)t+=255&e[n];return(255^t)+1&255}(a.from(n,"hex")),s=r.toString(16).toUpperCase().split("").map(e=>e.charCodeAt(0).toString(16).padStart(2,"0")).join("");return["3A".concat(o).concat(s,"0D0A"),s]}async function sendModbusRequest(e,t,n,r,i){let c=n.trim().toLowerCase().split("\n").map(e=>e.trim()),l=[],d=0,u=0,p=0,report=()=>{i&&i("Requests sent: ".concat(d,"\nResponses: ").concat(u,"\nErrors: ").concat(p))};for(let n of c){if(n.startsWith("#")||0===n.length)continue;let i=(0,s.uv)(n),c={dataB64:a.from(i,"hex").toString("base64"),asIs:r,dst:t};d++,report();let g=await (0,o.ri)(e,"/api/modbus/send-request/",{method:"POST",body:JSON.stringify(c)}),m=await g.json();m.dataB64?u++:p++,report(),l.push({request:i,response:m.dataB64?a.from(m.dataB64,"base64").toString("hex"):"Error: ".concat(m.modbusErrorCode)})}let g="";for(let e of l)g+="> ".concat(e.request,"\n< ").concat(e.response,"\n");return i&&i(g),l}async function readOpcbRegisters(e,t,n,o,r){let s=[],a=o,i=n;for(;a>0;){let n=Math.min(a,125),o=await readRegistersRequest(e,t,i,n,r);s.push(...o),a-=n,i+=n}return s}async function readRegistersRequest(e,t,n,o,r){let[s,a,i]=genRtuRequest({deviceId:r,funcCode:"holding"===t?3:4,address:n,quantity:o}),c=(await sendModbusRequest(e,"VIR",a,!1))[0].response,l=[];for(let e=0;e<o;e++)l.push(parseInt(c.slice(6+4*e,10+4*e),16));return l}function parseModbusLogRecord(e,t){let[n,o,s,...a]=e.split(" "),[i,c]=n.split("-"),l=1e3*Number(i)+Number(c),d=(0,r.k6)(new Date(o)),u="<"!==s&&">"!==s?"#":s,p=a.join(" ");if("#"===u)return{id:l,raw:e,date:d,type:"#",content:{kind:"raw",payload:p}};let g=Array.from(p.match(/.{1,2}/g));return p.length%2!=0||"rtu"===t&&(p.length<8||p.length>254)||"ascii"===t&&(p.length<18||"3a"!==g[0]||"0d"!==g[g.length-2]||"0a"!==g[g.length-1])||"tcp"===t&&p.length<16?{id:l,raw:e,date:d,type:u,content:[{kind:"error",payload:g.join(" ")}]}:{id:l,raw:e,date:d,type:u,content:function(e,t,n){if("rtu"===t){let t=e.splice(-2).join(" ");return[Object.assign(getRtuNoCrcContent(e,n),{crc:t})]}if("ascii"===t){let t=parseInt(e.slice(3,5).map(e=>String.fromCharCode(parseInt(e,16))).join(""),16),n={kind:"correct",prefix:e[0],deviceId:e.slice(1,3).join(" "),functionCode:e.slice(3,5).join(" "),errorFunctionCode:t>=128,payload:e.slice(6,-4).join(" "),crc:e.slice(-4).join(" "),description:e.slice(1,-4).map(e=>String.fromCharCode(parseInt(e,16))).join("")};return[n]}if("rtu-no-crc"===t)return[getRtuNoCrcContent(e,n)];{let t=[];for(let n=0;n<100&&!(e.length<1);n++){let n=256*parseInt(e[4],16)+parseInt(e[5],16);if(e.length<6+n){t.push({kind:"error",payload:e.join(" ")});break}let o=e.splice(0,6+n),r=parseInt(o[7],16);t.push({kind:"correct",prefix:o.slice(0,6).join(" "),deviceId:o[6],functionCode:o[7],errorFunctionCode:r>=128,payload:o.slice(8).join(" ")})}return t}}(g,t,u)}}function getRtuNoCrcContent(e,t){let n=parseInt(e[1],16),o={kind:"correct",deviceId:e[0],functionCode:e[1],errorFunctionCode:n>=128,payload:e.slice(2).join(" ")};if(">"===t&&(3===n||4===n)){let t=parseInt(e.slice(2,4).join(""),16),r=parseInt(e.slice(4,6).join(""),16),s=3===n?"holding":"input";r>1?o.description="Read ".concat(s," ").concat(t,"-").concat(t+r-1):o.description="Read ".concat(s," ").concat(t)}if("<"===t&&(3===n||4===n)){let t=e.slice(3).join(""),n=t.match(/.{1,4}/g);if(n){let e=Array.from(n).map(e=>parseInt(e,16));o.description=e.join(", ")}}return o}}}]);