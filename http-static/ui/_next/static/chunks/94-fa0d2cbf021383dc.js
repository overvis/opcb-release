"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[94],{7452:function(e,t,n){n.d(t,{Z:function(){return ButtonWithLoader}});var r=n(966),s=n(3283),o=n(3624);function ButtonWithLoader(e){let{inProgress:t,...n}={...e};return(0,r.jsx)(s.z,{...n,disabled:t,children:t?(0,r.jsx)(o.a,{}):n.children})}},2061:function(e,t,n){n.d(t,{Z:function(){return ChangelogLink}});var r=n(966),s=n(4512),o=n(5502),a=n(480),i=n(6e3),c=n(6981),l=n(3900),d=n(6104);function ChangelogLink(e){let{children:t,version:n,markdownContent:u}=e,[p,m]=(0,l.useState)("");(0,l.useEffect)(()=>{u||(0,d.Ab)().then(e=>{m(e)}).catch(console.error)},[u]);let[x,h]=(0,l.useState)(!1),f="Release information";n&&(f+=" for version ".concat(n));let g=c.TU.parse(null!=u?u:p,{mangle:!1,headerIds:!1});return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s.u,{opened:x,onClose:()=>h(!1),title:f,size:"xl",children:(0,r.jsx)(o.l,{children:(0,r.jsx)("div",{dangerouslySetInnerHTML:{__html:g}})})}),(0,r.jsxs)(a.e,{fz:"sm",onClick:()=>h(!0),children:[(0,r.jsx)(i.Z,{size:14,style:{position:"relative",top:"2px"}})," ",t]})]})}},4665:function(e,t,n){n.d(t,{s:function(){return MainLoader}});var r=n(966),s=n(8070),o=n(2489),a=n(6446),i=n(3900);function MainLoader(e){let t=(0,a.useRouter)(),[n,c]=(0,i.useState)(!0);return(0,i.useEffect)(()=>{let handleStart=()=>{c(!1)},handleStop=()=>{c(!0)};return t.events.on("routeChangeStart",handleStart),t.events.on("routeChangeComplete",handleStop),t.events.on("routeChangeError",handleStop),()=>{t.events.off("routeChangeStart",handleStart),t.events.off("routeChangeComplete",handleStop),t.events.off("routeChangeError",handleStop)}},[t]),(0,i.useEffect)(()=>{e.dataLoaded&&n||e.dataErrored?!n||e.dataLoaded||e.dataErrored?(0,s.We)():(0,s.fD)(50):(0,s.QT)()},[e.dataLoaded,e.dataErrored,n]),(0,r.jsx)(o.V,{autoReset:!0})}},8253:function(e,t,n){n.d(t,{Z:function(){return ModalLoadingForm}});var r=n(966),s=n(4512),o=n(8255),a=n(3624),i=n(7017),c=n(2922),l=n(3900),d=n(8464);function LoadingForm(e){let{closeModal:t,form:n,useSettings:s,save:u}=e,{data:p,mutate:m}=s(),[x,h]=(0,l.useState)(!1);return p?l.createElement(n,{initialValues:p,onSubmit:async e=>(0,d.$)(h,async()=>await u(e),(0,r.jsx)(i.Z,{}),(0,r.jsx)(c.Z,{}),()=>m(e),t),saving:x}):(0,r.jsx)(o.M,{py:"md",children:(0,r.jsx)(a.a,{})})}function ModalLoadingForm(e){return(0,r.jsx)(s.u,{opened:e.opened,size:e.size,onClose:()=>e.setOpened(!1),title:e.title,children:(0,r.jsx)(LoadingForm,{closeModal:()=>{e.onSettingsUpdate&&e.onSettingsUpdate(),e.setOpened(!1)},useSettings:e.useSettings,save:e.save,form:e.form})})}},2094:function(e,t,n){n.d(t,{Z:function(){return OpcbLayout}});var r=n(966),s=n(9956),o=n(1963),a=n(7696),i=n(6849),c=n(7344),l=n(3624),d=n(1098),u=n(717),p=n.n(u),m=n(6446),x=n.n(m),h=n(52),f=n(1039),g=n(1827),v=n(6104),b=n(2061),j=n(4665),y=n(9025),S=n(8078),k=n(462),w=n(480),B=n(2308),N=n(8641),T=n.n(N);let C=(0,y.k)(e=>({footer:{marginTop:120,paddingTop:"3rem",paddingBottom:"6rem",backgroundColor:"dark"===e.colorScheme?e.colors.dark[6]:e.colors.gray[0],borderTop:"1px solid ".concat("dark"===e.colorScheme?e.colors.dark[5]:e.colors.gray[2]),a:{color:e.colors.blue[6]}},logo:{opacity:.5},statusInfo:{color:e.colors.gray[6],fontSize:e.fontSizes.xs,b:{color:e.colors.gray[7],fontWeight:"normal"}},success:{color:e.colors.green[6]},failure:{color:e.colors.red[6]},disabled:{color:e.colors.gray[6]},afterFooter:{display:"flex",justifyContent:"space-between",alignItems:"center",marginTop:e.spacing.xl,paddingTop:e.spacing.xl,paddingBottom:e.spacing.xl,borderTop:"1px solid ".concat("dark"===e.colorScheme?e.colors.dark[4]:e.colors.gray[2]),[e.fn.smallerThan("sm")]:{flexDirection:"column"}},support:{[e.fn.smallerThan("sm")]:{marginTop:e.spacing.xs}},sep:{margin:"0 6px",display:"inline-block"}}));function OpcbFooter(e){var t,n;let{classes:o}=C(),i=(0,v.aw)();return(0,r.jsxs)("footer",{className:o.footer,style:{flex:0},children:[(0,r.jsx)(a.W,{size:"lg",children:(0,r.jsx)(T(),{src:"/media/overvis-basic-logo.svg",width:"60",height:"40",alt:"Overvis Logo",className:o.logo})}),(0,r.jsx)(a.W,{size:"lg",className:o.statusInfo,children:(0,r.jsxs)(S.k,{gap:"md",justify:"space-between",align:"flex-start",direction:"row",wrap:"wrap",columnGap:40,children:[(0,r.jsxs)(k.K,{spacing:2,children:[(0,r.jsxs)(s.x,{children:["OPCB is developed by ",(0,r.jsx)("a",{href:"https://www.overvis.com/",children:"Overvis"})," and"," ",(0,r.jsx)("a",{href:"https://www.novatek-electro.com/",children:"Novatek-Electro"})," \xa9 2023"]}),(0,r.jsxs)(s.x,{children:[(0,r.jsx)("a",{href:"https://docs.overvis.com/#/OPCB/",children:"Documentation"}),(0,r.jsx)("span",{className:o.sep,children:"∙"}),(0,r.jsx)("a",{href:"mailto:support@overvis.com",children:"support@overvis.com"}),(0,r.jsx)("span",{className:o.sep,children:"∙"}),"+44 800 048 50 08"]}),(0,r.jsxs)(c.Z,{children:[(0,r.jsxs)(s.x,{children:[(0,r.jsx)("b",{children:"Firmware version:"})," ",e.firmwareVersion," (",e.firmwareDate,")"]}),"string"!=typeof e.updateState&&"scheduled"===e.updateState.kind&&(0,r.jsx)(w.e,{href:"/control",children:(0,r.jsxs)(B.C,{color:"orange",children:["Scheduled update: ",e.updateState.version]})}),"string"!=typeof e.updateState&&"available"===e.updateState.kind&&(0,r.jsx)(w.e,{href:"/control",children:(0,r.jsxs)(B.C,{color:"orange",children:["Available update: ",e.updateState.version]})})]})]}),(null===(n=i.data)||void 0===n?void 0:null===(t=n.cmdFiles)||void 0===t?void 0:t.length)?(0,r.jsxs)(k.K,{spacing:2,align:"left",children:[(0,r.jsx)(s.x,{ml:"10px",children:"Command files found:"}),(0,r.jsx)(c.Z,{spacing:"xs",children:i.data.cmdFiles.map((e,t)=>(0,r.jsx)(B.C,{fz:10,color:"orange",children:e},t))})]}):null]})})]})}var M=n(1949),P=n(6537),L=n(3960),O=n(9608),z=n(8482),I=n(5040),Z=n(1431),D=n(3127),F=n(7253),E=n(4987),R=n(9142),A=n(5566),V=n(1233),W=n(7259),U=n(9869),H=n(4632),K=n(5266),Q=n(7147),Y=n(3174),G=n(7097),q=n.n(G),_=n(3900),$=n(8255),J=n(5782),X=n(3283),ee=n(8899),et=n(6886),en=n(5951),er=n(5614),es=n(9977),eo=n(6356),ea=n(3648),ei=n(1851),ec=n(9724),el=n(8637),ed=n(9804),eu=n(1260),ep=n(8431),em=n(7452),ex=n(8253);function TimeSettingsForm(e){let{initialValues:t,onSubmit:n,saving:s}=e,o=(0,ec.c)({initialValues:t});return(0,r.jsx)("form",{onSubmit:o.onSubmit(n),children:(0,r.jsxs)(k.K,{children:[(0,r.jsx)(et.Ph,{label:"Timezone:",withinPortal:!0,data:o.values.timezonesList,...o.getInputProps("timezone"),searchable:!0}),(0,r.jsx)(en.X,{label:"Synchronize time with NTP server",checked:o.values.useNtp,...o.getInputProps("useNtp")}),!o.values.useNtp&&(0,r.jsx)(ei.x,{popoverProps:{withinPortal:!0},label:"Set current time:",...o.getInputProps("setTime")}),(0,r.jsx)(em.Z,{type:"submit",inProgress:s,children:"Save"})]})})}let eh=(0,y.k)(e=>({card:{padding:e.spacing.xs,textAlign:"center"}}));function GeneralStatus(e){let{time:t,cpus:n,storage:o,ram:a,temperatureCelsius:i,voltage:l}=e,{classes:d}=eh(),[u,p]=_.useState(!1);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(ex.Z,{title:"Time settings",form:TimeSettingsForm,useSettings:eu.rV,save:eu.zQ,opened:u,setOpened:p}),(0,r.jsx)(er.Z,{h:"100%",children:(0,r.jsxs)(er.Z.Section,{children:[(0,r.jsxs)(k.K,{spacing:"xs",pb:"sm",sx:e=>({borderBottom:"1px solid ".concat(e.colors.gray[3])}),children:[(0,r.jsxs)(c.Z,{align:"center",position:"center",noWrap:!0,spacing:4,sx:e=>({borderBottom:"1px solid ".concat(e.colors.gray[3])}),pb:"xs",children:[(0,r.jsx)(s.x,{size:"sm",align:"center",children:(0,ed.o0)(1e3*t.now)}),(0,r.jsx)(es.A,{color:"blue",size:"xs",onClick:()=>p(!0),children:(0,r.jsx)(el.Z,{})})]}),(0,r.jsxs)(c.Z,{align:"start",position:"apart",noWrap:!0,children:[(0,r.jsx)(s.x,{size:"sm",c:"grey",children:"Uptime"}),(0,r.jsx)(s.x,{size:"sm",children:(0,ep.Ch)(t.os)})]}),(0,r.jsxs)(c.Z,{align:"start",position:"apart",noWrap:!0,children:[(0,r.jsx)(s.x,{size:"sm",c:"grey",children:"Runtime"}),(0,r.jsx)(s.x,{size:"sm",children:(0,ep.Ch)(t.process)})]})]}),n.length>0&&(0,r.jsxs)(D.x,{className:d.card,sx:e=>({borderBottom:"1px solid ".concat(e.colors.gray[3])}),children:[(0,r.jsx)(s.x,{children:(0,r.jsx)("b",{children:"CPU"})}),(0,r.jsx)(c.Z,{position:"center",pt:"sm",spacing:"xs",children:n.map((e,t)=>(0,r.jsxs)(B.C,{color:e>.8?"red":e>.5?"orange":"green",maw:"60px",children:[Math.round(100*e),"%"]},t))})]}),(0,r.jsxs)(eo.M,{cols:2,spacing:0,children:[(0,r.jsxs)(D.x,{sx:e=>({borderBottom:"1px solid ".concat(e.colors.gray[3]),borderRight:"1px solid ".concat(e.colors.gray[3])}),className:d.card,children:[(0,r.jsx)("b",{children:"SD"}),o?(0,r.jsx)(MemGauge,{usedBytes:o.usedBytes,totalBytes:o.totalBytes}):(0,r.jsx)(s.x,{children:"-"})]}),(0,r.jsxs)(D.x,{className:d.card,sx:e=>({borderBottom:"1px solid ".concat(e.colors.gray[3])}),children:[(0,r.jsx)("b",{children:"RAM"}),(0,r.jsx)(MemGauge,{usedBytes:a.usedBytes,totalBytes:a.totalBytes})]})]}),(0,r.jsxs)(eo.M,{cols:2,spacing:0,children:[(0,r.jsxs)(D.x,{className:d.card,sx:e=>({borderRight:"1px solid ".concat(e.colors.gray[3])}),children:[l?l.toFixed(1):"-"," ",(0,r.jsx)("b",{children:"V"})]}),(0,r.jsx)(D.x,{className:d.card,children:(0,r.jsxs)(s.x,{c:i?i>80?"red":i>50?"orange":"black":"dimmed",children:[i?i.toFixed(1):"-"," ",(0,r.jsx)("b",{children:"\xb0C"})]})})]})]})})]})}function MemGauge(e){let{usedBytes:t,totalBytes:n}=e,o=Math.round(t/1048576),a=Math.round(n/1048576),i=o/a;return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(s.x,{size:10,color:"dimmed",children:[o,"/",a," Mb"]}),(0,r.jsx)(ea.E,{size:"xs",value:100*o/a,color:i>.8?"red":i>.5?"orange":"green"})]})}var ef=n(7443),eg=n(1625),ev=n(4051),eb=n(3017),ej=n(1725),ey=n(7860),eS=n(4985),ek=n(7209),ew=n(3905),eB=n(9640),eN=n(571);function StatusVisualization(e){let{internet:t,lan:n,mbtcpClients:s,mbtcpServer:o,gsm:a,rc:i,rs485:l,vpn:d,wifi:u}=e,p=(0,M.rZ)(),m={border:p.colors.blue[6],disabled:p.colors.gray[6],error:p.colors.red[6],ok:p.colors.green[6],black:p.colors.gray[8],warn:p.colors.orange[6]},x=("unregistered"===d.connection.status||"disabled"===d.connection.status)&&"disabled"===i.status?"disabled":"offline"===d.connection.status&&"online"!==i.status&&"unbound"!==i.status||"offline"===i.status&&"online"!==d.connection.status?"error":"online",h=Object.values(l).length;return(0,r.jsxs)(c.Z,{position:"center",children:[(0,r.jsx)(L.z,{smallerThan:"xs",styles:{display:"none"},children:(0,r.jsxs)("svg",{width:"100%",height:"100%",viewBox:"".concat("disabled"===t.status?300:0," 68 ").concat(900+100*h+40," 382"),style:{maxHeight:"280px"},children:[(0,r.jsx)("defs",{children:(0,r.jsx)("marker",{id:"head",orient:"auto",markerWidth:"4",markerHeight:"4",refX:"2",refY:"2",children:(0,r.jsx)("path",{d:"M0,0 V4 L4,2 Z",fill:m.ok})})}),"disabled"!==t.status&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("image",{href:"/media/overvis-basic-logo.svg",width:65,x:5,y:300}),"online"===d.connection.status?(0,r.jsx)(ef.Z,{size:80,stroke:1,x:"0",y:"225",color:m.ok}):(0,r.jsx)(eg.Z,{size:80,stroke:1,x:"0",y:"225",color:"disabled"===x||"error"===x?m.disabled:m.border}),"disabled"!==x&&(0,r.jsx)(r.Fragment,{children:(0,r.jsx)("path",{strokeWidth:4,fill:"none",strokeDasharray:"online"===x?"0":"4,8",stroke:"error"===x?m.error:m.ok,strokeLinejoin:"round",d:"M90,265 H192",markerEnd:"online"===x?"url(#head)":""})}),"online"===t.status&&t.ip&&(0,r.jsx)("text",{x:240,y:220,fill:m.ok,style:{textAnchor:"middle"},children:t.ip})]}),(0,r.jsx)(ev.Z,{size:80,stroke:1,x:"200",y:"225",color:"online"===t.status?m.border:m.disabled}),("online"===t.status||"offline"===t.status&&("connected"===n.status||"connected"===u.status))&&(0,r.jsx)(r.Fragment,{children:(0,r.jsx)("path",{strokeWidth:4,fill:"none",stroke:"online"===t.status?t.ping&&t.ping<100?m.ok:m.warn:m.error,strokeDasharray:"online"===t.status?"0":"4,8",strokeLinejoin:"round",d:"M290,265 H491"})}),(0,r.jsx)(MbtcpServer,{server:o,colors:m,x:390.5,y:100}),(0,r.jsx)(MbtcpClients,{clients:s,colors:m,x:390.5,y:425}),(0,r.jsx)(eb.Z,{size:80,stroke:1,x:"500",y:"215",color:"connected"===n.status||"connected"===u.status?m.border:m.disabled}),("connected"===u.status||"disconnected"===u.status)&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("text",{x:540,y:80,fill:"connected"===u.status?m.ok:m.error,children:["SSID: ",(0,r.jsx)("tspan",{style:{fontWeight:"bold"},children:u.ssid})]}),(0,r.jsx)("path",{strokeWidth:4,fill:"none",stroke:"connected"===u.status?m.ok:m.error,strokeDasharray:"connected"===u.status?"0":"4,8",strokeLinejoin:"round",d:"M717,105 V90 H540 V210"})]}),("connected"===n.status||"disconnected"===n.status)&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("path",{strokeWidth:4,fill:"none",stroke:"connected"===n.status?m.ok:m.error,strokeDasharray:"connected"===n.status?"0":"4,8",strokeLinejoin:"round",d:"M717,412 V427 H540 V300"}),"connected"===n.status&&(0,r.jsx)("text",{x:540,y:450,fill:m.ok,children:n.ip})]}),(0,r.jsx)(OpcbImage,{colors:m,x:668,y:125,wifi:u,lanStatus:n.status,rs485PortsNum:h}),h>0&&(0,r.jsx)("path",{strokeWidth:2,fill:"none",stroke:h>0?m.border:m.disabled,strokeLinejoin:"round",d:"M847,412 V427 H".concat(900+100*Math.max(h,1)+40)}),(0,r.jsx)(Rs485Ports,{colors:m,rs485:l,spacing:100,shift:40})]})}),(0,r.jsx)(L.z,{largerThan:"xs",styles:{display:"none"},children:(0,r.jsx)(c.Z,{position:"center",children:(0,r.jsx)(D.x,{maw:200,children:(0,r.jsx)("svg",{width:"100%",height:"100%",viewBox:"0 0 235 290",children:(0,r.jsx)(OpcbImage,{colors:m,x:2,y:10,wifi:u,lanStatus:n.status,rs485PortsNum:h})})})})})]})}function OpcbImage(e){let{colors:t,x:n,y:s,wifi:o,lanStatus:a,rs485PortsNum:i}=e;return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("image",{href:"/media/opcb-top.png",x:n-10,y:s+5,width:"250",height:"250"}),(0,r.jsx)("rect",{x:n,y:s,width:"230",height:"265",rx:"20",stroke:t.border,strokeWidth:2,fill:"transparent"}),(0,r.jsx)("rect",{x:n+35,y:s-20,width:"30",height:"30",fill:"white",rx:"5px"}),(0,r.jsx)(ej.Z,{stroke:2,x:n+35+3,y:s-12,color:"disabled"===o.status?t.disabled:"disconnected"===o.status?t.error:t.ok}),"ap"===o.status&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("text",{x:n+35+5,y:s-40,fill:t.ok,children:["Access Point: ",(0,r.jsx)("tspan",{style:{fontWeight:"bold"},children:o.ssid})]}),(0,r.jsx)("text",{x:n+35+5,y:s-20,fill:t.ok,children:o.url})]}),(0,r.jsx)("rect",{x:n+35,y:s+250,width:"30",height:"30",fill:"white",rx:"5px"}),(0,r.jsx)(ey.Z,{stroke:2,x:n+35+3,y:s+250+3,color:"disabled"===a?t.disabled:"disconnected"===a?t.error:t.ok}),(0,r.jsx)("rect",{x:n+165,y:s+250,width:"30",height:"30",fill:"white",rx:"5px"}),(0,r.jsx)(eS.Z,{stroke:2,x:n+165+3,y:s+250+3,color:i>0?t.border:t.disabled})]})}function MbtcpServer(e){let{x:t,y:n,server:s,colors:o}=e;if("disabled"===s.status)return(0,r.jsx)(r.Fragment,{});let a=s.clients.filter(e=>"master"===e.mode.status).length,i=s.clients.filter(e=>"slave"===e.mode.status).length,c=a>0?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(ek.Z,{size:20,stroke:2,x:t-130,y:n+18,color:o.border}),(0,r.jsxs)("text",{x:t-137,y:n+18+15,fill:o.border,textAnchor:"end",children:[a," \xd7"]}),(0,r.jsx)("path",{strokeWidth:4,fill:"none",stroke:o.ok,strokeLinejoin:"round",d:"M".concat(t-98,",").concat(n+18+11," H").concat(t-40),markerEnd:"url(#head)"})]}):(0,r.jsx)(r.Fragment,{}),l=i>0?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(ew.Z,{size:20,stroke:2,x:t-130,y:n+43,color:o.border}),(0,r.jsxs)("text",{x:t-137,y:n+43+15,fill:o.border,textAnchor:"end",children:[i," \xd7"]}),(0,r.jsx)("path",{strokeWidth:4,fill:"none",stroke:o.ok,strokeLinejoin:"round",d:"M".concat(t-37,",").concat(n+43+11," H").concat(t-95),markerEnd:"url(#head)"})]}):(0,r.jsx)(r.Fragment,{});return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("text",{x:t,y:n-20,fill:o.ok,style:{textAnchor:"middle"},children:"Serving Modbus TCP"}),(0,r.jsxs)("text",{x:t,y:n,fill:o.ok,style:{textAnchor:"middle"},fontWeight:"bold",children:[s.listenIp,":",s.listenPort]}),(0,r.jsx)(eB.Z,{size:60,stroke:1.25,x:t-30,y:n,color:o.border})," ",(0,r.jsx)("path",{strokeWidth:2,fill:"none",stroke:o.ok,strokeLinejoin:"round",d:"M".concat(t,",253 V").concat(n+60)}),c,l]})}function MbtcpClients(e){let{x:t,y:n,clients:s,colors:o}=e;if(Object.values(s).length<1)return(0,r.jsx)(r.Fragment,{});let a=t-10,i=Object.values(s).map((e,s)=>{let i="connected"===e.info.status?o.ok:"disconnected"===e.info.status?o.error:o.disabled;return s<4?(0,r.jsxs)("g",{children:[(0,r.jsx)("text",{fontWeight:"bold",x:a-130,y:n-25*s,fill:i,style:{textAnchor:"end"},children:e.address}),"master"===e.mode.status?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(ek.Z,{size:20,stroke:2,x:a-120,y:n-25*s-16,color:i}),"disabled"!==e.info.status&&(0,r.jsx)("path",{strokeWidth:4,fill:"none",stroke:i,strokeLinejoin:"round",d:"M".concat(a-85,",").concat(n-25*s-6," H").concat(t-20+("connected"===e.info.status?0:5)),markerEnd:"connected"===e.info.status?"url(#head)":"",strokeDasharray:"connected"===e.info.status?"0":"4,8"})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(ew.Z,{size:20,stroke:2,x:a-120,y:n-25*s-17,color:i}),"disabled"!==e.info.status&&(0,r.jsx)("path",{strokeWidth:4,fill:"none",stroke:i,strokeLinejoin:"round",d:"M".concat(t-15,",").concat(n-25*s-6," H").concat(a-80-("connected"===e.info.status?0:5)),markerEnd:"connected"===e.info.status?"url(#head)":"",strokeDasharray:"connected"===e.info.status?"0":"4,8"})]})]},"".concat(e.address)):(0,r.jsx)(r.Fragment,{})});return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("path",{strokeWidth:2,fill:"none",stroke:o.ok,strokeLinejoin:"round",d:"M".concat(t,",277 V").concat(n)}),i]})}function Rs485Ports(e){let{rs485:t,colors:n,spacing:s,shift:o}=e,a=900+o;return(0,r.jsx)(r.Fragment,{children:Object.entries(t).map((e,t)=>{let[o,i]=e,c="connected"===i.info.status?n.border:"disabled"===i.info.status?n.disabled:n.error;return(0,r.jsxs)("g",{children:[(0,r.jsx)("text",{x:a+s*t+s/2,y:230,textAnchor:"middle",fill:c,fontWeight:"bold",children:i.device}),(0,eN.iC)(i.mode.protocol)?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(ek.Z,{size:60,stroke:1.25,x:a+t*s+s/2-30,y:230,color:c}),"disabled"!==i.info.status&&(0,r.jsx)("path",{strokeWidth:4,fill:"none",stroke:"connected"===i.info.status?n.ok:n.error,strokeLinejoin:"round",d:"M".concat(a+t*s+s/2,",").concat(300," V").concat("connected"===i.info.status?405:410),markerEnd:"connected"===i.info.status?"url(#head)":"",strokeDasharray:"connected"===i.info.status?"0":"4,8"})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(ew.Z,{size:60,stroke:1.25,x:a+t*s+s/2-30,y:230,color:c}),"disabled"!==i.info.status&&(0,r.jsx)("path",{strokeWidth:4,fill:"none",stroke:"connected"===i.info.status?n.ok:n.error,strokeLinejoin:"round",d:"M".concat(a+t*s+s/2,",415 V").concat(295),markerEnd:"connected"===i.info.status?"url(#head)":"",strokeDasharray:"connected"===i.info.status?"0":"4,8"})]})]},"".concat(o))})})}var eT=n(7964);function HeaderStatus(){let e=(0,ee.ZB)();if(!e.data)return e.error?(0,r.jsx)(r.Fragment,{children:"Error"}):(0,r.jsx)($.M,{my:"lg",children:(0,r.jsx)(l.a,{})});let t=e.data;return(0,r.jsx)(r.Fragment,{children:(0,r.jsxs)(J.r,{my:4,gutter:"sm",children:[(0,r.jsx)(J.r.Col,{md:3,sm:4,children:(0,r.jsx)(c.Z,{position:"center",pb:"sm",children:(0,r.jsx)(X.z,{component:q(),href:"/quick-setup",size:"xs",leftIcon:(0,r.jsx)(eT.Z,{size:13}),variant:"outline",uppercase:!0,children:"Quick setup"})})}),(0,r.jsx)(J.r.Col,{sm:8,md:9}),(0,r.jsx)(J.r.Col,{order:4,orderSm:1,sm:4,md:3,children:(0,r.jsx)(GeneralStatus,{...t.general})}),(0,r.jsx)(J.r.Col,{order:3,orderSm:2,sm:8,md:9,sx:{alignSelf:"center"},children:(0,r.jsx)(StatusVisualization,{...t})}),(0,r.jsx)(J.r.Col,{order:5,span:12,children:(0,r.jsx)(c.Z,{position:"center",children:(0,r.jsxs)(s.x,{align:"center",size:"xs",color:"dimmed",children:["Firmware: ",t.general.firmware.version," (",t.general.firmware.date,")"]})})})]})})}var eC=n(3550),eM=n(6078),eP=n(3063),eL=n(3738);async function saveDeviceName(e){return(0,eL.NC)({"global:userProvidedDeviceName":e||""})}function Logo(e){let t=(0,M.rZ)(),[n,o]=(0,_.useState)(!1),[a,i]=(0,_.useState)(e.deviceUserProvidedName||""),[d,u]=(0,_.useState)(!1),p=(0,g.A)();return(0,r.jsxs)(c.Z,{noWrap:!0,children:[(0,r.jsx)(q(),{href:"/",style:{textDecoration:"none"},children:(0,r.jsx)(T(),{src:"/media/overvis-basic-logo.svg",width:"100",height:"40",alt:"Overvis Logo"})}),n?d?(0,r.jsx)(l.a,{size:24}):(0,r.jsx)("form",{onSubmit:async e=>{e.preventDefault(),u(!0),await saveDeviceName(a),p.mutate(),u(!1),o(!1)},children:(0,r.jsx)(eC.i,{active:!0,children:(0,r.jsx)(eM.o,{value:a,onChange:e=>{let t=e.currentTarget.value;t.length>30&&(t=t.substring(0,30)),i(t)},onBlur:async()=>{u(!0),await saveDeviceName(a),p.mutate(),u(!1),o(!1)},placeholder:e.deviceModelName})})}):(0,r.jsxs)(c.Z,{spacing:4,children:[(0,r.jsx)(q(),{href:"/",style:{textDecoration:"none"},children:(0,r.jsxs)(k.K,{align:"flex-start",justify:"flex-start",spacing:0,mt:e.deviceUserProvidedName?"19px":"0px",children:[(0,r.jsx)(s.x,{sx:e=>({fontSize:"20px",color:e.colors.dark[9],lineHeight:"20px",fontWeight:700,maxWidth:"400px",overflow:"hidden",textOverflow:"ellipsis"}),transform:"uppercase",children:e.deviceUserProvidedName?e.deviceUserProvidedName:e.deviceModelName}),e.deviceUserProvidedName&&(0,r.jsx)(s.x,{sx:e=>({fontSize:"12px",color:e.colors.dark[3]}),transform:"uppercase",children:e.deviceModelName})]})}),(0,r.jsx)(s.x,{color:t.colors.blue[3],sx:{position:"relative",top:"4px",cursor:"pointer","&:hover":{color:t.colors.blue[6]}},children:(0,r.jsx)(eP.Z,{size:14,onClick:e=>{o(!0),e.preventDefault(),e.stopPropagation()}})})]})]})}let eO=(0,y.k)(e=>({mainLink:{textTransform:"uppercase",fontSize:13,color:e.colors[e.primaryColor][6],padding:"7px ".concat(e.spacing.sm),fontWeight:700,borderBottom:"2px solid transparent",transition:"border-color 100ms ease, color 100ms ease","&:hover":{color:"dark"===e.colorScheme?e.white:e.black,textDecoration:"none"}},secondaryLink:{color:"dark"===e.colorScheme?e.colors.dark[2]:e.colors.gray[6],fontSize:"10px",textTransform:"uppercase",transition:"color 100ms ease",borderRadius:e.radius.sm,"&:hover":{color:"dark"===e.colorScheme?e.white:e.black,textDecoration:"none"}},mainLinkActive:{color:e.black,borderBottomColor:e.black,pointerEvents:"none"},secondaryLinkActive:{backgroundColor:e.colors.gray[6],color:e.white,pointerEvents:"none"}}));function pathIsActive(e,t){return"/"===t?"/"===e:e.startsWith(t)}function OpcbHeader(e){let{manufacturerModeEnabled:t,deviceModelName:n,deviceUserProvidedName:o}=e,[i,{toggle:l}]=(0,F.q)(!1),{classes:d,cx:u}=eO(),p=(0,m.useRouter)(),x=(0,M.rZ)(),{token:f}=(0,h.pk)(),g=x.colors[x.primaryColor][6],v=[{link:"/",label:"Dashboard",icon:(0,r.jsx)(E.Z,{width:"18px"})},{link:"/automation",label:"Automation",icon:(0,r.jsx)(R.Z,{width:"18px"})},{link:"/connections/modbus-rs485",label:"Connections",icon:(0,r.jsx)(A.Z,{width:"18px"}),checkPath:"/connections"},{link:"/internet",label:"LAN/Internet",icon:(0,r.jsx)(V.Z,{width:"18px"})}],b=p.pathname,j=v.map(e=>(0,r.jsx)(w.e,{href:e.link,className:u(d.mainLink,{[d.mainLinkActive]:pathIsActive(b,e.checkPath||e.link)}),component:q(),children:(0,r.jsxs)(c.Z,{spacing:5,children:[e.icon,e.label]})},e.link)),y=[{link:"/control",label:"Control",icon:(0,r.jsx)(W.Z,{width:"12px"})},{link:"/access",label:"Access",icon:(0,r.jsx)(U.Z,{width:"12px"})}];t&&y.push({link:"/manufacture/register",label:"Manufacturing",icon:(0,r.jsx)(H.Z,{width:"12px"}),checkPath:"/manufacture"}),y.push({link:"/logout",label:"Log Out",icon:(0,r.jsx)(K.Z,{width:"12px"})});let B=y.map(e=>(0,r.jsxs)(_.Fragment,{children:["/logout"===e.link&&(null==f?void 0:f.username)&&"admin"!==f.username?(0,r.jsx)(s.x,{sx:{fontSize:"10px",fontWeight:700,marginRight:"-5px",paddingLeft:"8px"},children:null==f?void 0:f.username}):null,(0,r.jsx)(w.e,{href:e.link,className:u(d.secondaryLink,{[d.secondaryLinkActive]:pathIsActive(b,e.checkPath||e.link)}),component:q(),px:"sm",children:(0,r.jsxs)(c.Z,{spacing:5,children:[e.icon,e.label]})})]},e.label)),[N,T]=(0,_.useState)(!1),[C,G]=(0,_.useState)(!1);return(0,r.jsxs)(P.h,{height:84,mb:"lg",withBorder:!1,pos:"relative",zIndex:101,style:{flex:0},children:[(0,r.jsxs)(a.W,{size:"lg",sx:e=>({borderBottom:"2px solid black"}),bg:"white",children:[(0,r.jsxs)(k.K,{spacing:"xs",children:[(0,r.jsxs)(S.k,{justify:"space-between",align:"center",mih:84,children:[(0,r.jsx)(Logo,{deviceModelName:n,deviceUserProvidedName:o}),(0,r.jsx)(L.z,{smallerThan:"md",styles:{display:"none"},children:(0,r.jsxs)(k.K,{spacing:0,justify:"space-between",h:84,pt:"lg",children:[(0,r.jsx)(c.Z,{position:"right",spacing:0,mr:"-sm",children:B}),(0,r.jsx)(c.Z,{spacing:0,position:"right",mr:"-sm",children:j})]})}),(0,r.jsx)(L.z,{largerThan:"md",styles:{display:"none"},children:(0,r.jsx)(O.O,{opened:i,onClick:l,size:"sm"})})]}),(0,r.jsx)(L.z,{largerThan:"md",styles:{display:"none"},children:(0,r.jsxs)(z.U,{in:i,pb:"lg",children:[(0,r.jsx)(k.K,{spacing:"xs",children:v.map(e=>(0,r.jsx)(I.O,{label:e.label,icon:e.icon,active:pathIsActive(b,e.link),component:q(),href:e.link,sx:{textTransform:"uppercase",fontWeight:700}},e.link))}),(0,r.jsx)(k.K,{spacing:"xs",pt:"lg",children:y.map(e=>(0,r.jsx)(I.O,{label:e.label,icon:e.icon,active:pathIsActive(b,e.link),component:q(),href:e.link,sx:{textTransform:"uppercase",fontSize:"10px"}},e.link))})]})})]}),(0,r.jsx)(z.U,{transitionDuration:100,in:N,onTransitionEnd:()=>{G(N)},children:N||C?(0,r.jsx)(HeaderStatus,{}):(0,r.jsx)(r.Fragment,{})})]}),(0,r.jsx)(a.W,{size:"lg",pl:"132px",children:(0,r.jsx)(Z.k,{onClick:()=>T(e=>!e),px:"10px",bg:"white",pos:"relative",top:"-2px",c:g,sx:{"&:hover":{color:"black"},borderEndStartRadius:"4px",borderEndEndRadius:"4px",borderBottom:"2px solid black",borderLeft:"2px solid black",borderRight:"2px solid black"},children:(0,r.jsx)(D.x,{h:"23px",mt:"-3px",children:N?(0,r.jsx)(Q.Z,{}):(0,r.jsx)(Y.Z,{})})})})]})}function OpcbLayout(e){var t;let{children:n,pageTitle:u,contentIsLoading:m}=e,y=(0,g.A)(),S=(0,h.pk)(),k=!!y.data,w=(0,f.h)();return(null===(t=y.data)||void 0===t?void 0:t.quickSetupIsDone)===!1&&("192.168.4.1"===window.location.hostname||"setup.overvis.com"===window.location.hostname)&&S.token&&!S.token.skipQuickSetup&&x().push("/quick-setup"),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(j.s,{dataLoaded:k,dataErrored:!!y.error}),(0,r.jsx)(p(),{children:(0,r.jsx)("title",{children:"OPCB :: ".concat(u)})}),y.data?(0,r.jsx)(o.V,{padding:"md",style:{height:w?"100%":"100vh",display:"flex",flexDirection:"column"},styles:{body:{flex:1}},fixed:!1,header:(0,r.jsx)(OpcbHeader,{manufacturerModeEnabled:y.data.manufacturerModeEnabled,deviceModelName:y.data.modelName,deviceUserProvidedName:y.data.userProvidedName}),footer:w?(0,r.jsx)(r.Fragment,{}):(0,r.jsx)(OpcbFooter,{firmwareVersion:y.data.firmwareVersion,firmwareDate:y.data.firmwareDate,updateState:y.data.updateState}),children:(0,r.jsxs)(a.W,{size:"lg",mih:400,py:"lg",children:[y.data.lastSuccessfulUpgradeRef&&(0,r.jsx)(i.b,{title:"Firmware updated",color:"green",withCloseButton:!0,mb:30,icon:(0,r.jsx)(d.Z,{}),onClose:async()=>{await (0,v.aT)(),y.mutate()},children:(0,r.jsxs)(c.Z,{spacing:4,children:[(0,r.jsxs)(s.x,{children:["OPCB has been updated to version"," ",(0,r.jsx)("b",{children:y.data.lastSuccessfulUpgradeRef}),"."]}),(0,r.jsx)(b.Z,{children:"List of changes"})]})}),k?m?(0,r.jsx)(c.Z,{position:"center",p:"xl",children:(0,r.jsx)(l.a,{})}):n:(0,r.jsx)(r.Fragment,{})]})}):(0,r.jsxs)(s.x,{display:"none",children:["Loading ",null!==y.data&&""]})]})}},9804:function(e,t,n){n.d(t,{LU:function(){return formatDuration},k6:function(){return localTimeString},o0:function(){return formatDateTime}});var r=n(9089),s=n.n(r),o=n(3572),a=n.n(o);function formatDateTime(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=n?"YYYY-MM-DD HH:mm:ss":"YYYY-MM-DD HH:mm";return t?s()(e).format(r):s()(e).utc().format(r)}function localTimeString(e){return"".concat(e.toLocaleTimeString(),".").concat(e.getMilliseconds().toString().padStart(3,"0"))}function formatDuration(e){let t=Math.floor(e/36e5),n=Math.floor((e-36e5*t)/6e4),r=Math.floor((e-36e5*t-6e4*n)/1e3);return"".concat(t,"h ").concat(n,"m ").concat(r,"s")}s().extend(a())},8464:function(e,t,n){n.d(t,{$:function(){return submitFormProcess}});var r=n(6680);async function submitFormProcess(e,t,n,s,o,a){e(!0),(0,r.c0)({id:"settings-save",withCloseButton:!0,autoClose:!1,loading:!0,icon:null,color:"orange",title:"Saving settings...",message:"Please wait while the new settings are applied..."});try{await t()}catch(t){return(0,r.wD)({id:"settings-save",loading:!1,withCloseButton:!0,color:"red",icon:n,title:"Error saving settings",message:"There was an error saving settings. Please check form data and try again."}),console.error(t),e(!1),!1}return o&&o(),e(!1),(0,r.wD)({id:"settings-save",loading:!1,withCloseButton:!0,autoClose:5e3,color:"green",icon:s,title:"Settings saved",message:"Settings were saved and applied successfully."}),a&&a(),!0}n(3900)},1260:function(e,t,n){n.d(t,{cH:function(){return makeTimezoneRecord},rV:function(){return useSettings},zQ:function(){return saveSettings}});var r=n(52),s=n(3738);async function settingsFetcher(e){var t;let[n,r]=e,o=await (0,s.wv)(r,["global:time:timezone","global:time:useNtp"]),a=await (0,s.vn)(r,"/api/state/?keys=".concat("time:timezones"));return{timezone:o["global:time:timezone"]||"Etc/UTC",useNtp:"true"===o["global:time:useNtp"],timezonesList:(null===(t=a["time:timezones"])||void 0===t?void 0:t.split("\n"))||[],setTime:new Date}}function useSettings(){let e=(0,r.tQ)("time-settings",settingsFetcher);return{...e}}function makeTimezoneRecord(e){let t={"global:time:timezone":e.timezone,"global:time:useNtp":e.useNtp?"true":"false"};return t}async function saveSettings(e){let t=(0,r.bH)(),n=makeTimezoneRecord(e);if(await (0,r.ri)(t,"/api/confs/set/",{method:"POST",body:JSON.stringify(n),timeoutMs:3e4}),!e.useNtp&&e.setTime){let n=e.setTime;await (0,r.ri)(t,"/api/set-time/",{method:"POST",body:JSON.stringify({time:n.toISOString()}),timeoutMs:3e4})}}},1827:function(e,t,n){n.d(t,{A:function(){return useBasicSettings}});var r=n(52),s=n(3738);async function basicSettingsFetcher(e){let[t,n]=e,r="global:modelName,global:userProvidedDeviceName,global:quickSetupIsDone",o=await (0,s.vn)(n,"/api/confs/?keys=".concat(r));r="release:date,release:version,release:updateState,release:latestPatch:version,release:latestMinor:version,release:latestMajor:version,release:scheduledUpgradeToTag,release:lastSuccessfulUpgradeRef,manufacturer:modeEnabled";let a=await (0,s.vn)(n,"/api/state/?keys=".concat(r)),i="no-update";if(a["release:scheduledUpgradeToTag"]){let e=a["release:scheduledUpgradeToTag"],t=e.split("/");t.length>1&&(e=t[1]),i={kind:"scheduled",version:e}}else"disabled"===a["release:updateState"]?i="disabled":"no-repo"===a["release:updateState"]?i="no-repo":"dirty-repo"===a["release:updateState"]?i="dirty-repo":"broken-repo"===a["release:updateState"]?i="broken-repo":"available-update-patch"===a["release:updateState"]?i={kind:"available",version:a["release:latestPatch:version"]||"unknown version"}:"available-update-minor"===a["release:updateState"]?i={kind:"available",version:a["release:latestMinor:version"]||"unknown version"}:"available-update-major"===a["release:updateState"]?i={kind:"available",version:a["release:latestMajor:version"]||"unknown version"}:"imminent-upgrade"===a["release:updateState"]&&(i="upgrading");return{userProvidedName:o["global:userProvidedDeviceName"]||void 0,modelName:o["global:modelName"]||"OPCB",quickSetupIsDone:"true"===o["global:quickSetupIsDone"],manufacturerModeEnabled:"true"===a["manufacturer:modeEnabled"],firmwareVersion:a["release:version"]||"unknown",firmwareDate:a["release:date"]||"-",updateState:i,lastSuccessfulUpgradeRef:a["release:lastSuccessfulUpgradeRef"]||void 0}}function useBasicSettings(){return(0,r.tQ)("basic-settings",basicSettingsFetcher)}},8899:function(e,t,n){n.d(t,{ZB:function(){return useFullStatus}});var r=n(52),s=n(8988),o=n(2967),a=n(928),i=n(3738),c=n(8431);async function fullStatusConfFetcher(e){let[t,n]=e,r=await (0,i.vn)(n,"/api/confs/?keys=".concat("overvisReverseConnection:baseConnectUrl,overvisVpn:isEnabled,overvisVpn:pinCode,overvisVpn:wireguard:privateKey,overvisVpn:boundToOcpServer,overvisVpn:boundToOcpAccountEmail,overvisVpn:wireguard:vpnMotherlandServerIp,overvisVpn:wireguard:ipAddressCidr,elan:mac,global:model"));return{rcBaseConnectUrl:r["overvisReverseConnection:baseConnectUrl"],vpnIsEnabled:"true"===r["overvisVpn:isEnabled"],pinCode:r["overvisVpn:pinCode"],wgPrivateKey:r["overvisVpn:wireguard:privateKey"],vpnBoundToOcpServer:r["overvisVpn:boundToOcpServer"],vpnBoundToOcpAccountEmail:r["overvisVpn:boundToOcpAccountEmail"],mac:r["elan:mac"]||"<not set>",model:r["global:model"]||"<not set>",vpnMotherlandServerIp:r["overvisVpn:wireguard:vpnMotherlandServerIp"]||"<not set>",assignedVpnIp:r["overvisVpn:wireguard:ipAddressCidr"]||"<not set>"}}async function fullStatusFetcher(e){let[t,n]=e,r=await fullStatusConfFetcher(["/api/confs/",n]),l=await (0,i.vn)(n,"/api/state/");return{general:function(e){let t,n,r;let s=[];for(let t=0;t<16&&e.hasOwnProperty("sys:cpus:".concat(t));t++)s.push(Number(e["sys:cpus:".concat(t)]));return e.hasOwnProperty("storage:total")&&e.hasOwnProperty("storage:used")&&(t={totalBytes:Number(e["storage:total"]),usedBytes:Number(e["storage:used"])}),e.hasOwnProperty("temperature")&&(n=Math.round(10*Number(e.temperature))/10),e.hasOwnProperty("voltage")&&(r=Math.round(10*Number(e.voltage))/10),{time:{os:Math.round(Number(e["time:os"])),process:Math.round(Number(e["time:process"])),now:Math.round(Number(e["time:now"])/1e3),nowUtc:Math.round(Number(e["time:nowUtc"])/1e3)},cpus:s,firmware:{date:e["release:date"]||"-",version:e["release:version"]||"unknown"},ram:{totalBytes:Number(e["ram:total"]),usedBytes:Number(e["ram:used"])},storage:t,temperatureCelsius:n,voltage:r,manufacturerModeEnabled:"true"===e["manufacturer:modeEnabled"]}}(l),internet:function(e){let t={status:"disabled"};if(e.hasOwnProperty("inet:ping")){let n=e["inet:ping"];"unreachable"===n?t={status:"offline"}:(t={status:"online",ping:Number(n)},e.hasOwnProperty("inet:externalIp")&&(t.ip=e["inet:externalIp"]))}return t}(l),rc:function(e,t){let n,r;let s=e["overvisRc:status"]||"disabled",o=e["overvisRc:iface"],a=e["overvisRc:address"],i=e["overvisRc:lastError"],c=e["overvisRc:lastConnectionOn"];c&&(r=new Date(1e3*Number(c)).toISOString());let l=e["overvisRc:mac"],d=e["overvisRc:connectionAttemptsNum"],u=e["overvisRc:activationCode"],p=e["overvisRc:boundAccountEmail"],m=e["overvisRc:rx:total"],x=e["overvisRc:rx:connection"],h=e["overvisRc:rx:speed"],f=e["overvisRc:rx:lastTransferOn"],g=e["overvisRc:tx:total"],v=e["overvisRc:tx:connection"],b=e["overvisRc:tx:speed"],j=e["overvisRc:tx:lastTransferOn"];if("disabled"!==s&&o&&a&&l){if("waiting"!==s&&"connecting"!==s&&r){let e=Math.round((Date.now()-Number(r))/1e3),s={rxSpeedBytesPerSec:Number(h)||0,rxTotalBytes:Number(m)||0,rxConnectionBytes:Number(x)||0,rxLastBytesSinceSec:f?Math.round(Date.now()/1e3)-Number(f):0,txSpeedBytesPerSec:Number(b)||0,txTotalBytes:Number(g)||0,txConnectionBytes:Number(v)||0,txLastBytesSinceSec:j?Math.round(Date.now()/1e3)-Number(j):0};n=u?{status:"unbound",interface:o,mac:l,ocpServer:a,activationCode:u,bindLink:"".concat(t,"/manage/connect-rc/").concat(u,"/"),connectedSec:e,rxtx:s}:{status:"online",interface:o,mac:l,ocpServer:a,connectedSec:e,boundAccountEmail:p,openLink:"".concat(t,"/manage/net-by-mac/").concat(l,"/"),rxtx:s}}else n={status:"offline",attemptNum:Number(d)||0,interface:o,lastConnectionOn:r,mac:l,ocpServer:a,lastError:i}}else n={status:"disabled"};return n}(l,r.rcBaseConnectUrl||"https://ocp.overvis.com"),vpn:function(e,t){let n,{vpnIsEnabled:r,mac:s,wgPrivateKey:o,vpnBoundToOcpAccountEmail:a,vpnBoundToOcpServer:i,vpnMotherlandServerIp:c,pinCode:l,model:d,assignedVpnIp:u}=t,p="true"===e["wg:available"],m=e["wg:pubkey"],x=e["wg:ip"],h=e["wg:endpointAddress"],f=e["wg:endpointPubkey"],g=e["wg:ping"],v=e["wg:rx:total"],b=e["wg:tx:total"];if(r){if(o&&"<not set>"!==u&&l){if(g&&"unreachable"!==g){let e=a?{status:"bound",boundAccountEmail:a,openLink:"https://".concat(i,"/manage/network-by-pin/").concat(l,"/")}:{status:"unbound",bindLink:"https://c.overvis.com/".concat(l)};n={status:"online",ip:x||"<not set>",serverPublicKey:f||"<not set>",vpnServer:h||"<not set>",binding:e,rxtx:{rxTotalBytes:Number(v)||0,txTotalBytes:Number(b)||0},interface:"wg0",serverInternalIp:c||"<not set>"}}else n={status:"offline",error:"Endpoint unreachable",ip:x||"-",serverPublicKey:f||"-",vpnServer:h||"-",interface:"wg0",serverInternalIp:c||"-"}}else n={status:"unregistered"}}else n={status:"disabled",available:p};return{model:d,pin:l||"<no pin>",mac:s,privateKey:o||"<no private key generated>",publicKey:m||"<no public key generated>",connection:n,assignedVpnIp:u}}(l,{vpnIsEnabled:r.vpnIsEnabled,wgPrivateKey:r.wgPrivateKey,vpnBoundToOcpAccountEmail:r.vpnBoundToOcpAccountEmail,vpnBoundToOcpServer:r.vpnBoundToOcpServer,pinCode:r.pinCode,mac:r.mac,model:r.model,vpnMotherlandServerIp:r.vpnMotherlandServerIp,assignedVpnIp:r.assignedVpnIp}),lan:function(e){let t=e["elan:iface"],n="true"===e["elan:dhcpEnabled"],r="true"===e["elan:available"],s=e["elan:ip"],o=e["elan:mask"],a=e["elan:gatewayIp"],i=e["elan:gatewayPing"];return t?i&&"unreachable"!==i&&a&&s&&o?{status:"connected",interface:t,gatewayIp:a,gatewayPingMs:Number(i),ip:s,mask:o}:{status:"disconnected",interface:t,error:"Gateway unreachable",dhcpEnabled:n}:{status:"disabled",available:r}}(l),wifi:function(e){let t=e["wlan:iface"],n="true"===e["wlan:available"],r="true"===e["wlan:isAp"],s=e["wlan:ssid"],o=e["wlan:ip"],a=e["wlan:mask"],i=e["wlan:gatewayIp"],c=e["wlan:gatewayPing"],l=e["wlan:strengthDbm"],d=e["wlan:channel"]&&parseInt(e["wlan:channel"])||void 0,u=e["wlan:band"];return t&&s?r?o&&a?{status:"ap",interface:t,ssid:s,ip:o,url:"setup.overvis.com",band:u,channel:d}:{status:"disconnected",interface:t,ssid:s}:o&&a&&i&&c&&"unreachable"!==c?{status:"connected",interface:t,ssid:s,ip:o,mask:a,gatewayIp:i,gatewayPingMs:Number(c),strengthDbm:l?Number(l):void 0}:{status:"disconnected",interface:t,ssid:s}:{status:"disabled",available:n}}(l),gsm:function(e){let t=e["gsm:generic:state"],n=e["gsm:3gpp:imei"]||"-",r=e["gsm:3gpp:operatorName"]||"-",s=e["gsm:3gpp:operatorCode"]||"-",o=e["gsm:3gpp:registrationState"]||"-",a=e["gsm:generic:accessTechnologies"]||"-",i=e["gsm:generic:manufacturer"]||"-",l=e["gsm:generic:model"]||"-",d=e["gsm:generic:primaryPort"]||"-",u=e["gsm:generic:revision"]||"-",p=e["gsm:generic:signalQuality"]||"-",m=e["gsm:conn:ipAddressCidr"]||"-",x=e["gsm:conn:gateway"]||"-",h=e["gsm:conn:dns1"]||"-",f=e["gsm:conn:dns2"]||"-",g=e["gsm:generic:stateFailedReason"]||"-",v=r?"".concat(r):"".concat(s),[b,j]=m.split("/"),y=(0,c.or)(m);return"connected"===t?{status:"connected",accessTechnologies:a,imei:n,operator:v,registrationState:o,manufacturer:i,model:l,primaryPort:d,firmwareVersion:u,signalQuality:p,ip:b,mask:y,gateway:x,dns1:h,dns2:f}:"registered"===t?{status:"registered",accessTechnologies:a,imei:n,operator:v,registrationState:o,manufacturer:i,model:l,primaryPort:d,firmwareVersion:u,signalQuality:p,ip:b,mask:y,gateway:x,dns1:h,dns2:f}:"failed"===t?{status:"failed",failedReason:g,primaryPort:d,manufacturer:i,model:l,firmwareVersion:u}:{status:"unavailabled"}}(l),rs485:a.MQ(l),mbtcpServer:o.MQ(l),mbtcpClients:s.MQ(l)}}function useFullStatus(){let e=(0,r.tQ)("full-status",fullStatusFetcher,{refreshInterval:1e3,dedupingInterval:1e3});return{...e,error:e.error}}a.tY,a.gh,a.pk,a.ix,o.fV,s.we,s.mY,s.b$,o.we},8988:function(e,t,n){n.d(t,{$z:function(){return useStatus},MQ:function(){return fromRecord},b$:function(){return i},mY:function(){return a},we:function(){return o}});var r=n(52),s=n(3738);function fromRecord(e){let t={};for(let n=0;n<16;n++){let r;let s=e["mbtcpClient:".concat(n,":status")];if(!s)continue;let o=e["mbtcpClient:".concat(n,":address")];if(!o)continue;let a=e["mbtcpClient:".concat(n,":iface")]||"eth0";if(!a)continue;let i=parseInt(e["mbtcpClient:".concat(n,":lastConnectionOn")]||"0"),c=e["mbtcpClient:".concat(n,":connectionAttemptsNum")],l=e["mbtcpClient:".concat(n,":lastError")],d=e["mbtcpClient:".concat(n,":rx:total")],u=e["mbtcpClient:".concat(n,":rx:speed")],p=e["mbtcpClient:".concat(n,":rx:lastTransferOn")],m=e["mbtcpClient:".concat(n,":tx:total")],x=e["mbtcpClient:".concat(n,":tx:speed")],h=e["mbtcpClient:".concat(n,":tx:lastTransferOn")];r="disabled"===s?{status:"disabled"}:"waiting"!==s&&"connecting"!==s&&i?{status:"connected",iface:a,connectedOn:new Date(1e3*Number(i)).toISOString(),rxtx:{rxTotalBytes:Number(d)||0,rxSpeedBytesPerSec:Number(u)||0,rxLastBytesSinceSec:p?Math.round(Date.now()/1e3)-Number(p):0,txTotalBytes:Number(m)||0,txSpeedBytesPerSec:Number(x)||0,txLastBytesSinceSec:h?Math.round(Date.now()/1e3)-Number(h):0}}:{status:"disconnected",iface:a,attemptsNum:Number(c)||0,lastError:l,lastConnectionOn:i?new Date(i).toISOString():void 0};let f=e["route:mbtcpClient:".concat(n)];t[o]={info:r,address:o,mode:{status:"master",routes:f||"no routing"}}}return t}async function fetcher(e){let[t,n]=e;return fromRecord(await (0,s.UK)(n,["mbtcpClient:*","route:mbtcpClient:*"]))}function useStatus(){return(0,r.tQ)("mbtcp-clients",fetcher,{refreshInterval:1e3})}let o={address:"192.168.1.14:502",mode:{status:"master",routes:"1-110,112-255"},info:{status:"disabled"}},a={address:"192.168.1.15:502",mode:{status:"master",routes:"1-110,112-255"},info:{status:"disconnected",iface:"eth0",attemptsNum:33,lastError:"Connection reset by peer."}},i={address:"192.168.1.16:502",mode:{status:"master",routes:"1-110,112-255"},info:{status:"connected",iface:"eth0",connectedOn:"2022-12-05T12:34:56Z",rxtx:{rxTotalBytes:123456789,rxSpeedBytesPerSec:1234,rxLastBytesSinceSec:2,txTotalBytes:987654321,txSpeedBytesPerSec:4321,txLastBytesSinceSec:14}}}},2967:function(e,t,n){n.d(t,{$z:function(){return useStatus},MQ:function(){return fromRecord},fV:function(){return o},we:function(){return a}});var r=n(52),s=n(3738);function fromRecord(e){let t="true"===e["mbtcpServer:enabled"],n=e["mbtcpServer:iface"];"*"===n&&(n="any");let r=e["mbtcpServer:listenIp"],s=e["mbtcpServer:listenPort"],o=[];for(let t=0;t<16;t++){let n=e["mbtcpServer:client:".concat(t,":address")];if(!n)continue;let r=e["mbtcpServer:client:".concat(t,":connectedOn")];if(!r)continue;let s=e["mbtcpServer:client:".concat(t,":iface")]||"unknown interface",a=e["mbtcpServer:client:".concat(t,":rx:total")],i=e["mbtcpServer:client:".concat(t,":rx:speed")],c=e["mbtcpServer:client:".concat(t,":rx:lastTransferOn")],l=e["mbtcpServer:client:".concat(t,":tx:total")],d=e["mbtcpServer:client:".concat(t,":tx:speed")],u=e["mbtcpServer:client:".concat(t,":tx:lastTransferOn")];o.push({address:n,mode:{status:"master"},connectedOn:new Date(1e3*Number(r)).toISOString(),iface:s,rxtx:{rxTotalBytes:Number(a)||0,rxSpeedBytesPerSec:Number(i)||0,rxLastBytesSinceSec:c?Math.round(Date.now()/1e3)-Number(c):0,txTotalBytes:Number(l)||0,txSpeedBytesPerSec:Number(d)||0,txLastBytesSinceSec:u?Math.round(Date.now()/1e3)-Number(u):0}})}return t&&n&&r&&s?{status:"online",clients:o,interface:n,listenIp:r,listenPort:Number(s)}:{status:"disabled"}}async function fetcher(e){let[t,n]=e;return fromRecord(await (0,s.UK)(n,["mbtcpServer:*"]))}function useStatus(){return(0,r.tQ)("modbus-tcp-server-status",fetcher,{refreshInterval:1e3})}let o={status:"online",interface:"eth0",listenIp:"0.0.0.0",listenPort:502,clients:[{address:"192.168.0.13:12345",connectedOn:"2022-12-05T12:34:56Z",mode:{status:"master"},iface:"eth0",rxtx:{rxTotalBytes:123456789,rxSpeedBytesPerSec:1234,rxLastBytesSinceSec:2,txTotalBytes:987654321,txSpeedBytesPerSec:4321,txLastBytesSinceSec:14}},{address:"192.168.0.14:12345",connectedOn:"2022-12-05T12:34:56Z",mode:{status:"master"},iface:"wlan",rxtx:{rxTotalBytes:123456789,rxSpeedBytesPerSec:1234,rxLastBytesSinceSec:2,txTotalBytes:987654321,txSpeedBytesPerSec:4321,txLastBytesSinceSec:14}}]},a={status:"disabled"}},928:function(e,t,n){n.d(t,{MQ:function(){return fromRecord},RW:function(){return useRs485Status},gh:function(){return c},ix:function(){return i},pk:function(){return a},tY:function(){return o}});var r=n(52),s=n(3738);function fromRecord(e){let t={};for(let n=0;n<16;n++){let r,s;let o=e["rs485:".concat(n,":dev")];if(!o)continue;let a=e["rs485:".concat(n,":status")],i=e["rs485:".concat(n,":lastError")],c=e["rs485:".concat(n,":attemptsNum")],l=e["rs485:".concat(n,":connectedOn")],d=e["rs485:".concat(n,":rx:total")],u=e["rs485:".concat(n,":rx:speed")],p=e["rs485:".concat(n,":rx:lastTransferOn")],m=e["rs485:".concat(n,":tx:total")],x=e["rs485:".concat(n,":tx:speed")],h=e["rs485:".concat(n,":tx:lastTransferOn")],f=e["rs485:".concat(n,":mode")],g=e["route:rs485:".concat(n)];if("rtu-master"===f)r={routes:g||"no routing",protocol:f};else if("ascii-master"===f)r={routes:g||"no routing",protocol:f};else if("rtu-slave"===f)r={protocol:f};else if("ascii-slave"===f)r={protocol:f};else if("ipka-master"===f)r={routes:g||"no routing",protocol:f};else throw Error("Invalid mode "+f);if("disabled"===a)s={status:"disabled"};else if("attempting"!==a&&l){let e=[(s={status:"connected",connectedOn:new Date(1e3*Number(l)).toISOString(),rxtx:{rxTotalBytes:Number(d)||0,rxSpeedBytesPerSec:Number(u)||0,rxLastBytesSinceSec:p&&"0"!==p?Math.round(Date.now()/1e3)-Number(p):void 0,txTotalBytes:Number(m)||0,txSpeedBytesPerSec:Number(x)||0,txLastBytesSinceSec:h&&"0"!==h?Math.round(Date.now()/1e3)-Number(h):void 0}}).rxtx.rxLastBytesSinceSec,s.rxtx.txLastBytesSinceSec].filter(e=>void 0!==e);e.length>0&&(s.lastTransferOnSinceSec=Math.min(...e))}else s={status:"attempting",attemptsNum:Number(c)||0,lastError:i};t[o]={device:o,mode:r,info:s}}return t}async function fetcher(e){let[t,n]=e;return fromRecord(await (0,s.UK)(n,["rs485:*","route:rs485:*"]))}function useRs485Status(){return(0,r.tQ)("rs485-status",fetcher,{refreshInterval:1e3})}let o={device:"devTty1",mode:{routes:"1-110,112-255",protocol:"rtu-master"},info:{status:"disabled"}},a={device:"devTty2",mode:{protocol:"ascii-slave"},info:{status:"attempting",attemptsNum:33,lastConnectedOn:"2022-12-04T12:34:56Z",lastError:"No answer."}},i={device:"devTty3",mode:{protocol:"ascii-slave"},info:{status:"connected",connectedOn:"2022-12-05T12:34:56Z",rxtx:{rxTotalBytes:123456789,rxSpeedBytesPerSec:1234,rxLastBytesSinceSec:2,txTotalBytes:987654321,txSpeedBytesPerSec:4321,txLastBytesSinceSec:1400}}},c={device:"devTty4",mode:{routes:"1-110,112-255",protocol:"rtu-master"},info:{status:"connected",connectedOn:"2022-12-05T12:34:56Z",rxtx:{rxTotalBytes:123456789,rxSpeedBytesPerSec:1234,rxLastBytesSinceSec:2,txTotalBytes:987654321,txSpeedBytesPerSec:4321,txLastBytesSinceSec:1400}}}},571:function(e,t,n){n.d(t,{EH:function(){return a},_:function(){return o},dH:function(){return i},iC:function(){return isMaster},jz:function(){return useTtysSelectItems}});var r=n(3900),s=n(52);let o=[50,75,110,134,150,200,300,600,1200,1800,2400,4800,9600,19200,38400,57600,115200,230400,460800,5e5,576e3,921600,1e6,1152e3,15e5,2e6,25e5,3e6,35e5,4e6],a=[{label:"RTU slave",value:"rtu-slave"},{label:"ASCII slave",value:"ascii-slave"},{label:"RTU master",value:"rtu-master"},{label:"ASCII master",value:"ascii-master"},{label:"IPKA master",value:"ipka-master"}],i=[{label:"1N - 1 stop bit, no parity",value:"1N"},{label:"1E - 1 stop bit, even parity",value:"1E"},{label:"1O - 1 stop bit, odd parity",value:"1O"},{label:"2N - 2 stop bits, no parity",value:"2N"}];async function fetchTtys(e){let[t,n]=e;return(await (0,s.ri)(n,t)).json()}function useTtysSelectItems(e,t){let[n,o]=(0,r.useState)(e),{data:a,mutate:i,isLoading:c}=function(){let e=(0,s.tQ)("/api/list/ttys/",fetchTtys);return{data:e.data,isLoading:e.isLoading||e.isValidating,mutate:t=>{t?e.mutate(t,{revalidate:!1}):e.mutate()}}}(),l=[];return[l=(l=l.concat(...a?a.filter(e=>!t.includes(e)).map(e=>({value:e,label:e})):[])).concat(...n.map(e=>({value:e,label:e}))),c,i,o]}function isMaster(e){return"rtu-master"===e||"ascii-master"===e||"ipka-master"===e}},8431:function(e,t,n){function formatBytes(e){if(0===e)return"0 B";let t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(2))+" "+["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"][t]}function sinceString(e){let t=0;e>59&&(t=Math.floor(e/60),e%=60);let n=0;t>59&&(n=Math.floor(t/60),t%=60);let r=0;n>23&&(r=Math.floor(n/24),n%=24);let s=[];return r>0&&s.push(r+"d"),(n>0||s.length>0)&&s.push(n+"h"),(t>0||s.length>0)&&s.push(t+"m"),s.push(e+"s"),s.join(" ")}function getPingLevel(e){return e<100?"good":e<200?"medium":"bad"}function formatHexStringInput(e){return e.replace(/[\s-:]/g,"").toLowerCase().trim()}function formatHexStringOutput(e){return e.trim().toLowerCase().match(/.{1,2}/g).join(" ")}function cidrToSubnetMask(e){let t=e.split("/"),n=[],r=parseInt(t[1]);for(let e=0;e<32;e++)n.push(e<r?1:0);let s=n.join("").match(/.{1,8}/g).map(e=>parseInt(e,2).toString()).join(".");return s}n.d(t,{Ch:function(){return sinceString},k:function(){return getPingLevel},or:function(){return cidrToSubnetMask},td:function(){return formatBytes},uv:function(){return formatHexStringInput},zF:function(){return formatHexStringOutput}})}}]);