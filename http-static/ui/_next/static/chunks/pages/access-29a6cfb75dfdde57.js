(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[112],{4224:function(e,t,r){"use strict";r.d(t,{i:function(){return S}});var s=r(3900),n=r(1949),o=r(9025),a=r(5728),i=r(6877),c=Object.defineProperty,d=Object.defineProperties,l=Object.getOwnPropertyDescriptors,u=Object.getOwnPropertySymbols,p=Object.prototype.hasOwnProperty,h=Object.prototype.propertyIsEnumerable,__defNormalProp=(e,t,r)=>t in e?c(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,__spreadValues=(e,t)=>{for(var r in t||(t={}))p.call(t,r)&&__defNormalProp(e,r,t[r]);if(u)for(var r of u(t))h.call(t,r)&&__defNormalProp(e,r,t[r]);return e},__spreadProps=(e,t)=>d(e,l(t)),g=(0,o.k)((e,{captionSide:t,horizontalSpacing:r,verticalSpacing:s,fontSize:n,withBorder:o,withColumnBorders:c})=>{let d=`${(0,a.h)(1)} solid ${"dark"===e.colorScheme?e.colors.dark[4]:e.colors.gray[3]}`;return{root:__spreadProps(__spreadValues({},e.fn.fontStyles()),{width:"100%",borderCollapse:"collapse",captionSide:t,color:"dark"===e.colorScheme?e.colors.dark[0]:e.black,lineHeight:e.lineHeight,border:o?d:void 0,"& > caption":{marginTop:"top"===t?0:e.spacing.xs,marginBottom:"bottom"===t?0:e.spacing.xs,fontSize:e.fontSizes.sm,color:"dark"===e.colorScheme?e.colors.dark[2]:e.colors.gray[6]},"& > thead > tr > th, & > tfoot > tr > th, & > tbody > tr > th":{textAlign:"left",fontWeight:"bold",color:"dark"===e.colorScheme?e.colors.dark[0]:e.colors.gray[7],fontSize:(0,i.a)({size:n,sizes:e.fontSizes}),padding:`${(0,i.a)({size:s,sizes:e.spacing})} ${(0,i.a)({size:r,sizes:e.spacing})}`},"& > thead > tr > th":{borderBottom:d},"& > tfoot > tr > th, & > tbody > tr > th":{borderTop:d},"& > tbody > tr > td":{padding:`${(0,i.a)({size:s,sizes:e.spacing})} ${(0,i.a)({size:r,sizes:e.spacing})}`,borderTop:d,fontSize:(0,i.a)({size:n,sizes:e.fontSizes})},"& > tbody > tr:first-of-type > td, & > tbody > tr:first-of-type > th":{borderTop:"none"},"& > thead > tr > th, & > tbody > tr > td":{borderRight:c?d:"none","&:last-of-type":{borderRight:"none",borderLeft:c?d:"none"}},"& > tbody > tr > th":{borderRight:c?d:"none"},"&[data-striped] > tbody > tr:nth-of-type(odd)":{backgroundColor:"dark"===e.colorScheme?e.colors.dark[6]:e.colors.gray[0]},"&[data-hover] > tbody > tr":e.fn.hover({backgroundColor:"dark"===e.colorScheme?e.colors.dark[5]:e.colors.gray[1]})})}}),m=r(3127),f=Object.defineProperty,b=Object.defineProperties,x=Object.getOwnPropertyDescriptors,v=Object.getOwnPropertySymbols,j=Object.prototype.hasOwnProperty,y=Object.prototype.propertyIsEnumerable,Table_defNormalProp=(e,t,r)=>t in e?f(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,Table_spreadValues=(e,t)=>{for(var r in t||(t={}))j.call(t,r)&&Table_defNormalProp(e,r,t[r]);if(v)for(var r of v(t))y.call(t,r)&&Table_defNormalProp(e,r,t[r]);return e},Table_spreadProps=(e,t)=>b(e,x(t)),__objRest=(e,t)=>{var r={};for(var s in e)j.call(e,s)&&0>t.indexOf(s)&&(r[s]=e[s]);if(null!=e&&v)for(var s of v(e))0>t.indexOf(s)&&y.call(e,s)&&(r[s]=e[s]);return r};let w={striped:!1,highlightOnHover:!1,captionSide:"top",horizontalSpacing:"xs",fontSize:"sm",verticalSpacing:7,withBorder:!1,withColumnBorders:!1},S=(0,s.forwardRef)((e,t)=>{let r=(0,n.N4)("Table",w,e),{className:o,children:a,striped:i,highlightOnHover:c,captionSide:d,horizontalSpacing:l,verticalSpacing:u,fontSize:p,unstyled:h,withBorder:f,withColumnBorders:b,variant:x}=r,v=__objRest(r,["className","children","striped","highlightOnHover","captionSide","horizontalSpacing","verticalSpacing","fontSize","unstyled","withBorder","withColumnBorders","variant"]),{classes:j,cx:y}=g({captionSide:d,verticalSpacing:u,horizontalSpacing:l,fontSize:p,withBorder:f,withColumnBorders:b},{unstyled:h,name:"Table",variant:x});return s.createElement(m.x,Table_spreadProps(Table_spreadValues({},v),{component:"table",ref:t,className:y(j.root,o),"data-striped":i||void 0,"data-hover":c||void 0}),a)});S.displayName="@mantine/core/Table"},3979:function(e,t,r){"use strict";r.d(t,{k:function(){return S}});var s=r(3900),n=r(1949),o=r(5728),a=r(9025),i=r(6877),c=Object.defineProperty,d=Object.defineProperties,l=Object.getOwnPropertyDescriptors,u=Object.getOwnPropertySymbols,p=Object.prototype.hasOwnProperty,h=Object.prototype.propertyIsEnumerable,__defNormalProp=(e,t,r)=>t in e?c(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,__spreadValues=(e,t)=>{for(var r in t||(t={}))p.call(t,r)&&__defNormalProp(e,r,t[r]);if(u)for(var r of u(t))h.call(t,r)&&__defNormalProp(e,r,t[r]);return e},__spreadProps=(e,t)=>d(e,l(t));let g={xs:(0,o.h)(16),sm:(0,o.h)(20),md:(0,o.h)(26),lg:(0,o.h)(32),xl:(0,o.h)(40)},m=["filled","light","gradient","outline","default"];var f=(0,a.k)((e,{color:t,radius:r,gradient:s},{variant:n,size:a})=>{let c=(0,i.a)({size:a,sizes:g});return{root:__spreadValues(__spreadProps(__spreadValues({},e.fn.fontStyles()),{display:"inline-flex",alignItems:"center",justifyContent:"center",boxSizing:"border-box",width:c,height:c,minWidth:c,minHeight:c,borderRadius:e.fn.radius(r)}),function({theme:e,variant:t,color:r,gradient:s}){if(!m.includes(t))return null;let n=e.fn.variant({variant:t,color:r||e.primaryColor,gradient:s,primaryFallback:!1});return{backgroundColor:n.background,color:n.color,backgroundImage:"gradient"===t?n.background:void 0,border:`${(0,o.h)("gradient"===t?0:1)} solid ${n.border}`}}({theme:e,variant:n,gradient:s,color:t}))}}),b=r(3127),x=Object.defineProperty,v=Object.getOwnPropertySymbols,j=Object.prototype.hasOwnProperty,y=Object.prototype.propertyIsEnumerable,ThemeIcon_defNormalProp=(e,t,r)=>t in e?x(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,ThemeIcon_spreadValues=(e,t)=>{for(var r in t||(t={}))j.call(t,r)&&ThemeIcon_defNormalProp(e,r,t[r]);if(v)for(var r of v(t))y.call(t,r)&&ThemeIcon_defNormalProp(e,r,t[r]);return e},__objRest=(e,t)=>{var r={};for(var s in e)j.call(e,s)&&0>t.indexOf(s)&&(r[s]=e[s]);if(null!=e&&v)for(var s of v(e))0>t.indexOf(s)&&y.call(e,s)&&(r[s]=e[s]);return r};let w={size:"md",variant:"filled"},S=(0,s.forwardRef)((e,t)=>{let r=(0,n.N4)("ThemeIcon",w,e),{className:o,size:a,radius:i,variant:c,color:d,children:l,gradient:u,unstyled:p}=r,h=__objRest(r,["className","size","radius","variant","color","children","gradient","unstyled"]),{classes:g,cx:m}=f({variant:c,radius:i,color:d,gradient:u},{name:"ThemeIcon",unstyled:p,variant:c,size:a});return s.createElement(b.x,ThemeIcon_spreadValues({className:m(g.root,o),ref:t},h),l)});S.displayName="@mantine/core/ThemeIcon"},9561:function(e,t,r){"use strict";function isInRange({min:e,max:t},r){let s=r||!0;return r=>{if("number"!=typeof r)return s;let n=!0;return"number"==typeof e&&r<e&&(n=!1),"number"==typeof t&&r>t&&(n=!1),n?null:s}}r.d(t,{m:function(){return isInRange}})},5306:function(e,t,r){"use strict";function matches(e,t){let r=t||!0;return t=>"string"!=typeof t?r:e.test(t)?null:r}r.d(t,{w:function(){return matches}})},1457:function(e,t,r){"use strict";r.d(t,{Z:function(){return s}});var s=(0,r(4397).Z)("alert-triangle","IconAlertTriangle",[["path",{d:"M12 9v4",key:"svg-0"}],["path",{d:"M10.363 3.591l-8.106 13.534a1.914 1.914 0 0 0 1.636 2.871h16.214a1.914 1.914 0 0 0 1.636 -2.87l-8.106 -13.536a1.914 1.914 0 0 0 -3.274 0z",key:"svg-1"}],["path",{d:"M12 16h.01",key:"svg-2"}]])},2484:function(e,t,r){"use strict";r.d(t,{Z:function(){return s}});var s=(0,r(4397).Z)("plus","IconPlus",[["path",{d:"M12 5l0 14",key:"svg-0"}],["path",{d:"M5 12l14 0",key:"svg-1"}]])},7816:function(e,t,r){"use strict";r.d(t,{Z:function(){return s}});var s=(0,r(4397).Z)("trash","IconTrash",[["path",{d:"M4 7l16 0",key:"svg-0"}],["path",{d:"M10 11l0 6",key:"svg-1"}],["path",{d:"M14 11l0 6",key:"svg-2"}],["path",{d:"M5 7l1 12a2 2 0 0 0 2 2h8a2 2 0 0 0 2 -2l1 -12",key:"svg-3"}],["path",{d:"M9 7v-3a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v3",key:"svg-4"}]])},9083:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/access",function(){return r(7321)}])},29:function(e,t,r){"use strict";r.d(t,{Z:function(){return InputWithHelp}});var s=r(966),n=r(7344),o=r(9956),a=r(8255),i=r(8482),c=r(5897),d=r(3900);function InputWithHelp(e){let{children:t}=e,[r,l]=(0,d.useState)(!1);return(0,s.jsx)(t.type,{...Object.fromEntries(Object.entries(t.props)),labelProps:{display:"block"},label:(0,s.jsxs)(n.Z,{mb:"4px",spacing:5,children:[t.props.label,(0,s.jsx)(o.x,{children:(t.props.withAsterisk||t.props.required)&&(0,s.jsx)(o.x,{span:!0,color:"red","aria-hidden":!0,children:" *"})}),(0,s.jsx)(o.x,{ml:"auto",color:"blue",sx:{cursor:"pointer"},onClick:e=>{l(!r),e.preventDefault()},children:(0,s.jsx)(a.M,{children:(0,s.jsx)(c.Z,{size:14,stroke:1.5})})})]}),description:(0,s.jsx)(i.U,{in:r,transitionDuration:100,children:(0,s.jsx)(o.x,{size:"xs",color:"gray.6",lh:"14px",children:t.props.description})}),withAsterisk:!1})}},3732:function(e,t,r){"use strict";r.d(t,{Z:function(){return StatusBlock}});var s=r(966),n=r(4418),o=r(462),a=r(7344),i=r(3979),c=r(9956),d=r(9977),l=r(3127),u=r(8637);function StatusBlock(e){let t="connected"===e.status?"green":"warn"===e.status?"orange":"disconnected"===e.status?"red":"gray";return(0,s.jsx)(n.X,{h:"100%",withBorder:!0,children:(0,s.jsxs)(o.K,{spacing:0,h:"100%",children:[(0,s.jsxs)(a.Z,{position:"apart",align:"center",p:"xs",sx:e=>({borderBottom:"1px solid ".concat(e.colors.gray[3])}),children:[(0,s.jsxs)(a.Z,{spacing:"xs",noWrap:!0,children:[(0,s.jsx)(i.k,{color:t,variant:"light",children:e.icon}),(0,s.jsx)(c.x,{weight:500,c:t,transform:"uppercase",children:e.name}),e.addEl&&"string"==typeof e.addEl?(0,s.jsx)(c.x,{c:"dimmed",size:"sm",children:e.addEl}):e.addEl]}),(0,s.jsxs)(a.Z,{spacing:"xs",noWrap:!0,children:[e.addElRight,e.settingsAction&&(0,s.jsx)(d.A,{color:"blue",onClick:e.settingsAction,children:(0,s.jsx)(u.Z,{size:18})})]})]}),(0,s.jsx)(l.x,{bg:e.bg,h:"100%",children:e.children})]})})}},169:function(e,t,r){"use strict";r.d(t,{Z:function(){return StatusBlockWithSettings}});var s=r(966),n=r(3900),o=r(8253),a=r(3732);function StatusBlockWithSettings(e){let[t,r]=(0,n.useState)(!1);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(o.Z,{...e.settings,opened:t,setOpened:r}),(0,s.jsx)(a.Z,{...e,settingsAction:()=>r(!0),children:e.children})]})}},829:function(e,t,r){"use strict";r.d(t,{Z:function(){return WithConfirmation}});var s=r(966),n=r(4512),o=r(462),a=r(9956),i=r(7344),c=r(3283),d=r(3900);function WithConfirmation(e){let{children:t,title:r,description:l,buttonText:u,isLevelGood:p}=e,[h,g]=(0,d.useState)(!1);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.u,{opened:h,onClose:()=>g(!1),withCloseButton:!1,zIndex:400,children:(0,s.jsxs)(o.K,{children:[(0,s.jsx)(a.x,{fz:"md",weight:500,align:"center",children:r}),(0,s.jsx)(a.x,{fz:"sm",c:"gray.7",align:"center",children:l}),(0,s.jsxs)(i.Z,{position:"center",children:[(0,s.jsx)(c.z,{color:p?"green":"orange",onClick:()=>{t.props.onClick(),g(!1)},children:u}),(0,s.jsx)(c.z,{color:p?"orange":"green",onClick:()=>g(!1),children:"Cancel"})]})]})}),(0,s.jsx)(t.type,{...t.props,onClick:()=>g(!0)})]})}},7219:function(e,t,r){"use strict";r.d(t,{Mx:function(){return saveProcedure},_B:function(){return getDirtyValues},_N:function(){return useFormWithInitialUpdates},uA:function(){return makeInputPropsGen}});var s=r(966),n=r(7344),o=r(9956),a=r(9724),i=r(6680),c=r(7017),d=r(2922),l=r(1457),u=r(3900),p=r(9804);async function saveProcedure(e){(0,i.yK)("settings-save"),(0,i.c0)({id:"settings-save",withCloseButton:!0,autoClose:!1,loading:!0,icon:null,color:"orange",title:"Saving settings...",message:"Please wait while the new settings are applied..."});try{await e()}catch(e){(0,i.wD)({id:"settings-save",loading:!1,withCloseButton:!0,color:"red",icon:(0,s.jsx)(c.Z,{}),title:"Error saving settings",message:"There was an error saving settings. Please check form data and try again."}),console.error(e);return}(0,i.wD)({id:"settings-save",loading:!1,withCloseButton:!0,autoClose:1e3,color:"green",icon:(0,s.jsx)(d.Z,{}),title:"Settings saved",message:"Settings were saved and applied successfully."})}function makeInputPropsGen(e,t,r){return function(a){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"input",c=arguments.length>2?arguments[2]:void 0;return function(e,t,r,a,i){let c=e.getInputProps(t,r),d=i&&i>300;return{...c,classNames:{input:e.isDirty(t)&&a||void 0},inputContainer:d?e=>(0,s.jsxs)(s.Fragment,{children:[e,(0,s.jsxs)(n.Z,{spacing:3,c:"orange",mt:2,align:"center",children:[(0,s.jsx)(l.Z,{size:11,style:{marginTop:-1}}),(0,s.jsxs)(o.x,{fz:"xs",children:["Updated: ",(0,p.LU)(1e3*i)," ago."]})]})]}):void 0}}(e,a,{...r,type:i},t,c)}}function useFormWithInitialUpdates(e){let t=(0,a.c)(e);return(0,u.useEffect)(()=>{for(let r in t.values)t.isDirty(r)||t.setFieldValue(r,e.initialValues[r]);t.resetDirty({...e.initialValues})},[...Object.values(e.initialValues)]),t}function getDirtyValues(e){return Object.fromEntries(Object.entries(e.values).filter(t=>{let[r,s]=t;return e.isDirty(r)&&void 0!==s}))}},6169:function(e,t,r){"use strict";function checkIp(e){return e?e.toString().match(n)?void 0:"Invalid IP address.":"Required."}function checkIf(e,t){return(r,s)=>e(s)?t(r):void 0}r.d(t,{C6:function(){return s},Cl:function(){return checkIp},Sg:function(){return checkIf}});let s=/^(?=.{1,253}\.?$)[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\.[a-z0-9](?:[-0-9a-z]{0,61}[0-9a-z])?)*\.?$/i,n=/^(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)\.){3}(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)$/},7321:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return Page}});var s=r(966),n=r(3900),o=r(3283),a=r(4224),i=r(7432),c=r(9956),d=r(462),l=r(9977),u=r(7344),p=r(5041),h=r(6117),g=r(9869),m=r(2484),f=(0,r(4397).Z)("password","IconPassword",[["path",{d:"M12 10v4",key:"svg-0"}],["path",{d:"M10 13l4 -2",key:"svg-1"}],["path",{d:"M10 11l4 2",key:"svg-2"}],["path",{d:"M5 10v4",key:"svg-3"}],["path",{d:"M3 13l4 -2",key:"svg-4"}],["path",{d:"M3 11l4 2",key:"svg-5"}],["path",{d:"M19 10v4",key:"svg-6"}],["path",{d:"M17 13l4 -2",key:"svg-7"}],["path",{d:"M17 11l4 2",key:"svg-8"}]]),b=r(7816),x=r(256),v=r.n(x),j=r(8393),y=r(9724),w=r(9561),S=r(7452),k=r(29);function AccessSettingsForm(e){let{initialValues:t,onSubmit:r,saving:n}=e,o=(0,y.c)({initialValues:t,validate:{modbus:{sessionTtl:(0,w.m)({min:0,max:525600},"Must be in range 0-525600. 0 - unlimited."),modbusAuthErrorCode:(0,w.m)({min:1,max:255},"Must be in range 1-255.")}}});return(0,s.jsx)("form",{onSubmit:o.onSubmit(r),children:(0,s.jsxs)(d.K,{children:[(0,s.jsx)(k.Z,{children:(0,s.jsx)(j.Y,{label:"Session TTL (seconds):",description:"Period of idleness (in seconds) after which the Modbus authenticated session will be expired. 0 - unlimited.",required:!0,...o.getInputProps("modbus.sessionTtl")})}),(0,s.jsx)(k.Z,{children:(0,s.jsx)(j.Y,{label:"Modbus error on insufficient access rights (decimal):",description:"The code of Modbus error that will be returned to the client if the client has no access rights to the requested data. Default value: 10 (0x0A)",required:!0,...o.getInputProps("modbus.modbusAuthErrorCode")})}),(0,s.jsx)(S.Z,{type:"submit",inProgress:n,children:"Save"})]})})}var P=r(7219),A=r(169),O=r(829),M=r(52),_=r(3738);async function saveUser(e){let t=(0,M.bH)();return await (0,M.ri)(t,"/api/user/".concat(e.username,"/update/"),{method:"POST",body:JSON.stringify({allowModbus:e.allowModbus,allowApi:e.allowApi,level:e.level}),timeoutMs:3e4}),(0,_.ph)(["/api/users/",t])}async function changeUserPassword(e,t){let r=(0,M.bH)();await (0,M.ri)(r,"/api/user/".concat(e,"/change-password/"),{method:"POST",body:JSON.stringify({password:t}),timeoutMs:3e4})}async function createUser(e,t){let r=(0,M.bH)();await (0,M.ri)(r,"/api/users/create/",{method:"POST",body:JSON.stringify({username:e,password:t}),timeoutMs:3e4})}async function deleteUser(e){let t=(0,M.bH)();return await (0,M.ri)(t,"/api/user/".concat(e,"/remove/"),{method:"POST",body:JSON.stringify({})}),(0,_.ph)(["/api/users/",t])}async function addFreeAccessRange(e){let t=(0,M.bH)();await (0,M.ri)(t,"/api/modbus/free-ranges/create/",{method:"POST",body:JSON.stringify(e),timeoutMs:3e4})}async function deleteFreeAccessRange(e){let t=(0,M.bH)(),r=e.device;return await (0,M.ri)(t,"/api/modbus/free-range/".concat(void 0===r?"null":r,"-").concat(e.function,"/").concat(e.range,"/remove/"),{method:"POST",body:JSON.stringify({}),timeoutMs:3e4}),(0,_.ph)(["/api/modbus/free-ranges/",t])}async function settingsFetcher(e){let[t,r]=e,s=await (0,_.wv)(r,["auth:defaultModbusAccess:configurationAccess","auth:defaultModbusAccess:modbusDevicesAccess","auth:modbusAuthErrorCode","auth:sessionTtl"]);return{modbus:{defaultAccess:{configuration:s["auth:defaultModbusAccess:configurationAccess"],connectedDevices:s["auth:defaultModbusAccess:modbusDevicesAccess"]},modbusAuthErrorCode:parseInt(s["auth:modbusAuthErrorCode"]),sessionTtl:parseInt(s["auth:sessionTtl"])}}}async function saveSetting(e,t){let r=(0,M.bH)();return await (0,M.ri)(r,"/api/confs/set/",{method:"POST",body:JSON.stringify({[e]:t}),timeoutMs:3e4}),settingsFetcher(["/api/confs/set/",r])}async function saveGeneralSettings(e){return(0,_.NC)({"auth:modbusAuthErrorCode":e.modbus.modbusAuthErrorCode.toString(),"auth:sessionTtl":e.modbus.sessionTtl.toString()})}let C=[{label:"No access",value:"none"},{label:"Read",value:"read"},{label:"Read/Write",value:"readWrite"}];function AccessStatusBlock(e){let{settings:t,mutateSettings:r,users:n,mutateUsers:u,freeAccess:p,mutateFreeAccess:h,setAddUserModalOpened:f,setChangeUserPasswordModalOpened:b,setAddFreeRangeModalOpened:x,setCurrentUsername:j,authUsername:y}=e;return(0,s.jsx)(A.Z,{status:"disabled",name:"Users & Access",icon:(0,s.jsx)(g.Z,{}),bg:"gray.0",addEl:(0,s.jsx)(o.z,{ml:"sm",leftIcon:(0,s.jsx)(m.Z,{size:14}),compact:!0,onClick:()=>f(!0),children:"Add user"}),settings:{title:"Access settings",onSettingsUpdate:()=>{r()},form:AccessSettingsForm,useSettings:()=>({data:t,mutate:r}),save:async e=>{await saveGeneralSettings(e)}},children:(0,s.jsxs)(a.i,{w:"100%",verticalSpacing:"xs",children:[(0,s.jsx)("thead",{children:(0,s.jsxs)("tr",{style:{backgroundColor:"#fff"},children:[(0,s.jsx)("th",{children:"Username"}),(0,s.jsx)("th",{children:"Access Method"}),(0,s.jsx)("th",{children:"OPCB"}),(0,s.jsx)("th",{children:"Connected Devices"}),(0,s.jsx)("th",{})]})}),(0,s.jsxs)("tbody",{children:[Array.from(n.entries()).map(e=>{let[t,r]=e;return(0,s.jsx)(UserRow,{user:r,currentUser:y,mutate:u,openChangePasswordModal:e=>{j(e),b(!0)}},t.toString())}),(0,s.jsxs)("tr",{children:[(0,s.jsx)("td",{colSpan:2,children:(0,s.jsx)("b",{children:"Unauthenticated Modbus access:"})}),(0,s.jsx)("td",{children:(0,s.jsx)(i.s,{value:t.modbus.defaultAccess.configuration,data:C,onChange:e=>(0,P.Mx)(()=>r(saveSetting("auth:defaultModbusAccess:configurationAccess",e),{optimisticData:()=>{let r=v().cloneDeep(t);return r.modbus.defaultAccess.configuration=e,r}}))})}),(0,s.jsx)("td",{children:(0,s.jsx)(i.s,{data:C,value:t.modbus.defaultAccess.connectedDevices,onChange:e=>(0,P.Mx)(()=>r(saveSetting("auth:defaultModbusAccess:modbusDevicesAccess",e),{optimisticData:()=>{let r=v().cloneDeep(t);return r.modbus.defaultAccess.connectedDevices=e,r}}))})}),(0,s.jsx)("td",{})]}),(0,s.jsxs)("tr",{children:[(0,s.jsxs)("td",{colSpan:2,valign:"top",style:{borderTop:"none"},children:[(0,s.jsx)(c.x,{weight:700,children:"Always allow Modbus ranges:"}),(0,s.jsx)(c.x,{size:"xs",maw:"300px",children:"OPCB will always allow Modbus read/write access for the requests in those ranges. Note, that if you remove OPCB password input registers range, Modbus clients will not be able to authenticate at all."})]}),(0,s.jsx)("td",{colSpan:3,style:{borderTop:"none"},children:(0,s.jsxs)(d.K,{spacing:4,children:[Array.from(p.entries()).map(e=>{let[t,r]=e;return(0,s.jsx)(FreeModbusAccessRangeBlock,{range:r,mutate:h},t.toString())}),(0,s.jsx)(l.A,{color:"blue",onClick:()=>x(!0),children:(0,s.jsx)(m.Z,{size:16})})]})})]})]})]})})}function UserRow(e){let{user:t,currentUser:r,mutate:n,openChangePasswordModal:o}=e,a=t.username===r||"admin"===t.username,mutateUser=e=>(0,P.Mx)(()=>{let r=v().cloneDeep(t);return e(r),n(saveUser(r),{optimisticData:e=>e.map(e=>e.username===t.username?r:e)})});return(0,s.jsxs)("tr",{style:{backgroundColor:"#fff"},children:[(0,s.jsx)("td",{children:(0,s.jsx)(c.x,{weight:700,children:t.username})}),(0,s.jsx)("td",{children:(0,s.jsxs)(u.Z,{children:[(0,s.jsx)(p.r,{label:"API",checked:t.allowApi,disabled:a,onChange:e=>mutateUser(t=>(t.allowApi=e.currentTarget.checked,t))}),(0,s.jsx)(p.r,{label:"Modbus",checked:t.allowModbus,disabled:a,onChange:e=>mutateUser(t=>(t.allowModbus=e.currentTarget.checked,t))})]})}),(0,s.jsx)("td",{children:(0,s.jsx)(i.s,{data:C,value:t.level.configuration,disabled:a,onChange:e=>mutateUser(t=>(t.level.configuration=e,t))})}),(0,s.jsx)("td",{children:(0,s.jsx)(i.s,{data:C,value:t.level.connectedDevices,disabled:a,onChange:e=>mutateUser(t=>(t.level.connectedDevices=e,t))})}),(0,s.jsx)("td",{children:(0,s.jsxs)(u.Z,{spacing:"xs",position:"right",children:[(0,s.jsx)(h.u,{label:"Change password",children:(0,s.jsx)(l.A,{color:"blue",onClick:()=>o(t.username),children:(0,s.jsx)(f,{size:16,stroke:1.5})})}),(0,s.jsx)(O.Z,{title:"Delete user",description:'Are you sure you want to delete account "'.concat(t.username,'"?'),buttonText:"Delete",children:(0,s.jsx)(l.A,{color:"red",disabled:a,onClick:()=>{(0,P.Mx)(()=>n(deleteUser(t.username),{optimisticData:e=>e.filter(e=>e.username!==t.username)}))},children:(0,s.jsx)(b.Z,{size:16,stroke:1.5})})})]})})]})}function FreeModbusAccessRangeBlock(e){let{range:t,mutate:r}=e;return(0,s.jsxs)(u.Z,{bg:"gray.2",p:"xs",sx:e=>({borderRadius:e.radius.sm}),spacing:"md",noWrap:!0,children:[(0,s.jsxs)(u.Z,{spacing:4,align:"baseline",noWrap:!0,miw:113,children:[(0,s.jsx)(c.x,{weight:700,children:"Device ID:"}),(0,s.jsx)(c.x,{children:void 0===t.device?"OPCB":t.device})]}),(0,s.jsxs)(u.Z,{spacing:4,align:"baseline",noWrap:!0,miw:100,children:[(0,s.jsx)(c.x,{weight:700,children:"Function:"}),(0,s.jsx)(c.x,{children:t.function})]}),(0,s.jsxs)(u.Z,{spacing:4,align:"baseline",noWrap:!0,children:[(0,s.jsx)(c.x,{weight:700,children:"Registers:"}),(0,s.jsx)(c.x,{size:"xs",children:t.range})]}),(0,s.jsx)(O.Z,{title:"Delete range",description:"Are you sure you want to delete range?",buttonText:"Delete",children:(0,s.jsx)(l.A,{size:"sm",color:"red",ml:"auto",onClick:()=>{(0,P.Mx)(()=>r(deleteFreeAccessRange(t),{optimisticData:e=>e.filter(e=>e!==t)}))},children:(0,s.jsx)(b.Z,{size:16,stroke:1.5})})})]})}var T=r(5951),z=r(6078),I=r(5306),Z=r(6169);function AddFreeRangeForm(e){let{initialValues:t,onSubmit:r,saving:n}=e,o=(0,y.c)({initialValues:t,validate:{device:(0,Z.Sg)(e=>!e.opcb,(0,w.m)({min:0,max:255},"Must be in range 0-255")),function:(0,w.m)({min:1,max:127},"Must be in range 1-127"),range:(0,I.w)(/^(\d+-\d+,)*\d+-\d+$/,'Format: "startAddress-endAddress,startAddress-endAddress,...". Example: "0-10,20-30".')}});return(0,s.jsx)("form",{onSubmit:o.onSubmit(r),children:(0,s.jsxs)(d.K,{children:[(0,s.jsx)(T.X,{label:"OPCB Modbus ID",checked:o.values.opcb,...o.getInputProps("opcb")}),!o.values.opcb&&(0,s.jsx)(j.Y,{label:"Device Modbus ID (decimal):",...o.getInputProps("device")}),(0,s.jsx)(j.Y,{label:"Modbus Function (decimal):",...o.getInputProps("function")}),(0,s.jsx)(z.o,{label:"Registers range:",...o.getInputProps("range")}),(0,s.jsx)(S.Z,{type:"submit",inProgress:n,children:"Save"})]})})}var D=r(1277),N=r(6654);function AddUserForm(e){let{initialValues:t,onSubmit:r,saving:n}=e,o=(0,y.c)({initialValues:t,validate:{username:(0,N.d)({min:3,max:30},"Must have 3-30 characters"),password:(0,N.d)({min:3,max:30},"Must have 3-30 characters")}});return(0,s.jsx)("form",{onSubmit:o.onSubmit(r),children:(0,s.jsxs)(d.K,{children:[(0,s.jsx)(z.o,{label:"Username:",...o.getInputProps("username"),required:!0}),(0,s.jsx)(D.W,{label:"Password:",...o.getInputProps("password"),required:!0}),(0,s.jsx)(S.Z,{type:"submit",inProgress:n,children:"Save"})]})})}function ChangeUserPasswordForm(e){let{initialValues:t,onSubmit:r,saving:n}=e,o=(0,y.c)({initialValues:t,validate:{password:(0,N.d)({min:3,max:30},"Must have 3-30 characters")}});return(0,s.jsx)("form",{onSubmit:o.onSubmit(r),children:(0,s.jsxs)(d.K,{children:[(0,s.jsx)(D.W,{label:"New password:",...o.getInputProps("password"),required:!0}),(0,s.jsx)(S.Z,{type:"submit",inProgress:n,children:"Save"})]})})}var U=r(8253),F=r(2094);function Page(){let e=(0,M.tQ)("access-settings",settingsFetcher),t=(0,M.tQ)("/api/users/",_.ph),r=(0,M.tQ)("/api/modbus/free-ranges/",_.ph),o=(0,M.pk)(),[a,i]=n.useState(!1),[c,d]=n.useState(!1),[l,u]=n.useState(!1),[p,h]=n.useState();return e.data&&t.data&&r.data&&o.token?(0,s.jsxs)(F.Z,{pageTitle:"Access management",children:[(0,s.jsx)(U.Z,{title:"Add account",onSettingsUpdate:()=>{t.mutate()},form:AddUserForm,useSettings:()=>({data:{username:"",password:""},error:void 0,isValidating:!1,isLoading:!1,mutate:async()=>void 0}),save:e=>createUser(e.username,e.password),opened:a,setOpened:i}),(0,s.jsx)(U.Z,{title:'Change password for the account "'.concat(p,'"'),form:ChangeUserPasswordForm,useSettings:()=>({data:{username:p,password:""},error:void 0,isValidating:!1,isLoading:!1,mutate:async()=>void 0}),save:e=>changeUserPassword(e.username,e.password),opened:c,setOpened:d}),(0,s.jsx)(U.Z,{title:"Add free access to the Modbus range",form:AddFreeRangeForm,onSettingsUpdate:()=>{r.mutate()},useSettings:()=>({data:{opcb:!0,device:void 0,function:3,range:""},error:void 0,isValidating:!1,isLoading:!1,mutate:async()=>void 0}),save:async e=>(e.opcb&&(e.device=void 0),addFreeAccessRange(e)),opened:l,setOpened:u}),(0,s.jsx)(AccessStatusBlock,{settings:e.data,mutateSettings:e.mutate,users:t.data,mutateUsers:t.mutate,freeAccess:r.data,mutateFreeAccess:r.mutate,setAddUserModalOpened:i,setCurrentUsername:h,setChangeUserPasswordModalOpened:d,setAddFreeRangeModalOpened:u,authUsername:o.token.username})]}):(0,s.jsx)(F.Z,{pageTitle:"Access management",contentIsLoading:!0})}}},function(e){e.O(0,[863,217,666,161,497,886,94,774,888,179],function(){return e(e.s=9083)}),_N_E=e.O()}]);