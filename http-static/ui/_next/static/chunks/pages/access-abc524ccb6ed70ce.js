(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[112],{4224:function(e,t,s){"use strict";s.d(t,{i:function(){return S}});var r=s(3900),n=s(1949),o=s(9025),a=s(5728),i=s(6877),c=Object.defineProperty,d=Object.defineProperties,l=Object.getOwnPropertyDescriptors,u=Object.getOwnPropertySymbols,h=Object.prototype.hasOwnProperty,p=Object.prototype.propertyIsEnumerable,__defNormalProp=(e,t,s)=>t in e?c(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,__spreadValues=(e,t)=>{for(var s in t||(t={}))h.call(t,s)&&__defNormalProp(e,s,t[s]);if(u)for(var s of u(t))p.call(t,s)&&__defNormalProp(e,s,t[s]);return e},__spreadProps=(e,t)=>d(e,l(t)),g=(0,o.k)((e,{captionSide:t,horizontalSpacing:s,verticalSpacing:r,fontSize:n,withBorder:o,withColumnBorders:c})=>{let d=`${(0,a.h)(1)} solid ${"dark"===e.colorScheme?e.colors.dark[4]:e.colors.gray[3]}`;return{root:__spreadProps(__spreadValues({},e.fn.fontStyles()),{width:"100%",borderCollapse:"collapse",captionSide:t,color:"dark"===e.colorScheme?e.colors.dark[0]:e.black,lineHeight:e.lineHeight,border:o?d:void 0,"& > caption":{marginTop:"top"===t?0:e.spacing.xs,marginBottom:"bottom"===t?0:e.spacing.xs,fontSize:e.fontSizes.sm,color:"dark"===e.colorScheme?e.colors.dark[2]:e.colors.gray[6]},"& > thead > tr > th, & > tfoot > tr > th, & > tbody > tr > th":{textAlign:"left",fontWeight:"bold",color:"dark"===e.colorScheme?e.colors.dark[0]:e.colors.gray[7],fontSize:(0,i.a)({size:n,sizes:e.fontSizes}),padding:`${(0,i.a)({size:r,sizes:e.spacing})} ${(0,i.a)({size:s,sizes:e.spacing})}`},"& > thead > tr > th":{borderBottom:d},"& > tfoot > tr > th, & > tbody > tr > th":{borderTop:d},"& > tbody > tr > td":{padding:`${(0,i.a)({size:r,sizes:e.spacing})} ${(0,i.a)({size:s,sizes:e.spacing})}`,borderTop:d,fontSize:(0,i.a)({size:n,sizes:e.fontSizes})},"& > tbody > tr:first-of-type > td, & > tbody > tr:first-of-type > th":{borderTop:"none"},"& > thead > tr > th, & > tbody > tr > td":{borderRight:c?d:"none","&:last-of-type":{borderRight:"none",borderLeft:c?d:"none"}},"& > tbody > tr > th":{borderRight:c?d:"none"},"&[data-striped] > tbody > tr:nth-of-type(odd)":{backgroundColor:"dark"===e.colorScheme?e.colors.dark[6]:e.colors.gray[0]},"&[data-hover] > tbody > tr":e.fn.hover({backgroundColor:"dark"===e.colorScheme?e.colors.dark[5]:e.colors.gray[1]})})}}),m=s(3127),b=Object.defineProperty,f=Object.defineProperties,x=Object.getOwnPropertyDescriptors,j=Object.getOwnPropertySymbols,v=Object.prototype.hasOwnProperty,y=Object.prototype.propertyIsEnumerable,Table_defNormalProp=(e,t,s)=>t in e?b(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,Table_spreadValues=(e,t)=>{for(var s in t||(t={}))v.call(t,s)&&Table_defNormalProp(e,s,t[s]);if(j)for(var s of j(t))y.call(t,s)&&Table_defNormalProp(e,s,t[s]);return e},Table_spreadProps=(e,t)=>f(e,x(t)),__objRest=(e,t)=>{var s={};for(var r in e)v.call(e,r)&&0>t.indexOf(r)&&(s[r]=e[r]);if(null!=e&&j)for(var r of j(e))0>t.indexOf(r)&&y.call(e,r)&&(s[r]=e[r]);return s};let w={striped:!1,highlightOnHover:!1,captionSide:"top",horizontalSpacing:"xs",fontSize:"sm",verticalSpacing:7,withBorder:!1,withColumnBorders:!1},S=(0,r.forwardRef)((e,t)=>{let s=(0,n.N4)("Table",w,e),{className:o,children:a,striped:i,highlightOnHover:c,captionSide:d,horizontalSpacing:l,verticalSpacing:u,fontSize:h,unstyled:p,withBorder:b,withColumnBorders:f,variant:x}=s,j=__objRest(s,["className","children","striped","highlightOnHover","captionSide","horizontalSpacing","verticalSpacing","fontSize","unstyled","withBorder","withColumnBorders","variant"]),{classes:v,cx:y}=g({captionSide:d,verticalSpacing:u,horizontalSpacing:l,fontSize:h,withBorder:b,withColumnBorders:f},{unstyled:p,name:"Table",variant:x});return r.createElement(m.x,Table_spreadProps(Table_spreadValues({},j),{component:"table",ref:t,className:y(v.root,o),"data-striped":i||void 0,"data-hover":c||void 0}),a)});S.displayName="@mantine/core/Table"},5306:function(e,t,s){"use strict";function matches(e,t){let s=t||!0;return t=>"string"!=typeof t?s:e.test(t)?null:s}s.d(t,{w:function(){return matches}})},2484:function(e,t,s){"use strict";s.d(t,{Z:function(){return r}});var r=(0,s(4397).Z)("plus","IconPlus",[["path",{d:"M12 5l0 14",key:"svg-0"}],["path",{d:"M5 12l14 0",key:"svg-1"}]])},7816:function(e,t,s){"use strict";s.d(t,{Z:function(){return r}});var r=(0,s(4397).Z)("trash","IconTrash",[["path",{d:"M4 7l16 0",key:"svg-0"}],["path",{d:"M10 11l0 6",key:"svg-1"}],["path",{d:"M14 11l0 6",key:"svg-2"}],["path",{d:"M5 7l1 12a2 2 0 0 0 2 2h8a2 2 0 0 0 2 -2l1 -12",key:"svg-3"}],["path",{d:"M9 7v-3a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v3",key:"svg-4"}]])},9083:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/access",function(){return s(7321)}])},29:function(e,t,s){"use strict";s.d(t,{Z:function(){return InputWithHelp}});var r=s(966),n=s(7344),o=s(9956),a=s(8255),i=s(8482),c=s(5897),d=s(3900);function InputWithHelp(e){let{children:t}=e,[s,l]=(0,d.useState)(!1);return(0,r.jsx)(t.type,{...Object.fromEntries(Object.entries(t.props)),labelProps:{display:"block"},label:(0,r.jsxs)(n.Z,{mb:"4px",spacing:5,children:[t.props.label,(0,r.jsx)(o.x,{children:(t.props.withAsterisk||t.props.required)&&(0,r.jsx)(o.x,{span:!0,color:"red","aria-hidden":!0,children:" *"})}),(0,r.jsx)(o.x,{ml:"auto",color:"blue",sx:{cursor:"pointer"},onClick:e=>{l(!s),e.preventDefault()},children:(0,r.jsx)(a.M,{children:(0,r.jsx)(c.Z,{size:14,stroke:1.5})})})]}),description:(0,r.jsx)(i.U,{in:s,transitionDuration:100,children:(0,r.jsx)(o.x,{size:"xs",color:"gray.6",lh:"14px",children:t.props.description})}),withAsterisk:!1})}},5465:function(e,t,s){"use strict";s.d(t,{Z:function(){return StatusBlockWithSettings}});var r=s(966),n=s(3900),o=s(8253),a=s(4418),i=s(462),c=s(7344),d=s(3979),l=s(9956),u=s(9977),h=s(3127),p=s(8637);function StatusBlock(e){let t="connected"===e.status?"green":"warn"===e.status?"orange":"disconnected"===e.status?"red":"gray";return(0,r.jsx)(a.X,{h:"100%",withBorder:!0,children:(0,r.jsxs)(i.K,{spacing:0,h:"100%",children:[(0,r.jsxs)(c.Z,{position:"apart",align:"center",p:"xs",sx:e=>({borderBottom:"1px solid ".concat(e.colors.gray[3])}),children:[(0,r.jsxs)(c.Z,{spacing:"xs",noWrap:!0,children:[(0,r.jsx)(d.k,{color:t,variant:"light",children:e.icon}),(0,r.jsx)(l.x,{weight:500,c:t,transform:"uppercase",children:e.name}),e.addEl&&"string"==typeof e.addEl?(0,r.jsx)(l.x,{c:"dimmed",size:"sm",children:e.addEl}):e.addEl]}),(0,r.jsxs)(c.Z,{spacing:"xs",noWrap:!0,children:[e.addElRight,e.settingsAction&&(0,r.jsx)(u.A,{color:"blue",onClick:e.settingsAction,children:(0,r.jsx)(p.Z,{size:18})})]})]}),(0,r.jsx)(h.x,{bg:e.bg,h:"100%",children:e.children})]})})}function StatusBlockWithSettings(e){let[t,s]=(0,n.useState)(!1);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(o.Z,{...e.settings,opened:t,setOpened:s}),(0,r.jsx)(StatusBlock,{...e,settingsAction:()=>s(!0),children:e.children})]})}},829:function(e,t,s){"use strict";s.d(t,{Z:function(){return WithConfirmation}});var r=s(966),n=s(2638),o=s(462),a=s(9956),i=s(7344),c=s(3283),d=s(3900);function WithConfirmation(e){let{children:t,title:s,description:l,buttonText:u}=e,[h,p]=(0,d.useState)(!1);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.u,{opened:h,onClose:()=>p(!1),withCloseButton:!1,children:(0,r.jsxs)(o.K,{children:[(0,r.jsx)(a.x,{fz:"md",weight:500,align:"center",children:s}),(0,r.jsx)(a.x,{fz:"sm",c:"gray.7",align:"center",children:l}),(0,r.jsxs)(i.Z,{position:"center",children:[(0,r.jsx)(c.z,{color:"orange",onClick:()=>{t.props.onClick(),p(!1)},children:u}),(0,r.jsx)(c.z,{color:"green",onClick:()=>p(!1),children:"Cancel"})]})]})}),(0,r.jsx)(t.type,{...t.props,onClick:()=>p(!0)})]})}},7219:function(e,t,s){"use strict";s.d(t,{M:function(){return saveProcedure},u:function(){return makeInputPropsGen}});var r=s(966),n=s(6680),o=s(7017),a=s(2922);async function saveProcedure(e){(0,n.yK)("settings-save"),(0,n.c0)({id:"settings-save",withCloseButton:!0,autoClose:!1,loading:!0,icon:null,color:"orange",title:"Saving settings...",message:"Please wait while the new settings are applied..."});try{await e()}catch(e){(0,n.wD)({id:"settings-save",loading:!1,withCloseButton:!0,color:"red",icon:(0,r.jsx)(o.Z,{}),title:"Error saving settings",message:"There was an error saving settings. Please check form data and try again."}),console.error(e);return}(0,n.wD)({id:"settings-save",loading:!1,withCloseButton:!0,autoClose:1e3,color:"green",icon:(0,r.jsx)(a.Z,{}),title:"Settings saved",message:"Settings were saved and applied successfully."})}function makeInputPropsGen(e,t,s){return function(r){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"input";return function(e,t,s,r){let n=e.getInputProps(t,s);return{...n,classNames:{input:e.isDirty(t)&&r||void 0}}}(e,r,{...s,type:n},t)}}},6169:function(e,t,s){"use strict";function checkIp(e){return e?e.toString().match(n)?void 0:"Invalid IP address.":"Required."}function checkIf(e,t){return(s,r)=>e(r)?t(s):void 0}s.d(t,{C6:function(){return r},Cl:function(){return checkIp},Sg:function(){return checkIf}});let r=/^(?=.{1,253}\.?$)[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\.[a-z0-9](?:[-0-9a-z]{0,61}[0-9a-z])?)*\.?$/i,n=/^(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)\.){3}(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)$/},7321:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return Page}});var r=s(966),n=s(3900),o=s(3283),a=s(4224),i=s(7432),c=s(9956),d=s(462),l=s(9977),u=s(7344),h=s(5041),p=s(6117),g=s(9869),m=s(2484),b=(0,s(4397).Z)("password","IconPassword",[["path",{d:"M12 10v4",key:"svg-0"}],["path",{d:"M10 13l4 -2",key:"svg-1"}],["path",{d:"M10 11l4 2",key:"svg-2"}],["path",{d:"M5 10v4",key:"svg-3"}],["path",{d:"M3 13l4 -2",key:"svg-4"}],["path",{d:"M3 11l4 2",key:"svg-5"}],["path",{d:"M19 10v4",key:"svg-6"}],["path",{d:"M17 13l4 -2",key:"svg-7"}],["path",{d:"M17 11l4 2",key:"svg-8"}]]),f=s(7816),x=s(256),j=s.n(x),v=s(8393),y=s(9724),w=s(9561),S=s(7452),k=s(29);function AccessSettingsForm(e){let{initialValues:t,onSubmit:s,saving:n}=e,o=(0,y.c)({initialValues:t,validate:{modbus:{sessionTtl:(0,w.m)({min:0,max:525600},"Must be in range 0-525600. 0 - unlimited."),modbusAuthErrorCode:(0,w.m)({min:1,max:255},"Must be in range 1-255.")}}});return(0,r.jsx)("form",{onSubmit:o.onSubmit(s),children:(0,r.jsxs)(d.K,{children:[(0,r.jsx)(k.Z,{children:(0,r.jsx)(v.Y,{label:"Session TTL (seconds):",description:"Period of idleness (in seconds) after which the Modbus authenticated session will be expired. 0 - unlimited.",required:!0,...o.getInputProps("modbus.sessionTtl")})}),(0,r.jsx)(k.Z,{children:(0,r.jsx)(v.Y,{label:"Modbus error on insufficient access rights (decimal):",description:"The code of Modbus error that will be returned to the client if the client has no access rights to the requested data. Default value: 10 (0x0A)",required:!0,...o.getInputProps("modbus.modbusAuthErrorCode")})}),(0,r.jsx)(S.Z,{type:"submit",inProgress:n,children:"Save"})]})})}var A=s(7219),P=s(5465),M=s(829),C=s(52),O=s(3738);async function saveUser(e){let t=(0,C.bH)();return await (0,C.ri)(t,"/api/user/".concat(e.username,"/update/"),{method:"POST",body:JSON.stringify({allowModbus:e.allowModbus,allowApi:e.allowApi,level:e.level}),timeoutMs:3e4}),(0,O.ph)(["/api/users/",t])}async function changeUserPassword(e,t){let s=(0,C.bH)();await (0,C.ri)(s,"/api/user/".concat(e,"/change-password/"),{method:"POST",body:JSON.stringify({password:t}),timeoutMs:3e4})}async function createUser(e,t){let s=(0,C.bH)();await (0,C.ri)(s,"/api/users/create/",{method:"POST",body:JSON.stringify({username:e,password:t}),timeoutMs:3e4})}async function deleteUser(e){let t=(0,C.bH)();return await (0,C.ri)(t,"/api/user/".concat(e,"/remove/"),{method:"POST",body:JSON.stringify({})}),(0,O.ph)(["/api/users/",t])}async function addFreeAccessRange(e){let t=(0,C.bH)();await (0,C.ri)(t,"/api/modbus/free-ranges/create/",{method:"POST",body:JSON.stringify(e),timeoutMs:3e4})}async function deleteFreeAccessRange(e){let t=(0,C.bH)(),s=e.device;return await (0,C.ri)(t,"/api/modbus/free-range/".concat(void 0===s?"null":s,"-").concat(e.function,"/").concat(e.range,"/remove/"),{method:"POST",body:JSON.stringify({}),timeoutMs:3e4}),(0,O.ph)(["/api/modbus/free-ranges/",t])}async function settingsFetcher(e){let[t,s]=e,r=await (0,O.wv)(s,["auth:defaultModbusAccess:configurationAccess","auth:defaultModbusAccess:modbusDevicesAccess","auth:modbusAuthErrorCode","auth:sessionTtl"]);return{modbus:{defaultAccess:{configuration:r["auth:defaultModbusAccess:configurationAccess"],connectedDevices:r["auth:defaultModbusAccess:modbusDevicesAccess"]},modbusAuthErrorCode:parseInt(r["auth:modbusAuthErrorCode"]),sessionTtl:parseInt(r["auth:sessionTtl"])}}}async function saveSetting(e,t){let s=(0,C.bH)();return await (0,C.ri)(s,"/api/confs/set/",{method:"POST",body:JSON.stringify({[e]:t}),timeoutMs:3e4}),settingsFetcher(["/api/confs/set/",s])}async function saveGeneralSettings(e){return(0,O.NC)({"auth:modbusAuthErrorCode":e.modbus.modbusAuthErrorCode.toString(),"auth:sessionTtl":e.modbus.sessionTtl.toString()})}let z=[{label:"No access",value:"none"},{label:"Read",value:"read"},{label:"Read/Write",value:"readWrite"}];function AccessStatusBlock(e){let{settings:t,mutateSettings:s,users:n,mutateUsers:u,freeAccess:h,mutateFreeAccess:p,setAddUserModalOpened:b,setChangeUserPasswordModalOpened:f,setAddFreeRangeModalOpened:x,setCurrentUsername:v,authUsername:y}=e;return(0,r.jsx)(P.Z,{status:"disabled",name:"Users & Access",icon:(0,r.jsx)(g.Z,{}),bg:"gray.0",addEl:(0,r.jsx)(o.z,{ml:"sm",leftIcon:(0,r.jsx)(m.Z,{size:14}),compact:!0,onClick:()=>b(!0),children:"Add user"}),settings:{title:"Access settings",onSettingsUpdate:()=>{s()},form:AccessSettingsForm,useSettings:()=>({data:t,mutate:s}),save:async e=>{await saveGeneralSettings(e)}},children:(0,r.jsxs)(a.i,{w:"100%",verticalSpacing:"xs",children:[(0,r.jsx)("thead",{children:(0,r.jsxs)("tr",{style:{backgroundColor:"#fff"},children:[(0,r.jsx)("th",{children:"Username"}),(0,r.jsx)("th",{children:"Access Method"}),(0,r.jsx)("th",{children:"OPCB"}),(0,r.jsx)("th",{children:"Connected Devices"}),(0,r.jsx)("th",{})]})}),(0,r.jsxs)("tbody",{children:[Array.from(n.entries()).map(e=>{let[t,s]=e;return(0,r.jsx)(UserRow,{user:s,currentUser:y,mutate:u,openChangePasswordModal:e=>{v(e),f(!0)}},t.toString())}),(0,r.jsxs)("tr",{children:[(0,r.jsx)("td",{colSpan:2,children:(0,r.jsx)("b",{children:"Unauthenticated Modbus access:"})}),(0,r.jsx)("td",{children:(0,r.jsx)(i.s,{value:t.modbus.defaultAccess.configuration,data:z,onChange:e=>(0,A.M)(()=>s(saveSetting("auth:defaultModbusAccess:configurationAccess",e),{optimisticData:()=>{let s=j().cloneDeep(t);return s.modbus.defaultAccess.configuration=e,s}}))})}),(0,r.jsx)("td",{children:(0,r.jsx)(i.s,{data:z,value:t.modbus.defaultAccess.connectedDevices,onChange:e=>(0,A.M)(()=>s(saveSetting("auth:defaultModbusAccess:modbusDevicesAccess",e),{optimisticData:()=>{let s=j().cloneDeep(t);return s.modbus.defaultAccess.connectedDevices=e,s}}))})}),(0,r.jsx)("td",{})]}),(0,r.jsxs)("tr",{children:[(0,r.jsxs)("td",{colSpan:2,valign:"top",style:{borderTop:"none"},children:[(0,r.jsx)(c.x,{weight:700,children:"Always allow Modbus ranges:"}),(0,r.jsx)(c.x,{size:"xs",maw:"300px",children:"OPCB will always allow Modbus read/write access for the requests in those ranges. Note, that if you remove OPCB password input registers range, Modbus clients will not be able to authenticate at all."})]}),(0,r.jsx)("td",{colSpan:3,style:{borderTop:"none"},children:(0,r.jsxs)(d.K,{spacing:4,children:[Array.from(h.entries()).map(e=>{let[t,s]=e;return(0,r.jsx)(FreeModbusAccessRangeBlock,{range:s,mutate:p},t.toString())}),(0,r.jsx)(l.A,{color:"blue",onClick:()=>x(!0),children:(0,r.jsx)(m.Z,{size:16})})]})})]})]})]})})}function UserRow(e){let{user:t,currentUser:s,mutate:n,openChangePasswordModal:o}=e,a=t.username===s||"admin"===t.username,mutateUser=e=>(0,A.M)(()=>{let s=j().cloneDeep(t);return e(s),n(saveUser(s),{optimisticData:e=>e.map(e=>e.username===t.username?s:e)})});return(0,r.jsxs)("tr",{style:{backgroundColor:"#fff"},children:[(0,r.jsx)("td",{children:(0,r.jsx)(c.x,{weight:700,children:t.username})}),(0,r.jsx)("td",{children:(0,r.jsxs)(u.Z,{children:[(0,r.jsx)(h.r,{label:"API",checked:t.allowApi,disabled:a,onChange:e=>mutateUser(t=>(t.allowApi=e.currentTarget.checked,t))}),(0,r.jsx)(h.r,{label:"Modbus",checked:t.allowModbus,disabled:a,onChange:e=>mutateUser(t=>(t.allowModbus=e.currentTarget.checked,t))})]})}),(0,r.jsx)("td",{children:(0,r.jsx)(i.s,{data:z,value:t.level.configuration,disabled:a,onChange:e=>mutateUser(t=>(t.level.configuration=e,t))})}),(0,r.jsx)("td",{children:(0,r.jsx)(i.s,{data:z,value:t.level.connectedDevices,disabled:a,onChange:e=>mutateUser(t=>(t.level.connectedDevices=e,t))})}),(0,r.jsx)("td",{children:(0,r.jsxs)(u.Z,{spacing:"xs",position:"right",children:[(0,r.jsx)(p.u,{label:"Change password",children:(0,r.jsx)(l.A,{color:"blue",onClick:()=>o(t.username),children:(0,r.jsx)(b,{size:16,stroke:1.5})})}),(0,r.jsx)(M.Z,{title:"Delete user",description:'Are you sure you want to delete account "'.concat(t.username,'"?'),buttonText:"Delete",children:(0,r.jsx)(l.A,{color:"red",disabled:a,onClick:()=>{(0,A.M)(()=>n(deleteUser(t.username),{optimisticData:e=>e.filter(e=>e.username!==t.username)}))},children:(0,r.jsx)(f.Z,{size:16,stroke:1.5})})})]})})]})}function FreeModbusAccessRangeBlock(e){let{range:t,mutate:s}=e;return(0,r.jsxs)(u.Z,{bg:"gray.2",p:"xs",sx:e=>({borderRadius:e.radius.sm}),spacing:"md",noWrap:!0,children:[(0,r.jsxs)(u.Z,{spacing:4,align:"baseline",noWrap:!0,miw:113,children:[(0,r.jsx)(c.x,{weight:700,children:"Device ID:"}),(0,r.jsx)(c.x,{children:void 0===t.device?"OPCB":t.device})]}),(0,r.jsxs)(u.Z,{spacing:4,align:"baseline",noWrap:!0,miw:100,children:[(0,r.jsx)(c.x,{weight:700,children:"Function:"}),(0,r.jsx)(c.x,{children:t.function})]}),(0,r.jsxs)(u.Z,{spacing:4,align:"baseline",noWrap:!0,children:[(0,r.jsx)(c.x,{weight:700,children:"Registers:"}),(0,r.jsx)(c.x,{size:"xs",children:t.range})]}),(0,r.jsx)(M.Z,{title:"Delete range",description:"Are you sure you want to delete range?",buttonText:"Delete",children:(0,r.jsx)(l.A,{size:"sm",color:"red",ml:"auto",onClick:()=>{(0,A.M)(()=>s(deleteFreeAccessRange(t),{optimisticData:e=>e.filter(e=>e!==t)}))},children:(0,r.jsx)(f.Z,{size:16,stroke:1.5})})})]})}var T=s(5951),Z=s(6078),_=s(5306),D=s(6169);function AddFreeRangeForm(e){let{initialValues:t,onSubmit:s,saving:n}=e,o=(0,y.c)({initialValues:t,validate:{device:(0,D.Sg)(e=>!e.opcb,(0,w.m)({min:0,max:255},"Must be in range 0-255")),function:(0,w.m)({min:1,max:127},"Must be in range 1-127"),range:(0,_.w)(/^(\d+-\d+,)*\d+-\d+$/,'Format: "startAddress-endAddress,startAddress-endAddress,...". Example: "0-10,20-30".')}});return(0,r.jsx)("form",{onSubmit:o.onSubmit(s),children:(0,r.jsxs)(d.K,{children:[(0,r.jsx)(T.X,{label:"OPCB Modbus ID",checked:o.values.opcb,...o.getInputProps("opcb")}),!o.values.opcb&&(0,r.jsx)(v.Y,{label:"Device Modbus ID (decimal):",...o.getInputProps("device")}),(0,r.jsx)(v.Y,{label:"Modbus Function (decimal):",...o.getInputProps("function")}),(0,r.jsx)(Z.o,{label:"Registers range:",...o.getInputProps("range")}),(0,r.jsx)(S.Z,{type:"submit",inProgress:n,children:"Save"})]})})}var I=s(1277),U=s(6654);function AddUserForm(e){let{initialValues:t,onSubmit:s,saving:n}=e,o=(0,y.c)({initialValues:t,validate:{username:(0,U.d)({min:3,max:30},"Must have 3-30 characters"),password:(0,U.d)({min:3,max:30},"Must have 3-30 characters")}});return(0,r.jsx)("form",{onSubmit:o.onSubmit(s),children:(0,r.jsxs)(d.K,{children:[(0,r.jsx)(Z.o,{label:"Username:",...o.getInputProps("username"),required:!0}),(0,r.jsx)(I.W,{label:"Password:",...o.getInputProps("password"),required:!0}),(0,r.jsx)(S.Z,{type:"submit",inProgress:n,children:"Save"})]})})}function ChangeUserPasswordForm(e){let{initialValues:t,onSubmit:s,saving:n}=e,o=(0,y.c)({initialValues:t,validate:{password:(0,U.d)({min:3,max:30},"Must have 3-30 characters")}});return(0,r.jsx)("form",{onSubmit:o.onSubmit(s),children:(0,r.jsxs)(d.K,{children:[(0,r.jsx)(I.W,{label:"New password:",...o.getInputProps("password"),required:!0}),(0,r.jsx)(S.Z,{type:"submit",inProgress:n,children:"Save"})]})})}var N=s(8253),F=s(2094);function Page(){let e=(0,C.tQ)("access-settings",settingsFetcher),t=(0,C.tQ)("/api/users/",O.ph),s=(0,C.tQ)("/api/modbus/free-ranges/",O.ph),o=(0,C.pk)(),[a,i]=n.useState(!1),[c,d]=n.useState(!1),[l,u]=n.useState(!1),[h,p]=n.useState();return e.data&&t.data&&s.data&&o.token?(0,r.jsxs)(F.Z,{pageTitle:"Access management",children:[(0,r.jsx)(N.Z,{title:"Add account",onSettingsUpdate:()=>{t.mutate()},form:AddUserForm,useSettings:()=>({data:{username:"",password:""},error:void 0,isValidating:!1,isLoading:!1,mutate:async()=>void 0}),save:e=>createUser(e.username,e.password),opened:a,setOpened:i}),(0,r.jsx)(N.Z,{title:'Change password for the account "'.concat(h,'"'),form:ChangeUserPasswordForm,useSettings:()=>({data:{username:h,password:""},error:void 0,isValidating:!1,isLoading:!1,mutate:async()=>void 0}),save:e=>changeUserPassword(e.username,e.password),opened:c,setOpened:d}),(0,r.jsx)(N.Z,{title:"Add free access to the Modbus range",form:AddFreeRangeForm,onSettingsUpdate:()=>{s.mutate()},useSettings:()=>({data:{opcb:!0,device:void 0,function:3,range:""},error:void 0,isValidating:!1,isLoading:!1,mutate:async()=>void 0}),save:async e=>(e.opcb&&(e.device=void 0),addFreeAccessRange(e)),opened:l,setOpened:u}),(0,r.jsx)(AccessStatusBlock,{settings:e.data,mutateSettings:e.mutate,users:t.data,mutateUsers:t.mutate,freeAccess:s.data,mutateFreeAccess:s.mutate,setAddUserModalOpened:i,setCurrentUsername:p,setChangeUserPasswordModalOpened:d,setAddFreeRangeModalOpened:u,authUsername:o.token.username})]}):(0,r.jsx)(F.Z,{pageTitle:"Access management",contentIsLoading:!0})}}},function(e){e.O(0,[863,217,666,388,924,886,94,774,888,179],function(){return e(e.s=9083)}),_N_E=e.O()}]);