(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[112],{3771:function(e,t,s){"use strict";s.d(t,{i:function(){return z}});var r=s(5721),n=s(2251),i=s(2104),o=s(9928),a=s(5580),c=Object.defineProperty,d=Object.defineProperties,l=Object.getOwnPropertyDescriptors,u=Object.getOwnPropertySymbols,h=Object.prototype.hasOwnProperty,p=Object.prototype.propertyIsEnumerable,g=(e,t,s)=>t in e?c(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,m=(e,t)=>{for(var s in t||(t={}))h.call(t,s)&&g(e,s,t[s]);if(u)for(var s of u(t))p.call(t,s)&&g(e,s,t[s]);return e},b=(e,t)=>d(e,l(t)),f=(0,i.k)((e,{captionSide:t,horizontalSpacing:s,verticalSpacing:r,fontSize:n,withBorder:i,withColumnBorders:c})=>{let d=`${(0,o.h)(1)} solid ${"dark"===e.colorScheme?e.colors.dark[4]:e.colors.gray[3]}`;return{root:b(m({},e.fn.fontStyles()),{width:"100%",borderCollapse:"collapse",captionSide:t,color:"dark"===e.colorScheme?e.colors.dark[0]:e.black,lineHeight:e.lineHeight,border:i?d:void 0,"& caption":{marginTop:"top"===t?0:e.spacing.xs,marginBottom:"bottom"===t?0:e.spacing.xs,fontSize:e.fontSizes.sm,color:"dark"===e.colorScheme?e.colors.dark[2]:e.colors.gray[6]},"& thead tr th, & tfoot tr th, & tbody tr th":{textAlign:"left",fontWeight:"bold",color:"dark"===e.colorScheme?e.colors.dark[0]:e.colors.gray[7],fontSize:(0,a.a)({size:n,sizes:e.fontSizes}),padding:`${(0,a.a)({size:r,sizes:e.spacing})} ${(0,a.a)({size:s,sizes:e.spacing})}`},"& thead tr th":{borderBottom:d},"& tfoot tr th, & tbody tr th":{borderTop:d},"& tbody tr td":{padding:`${(0,a.a)({size:r,sizes:e.spacing})} ${(0,a.a)({size:s,sizes:e.spacing})}`,borderTop:d,fontSize:(0,a.a)({size:n,sizes:e.fontSizes})},"& tbody tr:first-of-type td, & tbody tr:first-of-type th":{borderTop:"none"},"& thead th, & tbody td":{borderRight:c?d:"none","&:last-of-type":{borderRight:"none",borderLeft:c?d:"none"}},"& tbody tr th":{borderRight:c?d:"none"},"&[data-striped] tbody tr:nth-of-type(odd)":{backgroundColor:"dark"===e.colorScheme?e.colors.dark[6]:e.colors.gray[0]},"&[data-hover] tbody tr":e.fn.hover({backgroundColor:"dark"===e.colorScheme?e.colors.dark[5]:e.colors.gray[1]})})}}),x=s(5570),j=Object.defineProperty,v=Object.defineProperties,y=Object.getOwnPropertyDescriptors,w=Object.getOwnPropertySymbols,S=Object.prototype.hasOwnProperty,k=Object.prototype.propertyIsEnumerable,M=(e,t,s)=>t in e?j(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,A=(e,t)=>{for(var s in t||(t={}))S.call(t,s)&&M(e,s,t[s]);if(w)for(var s of w(t))k.call(t,s)&&M(e,s,t[s]);return e},C=(e,t)=>v(e,y(t)),O=(e,t)=>{var s={};for(var r in e)S.call(e,r)&&0>t.indexOf(r)&&(s[r]=e[r]);if(null!=e&&w)for(var r of w(e))0>t.indexOf(r)&&k.call(e,r)&&(s[r]=e[r]);return s};let P={striped:!1,highlightOnHover:!1,captionSide:"top",horizontalSpacing:"xs",fontSize:"sm",verticalSpacing:7,withBorder:!1,withColumnBorders:!1},z=(0,r.forwardRef)((e,t)=>{let s=(0,n.N4)("Table",P,e),{className:i,children:o,striped:a,highlightOnHover:c,captionSide:d,horizontalSpacing:l,verticalSpacing:u,fontSize:h,unstyled:p,withBorder:g,withColumnBorders:m,variant:b}=s,j=O(s,["className","children","striped","highlightOnHover","captionSide","horizontalSpacing","verticalSpacing","fontSize","unstyled","withBorder","withColumnBorders","variant"]),{classes:v,cx:y}=f({captionSide:d,verticalSpacing:u,horizontalSpacing:l,fontSize:h,withBorder:g,withColumnBorders:m},{unstyled:p,name:"Table",variant:b});return r.createElement(x.x,C(A({},j),{component:"table",ref:t,className:y(v.root,i),"data-striped":a||void 0,"data-hover":c||void 0}),o)});z.displayName="@mantine/core/Table"},9116:function(e,t,s){"use strict";function r(e,t){let s=t||!0;return t=>"string"!=typeof t?s:e.test(t)?null:s}s.d(t,{w:function(){return r}})},5789:function(e,t,s){"use strict";s.d(t,{Z:function(){return r}});var r=(0,s(7557).Z)("plus","IconPlus",[["path",{d:"M12 5l0 14",key:"svg-0"}],["path",{d:"M5 12l14 0",key:"svg-1"}]])},2737:function(e,t,s){"use strict";s.d(t,{Z:function(){return r}});var r=(0,s(7557).Z)("trash","IconTrash",[["path",{d:"M4 7l16 0",key:"svg-0"}],["path",{d:"M10 11l0 6",key:"svg-1"}],["path",{d:"M14 11l0 6",key:"svg-2"}],["path",{d:"M5 7l1 12a2 2 0 0 0 2 2h8a2 2 0 0 0 2 -2l1 -12",key:"svg-3"}],["path",{d:"M9 7v-3a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v3",key:"svg-4"}]])},3922:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/access",function(){return s(8842)}])},5018:function(e,t,s){"use strict";s.d(t,{Z:function(){return l}});var r=s(6521),n=s(1876),i=s(8202),o=s(2952),a=s(8026),c=s(4211),d=s(5721);function l(e){let{children:t}=e,[s,l]=(0,d.useState)(!1);return(0,r.jsx)(t.type,{...Object.fromEntries(Object.entries(t.props)),labelProps:{display:"block"},label:(0,r.jsxs)(n.Z,{mb:"4px",spacing:5,children:[t.props.label,(0,r.jsx)(i.x,{children:(t.props.withAsterisk||t.props.required)&&(0,r.jsx)(i.x,{span:!0,color:"red","aria-hidden":!0,children:" *"})}),(0,r.jsx)(i.x,{ml:"auto",color:"gray.6",sx:{cursor:"pointer"},onClick:e=>{l(!s),e.preventDefault()},children:(0,r.jsx)(o.M,{children:(0,r.jsx)(c.Z,{size:14,stroke:1.5})})})]}),description:(0,r.jsx)(a.U,{in:s,transitionDuration:100,children:(0,r.jsx)(i.x,{size:"xs",color:"gray.6",lh:"14px",children:t.props.description})}),withAsterisk:!1})}},8581:function(e,t,s){"use strict";s.d(t,{Z:function(){return m}});var r=s(6521),n=s(5721),i=s(594),o=s(7961),a=s(5388),c=s(1876),d=s(6386),l=s(8202),u=s(9011),h=s(5570),p=s(1771);function g(e){let t="connected"===e.status?"green":"warn"===e.status?"orange":"disconnected"===e.status?"red":"gray";return(0,r.jsx)(o.X,{h:"100%",withBorder:!0,children:(0,r.jsxs)(a.K,{spacing:0,h:"100%",children:[(0,r.jsxs)(c.Z,{position:"apart",align:"center",p:"xs",sx:e=>({borderBottom:"1px solid ".concat(e.colors.gray[3])}),children:[(0,r.jsxs)(c.Z,{spacing:"xs",noWrap:!0,children:[(0,r.jsx)(d.k,{color:t,variant:"light",children:e.icon}),(0,r.jsx)(l.x,{weight:500,c:t,transform:"uppercase",children:e.name}),e.addEl&&"string"==typeof e.addEl?(0,r.jsx)(l.x,{c:"dimmed",size:"sm",children:e.addEl}):e.addEl]}),(0,r.jsxs)(c.Z,{spacing:"xs",noWrap:!0,children:[e.addElRight,e.settingsAction&&(0,r.jsx)(u.A,{color:"blue",onClick:e.settingsAction,children:(0,r.jsx)(p.Z,{size:18})})]})]}),(0,r.jsx)(h.x,{bg:e.bg,h:"100%",children:e.children})]})})}function m(e){let[t,s]=(0,n.useState)(!1);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(i.Z,{...e.settings,opened:t,setOpened:s}),(0,r.jsx)(g,{...e,settingsAction:()=>s(!0),children:e.children})]})}},3611:function(e,t,s){"use strict";s.d(t,{Z:function(){return l}});var r=s(6521),n=s(5400),i=s(5388),o=s(8202),a=s(1876),c=s(5885),d=s(5721);function l(e){let{children:t,title:s,description:l,buttonText:u}=e,[h,p]=(0,d.useState)(!1);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.u,{opened:h,onClose:()=>p(!1),withCloseButton:!1,children:(0,r.jsxs)(i.K,{children:[(0,r.jsx)(o.x,{fz:"md",weight:500,align:"center",children:s}),(0,r.jsx)(o.x,{fz:"sm",c:"gray.7",align:"center",children:l}),(0,r.jsxs)(a.Z,{position:"center",children:[(0,r.jsx)(c.z,{color:"orange",onClick:()=>{t.props.onClick(),p(!1)},children:u}),(0,r.jsx)(c.z,{color:"green",onClick:()=>p(!1),children:"Cancel"})]})]})}),(0,r.jsx)(t.type,{...t.props,onClick:()=>p(!0)})]})}},7176:function(e,t,s){"use strict";s.d(t,{M:function(){return a},u:function(){return c}});var r=s(6521),n=s(367),i=s(602),o=s(4239);async function a(e){(0,n.yK)("settings-save"),(0,n.c0)({id:"settings-save",withCloseButton:!0,autoClose:!1,loading:!0,icon:null,color:"orange",title:"Saving settings...",message:"Please wait while the new settings are applied..."});try{await e()}catch(e){(0,n.wD)({id:"settings-save",loading:!1,withCloseButton:!0,color:"red",icon:(0,r.jsx)(i.Z,{}),title:"Error saving settings",message:"There was an error saving settings. Please check form data and try again."}),console.error(e);return}(0,n.wD)({id:"settings-save",loading:!1,withCloseButton:!0,autoClose:1e3,color:"green",icon:(0,r.jsx)(o.Z,{}),title:"Settings saved",message:"Settings were saved and applied successfully."})}function c(e,t,s){return function(r){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"input";return function(e,t,s,r){let n=e.getInputProps(t,s);return{...n,classNames:{input:e.isDirty(t)&&r||void 0}}}(e,r,{...s,type:n},t)}}},2514:function(e,t,s){"use strict";function r(e){return e?e.toString().match(o)?void 0:"Invalid IP address.":"Required."}function n(e,t){return(s,r)=>e(r)?t(s):void 0}s.d(t,{C6:function(){return i},Cl:function(){return r},Sg:function(){return n}});let i=/^(?=.{1,253}\.?$)[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\.[a-z0-9](?:[-0-9a-z]{0,61}[0-9a-z])?)*\.?$/i,o=/^(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)\.){3}(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)$/},8842:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return et}});var r=s(6521),n=s(5721),i=s(5885),o=s(3771),a=s(58),c=s(8202),d=s(5388),l=s(9011),u=s(1876),h=s(8997),p=s(3070),g=s(3643),m=s(5789),b=(0,s(7557).Z)("password","IconPassword",[["path",{d:"M12 10v4",key:"svg-0"}],["path",{d:"M10 13l4 -2",key:"svg-1"}],["path",{d:"M10 11l4 2",key:"svg-2"}],["path",{d:"M5 10v4",key:"svg-3"}],["path",{d:"M3 13l4 -2",key:"svg-4"}],["path",{d:"M3 11l4 2",key:"svg-5"}],["path",{d:"M19 10v4",key:"svg-6"}],["path",{d:"M17 13l4 -2",key:"svg-7"}],["path",{d:"M17 11l4 2",key:"svg-8"}]]),f=s(2737),x=s(5619),j=s.n(x),v=s(4094),y=s(3126),w=s(823),S=s(1685),k=s(5018);function M(e){let{initialValues:t,onSubmit:s,saving:n}=e,i=(0,y.c)({initialValues:t,validate:{modbus:{sessionTtl:(0,w.m)({min:0,max:525600},"Must be in range 0-525600. 0 - unlimited."),modbusAuthErrorCode:(0,w.m)({min:1,max:255},"Must be in range 1-255.")}}});return(0,r.jsx)("form",{onSubmit:i.onSubmit(s),children:(0,r.jsxs)(d.K,{children:[(0,r.jsx)(k.Z,{children:(0,r.jsx)(v.Y,{label:"Session TTL (seconds):",description:"Period of idleness (in seconds) after which the Modbus authenticated session will be expired. 0 - unlimited.",required:!0,...i.getInputProps("modbus.sessionTtl")})}),(0,r.jsx)(k.Z,{children:(0,r.jsx)(v.Y,{label:"Modbus error on insufficient access rights (decimal):",description:"The code of Modbus error that will be returned to the client if the client has no access rights to the requested data. Default value: 10 (0x0A)",required:!0,...i.getInputProps("modbus.modbusAuthErrorCode")})}),(0,r.jsx)(S.Z,{type:"submit",inProgress:n,children:"Save"})]})})}var A=s(7176),C=s(8581),O=s(3611),P=s(4579),z=s(4911);async function Z(e){let t=(0,P.bH)();return await (0,P.ri)(t,"/api/user/".concat(e.username,"/update/"),{method:"POST",body:JSON.stringify({allowModbus:e.allowModbus,allowApi:e.allowApi,level:e.level}),timeoutMs:3e4}),(0,z.ph)(["/api/users/",t])}async function T(e,t){let s=(0,P.bH)();await (0,P.ri)(s,"/api/user/".concat(e,"/change-password/"),{method:"POST",body:JSON.stringify({password:t}),timeoutMs:3e4})}async function D(e,t){let s=(0,P.bH)();await (0,P.ri)(s,"/api/users/create/",{method:"POST",body:JSON.stringify({username:e,password:t}),timeoutMs:3e4})}async function I(e){let t=(0,P.bH)();return await (0,P.ri)(t,"/api/user/".concat(e,"/remove/"),{method:"POST",body:JSON.stringify({})}),(0,z.ph)(["/api/users/",t])}async function E(e){let t=(0,P.bH)();await (0,P.ri)(t,"/api/modbus/free-ranges/create/",{method:"POST",body:JSON.stringify(e),timeoutMs:3e4})}async function N(e){let t=(0,P.bH)(),s=e.device;return await (0,P.ri)(t,"/api/modbus/free-range/".concat(void 0===s?"null":s,"-").concat(e.function,"/").concat(e.range,"/remove/"),{method:"POST",body:JSON.stringify({}),timeoutMs:3e4}),(0,z.ph)(["/api/modbus/free-ranges/",t])}async function B(e){let[t,s]=e,r=await (0,z.wv)(s,["auth:defaultModbusAccess:configurationAccess","auth:defaultModbusAccess:modbusDevicesAccess","auth:modbusAuthErrorCode","auth:sessionTtl"]);return{modbus:{defaultAccess:{configuration:r["auth:defaultModbusAccess:configurationAccess"],connectedDevices:r["auth:defaultModbusAccess:modbusDevicesAccess"]},modbusAuthErrorCode:parseInt(r["auth:modbusAuthErrorCode"]),sessionTtl:parseInt(r["auth:sessionTtl"])}}}async function U(e,t){let s=(0,P.bH)();return await (0,P.ri)(s,"/api/confs/set/",{method:"POST",body:JSON.stringify({[e]:t}),timeoutMs:3e4}),B(["/api/confs/set/",s])}async function R(e){return(0,z.NC)({"auth:modbusAuthErrorCode":e.modbus.modbusAuthErrorCode.toString(),"auth:sessionTtl":e.modbus.sessionTtl.toString()})}let _=[{label:"No access",value:"none"},{label:"Read",value:"read"},{label:"Read/Write",value:"readWrite"}];function H(e){let{settings:t,mutateSettings:s,users:n,mutateUsers:u,freeAccess:h,mutateFreeAccess:p,setAddUserModalOpened:b,setChangeUserPasswordModalOpened:f,setAddFreeRangeModalOpened:x,setCurrentUsername:v,authUsername:y}=e;return(0,r.jsx)(C.Z,{status:"disabled",name:"Users & Access",icon:(0,r.jsx)(g.Z,{}),bg:"gray.0",addEl:(0,r.jsx)(i.z,{ml:"sm",leftIcon:(0,r.jsx)(m.Z,{size:14}),compact:!0,onClick:()=>b(!0),children:"Add user"}),settings:{title:"Access settings",onSettingsUpdate:()=>{s()},form:M,useSettings:()=>({data:t,mutate:s}),save:async e=>{await R(e)}},children:(0,r.jsxs)(o.i,{w:"100%",verticalSpacing:"xs",children:[(0,r.jsx)("thead",{children:(0,r.jsxs)("tr",{style:{backgroundColor:"#fff"},children:[(0,r.jsx)("th",{children:"Username"}),(0,r.jsx)("th",{children:"Access Method"}),(0,r.jsx)("th",{children:"OPCB"}),(0,r.jsx)("th",{children:"Connected Devices"}),(0,r.jsx)("th",{})]})}),(0,r.jsxs)("tbody",{children:[Array.from(n.entries()).map(e=>{let[t,s]=e;return(0,r.jsx)(W,{user:s,currentUser:y,mutate:u,openChangePasswordModal:e=>{v(e),f(!0)}},t.toString())}),(0,r.jsxs)("tr",{children:[(0,r.jsx)("td",{colSpan:2,children:(0,r.jsx)("b",{children:"Unauthenticated Modbus access:"})}),(0,r.jsx)("td",{children:(0,r.jsx)(a.s,{value:t.modbus.defaultAccess.configuration,data:_,onChange:e=>(0,A.M)(()=>s(U("auth:defaultModbusAccess:configurationAccess",e),{optimisticData:()=>{let s=j().cloneDeep(t);return s.modbus.defaultAccess.configuration=e,s}}))})}),(0,r.jsx)("td",{children:(0,r.jsx)(a.s,{data:_,value:t.modbus.defaultAccess.connectedDevices,onChange:e=>(0,A.M)(()=>s(U("auth:defaultModbusAccess:modbusDevicesAccess",e),{optimisticData:()=>{let s=j().cloneDeep(t);return s.modbus.defaultAccess.connectedDevices=e,s}}))})}),(0,r.jsx)("td",{})]}),(0,r.jsxs)("tr",{children:[(0,r.jsxs)("td",{colSpan:2,valign:"top",style:{borderTop:"none"},children:[(0,r.jsx)(c.x,{weight:700,children:"Always allow Modbus ranges:"}),(0,r.jsx)(c.x,{size:"xs",maw:"300px",children:"OPCB will always allow Modbus read/write access for the requests in those ranges. Note, that if you remove OPCB password input registers range, Modbus clients will not be able to authenticate at all."})]}),(0,r.jsx)("td",{colSpan:3,style:{borderTop:"none"},children:(0,r.jsxs)(d.K,{spacing:4,children:[Array.from(h.entries()).map(e=>{let[t,s]=e;return(0,r.jsx)($,{range:s,mutate:p},t.toString())}),(0,r.jsx)(l.A,{color:"blue",onClick:()=>x(!0),children:(0,r.jsx)(m.Z,{size:16})})]})})]})]})]})})}function W(e){let{user:t,currentUser:s,mutate:n,openChangePasswordModal:i}=e,o=t.username===s||"admin"===t.username,d=e=>(0,A.M)(()=>{let s=j().cloneDeep(t);return e(s),n(Z(s),{optimisticData:e=>e.map(e=>e.username===t.username?s:e)})});return(0,r.jsxs)("tr",{style:{backgroundColor:"#fff"},children:[(0,r.jsx)("td",{children:(0,r.jsx)(c.x,{weight:700,children:t.username})}),(0,r.jsx)("td",{children:(0,r.jsxs)(u.Z,{children:[(0,r.jsx)(h.r,{label:"API",checked:t.allowApi,disabled:o,onChange:e=>d(t=>(t.allowApi=e.currentTarget.checked,t))}),(0,r.jsx)(h.r,{label:"Modbus",checked:t.allowModbus,disabled:o,onChange:e=>d(t=>(t.allowModbus=e.currentTarget.checked,t))})]})}),(0,r.jsx)("td",{children:(0,r.jsx)(a.s,{data:_,value:t.level.configuration,disabled:o,onChange:e=>d(t=>(t.level.configuration=e,t))})}),(0,r.jsx)("td",{children:(0,r.jsx)(a.s,{data:_,value:t.level.connectedDevices,disabled:o,onChange:e=>d(t=>(t.level.connectedDevices=e,t))})}),(0,r.jsx)("td",{children:(0,r.jsxs)(u.Z,{spacing:"xs",position:"right",children:[(0,r.jsx)(p.u,{label:"Change password",children:(0,r.jsx)(l.A,{color:"blue",onClick:()=>i(t.username),children:(0,r.jsx)(b,{size:16,stroke:1.5})})}),(0,r.jsx)(O.Z,{title:"Delete user",description:'Are you sure you want to delete account "'.concat(t.username,'"?'),buttonText:"Delete",children:(0,r.jsx)(l.A,{color:"red",disabled:o,onClick:()=>{(0,A.M)(()=>n(I(t.username),{optimisticData:e=>e.filter(e=>e.username!==t.username)}))},children:(0,r.jsx)(f.Z,{size:16,stroke:1.5})})})]})})]})}function $(e){let{range:t,mutate:s}=e;return(0,r.jsxs)(u.Z,{bg:"gray.2",p:"xs",sx:e=>({borderRadius:e.radius.sm}),spacing:"md",noWrap:!0,children:[(0,r.jsxs)(u.Z,{spacing:4,align:"baseline",noWrap:!0,miw:113,children:[(0,r.jsx)(c.x,{weight:700,children:"Device ID:"}),(0,r.jsx)(c.x,{children:void 0===t.device?"OPCB":t.device})]}),(0,r.jsxs)(u.Z,{spacing:4,align:"baseline",noWrap:!0,miw:100,children:[(0,r.jsx)(c.x,{weight:700,children:"Function:"}),(0,r.jsx)(c.x,{children:t.function})]}),(0,r.jsxs)(u.Z,{spacing:4,align:"baseline",noWrap:!0,children:[(0,r.jsx)(c.x,{weight:700,children:"Registers:"}),(0,r.jsx)(c.x,{size:"xs",children:t.range})]}),(0,r.jsx)(O.Z,{title:"Delete range",description:"Are you sure you want to delete range?",buttonText:"Delete",children:(0,r.jsx)(l.A,{size:"sm",color:"red",ml:"auto",onClick:()=>{(0,A.M)(()=>s(N(t),{optimisticData:e=>e.filter(e=>e!==t)}))},children:(0,r.jsx)(f.Z,{size:16,stroke:1.5})})})]})}var q=s(80),K=s(8508),F=s(9116),J=s(2514);function L(e){let{initialValues:t,onSubmit:s,saving:n}=e,i=(0,y.c)({initialValues:t,validate:{device:(0,J.Sg)(e=>!e.opcb,(0,w.m)({min:0,max:255},"Must be in range 0-255")),function:(0,w.m)({min:1,max:127},"Must be in range 1-127"),range:(0,F.w)(/^(\d+-\d+,)*\d+-\d+$/,'Format: "startAddress-endAddress,startAddress-endAddress,...". Example: "0-10,20-30".')}});return(0,r.jsx)("form",{onSubmit:i.onSubmit(s),children:(0,r.jsxs)(d.K,{children:[(0,r.jsx)(q.X,{label:"OPCB Modbus ID",checked:i.values.opcb,...i.getInputProps("opcb")}),!i.values.opcb&&(0,r.jsx)(v.Y,{label:"Device Modbus ID (decimal):",...i.getInputProps("device")}),(0,r.jsx)(v.Y,{label:"Modbus Function (decimal):",...i.getInputProps("function")}),(0,r.jsx)(K.o,{label:"Registers range:",...i.getInputProps("range")}),(0,r.jsx)(S.Z,{type:"submit",inProgress:n,children:"Save"})]})})}var X=s(9960),Y=s(82);function Q(e){let{initialValues:t,onSubmit:s,saving:n}=e,i=(0,y.c)({initialValues:t,validate:{username:(0,Y.d)({min:3,max:30},"Must have 3-30 characters"),password:(0,Y.d)({min:3,max:30},"Must have 3-30 characters")}});return(0,r.jsx)("form",{onSubmit:i.onSubmit(s),children:(0,r.jsxs)(d.K,{children:[(0,r.jsx)(K.o,{label:"Username:",...i.getInputProps("username"),required:!0}),(0,r.jsx)(X.W,{label:"Password:",...i.getInputProps("password"),required:!0}),(0,r.jsx)(S.Z,{type:"submit",inProgress:n,children:"Save"})]})})}function V(e){let{initialValues:t,onSubmit:s,saving:n}=e,i=(0,y.c)({initialValues:t,validate:{password:(0,Y.d)({min:3,max:30},"Must have 3-30 characters")}});return(0,r.jsx)("form",{onSubmit:i.onSubmit(s),children:(0,r.jsxs)(d.K,{children:[(0,r.jsx)(X.W,{label:"New password:",...i.getInputProps("password"),required:!0}),(0,r.jsx)(S.Z,{type:"submit",inProgress:n,children:"Save"})]})})}var G=s(594),ee=s(9296);function et(){let e=(0,P.tQ)("access-settings",B),t=(0,P.tQ)("/api/users/",z.ph),s=(0,P.tQ)("/api/modbus/free-ranges/",z.ph),i=(0,P.pk)(),[o,a]=n.useState(!1),[c,d]=n.useState(!1),[l,u]=n.useState(!1),[h,p]=n.useState();return e.data&&t.data&&s.data&&i.token?(0,r.jsxs)(ee.Z,{pageTitle:"Access management",children:[(0,r.jsx)(G.Z,{title:"Add account",onSettingsUpdate:()=>{t.mutate()},form:Q,useSettings:()=>({data:{username:"",password:""},error:void 0,isValidating:!1,isLoading:!1,mutate:async()=>void 0}),save:e=>D(e.username,e.password),opened:o,setOpened:a}),(0,r.jsx)(G.Z,{title:'Change password for the account "'.concat(h,'"'),form:V,useSettings:()=>({data:{username:h,password:""},error:void 0,isValidating:!1,isLoading:!1,mutate:async()=>void 0}),save:e=>T(e.username,e.password),opened:c,setOpened:d}),(0,r.jsx)(G.Z,{title:"Add free access to the Modbus range",form:L,onSettingsUpdate:()=>{s.mutate()},useSettings:()=>({data:{opcb:!0,device:void 0,function:3,range:""},error:void 0,isValidating:!1,isLoading:!1,mutate:async()=>void 0}),save:async e=>(e.opcb&&(e.device=void 0),E(e)),opened:l,setOpened:u}),(0,r.jsx)(H,{settings:e.data,mutateSettings:e.mutate,users:t.data,mutateUsers:t.mutate,freeAccess:s.data,mutateFreeAccess:s.mutate,setAddUserModalOpened:a,setCurrentUsername:p,setChangeUserPasswordModalOpened:d,setAddFreeRangeModalOpened:u,authUsername:i.token.username})]}):(0,r.jsx)(ee.Z,{pageTitle:"Access management",contentIsLoading:!0})}}},function(e){e.O(0,[944,634,733,301,979,156,296,774,888,179],function(){return e(e.s=3922)}),_N_E=e.O()}]);