(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[234],{8699:function(e,n,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/connections/lora-sens",function(){return t(7958)}])},6435:function(e,n,t){"use strict";t.d(n,{Z:function(){return ConnectionsLayout}});var r=t(966),i=t(9025),s=t(7344),a=t(3960),o=t(8822),l=t(5040),d=t(3127),c=t(4985),u=t(4853),h=t(937),m=t(8769),x=t(1407),g=t(8392),p=t(9640),j=t(7097),v=t.n(j),f=t(2094);let S=(0,i.k)(e=>({navlink:{color:e.colors.blue[6],"&:hover":{color:e.colors.dark,backgroundColor:"transparent"},"&[data-active]":{color:e.colors.dark,backgroundColor:"transparent",borderRight:"2px solid #000",pointerEvents:"none"}}}));function ConnectionsLayout(e){let{children:n,pageId:t,title:i}=e,{classes:j}=S();return(0,r.jsx)(f.Z,{pageTitle:"Connections :: ".concat(i),children:(0,r.jsxs)(s.Z,{align:"stretch",position:"left",noWrap:!0,children:[(0,r.jsx)(a.z,{smallerThan:"md",styles:{width:50,whiteSpace:"nowrap",marginLeft:-25},children:(0,r.jsx)(o.w,{width:{md:200},ml:"-sm",mih:0,height:"auto",children:(0,r.jsxs)(o.w.Section,{children:[(0,r.jsx)(l.O,{component:v(),href:"/connections/modbus-rs485",label:"Modbus over RS-485",icon:(0,r.jsx)(c.Z,{size:16,stroke:1.5}),active:"modbus-rs485"===t,className:j.navlink}),(0,r.jsx)(l.O,{component:v(),href:"/connections/modbus-tcp-server",label:"Modbus TCP Server",icon:(0,r.jsx)(u.Z,{size:16,stroke:1.5}),active:"modbus-tcp-server"===t,className:j.navlink}),(0,r.jsx)(l.O,{component:v(),href:"/connections/modbus-tcp-client",label:"Modbus TCP Client",icon:(0,r.jsx)(h.Z,{size:16,stroke:1.5}),active:"modbus-tcp-client"===t,className:j.navlink}),(0,r.jsx)(l.O,{component:v(),href:"/connections/opcb-modbus-access",label:"OPCB Modbus Access",icon:(0,r.jsx)(m.Z,{size:16,stroke:1.5}),active:"opcb-modbus-access"===t,className:j.navlink}),(0,r.jsx)(l.O,{component:v(),href:"/connections/lora-sens",label:"LoraSens",icon:(0,r.jsx)(x.Z,{size:16,stroke:1.5}),active:"lora-sens"===t,className:j.navlink}),(0,r.jsx)(l.O,{component:v(),href:"/connections/mqtt",label:"MQTT Broker",icon:(0,r.jsx)(g.Z,{size:16,stroke:1.5}),active:"mqtt"===t,className:j.navlink}),(0,r.jsx)(l.O,{component:v(),href:"/connections/overvis-modbus-tcp",label:"Overvis Modbus TCP",icon:(0,r.jsx)(p.Z,{size:16,stroke:1.5}),active:"overvis-modbus-tcp"===t,className:j.navlink})]})})}),(0,r.jsx)(d.x,{sx:{flexGrow:1},children:n})]})})}},7723:function(e,n,t){"use strict";var r=t(9025);n.Z=(0,r.k)(e=>({dirtyInput:{backgroundColor:e.colors.blue[0]}}))},29:function(e,n,t){"use strict";t.d(n,{Z:function(){return InputWithHelp}});var r=t(966),i=t(7344),s=t(9956),a=t(8255),o=t(8482),l=t(5897),d=t(3900);function InputWithHelp(e){let{children:n}=e,[t,c]=(0,d.useState)(!1);return(0,r.jsx)(n.type,{...Object.fromEntries(Object.entries(n.props)),labelProps:{display:"block"},label:(0,r.jsxs)(i.Z,{mb:"4px",spacing:5,children:[n.props.label,(0,r.jsx)(s.x,{children:(n.props.withAsterisk||n.props.required)&&(0,r.jsx)(s.x,{span:!0,color:"red","aria-hidden":!0,children:" *"})}),(0,r.jsx)(s.x,{ml:"auto",color:"blue",sx:{cursor:"pointer"},onClick:e=>{c(!t),e.preventDefault()},children:(0,r.jsx)(a.M,{children:(0,r.jsx)(l.Z,{size:14,stroke:1.5})})})]}),description:(0,r.jsx)(o.U,{in:t,transitionDuration:100,children:(0,r.jsx)(s.x,{size:"xs",color:"gray.6",lh:"14px",children:n.props.description})}),withAsterisk:!1})}},477:function(e,n,t){"use strict";t.d(n,{Z:function(){return RxTxDisplay}});var r=t(966),i=t(1949),s=t(4137),a=t(2242),o=t(8431),l=t(3610);function RxTxDisplay(e){let{bytes:n,lastBytesSinceSec:t,speed:d,dbm:c,tx:u,oneline:h=!0}=e,m=(0,i.rZ)(),x=void 0!==t&&t<=2?m.colors.green[6]:m.colors.gray[6];return(0,r.jsx)(l.Z,{icon:u?(0,r.jsx)(s.Z,{stroke:1,height:15,color:x}):(0,r.jsx)(a.Z,{stroke:1,height:15,color:x}),name:u?"TX":"RX",subNameVal:c?"".concat(c," dBm"):void 0,nameColor:x,mainVal:(0,o.td)(n),subVal:{level:void 0!==t&&t<=2?"good":"dimmed",value:"".concat((0,o.td)(d),"/s")},oneline:h})}},3610:function(e,n,t){"use strict";t.d(n,{Z:function(){return ValueDisplay}});var r=t(966),i=t(9956),s=t(7344),a=t(462);function ValueDisplay(e){let{icon:n,name:t,subNameVal:o,nameColor:l="dimmed",mainVal:d,subVal:c,oneline:u}=e,h=!function(e){for(var n=arguments.length,t=Array(n>1?n-1:0),r=1;r<n;r++)t[r-1]=arguments[r];return"object"==typeof e&&null!==e&&t.every(n=>n in e)}(c,"value","level")?c:(0,r.jsxs)(r.Fragment,{children:[c.name&&c.name+" ",(0,r.jsx)(i.x,{span:!0,c:"good"===c.level?"green":"medium"===c.level?"orange":"bad"===c.level?"red":"dimmed",transform:"none",children:c.value})]}),m=(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(s.Z,{spacing:5,children:[(0,r.jsx)(i.x,{weight:"bold",size:"xs",color:l,transform:"uppercase",children:t}),o&&(0,r.jsx)(i.x,{size:10,color:"dimmed",children:o})]}),(0,r.jsx)(i.x,{fz:"xs",color:"black",children:d}),h&&(0,r.jsx)(i.x,{size:10,color:"dimmed",children:h})]});return u?(0,r.jsxs)(s.Z,{spacing:5,align:"baseline",noWrap:!0,children:[(0,r.jsx)("div",{style:{position:"relative",top:"2px",marginTop:"-5px",marginRight:"-4px"},children:n}),m]}):(0,r.jsxs)(s.Z,{spacing:0,align:"baseline",noWrap:!0,children:[(0,r.jsx)("div",{style:{position:"relative",top:"2px",marginTop:"-5px"},children:n}),(0,r.jsx)(a.K,{spacing:0,children:m})]})}t(3900)},829:function(e,n,t){"use strict";t.d(n,{Z:function(){return WithConfirmation}});var r=t(966),i=t(4512),s=t(462),a=t(9956),o=t(7344),l=t(3283),d=t(3900);function WithConfirmation(e){let{children:n,title:t,description:c,buttonText:u,isLevelGood:h}=e,[m,x]=(0,d.useState)(!1);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(i.u,{opened:m,onClose:()=>x(!1),withCloseButton:!1,zIndex:400,children:(0,r.jsxs)(s.K,{children:[(0,r.jsx)(a.x,{fz:"md",weight:500,align:"center",children:t}),(0,r.jsx)(a.x,{fz:"sm",c:"gray.7",align:"center",children:c}),(0,r.jsxs)(o.Z,{position:"center",children:[(0,r.jsx)(l.z,{color:h?"green":"orange",onClick:()=>{n.props.onClick(),x(!1)},children:u}),(0,r.jsx)(l.z,{color:h?"orange":"green",onClick:()=>x(!1),children:"Cancel"})]})]})}),(0,r.jsx)(n.type,{...n.props,onClick:()=>x(!0)})]})}},7219:function(e,n,t){"use strict";t.d(n,{Mx:function(){return saveProcedure},_B:function(){return getDirtyValues},_N:function(){return useFormWithInitialUpdates},uA:function(){return makeInputPropsGen}});var r=t(966),i=t(7344),s=t(9956),a=t(9724),o=t(6680),l=t(7017),d=t(2922),c=t(1457),u=t(3900),h=t(9804);async function saveProcedure(e){(0,o.yK)("settings-save"),(0,o.c0)({id:"settings-save",withCloseButton:!0,autoClose:!1,loading:!0,icon:null,color:"orange",title:"Saving settings...",message:"Please wait while the new settings are applied..."});try{await e()}catch(e){(0,o.wD)({id:"settings-save",loading:!1,withCloseButton:!0,color:"red",icon:(0,r.jsx)(l.Z,{}),title:"Error saving settings",message:"There was an error saving settings. Please check form data and try again."}),console.error(e);return}(0,o.wD)({id:"settings-save",loading:!1,withCloseButton:!0,autoClose:1e3,color:"green",icon:(0,r.jsx)(d.Z,{}),title:"Settings saved",message:"Settings were saved and applied successfully."})}function makeInputPropsGen(e,n,t){return function(a){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"input",l=arguments.length>2?arguments[2]:void 0;return function(e,n,t,a,o){let l=e.getInputProps(n,t),d=o&&o>300;return{...l,classNames:{input:e.isDirty(n)&&a||void 0},inputContainer:d?e=>(0,r.jsxs)(r.Fragment,{children:[e,(0,r.jsxs)(i.Z,{spacing:3,c:"orange",mt:2,align:"center",children:[(0,r.jsx)(c.Z,{size:11,style:{marginTop:-1}}),(0,r.jsxs)(s.x,{fz:"xs",children:["Updated: ",(0,h.LU)(1e3*o)," ago."]})]})]}):void 0}}(e,a,{...t,type:o},n,l)}}function useFormWithInitialUpdates(e){let n=(0,a.c)(e);return(0,u.useEffect)(()=>{for(let t in n.values)n.isDirty(t)||n.setFieldValue(t,e.initialValues[t]);n.resetDirty({...e.initialValues})},[...Object.values(e.initialValues)]),n}function getDirtyValues(e){return Object.fromEntries(Object.entries(e.values).filter(n=>{let[t,r]=n;return e.isDirty(t)&&void 0!==r}))}},7958:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return Page}});var r,i,s,a,o,l,d,c,u,h,m,x,g=t(966),p=t(462),j=t(2763),v=t(9956),f=t(480),S=t(7344),b=t(5041),y=t(5782),w=t(3624),C=t(3900),T=t(6435),z=t(9025),k=t(5728),Z=t(1949),P=t(4512),O=t(4215),L=t(5614),N=t(9977),E=t(8598),D=t(2308),I=t(3283),R=t(8482),B=t(4495),F=t(7816),K=t(8637),W=t(1138),M=t(8926),q=t(7147),_=t(3174),U=t(52);function getSkuDisplayName(e){if(!e)return"Unknown LoraSens device";switch(e){case"lth-1":return"Temperature/humidity sensor LTH-1";case"lwg-1":return"Weight sensor array LWG-1"}}async function bindLoraSensDevice(e,n,t,r,i,s,a,o,l){await (0,U.ri)(e,"/api/lora-sens/device/bind/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({did:n,devKindCode:t,firmwareVersion:r,frequencyDeviceKhz:i,frequencyGatewayKhz:s,bandwidthKhz:a,spreadFactor:o,codingRateBits:l})})}async function ignoreLoraSensDevice(e,n){await (0,U.ri)(e,"/api/lora-sens/device/ignore/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({did:n})})}async function deleteLoraSensDevice(e,n){await (0,U.ri)(e,"/api/lora-sens/device/delete/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:n})})}async function loraSensDevicesFetcher(e){let[n,t]=e,r=await (0,U.ri)(t,"/api/lora-sens/list/devices/"),i=await r.json(),s=[];for(let e of i)s.push({...e,lastConnectionOn:e.lastConnectionOn&&new Date(1e3*e.lastConnectionOn),nextConnectionOn:e.nextConnectionOn&&new Date(1e3*e.nextConnectionOn)});return s}async function loraSensUnbindedDevicesFetcher(e){let[n,t]=e,r=await (0,U.ri)(t,"/api/lora-sens/list/unbinded-devices/"),i=await r.json();for(let e of i)e.lastConnectionOn=e.lastConnectionOn&&new Date(1e3*e.lastConnectionOn),e.acceptedOn=e.acceptedOn&&new Date(1e3*e.acceptedOn);return i}async function saveDeviceSettings(e,n,t){await (0,U.ri)(e,"/api/lora-sens/device/save-settings/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({deviceId:n,...t})})}(r=d||(d={})).Weight="lwg-1",r.Temperature="lth-1";var A=t(9804),G=t(1572);function LoraNextConnectionTime(e){var n;let{nextConnectionOn:t}=e,r=1e3*((null===(n=(0,G.ZB)().data)||void 0===n?void 0:n.general.time.nowUtc)||0),i=t&&(0,A.LU)(Math.abs(t.getTime()-r));return(0,g.jsx)(v.x,{c:"dimmed",fz:10,mb:-1,children:t.getTime()>=r?"Next in ".concat(i):"Expected ".concat(i," ago")})}function LoraSensName(e){let{name:n,isConnected:t}=e;return(0,g.jsx)(v.x,{fw:500,c:t?"green":"inherit",children:n})}var V=t(3960),H=t(3017),Y=t(4964);function LoraSensorConnectionSection(e){let{nextConnectionOn:n,lastConnectionOn:t,frequency:r,frequencyGateway:i,bandwidth:s,spreadFactor:a,codingRate:o,isConnected:l,isActive:d}=e;return(0,g.jsxs)(p.K,{spacing:2,children:[(0,g.jsxs)(S.Z,{spacing:5,children:[(0,g.jsx)(v.x,{color:"dimmed",children:l?(0,g.jsx)(H.Z,{stroke:1,size:15}):(0,g.jsx)(Y.Z,{stroke:1,size:15})}),t?(0,g.jsxs)(v.x,{c:l?"green":"inherit",fz:12,transform:"uppercase",children:[(0,g.jsx)("b",{children:"Last transfer on"})," ",(0,A.o0)(t.getTime(),!0)]}):(0,g.jsx)(v.x,{c:"dimmed",fz:12,transform:"uppercase",children:(0,g.jsx)("b",{children:"Last connection unknown"})}),d&&(0,g.jsx)(V.z,{smallerThan:"xs",styles:{marginLeft:20,marginTop:-10},children:(0,g.jsx)(v.x,{c:"green",mb:-1,children:(0,g.jsx)(B.Z,{size:16})})})||n&&(0,g.jsx)(V.z,{smallerThan:"xs",styles:{marginLeft:20,marginTop:-10},children:(0,g.jsx)(LoraNextConnectionTime,{nextConnectionOn:n})})||null]}),(0,g.jsx)(v.x,{size:10,ml:20,children:"".concat(r/1e3,"/").concat(i/1e3," MHz, ").concat(s.toFixed(2)," KHz, ").concat(a," SF, ").concat(o," CR")})]})}var J=t(2671),Q=t(3127);function LoraSensorImageSection(e){let{type:n}=e;return(0,g.jsx)(g.Fragment,{children:n===d.Temperature?(0,g.jsx)(J.E,{height:140,src:"/media/temperature-sensor.png",alt:"Temperature sensor"}):n===d.Weight?(0,g.jsx)(J.E,{height:140,src:"/media/weight-sensor.png",alt:"Weight sensor",fit:"scale-down"}):(0,g.jsx)(Q.x,{w:"100%",h:140,style:{backgroundColor:"#e6e6e6"}})})}var X=t(6078),$=t(8393),ee=t(7017),en=t(2922),et=t(8464),er=t(7452),ei=t(7219),es=t(7723),ea=t(29);async function readSetting(e,n,t,r){let i=await (0,U.ri)(e,"/api/lora-sens/read-settings/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({deviceId:n,did:t,params:[r]})});return(await i.json())[r]}async function settingsFetcher(e){let[n,t,r,i,s]=e,a=await (0,U.ri)(s,"/api/lora-sens/read-settings/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({deviceId:t,did:r,params:i})});return a.json()}function useSettings(e,n,t){let r=(0,U.tQ)(["lora-sens-params",e,n,t],settingsFetcher,{refreshInterval:1e4});return{...r}}async function saveSettings(e,n,t){await (0,U.ri)(e,"/api/lora-sens/write-settings/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({did:n,params:t})})}function waitSettingWrite(e,n,t,r){let i;let s=new Promise(async(s,a)=>{let o=0;i=window.setInterval(async()=>{o++;try{let a=await readSetting(e,n,t,r);(null==a?void 0:a.lastUpdatedSec)&&o>a.lastUpdatedSec&&(clearInterval(i),s(a))}catch(e){clearInterval(i),a(e)}},1e3)});return[()=>clearInterval(i),s]}function LoraSensorTemprSettingsForm(e){var n,t,r,i,s,a;let{authToken:o,deviceId:l,did:d,deviceName:c,updatePeriodSec:u,closeModal:h}=e,[m,x]=(0,C.useState)(!1),j=useSettings(l,d,["temperatureOffset","humidityOffset"]).data,v=(0,ei._N)({initialValues:{temperatureOffset:null==j?void 0:null===(n=j.temperatureOffset)||void 0===n?void 0:n.value,humidityOffset:null==j?void 0:null===(t=j.humidityOffset)||void 0===t?void 0:t.value,deviceName:c||"",updatePeriodSec:u||300},validate:{deviceName:e=>(null==e?void 0:e.length)&&!(e.length>200)?void 0:"Name length must be between 1 and 200.",updatePeriodSec:e=>!e||e>36686400?"Update period must be between 1 and 36686400":void 0,temperatureOffset:e=>!e||e<-10||e>10?"Temperature offset must be between -10 and 10":void 0,humidityOffset:e=>!e||e<-10||e>10?"Humidity offset must be between -10 and 10":void 0}});(0,C.useEffect)(()=>{var e,n;(null==j?void 0:null===(e=j.temperatureOffset)||void 0===e?void 0:e.lastCmdError)&&v.setFieldError("temperatureOffset","Parameter error: ".concat(j.temperatureOffset.lastCmdError)),(null==j?void 0:null===(n=j.humidityOffset)||void 0===n?void 0:n.lastCmdError)&&v.setFieldError("humidityOffset","Parameter error: ".concat(j.humidityOffset.lastCmdError))},[v,null==j?void 0:null===(r=j.humidityOffset)||void 0===r?void 0:r.lastCmdError,null==j?void 0:null===(i=j.temperatureOffset)||void 0===i?void 0:i.lastCmdError]);let{classes:f}=(0,es.Z)(),S=(0,ei.uA)(v,f.dirtyInput);return(0,g.jsx)("form",{onSubmit:v.onSubmit(async e=>{await (0,et.$)(x,async()=>{let e=(0,ei._B)(v);await saveSettings(o,d,{humidityOffset:e.humidityOffset,temperatureOffset:e.temperatureOffset}),await saveDeviceSettings(o,l,{name:e.deviceName,updatePeriodSec:e.updatePeriodSec})},(0,g.jsx)(ee.Z,{}),(0,g.jsx)(en.Z,{}),void 0,h)}),children:(0,g.jsxs)(p.K,{children:[(0,g.jsx)(X.o,{label:"Name:",required:!0,...S("title")}),(0,g.jsx)(ea.Z,{children:(0,g.jsx)($.Y,{label:"Update period, sec:",description:"Delay in seconds to reconnect the sensor.",...S("updatePeriodSec"),required:!0})}),(0,g.jsx)(ea.Z,{children:(0,g.jsx)($.Y,{label:"Temperature offset, \xb0C:",...S("temperatureOffset","input",null==j?void 0:null===(s=j.temperatureOffset)||void 0===s?void 0:s.lastUpdatedSec),description:"Temperature offset.",precision:2,step:.01,min:-10,max:10,required:!0})}),(0,g.jsx)(ea.Z,{children:(0,g.jsx)($.Y,{label:"Humidity offset, %:",...S("humidityOffset","input",null==j?void 0:null===(a=j.humidityOffset)||void 0===a?void 0:a.lastUpdatedSec),description:"Humidity offset.",precision:1,step:.1,min:-10,max:10,required:!0})}),(0,g.jsx)(er.Z,{type:"submit",inProgress:m,children:"Save"})]})})}function LoraSensorWeightSettingsForm(e){var n,t,r,i,s,a;let{authToken:o,deviceId:l,did:d,deviceName:c,updatePeriodSec:u,closeModal:h}=e,[m,x]=(0,C.useState)(!1),j=useSettings(l,d,["scanPeriod","tresholdToSend"]).data,v=(0,ei._N)({initialValues:{scanPeriod:null==j?void 0:null===(n=j.scanPeriod)||void 0===n?void 0:n.value,tresholdToSend:null==j?void 0:null===(t=j.tresholdToSend)||void 0===t?void 0:t.value,deviceName:c||"",updatePeriodSec:u||300},validate:{deviceName:e=>(null==e?void 0:e.length)&&!(e.length>200)?void 0:"Name length must be between 1 and 200.",updatePeriodSec:e=>!e||e>36686400?"Update period must be between 1 and 36686400":void 0,scanPeriod:e=>!e||e<5||e>43200?"Scan period must be between 5 and 43200":void 0,tresholdToSend:e=>!e||e<.01||e>100?"Treshold to send must be between 0.01 and 100":void 0}});(0,C.useEffect)(()=>{var e,n,t;(null==j?void 0:null===(e=j.scanPeriod)||void 0===e?void 0:e.lastCmdError)&&v.setFieldError("scanPeriod","Parameter error: ".concat(null==j?void 0:null===(t=j.scanPeriod)||void 0===t?void 0:t.lastCmdError)),(null==j?void 0:null===(n=j.tresholdToSend)||void 0===n?void 0:n.lastCmdError)&&v.setFieldError("tresholdToSend","Parameter error: ".concat(j.tresholdToSend.lastCmdError))},[v,null==j?void 0:null===(r=j.scanPeriod)||void 0===r?void 0:r.lastCmdError,null==j?void 0:null===(i=j.tresholdToSend)||void 0===i?void 0:i.lastCmdError]);let{classes:f}=(0,es.Z)(),S=(0,ei.uA)(v,f.dirtyInput);return(0,g.jsx)("form",{onSubmit:v.onSubmit(async e=>{await (0,et.$)(x,async()=>{let e=(0,ei._B)(v);await saveSettings(o,d,{scanPeriod:e.scanPeriod,tresholdToSend:e.tresholdToSend}),await saveDeviceSettings(o,l,{name:e.deviceName,updatePeriodSec:e.updatePeriodSec})},(0,g.jsx)(ee.Z,{}),(0,g.jsx)(en.Z,{}),void 0,h)}),children:(0,g.jsxs)(p.K,{children:[(0,g.jsx)(X.o,{label:"Name:",required:!0,...S("deviceName"),minLength:1,maxLength:120}),(0,g.jsx)(ea.Z,{children:(0,g.jsx)($.Y,{label:"Connection period, sec:",description:"Sensor motherboard will connect to OPCB at the specified interval and transfer all gathered data.",...S("updatePeriodSec"),min:1,required:!0})}),(0,g.jsx)(ea.Z,{children:(0,g.jsx)($.Y,{label:"Scan period, sec:",...S("scanPeriod","input",null==j?void 0:null===(s=j.scanPeriod)||void 0===s?void 0:s.lastUpdatedSec),description:"Sensor motherboard will read the data from sensors at the specified interval.",required:!0,min:5,mah:43200})}),(0,g.jsx)(ea.Z,{children:(0,g.jsx)($.Y,{label:"Weight change logging threshold, kg:",...S("tresholdToSend","input",null==j?void 0:null===(a=j.tresholdToSend)||void 0===a?void 0:a.lastUpdatedSec),description:"Minimum weight threshold at which changes should be logged in journal by the sensor motherboard.",required:!0,precision:2,step:.01,min:.01,max:100})}),(0,g.jsx)(er.Z,{type:"submit",inProgress:m,children:"Save"})]})})}var eo=t(8255),el=t(4224);async function readingsFetcher(e){let[n,t,r,i]=e,s=await (0,U.ri)(i,"/api/lora-sens/readings/?deviceId=".concat(t,"&params=").concat(r.join(",")));return s.json()}function LoraSensParamValuesTable(e){let{id:n,sku:t}=e,r=function(e,n){let t=(0,U.tQ)(["lora-sens-last-results",e,n],readingsFetcher,{refreshInterval:1e3});return{...t}}(n,t===d.Temperature?["temperatureDegree","humidityPercent"]:["moduleWeight1","moduleWeight2","moduleWeight3","moduleWeight4","moduleWeight5","moduleWeight6","moduleWeight7","moduleWeight8"]);return(0,g.jsx)(g.Fragment,{children:(null==r?void 0:r.data)?(0,g.jsx)(g.Fragment,{children:r.data.length?(0,g.jsx)(el.i,{w:"100%",children:(0,g.jsx)("tbody",{children:r.data.map(e=>(0,g.jsxs)("tr",{children:[(0,g.jsx)("td",{children:(0,g.jsx)(v.x,{size:"xs",children:e.displayNameEn})}),(0,g.jsx)("td",{children:e.error?(0,g.jsx)(v.x,{size:"xs",color:"SENSOR_ERR_DISABLED"===e.error?"gray":"red",children:"SENSOR_ERR_DISABLED"===e.error?"disabled":e.error}):(0,g.jsxs)(v.x,{size:"xs",align:"end",children:[e.value||"-"," ",e.unit]})})]},e.id))})}):(0,g.jsx)(v.x,{size:"xs",align:"center",w:"100%",c:"dimmed",children:"No readings values"})}):(0,g.jsx)(eo.M,{my:"xs",w:"100%",children:(0,g.jsx)(w.a,{size:"sm",variant:"dots"})})})}var ed=t(5655),ec=t(6680);(i=c||(c={})).Idle="idle",i.Zero="zero",i.MaxWeight="max-weight",i.Complete="complete",i.Error="error",(s=u||(u={}))[s.Idle=768]="Idle",s[s.Start=784]="Start",s[s.Zero=800]="Zero",s[s.MaxWeight=816]="MaxWeight";let eu=new Map([[1,"Sensor disabled in settings."],[2,"Sensor not calibrated."],[3,"Sensor read timeout."],[4,"Sensor overflow."],[5,"Sensor not found."],[10,"General error."],[11,"Function argument error."],[12,"Parameter error."],[13,"Not enough memory."],[14,"Packet parsing error."],[15,"Access error."],[16,"Transmission error."],[17,"Receive error (timeout)."],[18,"Packet header error."],[19,"Packet length error."],[20,"Packet checksum error."],[21,"Log read/write error."],[30,"Command sequence error."],[31,"Unknown calibration command."],[32,"Error loading calibr. coefficient."],[33,"Error saving calibr. coefficient."],[34,"Calibration error min > max."],[65535,"General error."],[65534,"Function argument error."],[65533,"Parameter error."],[65532,"Not enough memory."],[65531,"Packet parsing error."],[65530,"Access error."],[65529,"Transmission error."],[65528,"Receive error (timeout)."],[65527,"Packet header error."],[65526,"Packet length error."],[65525,"Packet checksum error."],[65506,"Sensor communication error."],[65505,"Calibration read/write error."],[65504,"Sensor disabled."],[65503,"Sensor error."],[65502,"Command sequence error."],[65501,"Unknown command."]]);function getLoraSensErrorName(e){return e&&eu.get(e)||"Unknown error"}function LoraSensWeightCalibration(e){let{isCalibrationOpened:n,module:t,authToken:r,setIsModulesInProgress:i,defaultMaxWeight:s}=e,[a,o]=(0,C.useState)(c.Idle),[l,d]=(0,C.useState)(s||.001),[h,m]=(0,C.useState)(void 0),x=(0,C.useRef)();(0,C.useEffect)(()=>{n||o(c.Idle)},[n]),(0,C.useEffect)(()=>()=>{var e;null===(e=x.current)||void 0===e||e.call(x)},[]);let handlerSetCalibrationStatus=async e=>{var n,s;if(i(!0),e===u.MaxWeight&&void 0!==l){let e="maxWeightSensor".concat(t.moduleNumber+1);await saveSettings(r,t.did,{[e]:l});let[n,i]=waitSettingWrite(r,t.deviceId,t.did,e);x.current=n,await i}await saveSettings(r,t.did,{commands:e===u.Idle?e:e+t.moduleNumber+1});let[a,d]=waitSettingWrite(r,t.deviceId,t.did,"systemStatus");x.current=a;let h=function(e){if(void 0===e)return"idle";switch(e>>13&7){case 0:return"idle";case 1:return"zero";case 2:return"max-weight";case 3:return"complete"}return"error"}(null===(n=await d)||void 0===n?void 0:n.value);if(o(h),h===c.Complete)(0,ec.c0)({withCloseButton:!0,autoClose:!0,icon:null,color:"green",title:"Calibration completed.",message:"Calibration completed successfully."});else if(h===c.Error){let e=null===(s=await readSetting(r,t.deviceId,t.did,"commands"))||void 0===s?void 0:s.lastCmdError,n=getLoraSensErrorName(e);m(n),(0,ec.c0)({withCloseButton:!0,autoClose:!0,icon:null,color:"red",title:"Calibration error.",message:"Calibration error: ".concat(n,".")})}i(!1)};return(0,g.jsx)(g.Fragment,{children:a===c.Idle&&(0,g.jsx)(CalibrationStart,{handleSetCalibrationProccess:handlerSetCalibrationStatus})||a===c.Zero&&(0,g.jsx)(CalibrationZero,{handleSetCalibrationProccess:handlerSetCalibrationStatus})||a===c.MaxWeight&&(0,g.jsx)(CalibrationMaxWeight,{handleSetCalibrationProccess:handlerSetCalibrationStatus,maxWeightKg:l,setMaxWeightKg:d})||a===c.Complete&&(0,g.jsx)(CalibrationEnd,{handleSetCalibrationProccess:handlerSetCalibrationStatus})||a===c.Error&&(0,g.jsx)(CalibrationError,{setCalibration:o,errorName:h})})}function CalibrationStart(e){let{handleSetCalibrationProccess:n}=e;return(0,g.jsxs)(p.K,{pt:"md",children:[(0,g.jsx)(v.x,{fz:12,children:'Remove everything from the calibration module, including the tare and press "Start".'}),(0,g.jsx)(S.Z,{children:(0,g.jsx)(I.z,{onClick:async()=>await n(u.Start),children:"Start"})})]})}function CalibrationZero(e){let{handleSetCalibrationProccess:n}=e;return(0,g.jsxs)(p.K,{pt:"md",children:[(0,g.jsx)(v.x,{fz:12,children:'Make sure there is no weight on the calibration module and press "Continue".'}),(0,g.jsx)(S.Z,{children:(0,g.jsx)(I.z,{onClick:async()=>await n(u.Zero),children:"Continue"})})]})}function CalibrationMaxWeight(e){let{handleSetCalibrationProccess:n,maxWeightKg:t,setMaxWeightKg:r}=e;return(0,g.jsxs)(p.K,{pt:"md",children:[(0,g.jsx)(v.x,{fz:12,children:'Set a weight on the calibration module equal to the maximum measured weight, then enter the weight in the field below and press "Continue".'}),(0,g.jsx)(ea.Z,{children:(0,g.jsx)($.Y,{label:"Max weight, kg",description:"Write down the exact value of the set weight in kg.",value:t,precision:3,min:.001,max:5e3,step:.001,onChange:e=>r(Number(e)),required:!0})}),(0,g.jsx)(S.Z,{children:(0,g.jsx)(I.z,{onClick:async()=>await n(u.MaxWeight),children:"Continue"})})]})}function CalibrationEnd(e){let{handleSetCalibrationProccess:n}=e;return(0,g.jsxs)(p.K,{pt:"md",children:[(0,g.jsx)(v.x,{fz:12,children:'Calibration complete. Press "End calibration".'}),(0,g.jsx)(S.Z,{children:(0,g.jsx)(I.z,{onClick:()=>n(u.Idle),children:"End calibration"})})]})}function CalibrationError(e){let{setCalibration:n,errorName:t}=e;return(0,g.jsxs)(p.K,{pt:"md",children:[(0,g.jsxs)(v.x,{fz:12,c:"red",children:["Calibration error: ",t]}),(0,g.jsx)(S.Z,{children:(0,g.jsx)(I.z,{onClick:async()=>n(c.Idle),children:"End calibration"})})]})}function LoraSensWeightResetTare(e){let{isOpened:n,module:t,authToken:r,setIsModulesInProgress:i}=e,[s,a]=(0,C.useState)(h.Idle),[o,l]=(0,C.useState)(void 0),d=(0,C.useRef)();(0,C.useEffect)(()=>{n||a(h.Idle)},[n]),(0,C.useEffect)(()=>()=>{var e;null===(e=d.current)||void 0===e||e.call(d)},[]);let handlerSetResetTareStatus=async e=>{var n,s;i(!0),await saveSettings(r,t.did,{commands:e===m.Idle?e:e+t.moduleNumber+1});let[o,c]=waitSettingWrite(r,t.deviceId,t.did,"systemStatus");d.current=o;let u=function(e){if(void 0===e)return"idle";switch(e>>10&7){case 0:return"idle";case 1:return"start";case 3:return"complete"}return"error"}(null===(n=await c)||void 0===n?void 0:n.value);if(a(u),u===h.Complete)(0,ec.c0)({withCloseButton:!0,autoClose:!0,icon:null,color:"green",title:"Tare reset is completed.",message:"Tare reset is completed successfully."});else if(u===h.Error){let e=null===(s=await readSetting(r,t.deviceId,t.did,"commands"))||void 0===s?void 0:s.lastCmdError,n=getLoraSensErrorName(e);l(n),(0,ec.c0)({withCloseButton:!0,autoClose:!0,icon:null,color:"red",title:"Reset tare error.",message:"Reset tare error: ".concat(n,".")})}i(!1)};return(0,g.jsx)(g.Fragment,{children:s===h.Idle&&(0,g.jsx)(ResetTareStart,{handlerSetResetTareStatus:handlerSetResetTareStatus})||s===h.Start&&(0,g.jsx)(ResetTareConfirm,{handlerSetResetTareStatus:handlerSetResetTareStatus})||s===h.Complete&&(0,g.jsx)(ResetTareEnd,{handlerSetResetTareStatus:handlerSetResetTareStatus})||s===h.Error&&(0,g.jsx)(ResetTareError,{setResetTare:a,lastError:o})})}function ResetTareStart(e){let{handlerSetResetTareStatus:n}=e;return(0,g.jsxs)(p.K,{pt:"md",children:[(0,g.jsx)(v.x,{fz:12,children:'Remove all weight from module, leaving the tare and press "Start".'}),(0,g.jsx)(S.Z,{children:(0,g.jsx)(I.z,{onClick:async()=>await n(m.Start),children:"Start"})})]})}function ResetTareConfirm(e){let{handlerSetResetTareStatus:n}=e;return(0,g.jsxs)(p.K,{pt:"md",children:[(0,g.jsx)(v.x,{fz:12,children:'The tare reseting has started, press "Continue".'}),(0,g.jsx)(S.Z,{children:(0,g.jsx)(I.z,{onClick:async()=>await n(m.Confirm),children:"Continue"})})]})}function ResetTareEnd(e){let{handlerSetResetTareStatus:n}=e;return(0,g.jsxs)(p.K,{pt:"md",children:[(0,g.jsx)(v.x,{fz:12,children:'The tare reseting is complete, press "End reset tare".'}),(0,g.jsx)(S.Z,{children:(0,g.jsx)(I.z,{onClick:async()=>await n(m.Idle),children:"End reset tare"})})]})}function ResetTareError(e){let{setResetTare:n,lastError:t}=e;return(0,g.jsxs)(p.K,{pt:"md",children:[(0,g.jsxs)(v.x,{fz:12,c:"red",children:["Reset tare error: ",t]}),(0,g.jsx)(S.Z,{children:(0,g.jsx)(I.z,{onClick:async()=>n(h.Idle),children:"End reset tare"})})]})}async function weightModulesDataFetcher(e){let[n,t,r]=e,i=await (0,U.ri)(r,"/api/lora-sens/weight/modules/?deviceId=".concat(t));return i.json()}async function setWeightModuleState(e,n,t,r){await (0,U.ri)(e,"/api/lora-sens/weight/module/set-state/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({did:n,moduleNumber:t,isEnabled:r})})}function LoraSensWeightModulesList(e){let{deviceId:n,did:t,authToken:r}=e,i=function(e){let n=(0,U.tQ)(["lora-sens-weight-modules",e],weightModulesDataFetcher,{refreshInterval:1e3});return{...n}}(n),[s,a]=(0,C.useState)(void 0),[o,l]=(0,C.useState)(void 0),[d,c]=(0,C.useState)(!1),handleSetCalibrationOpenNumber=e=>{a(e===s?void 0:e),l(void 0)},handleSetResetTareOpenedNumber=e=>{l(e===o?void 0:e),a(void 0)};return(0,g.jsxs)(p.K,{spacing:"sm",style:{position:"relative"},children:[(0,g.jsx)(ed.f,{visible:d,overlayBlur:2,loader:(0,g.jsxs)(p.K,{align:"center",spacing:"xs",children:[(0,g.jsx)(v.x,{c:"dimmed",fz:12,transform:"uppercase",children:"Waiting"}),(0,g.jsx)(w.a,{size:"sm"})]})}),(0,g.jsx)(v.x,{fz:16,children:"Sensor modules"}),i.data?(0,g.jsx)(p.K,{spacing:0,children:i.data.map((e,n)=>(0,g.jsx)(LoraSensWeightModule,{module:e,authToken:r,isCalibrationOpened:n===s,isOpened:n===o,handleSetCalibrationOpenNumber:handleSetCalibrationOpenNumber,handleSetResetTareOpenedNumber:handleSetResetTareOpenedNumber,setIsModulesInProgress:c},n))}):(0,g.jsx)(eo.M,{my:"xs",children:(0,g.jsx)(w.a,{size:"sm",variant:"dots"})})]})}function LoraSensWeightModule(e){let{module:n,authToken:t,isCalibrationOpened:r,isOpened:i,handleSetCalibrationOpenNumber:s,handleSetResetTareOpenedNumber:a,setIsModulesInProgress:o}=e,[l,d]=(0,C.useState)(n.state);(0,C.useEffect)(()=>{d(n.state)},[n.state]);let handleSwitchChange=async e=>{d(x.Processing),await setWeightModuleState(t,n.did,n.moduleNumber,e.currentTarget.checked)};return(0,g.jsxs)(Q.x,{py:"xs",sx:e=>({borderBottom:"1px solid ".concat(e.colors.gray[2])}),children:[(0,g.jsxs)(S.Z,{position:"apart",spacing:"xs",children:[(0,g.jsxs)(S.Z,{children:[(0,g.jsx)(v.x,{color:"dimmed",size:"xs",children:n.moduleNumber+1}),l===x.Processing?(0,g.jsx)(w.a,{size:"sm",variant:"dots",style:{marginLeft:9}}):(0,g.jsx)(b.r,{onLabel:"ON",offLabel:"OFF",checked:l===x.On,onChange:e=>handleSwitchChange(e)})]}),(0,g.jsx)(S.Z,{style:{flexGrow:1,justifyContent:"flex-end"},children:n.moduleError?(0,g.jsx)(v.x,{size:"xs",color:"SENSOR_ERR_DISABLED"===n.moduleError?"gray":"red",children:"SENSOR_ERR_DISABLED"===n.moduleError?"disabled":n.moduleError}):(0,g.jsx)(v.x,{size:"xs",children:void 0!==n.weight?"".concat(n.weight," kg"):"-"})}),(0,g.jsxs)(S.Z,{spacing:"xs",children:[(0,g.jsx)(I.z,{variant:"subtle",compact:!0,size:"xs",onClick:()=>{s(n.moduleNumber)},disabled:l!==x.On,style:{backgroundColor:"transparent"},children:"Calibration"}),(0,g.jsx)(I.z,{variant:"subtle",compact:!0,size:"xs",onClick:()=>{a(n.moduleNumber)},disabled:l!==x.On,style:{backgroundColor:"transparent"},children:"Tare reset"})]})]}),(0,g.jsx)(R.U,{in:r,transitionDuration:200,children:(0,g.jsx)(LoraSensWeightCalibration,{isCalibrationOpened:r,module:n,authToken:t,setIsModulesInProgress:o,defaultMaxWeight:n.weight})}),(0,g.jsx)(R.U,{in:i,transitionDuration:200,children:(0,g.jsx)(LoraSensWeightResetTare,{isOpened:i,module:n,authToken:t,setIsModulesInProgress:o})})]})}(a=h||(h={})).Idle="idle",a.Start="start",a.Complete="complete",a.Error="error",(o=m||(m={}))[o.Idle=256]="Idle",o[o.Start=272]="Start",o[o.Confirm=288]="Confirm",(l=x||(x={})).On="on",l.Off="off",l.Processing="processing";var eh=t(477),em=t(3610),ex=t(829);let eg=(0,z.k)(e=>({imageSection:{borderBottom:"".concat((0,k.h)(1)," solid ").concat(e.colors.gray[3]),backgroundColor:"white"},mainSection:{padding:e.spacing.sm,borderBottom:"".concat((0,k.h)(1)," solid ").concat(e.colors.gray[3]),marginBottom:e.spacing.xs},logSection:{padding:e.spacing.sm,borderTop:"".concat((0,k.h)(1)," solid ").concat(e.colors.gray[3])}}));function LoraBindedSensor(e){let{sensor:n,token:t}=e,r=(0,Z.rZ)(),{classes:i}=eg(),[s,a]=(0,C.useState)(!1),[o,l]=(0,C.useState)(!1);return(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)(P.u,{opened:s,onClose:()=>a(!1),title:(0,g.jsxs)(p.K,{spacing:5,children:[(0,g.jsxs)(S.Z,{spacing:5,align:"center",children:[(0,g.jsx)(v.x,{size:22,color:n.isActive?"green":"grey",children:(0,g.jsx)(B.Z,{})}),(0,g.jsxs)(v.x,{children:[n.name," settings"]})]}),n.nextConnectionOn&&!n.isActive&&(0,g.jsx)(LoraNextConnectionTime,{nextConnectionOn:n.nextConnectionOn})||(0,g.jsx)(O.T,{h:"sm"})]}),children:n.sku===d.Temperature?(0,g.jsx)(LoraSensorTemprSettingsForm,{deviceId:n.id,did:n.did,authToken:t,deviceName:n.name,updatePeriodSec:n.updatePeriodSec,closeModal:()=>a(!1)}):(0,g.jsxs)(p.K,{children:[(0,g.jsx)(LoraSensorWeightSettingsForm,{deviceId:n.id,did:n.did,authToken:t,deviceName:n.name,updatePeriodSec:n.updatePeriodSec,closeModal:()=>a(!1)}),(0,g.jsx)(LoraSensWeightModulesList,{deviceId:n.id,did:n.did,authToken:t})]})}),(0,g.jsxs)(L.Z,{shadow:"sm",padding:"xs",withBorder:!0,radius:"md",sx:{backgroundColor:n.isConnected?"white":r.colors.gray[0]},children:[(0,g.jsx)(L.Z.Section,{className:i.imageSection,children:(0,g.jsx)(LoraSensorImageSection,{type:n.sku})}),(0,g.jsx)(L.Z.Section,{className:i.mainSection,children:(0,g.jsxs)(S.Z,{position:"apart",children:[(0,g.jsxs)("div",{children:[(0,g.jsx)(LoraSensName,{name:n.name,isConnected:n.isConnected}),(0,g.jsx)(v.x,{fz:"xs",c:"dimmed",children:getSkuDisplayName(n.sku)}),(0,g.jsxs)(v.x,{fz:"xs",c:"dimmed",children:["DID: ",(0,g.jsx)("span",{style:{fontFamily:"monospace"},children:n.did})]})]}),(0,g.jsxs)(S.Z,{spacing:"xs",noWrap:!0,align:"flex-end",children:[(0,g.jsx)(ex.Z,{title:'Unbind device "'.concat(n.name,'"'),description:(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)("p",{children:"All information gathered from this device will be lost."}),(0,g.jsxs)("p",{children:["This device will not appear in the new devices list.",(0,g.jsx)("br",{}),"To rebind it, press and hold the button on the device for 5s."]})]}),buttonText:"Delete",children:(0,g.jsx)(N.A,{color:"red",onClick:async()=>{await deleteLoraSensDevice(t,n.id)},children:(0,g.jsx)(F.Z,{size:18})})}),(0,g.jsx)(N.A,{color:"blue",onClick:()=>a(!0),children:(0,g.jsx)(K.Z,{size:18})})]})]})}),(0,g.jsxs)(p.K,{spacing:"xs",mb:"xs",children:[(0,g.jsx)(LoraSensorConnectionSection,{nextConnectionOn:n.nextConnectionOn,lastConnectionOn:n.lastConnectionOn,frequency:n.connectionParameters.frequencyDeviceKhz,frequencyGateway:n.connectionParameters.frequencyGatewayKhz,bandwidth:n.connectionParameters.bandwidthKhz,spreadFactor:n.connectionParameters.spreadFactor,codingRate:n.connectionParameters.codingRateBits,isConnected:n.isConnected,isActive:n.isActive}),(0,g.jsxs)(S.Z,{spacing:"xs",align:"start",children:[n.batteryLevelPrecent?(0,g.jsx)(em.Z,{icon:(0,g.jsx)(W.Z,{stroke:1,height:15,color:r.colors.gray[6],style:{marginLeft:-5}}),name:"Battery",mainVal:"".concat(n.batteryLevelPrecent," %")}):null,n.logFillLevelPrecent?(0,g.jsx)(em.Z,{name:"Log",icon:(0,g.jsx)(M.Z,{stroke:1,height:14,color:r.colors.gray[6]}),mainVal:"".concat(n.logFillLevelPrecent," %")}):null,(0,g.jsx)(eh.Z,{bytes:n.rxBytes,speed:n.rxSpeedBps,dbm:n.signalLevelRxDbm,oneline:!1,lastBytesSinceSec:Math.round(Date.now()-(n.rxLastOn||0))}),(0,g.jsx)(eh.Z,{bytes:n.txBytes,speed:n.txSpeedBps,dbm:n.signalLevelTxDbm,oneline:!1,lastBytesSinceSec:Math.round(Date.now()-(n.txLastOn||0)),tx:!0})]})]}),n.commands.length>0&&(0,g.jsx)(L.Z.Section,{className:i.logSection,children:(0,g.jsx)(E.x.Autosize,{mah:120,maw:"100%",type:"never",children:(0,g.jsx)(p.K,{spacing:"xs",children:n.commands.map(e=>(0,g.jsx)(D.C,{radius:"sm",color:e.errorCode&&"red"||"blue",children:e.command},e.id))})})}),(0,g.jsx)(L.Z.Section,{children:(0,g.jsxs)(p.K,{bg:"gray.0",sx:e=>({borderTop:"1px solid ".concat(e.colors.gray[3])}),p:2,spacing:0,children:[(0,g.jsx)(S.Z,{children:o?(0,g.jsx)(I.z,{variant:"subtle",compact:!0,leftIcon:(0,g.jsx)(q.Z,{size:14}),size:"xs",onClick:()=>l(!1),children:"Hide values"}):(0,g.jsx)(I.z,{variant:"subtle",compact:!0,leftIcon:(0,g.jsx)(_.Z,{size:14}),size:"xs",onClick:()=>l(!0),children:"Show values"})}),(0,g.jsx)(R.U,{in:o,transitionDuration:100,children:(0,g.jsx)(S.Z,{mih:50,w:"100%",children:o?(0,g.jsx)(LoraSensParamValuesTable,{id:n.id,sku:n.sku}):null})})]})})]})]})}var ep=t(6319),ej=t(3600),ev=t(2242),ef=t(1457);let eS=(0,z.k)(e=>({imageSection:{borderBottom:"".concat((0,k.h)(1)," solid ").concat(e.colors.gray[3])},mainSection:{padding:e.spacing.sm,borderBottom:"".concat((0,k.h)(1)," solid ").concat(e.colors.gray[3]),marginBottom:e.spacing.xs}}));function LoraNewSensorCard(e){let{sensor:n,token:t,frequencyDeviceKhz:r,frequencyGatewayKhz:i,bandwidthKhz:s,spreadFactor:a,codingRateBits:o}=e,l=(0,Z.rZ)(),{classes:d}=eS(),[c,u]=(0,C.useState)(!!n.acceptedOn);return(0,g.jsxs)(L.Z,{shadow:"sm",padding:"xs",withBorder:!0,radius:"md",pos:"relative",children:[(0,g.jsx)(ed.f,{visible:c,overlayBlur:2,zIndex:100,loader:(0,g.jsxs)(p.K,{align:"center",spacing:"xs",children:[(0,g.jsx)(v.x,{c:"dimmed",fz:12,transform:"uppercase",children:"Binding"}),(0,g.jsx)(w.a,{size:"sm"})]})}),(0,g.jsx)(L.Z.Section,{className:d.imageSection,children:(0,g.jsx)(LoraSensorImageSection,{type:n.sku})}),(0,g.jsx)(L.Z.Section,{className:d.mainSection,children:(0,g.jsxs)(S.Z,{position:"apart",children:[(0,g.jsxs)("div",{children:[(0,g.jsx)(LoraSensName,{name:n.did.toString(),isConnected:!0}),(0,g.jsx)(v.x,{fz:"xs",c:"dimmed",children:getSkuDisplayName(n.sku)})]}),(0,g.jsxs)(S.Z,{spacing:"xs",noWrap:!0,align:"flex-end",children:[(0,g.jsx)(ex.Z,{title:'Blacklist sensor "'.concat(n.did,'"?'),description:(0,g.jsxs)("p",{children:["This action will put this device ID in the blacklist.",(0,g.jsx)("br",{}),"To make it visible again, reset the device by pressing the button on the case."]}),buttonText:"Ignore",children:(0,g.jsx)(I.z,{variant:"subtle",color:"red",radius:"sm",size:"xs",leftIcon:(0,g.jsx)(ep.Z,{size:18}),onClick:async()=>{await ignoreLoraSensDevice(t,n.did)},children:"Ignore"})}),n.sku&&(0,g.jsx)(ex.Z,{title:'Bind sensor "'.concat(n.did,'"'),description:'Are you sure you want to bind the sensor "'.concat(n.did,'"?'),buttonText:"Bind",isLevelGood:!0,children:(0,g.jsx)(I.z,{variant:"subtle",radius:"sm",size:"xs",leftIcon:(0,g.jsx)(ej.Z,{size:18}),onClick:async()=>{u(!0),await bindLoraSensDevice(t,n.did,n.deviceKindCode,n.firmwareVersion,r,i,s,a,o)},children:"Bind"})})]})]})}),(0,g.jsxs)(p.K,{spacing:"xs",mb:"xs",children:[(0,g.jsx)(LoraSensorConnectionSection,{lastConnectionOn:n.lastConnectionOn,frequency:n.connectionParameters.frequencyDeviceKhz,frequencyGateway:n.connectionParameters.frequencyGatewayKhz,bandwidth:n.connectionParameters.bandwidthKhz,spreadFactor:n.connectionParameters.spreadFactor,codingRate:n.connectionParameters.codingRateBits,isConnected:!0}),(0,g.jsx)(em.Z,{name:"RX",mainVal:"".concat(n.signalLevelRxdBm," dBm"),icon:(0,g.jsx)(ev.Z,{stroke:1,height:15,color:l.colors.gray[6],style:{marginLeft:-5}}),oneline:!0})]}),n.alreadyBindedDeviceTitle&&(0,g.jsx)(L.Z.Section,{children:(0,g.jsxs)(S.Z,{c:"orange",spacing:2,align:"center",p:"xs",sx:e=>({borderTop:"1px solid ".concat(e.colors.gray[3])}),children:[(0,g.jsx)(ef.Z,{size:11,style:{marginTop:-2}}),(0,g.jsxs)(v.x,{fz:"xs",children:['This sensor is already binded and has the title: "',n.alreadyBindedDeviceTitle,'"']})]})})]})}var eb=t(2094),ey=t(3738);async function lora_sens_settingsFetcher(e){let[n,t]=e,r=await (0,ey.wv)(t,["loraSens:enabled"]);return{enabled:"true"===r["loraSens:enabled"]}}async function lora_sens_saveSettings(e){return(0,ey.NC)({"loraSens:enabled":e.enabled?"true":"false"})}async function loraSensFetcher(e){let[n,t]=e,r=await (0,ey.UK)(t,["loraSens:enabled","loraSens:available","loraSens:frequencyDeviceKhz","loraSens:frequencyGatewayKhz","loraSens:bandwidthKhz","loraSens:spreadingFactor","loraSens:codingRateBits","loraSens:txPowerLimitDbm","loraSens:loraPollingTimeMs"]);return{available:"true"===r["loraSens:available"],enabled:"true"===r["loraSens:enabled"],frequencyDeviceKhz:Number(r["loraSens:frequencyDeviceKhz"]||"0"),frequencyGatewayKhz:Number(r["loraSens:frequencyGatewayKhz"]||"0"),bandwidthKhz:Number(r["loraSens:bandwidthKhz"]||"0"),spreadingFactor:Number(r["loraSens:spreadingFactor"]||"0"),codingRateBits:Number(r["loraSens:codingRateBits"]||"0"),txPowerLimitDbm:Number(r["loraSens:txPowerLimitDbm"]||"0"),loraPollingTimeMs:Number(r["loraSens:loraPollingTimeMs"]||"0")}}function Page(){let e=function(){let e=(0,U.tQ)("lora-settings",lora_sens_settingsFetcher);return{...e}}(),n=(0,U.tQ)("lorasens-status",loraSensFetcher,{refreshInterval:1e3}),{token:t}=(0,U.pk)();return e.data&&n.data&&t?(0,g.jsx)(T.Z,{pageId:"lora-sens",title:"LoRa Sens",children:(0,g.jsxs)(p.K,{spacing:"md",fz:"sm",children:[(0,g.jsx)(j.D,{order:3,children:"LoraSens Devices Connections"}),(0,g.jsxs)(v.x,{c:"gray.7",children:[(0,g.jsx)(v.x,{children:"LoraSens is a protocol used for connection to wireless sensors via LoRa interface. Your OPCB device should have an additional LoRa gateway board to support this type of sensors. If your device is equipped with this board, you can enable and set up the feature on this page."}),(0,g.jsx)(v.x,{children:"Currently supported sensors:"}),(0,g.jsxs)("ul",{children:[(0,g.jsxs)("li",{children:[(0,g.jsx)("b",{children:"LTH-1"})," - Temperature and humidity standalone sensor"]}),(0,g.jsxs)("li",{children:[(0,g.jsx)("b",{children:"LWG-1"})," - Weight sensor array"]})]}),(0,g.jsxs)(v.x,{children:["Acquire LoraSens equipment at"," ",(0,g.jsx)(f.e,{href:"http://www.novatek-electro.com/",children:"http://www.novatek-electro.com/"})]})]}),n.data.available?(0,g.jsxs)(p.K,{spacing:"25px",children:[(0,g.jsx)(LoraSensGateway,{settings:e.data,status:n.data,mutate:e.mutate}),n.data.enabled&&(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)(NewSensors,{token:t,frequencyDeviceKhz:n.data.frequencyDeviceKhz,frequencyGatewayKhz:n.data.frequencyGatewayKhz,bandwidthKhz:n.data.bandwidthKhz,spreadFactor:n.data.spreadingFactor,codingRateBits:n.data.codingRateBits}),(0,g.jsx)(BindedSensors,{token:t})]})]}):(0,g.jsxs)(v.x,{c:"black",children:["Your device does not support LoraSens. Please contact"," ",(0,g.jsx)(f.e,{href:"mailto:support@overvis.com",children:"support@overvis.com"})," if you wish to acquire the OPCB with LoraSens board."]})]})}):(0,g.jsx)(eb.Z,{pageTitle:"Lora Sensors",contentIsLoading:!0})}function LoraSensGateway(e){let{settings:n,status:t,mutate:r}=e,[i,s]=(0,C.useState)(n.enabled);return(0,g.jsxs)(p.K,{spacing:"md",children:[(0,g.jsxs)(S.Z,{align:"end",children:[(0,g.jsx)(b.r,{checked:i,onLabel:"ON",offLabel:"OFF",onChange:async()=>{s(!i),await lora_sens_saveSettings({enabled:!i}),r({...n,enabled:!i})}}),(0,g.jsxs)(v.x,{style:{marginTop:-2},c:t.enabled?"green":"inherit",children:["LoraSens is ",t.enabled?"enabled":"disabled"]})]}),t.enabled?(0,g.jsxs)(S.Z,{c:"gray",fz:10,spacing:7,children:[(0,g.jsxs)(v.x,{children:["Device Frequesncy: ",t.frequencyDeviceKhz," kHz,"]}),(0,g.jsxs)(v.x,{children:["Gateway Frequesncy: ",t.frequencyGatewayKhz," kHz,"]}),(0,g.jsxs)(v.x,{children:["Bandwidth: ",t.bandwidthKhz," kHz,"]}),(0,g.jsxs)(v.x,{children:["Spreading factor: ",t.spreadingFactor,","]}),(0,g.jsxs)(v.x,{children:["Coding rate: ",t.codingRateBits," bits,"]}),(0,g.jsxs)(v.x,{children:["Polling time: ",t.loraPollingTimeMs," ms,"]}),(0,g.jsxs)(v.x,{children:["Power limit: ",t.txPowerLimitDbm," dBm"]})]}):null]})}function BindedSensors(e){let{token:n}=e,t=(0,U.tQ)("lora-sens-devices",loraSensDevicesFetcher,{refreshInterval:1e3});return(0,g.jsx)(g.Fragment,{children:t.data&&t.data.length?(0,g.jsxs)(p.K,{children:[(0,g.jsx)(j.D,{order:3,children:"Connected sensors"}),(0,g.jsx)(y.r,{align:"start",children:t.data.map(e=>(0,g.jsx)(y.r.Col,{sm:12,md:6,children:(0,g.jsx)(LoraBindedSensor,{sensor:e,token:n})},e.id))})]}):null})}function NewSensors(e){let{token:n,frequencyDeviceKhz:t,frequencyGatewayKhz:r,bandwidthKhz:i,spreadFactor:s,codingRateBits:a}=e,o=(0,U.tQ)("lora-sens-unbinded-devices",loraSensUnbindedDevicesFetcher,{refreshInterval:1e3});return(0,g.jsx)(g.Fragment,{children:o.data?(0,g.jsxs)(p.K,{spacing:"sm",children:[(0,g.jsxs)(S.Z,{spacing:"xs",children:[(0,g.jsx)(j.D,{order:3,children:"Scanning for new sensors"}),(0,g.jsx)(w.a,{size:"sm",style:{paddingTop:5}})]}),o.data.length>0&&(0,g.jsx)(y.r,{align:"start",children:o.data.map(e=>(0,g.jsx)(y.r.Col,{sm:12,md:6,children:(0,g.jsx)(LoraNewSensorCard,{sensor:e,token:n,frequencyDeviceKhz:t,frequencyGatewayKhz:r,bandwidthKhz:i,spreadFactor:s,codingRateBits:a})},e.did))})]}):null})}}},function(e){e.O(0,[217,666,161,497,26,94,774,888,179],function(){return e(e.s=8699)}),_N_E=e.O()}]);