(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[354],{4211:function(e,t,n){"use strict";n.d(t,{Z:function(){return s}});var s=(0,n(7557).Z)("info-circle","IconInfoCircle",[["path",{d:"M3 12a9 9 0 1 0 18 0a9 9 0 0 0 -18 0",key:"svg-0"}],["path",{d:"M12 9h.01",key:"svg-1"}],["path",{d:"M11 12h1v4h1",key:"svg-2"}]])},8350:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/connections/modbus-tcp-client",function(){return n(7003)}])},5018:function(e,t,n){"use strict";n.d(t,{Z:function(){return d}});var s=n(6521),i=n(1876),o=n(8202),c=n(2952),a=n(8026),r=n(4211),l=n(5721);function d(e){let{children:t}=e,[n,d]=(0,l.useState)(!1);return(0,s.jsx)(t.type,{...Object.fromEntries(Object.entries(t.props)),labelProps:{display:"block"},label:(0,s.jsxs)(i.Z,{mb:"4px",spacing:5,children:[t.props.label,(0,s.jsx)(o.x,{children:(t.props.withAsterisk||t.props.required)&&(0,s.jsx)(o.x,{span:!0,color:"red","aria-hidden":!0,children:" *"})}),(0,s.jsx)(o.x,{ml:"auto",color:"gray.6",sx:{cursor:"pointer"},onClick:e=>{d(!n),e.preventDefault()},children:(0,s.jsx)(c.M,{children:(0,s.jsx)(r.Z,{size:14,stroke:1.5})})})]}),description:(0,s.jsx)(a.U,{in:n,transitionDuration:100,children:(0,s.jsx)(o.x,{size:"xs",color:"gray.6",lh:"14px",children:t.props.description})}),withAsterisk:!1})}},7003:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return Y}});var s=n(6521),i=n(5388),o=n(7961),c=n(8202),a=n(1876),r=n(5885),l=n(9011),d=n(8026),u=n(9886),p=n(5721),x=n(1120),m=n(594),h=n(8508),j=n(4094),b=n(8997),f=n(4584),g=n(3126),y=n(6686),v=n(3790),S=n(1685),Z=n(7176),C=n(9578),M=n(5018);function P(e){let{initialValues:t,onSubmit:n,saving:o}=e,{classes:c}=(0,C.Z)(),a=(0,g.c)({initialValues:t,validate:{}}),l=(0,Z.u)(a,"update"===a.values.formMode?c.dirtyInput:void 0),[u,x]=(0,p.useState)(!1);return(0,s.jsx)("form",{onSubmit:a.onSubmit(async e=>{let t=await n(e);t&&a.resetDirty()}),children:(0,s.jsxs)(i.K,{children:["create"===a.values.formMode?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(h.o,{label:"IP address:",...l("ip"),required:!0}),(0,s.jsx)(j.Y,{label:"Port:",...l("port"),required:!0})]}):(0,s.jsx)(b.r,{label:"Enabled",...l("isEnabled","checkbox")}),(0,s.jsx)(h.o,{label:"Device ID range:",...l("uidRange")}),u?(0,s.jsx)(r.z,{variant:"subtle",compact:!0,leftIcon:(0,s.jsx)(y.Z,{size:14}),size:"xs",onClick:()=>x(!1),children:"Hide advanced settings"}):(0,s.jsx)(r.z,{variant:"subtle",compact:!0,leftIcon:(0,s.jsx)(v.Z,{size:14}),size:"xs",onClick:()=>x(!0),children:"Show advanced settings"}),(0,s.jsx)(d.U,{in:u,transitionDuration:100,children:(0,s.jsxs)(i.K,{children:[(0,s.jsx)(f.Ph,{label:"Use interface:",withinPortal:!0,data:[{value:"any",label:"Any interface"},{value:"elan",label:"ELAN"},{value:"wlan",label:"WLAN"}],...l("interface")}),(0,s.jsx)(M.Z,{children:(0,s.jsx)(j.Y,{label:"Reconnection period (sec):",description:"Reconnection period in seconds in case of connection failure.",min:1,max:600,required:!0,...l("reconnectionPeriodSec")})}),(0,s.jsx)(M.Z,{children:(0,s.jsx)(j.Y,{label:"Response await timeout (ms):",description:"Time in milliseconds to wait for a response from the Modbus TCP server.",min:1,max:6e4,required:!0,...l("responseTimeoutMs")})}),(0,s.jsx)(M.Z,{children:(0,s.jsx)(j.Y,{label:"Simultaneous requests:",description:"Number of simultaneously sent requests to the server client. Set to 1 to send all requests sequentially.",min:1,max:20,required:!0,...l("parallelRequestsNum")})})]})}),(0,s.jsx)(S.Z,{type:"submit",inProgress:o,children:"Save"})]})})}var w=n(9296),T=n(4579),k=n(4911);async function z(e){let t=(0,T.bH)();await (0,T.ri)(t,"/api/mbtcp-client/".concat(e.ip,"-").concat(e.port,"/update/"),{method:"POST",body:JSON.stringify(e),timeoutMs:3e4})}async function O(e){let t=(0,T.bH)();await (0,T.ri)(t,"/api/mbtcp-clients/create/",{method:"POST",body:JSON.stringify(e),timeoutMs:3e4})}async function N(e,t){let n=(0,T.bH)();return await (0,T.ri)(n,"/api/mbtcp-client/".concat(e,"-").concat(t.toString(),"/remove/"),{method:"POST",body:JSON.stringify({}),timeoutMs:3e4}),(0,k.ph)(["/api/mbtcp-clients/",n])}let E={ip:"127.0.0.1",port:502,interface:"any",isEnabled:!0,uidRange:"1-255",responseTimeoutMs:1e3,parallelRequestsNum:1,reconnectionPeriodSec:5};var q=n(7743),I=n(5789),_=n(9710),A=n(2628),D=n(2737),B=n(8581),R=n(3611),V=n(2404),L=n(9016),U=n(4166),H=n(218),K=n(9318);function Y(){let e=(0,T.tQ)("/api/mbtcp-clients/",k.ph),t=(0,q.$z)(),[n,l]=(0,p.useState)(!1),d=e.data,u=t.data;return d&&u?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(m.Z,{title:"Add Modbus TCP client connection",onSettingsUpdate:()=>{e.mutate()},form:P,useSettings:()=>({data:{formMode:"create",...E},error:void 0,isValidating:!1,isLoading:!1,mutate:async()=>void 0}),save:O,opened:n,setOpened:l}),(0,s.jsx)(x.Z,{pageId:"modbus-tcp-client",title:"Modbus TCP Client",children:(0,s.jsxs)(i.K,{children:[d.length>0?d.map(t=>(0,s.jsx)(J,{settings:t,status:u["".concat(t.ip,":").concat(t.port)],onSettingsUpdate:()=>{e.mutate()},mutate:e.mutate},"".concat(t.ip,":").concat(t.port))):(0,s.jsx)(o.X,{p:"lg",bg:"gray.1",withBorder:!0,children:(0,s.jsx)(c.x,{ta:"center",fz:"sm",children:"No Modbus TCP client connections created."})}),(0,s.jsx)(a.Z,{children:(0,s.jsx)(r.z,{onClick:()=>{l(!0)},leftIcon:(0,s.jsx)(I.Z,{}),children:"Add Modbus TCP client connection"})})]})})]}):(0,s.jsx)(w.Z,{pageTitle:"Modbus TCP Client",contentIsLoading:!0})}function J(e){let{settings:t,status:n,mutate:o,onSettingsUpdate:c}=e,[x,m]=(0,p.useState)(!1);return(0,s.jsx)(B.Z,{name:"".concat(t.ip,":").concat(t.port),icon:(null==n?void 0:n.info.status)==="connected"?(0,s.jsx)(_.Z,{}):(0,s.jsx)(A.Z,{}),status:(null==n?void 0:n.info.status)==="connected"?"connected":(null==n?void 0:n.info.status)==="disconnected"?"disconnected":"disabled",settings:{title:"Modbus TCP client settings: ".concat(t.ip,":").concat(t.port),form:P,useSettings:()=>({data:{...t,formMode:"update"},error:void 0,isValidating:!1,isLoading:!1,mutate:async()=>void 0}),save:z,onSettingsUpdate:c},addElRight:(0,s.jsx)(R.Z,{title:"Delete conection",description:'Are you sure you want to delete the connection "'.concat(t.ip,":").concat(t.port,'"?'),buttonText:"Delete",children:(0,s.jsx)(l.A,{color:"red",onClick:()=>{(0,Z.M)(()=>o(N(t.ip,t.port),{optimisticData:e=>e.filter(e=>e.ip!==t.ip&&e.port!==t.port)}))},children:(0,s.jsx)(D.Z,{size:18})})}),children:n?(0,s.jsxs)(i.K,{spacing:0,children:["connected"===n.info.status?(0,s.jsxs)(a.Z,{align:"start",p:"sm",children:[(0,s.jsx)(L.Z,{name:"Connected as",nameColor:"green",mainVal:"Modbus TCP Master",subVal:(0,H.o0)(n.info.connectedOn,!0)}),(0,s.jsx)(L.Z,{name:"Routes",mainVal:n.mode.routes}),(0,s.jsx)(U.Z,{bytes:n.info.rxtx.rxTotalBytes,lastBytesSinceSec:n.info.rxtx.rxLastBytesSinceSec,speed:n.info.rxtx.rxSpeedBytesPerSec,oneline:!1}),(0,s.jsx)(U.Z,{bytes:n.info.rxtx.txTotalBytes,lastBytesSinceSec:n.info.rxtx.txLastBytesSinceSec,speed:n.info.rxtx.txSpeedBytesPerSec,tx:!0,oneline:!1})]}):"disconnected"===n.info.status?(0,s.jsxs)(a.Z,{align:"start",p:"sm",children:[(0,s.jsx)(L.Z,{name:"Connecting as",nameColor:"red",mainVal:"Modbus TCP Master",subVal:n.info.lastConnectionOn?"Last connected: "+(0,H.o0)(n.info.lastConnectionOn,!0):void 0}),(0,s.jsx)(L.Z,{name:"Error",nameColor:"red",mainVal:n.info.lastError||"-",subVal:"Attempt: ".concat(n.info.attemptsNum)})]}):(0,s.jsx)(V.Z,{text:"Connection disabled in settings."}),"connected"===n.info.status&&(0,s.jsxs)(i.K,{bg:"gray.0",sx:e=>({borderTop:"1px solid ".concat(e.colors.gray[3])}),p:2,spacing:0,children:[(0,s.jsx)(a.Z,{children:x?(0,s.jsx)(r.z,{variant:"subtle",compact:!0,leftIcon:(0,s.jsx)(y.Z,{size:14}),size:"xs",onClick:()=>m(!1),children:"Hide debug tools"}):(0,s.jsx)(r.z,{variant:"subtle",compact:!0,leftIcon:(0,s.jsx)(v.Z,{size:14}),size:"xs",onClick:()=>m(!0),children:"Show debug tools"})}),(0,s.jsx)(d.U,{in:x,transitionDuration:100,children:(0,s.jsx)(K.Z,{dst:"MTC-".concat(t.ip,":").concat(t.port),mode:"tcp",isMaster:!0})})]})]}):(0,s.jsxs)(a.Z,{p:"xs",spacing:"xs",children:[(0,s.jsx)(u.O,{width:100,height:70,radius:"sm"}),(0,s.jsx)(u.O,{width:100,height:70,radius:"sm"}),(0,s.jsx)(u.O,{width:200,height:70,radius:"sm"})]})})}}},function(e){e.O(0,[634,733,301,979,105,87,296,752,39,774,888,179],function(){return e(e.s=8350)}),_N_E=e.O()}]);