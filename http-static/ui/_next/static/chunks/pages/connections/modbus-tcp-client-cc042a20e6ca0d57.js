(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[354],{5897:function(e,t,n){"use strict";n.d(t,{Z:function(){return s}});var s=(0,n(4397).Z)("info-circle","IconInfoCircle",[["path",{d:"M3 12a9 9 0 1 0 18 0a9 9 0 0 0 -18 0",key:"svg-0"}],["path",{d:"M12 9h.01",key:"svg-1"}],["path",{d:"M11 12h1v4h1",key:"svg-2"}]])},3279:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/connections/modbus-tcp-client",function(){return n(2937)}])},29:function(e,t,n){"use strict";n.d(t,{Z:function(){return InputWithHelp}});var s=n(966),i=n(7344),o=n(9956),c=n(8255),a=n(8482),r=n(5897),l=n(3900);function InputWithHelp(e){let{children:t}=e,[n,d]=(0,l.useState)(!1);return(0,s.jsx)(t.type,{...Object.fromEntries(Object.entries(t.props)),labelProps:{display:"block"},label:(0,s.jsxs)(i.Z,{mb:"4px",spacing:5,children:[t.props.label,(0,s.jsx)(o.x,{children:(t.props.withAsterisk||t.props.required)&&(0,s.jsx)(o.x,{span:!0,color:"red","aria-hidden":!0,children:" *"})}),(0,s.jsx)(o.x,{ml:"auto",color:"blue",sx:{cursor:"pointer"},onClick:e=>{d(!n),e.preventDefault()},children:(0,s.jsx)(c.M,{children:(0,s.jsx)(r.Z,{size:14,stroke:1.5})})})]}),description:(0,s.jsx)(a.U,{in:n,transitionDuration:100,children:(0,s.jsx)(o.x,{size:"xs",color:"gray.6",lh:"14px",children:t.props.description})}),withAsterisk:!1})}},2937:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return Page}});var s=n(966),i=n(462),o=n(4418),c=n(9956),a=n(7344),r=n(3283),l=n(9977),d=n(8482),u=n(868),p=n(3900),x=n(6435),m=n(8253),h=n(6078),b=n(8393),j=n(5041),f=n(6886),g=n(9724),y=n(7147),S=n(3174),v=n(7452),Z=n(7723),C=n(29),M=n(7219);function ModbusTcpClientSettingsForm(e){let{initialValues:t,onSubmit:n,saving:o}=e,{classes:c}=(0,Z.Z)(),a=(0,g.c)({initialValues:t,validate:{}}),l=(0,M.uA)(a,"update"===a.values.formMode?c.dirtyInput:void 0),[u,x]=(0,p.useState)(!1);return(0,s.jsx)("form",{onSubmit:a.onSubmit(async e=>{let t=await n(e);t&&a.resetDirty()}),children:(0,s.jsxs)(i.K,{children:["create"===a.values.formMode?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(h.o,{label:"IP address:",...l("ip"),required:!0}),(0,s.jsx)(b.Y,{label:"Port:",...l("port"),required:!0})]}):(0,s.jsx)(j.r,{label:"Enabled",...l("isEnabled","checkbox")}),(0,s.jsx)(h.o,{label:"Device ID range:",...l("uidRange")}),u?(0,s.jsx)(r.z,{variant:"subtle",compact:!0,leftIcon:(0,s.jsx)(y.Z,{size:14}),size:"xs",onClick:()=>x(!1),children:"Hide advanced settings"}):(0,s.jsx)(r.z,{variant:"subtle",compact:!0,leftIcon:(0,s.jsx)(S.Z,{size:14}),size:"xs",onClick:()=>x(!0),children:"Show advanced settings"}),(0,s.jsx)(d.U,{in:u,transitionDuration:100,children:(0,s.jsxs)(i.K,{children:[(0,s.jsx)(f.Ph,{label:"Use interface:",withinPortal:!0,data:[{value:"any",label:"Any interface"},{value:"elan",label:"ELAN"},{value:"wlan",label:"WLAN"}],...l("interface")}),(0,s.jsx)(C.Z,{children:(0,s.jsx)(b.Y,{label:"Reconnection period (sec):",description:"Reconnection period in seconds in case of connection failure.",min:1,max:600,required:!0,...l("reconnectionPeriodSec")})}),(0,s.jsx)(C.Z,{children:(0,s.jsx)(b.Y,{label:"Response await timeout (ms):",description:"Time in milliseconds to wait for a response from the Modbus TCP server.",min:1,max:6e4,required:!0,...l("responseTimeoutMs")})}),(0,s.jsx)(C.Z,{children:(0,s.jsx)(b.Y,{label:"Simultaneous requests:",description:"Number of simultaneously sent requests to the server client. Set to 1 to send all requests sequentially.",min:1,max:20,required:!0,...l("parallelRequestsNum")})})]})}),(0,s.jsx)(v.Z,{type:"submit",inProgress:o,children:"Save"})]})})}var T=n(2094),P=n(52),w=n(3738);async function update(e){let t=(0,P.bH)();await (0,P.ri)(t,"/api/mbtcp-client/".concat(e.ip,"-").concat(e.port,"/update/"),{method:"POST",body:JSON.stringify(e),timeoutMs:3e4})}async function create(e){let t=(0,P.bH)();await (0,P.ri)(t,"/api/mbtcp-clients/create/",{method:"POST",body:JSON.stringify(e),timeoutMs:3e4})}async function remove(e,t){let n=(0,P.bH)();return await (0,P.ri)(n,"/api/mbtcp-client/".concat(e,"-").concat(t.toString(),"/remove/"),{method:"POST",body:JSON.stringify({}),timeoutMs:3e4}),(0,w.ph)(["/api/mbtcp-clients/",n])}let k={ip:"",port:502,interface:"any",isEnabled:!0,uidRange:"1-255",responseTimeoutMs:1e3,parallelRequestsNum:1,reconnectionPeriodSec:5};var z=n(8988),O=n(2484),N=n(3600),I=n(4621),E=n(7816),q=n(169),_=n(829),A=n(5451),D=n(3610),B=n(477),R=n(9804),V=n(1921);function Page(){let e=(0,P.tQ)("/api/mbtcp-clients/",w.ph),t=(0,z.$z)(),[n,l]=(0,p.useState)(!1),d=e.data,u=t.data;return d&&u?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(m.Z,{title:"Add Modbus TCP client connection",onSettingsUpdate:()=>{e.mutate()},form:ModbusTcpClientSettingsForm,useSettings:()=>({data:{formMode:"create",...k},error:void 0,isValidating:!1,isLoading:!1,mutate:async()=>void 0}),save:create,opened:n,setOpened:l}),(0,s.jsx)(x.Z,{pageId:"modbus-tcp-client",title:"Modbus TCP Client",children:(0,s.jsxs)(i.K,{children:[d.length>0?d.map(t=>(0,s.jsx)(ModbusTcpClientStatus,{settings:t,status:u["".concat(t.ip,":").concat(t.port)],onSettingsUpdate:()=>{e.mutate()},mutate:e.mutate},"".concat(t.ip,":").concat(t.port))):(0,s.jsx)(o.X,{p:"lg",bg:"gray.1",withBorder:!0,children:(0,s.jsx)(c.x,{ta:"center",fz:"sm",children:"No Modbus TCP client connections created."})}),(0,s.jsx)(a.Z,{children:(0,s.jsx)(r.z,{onClick:()=>{l(!0)},leftIcon:(0,s.jsx)(O.Z,{}),children:"Add Modbus TCP client connection"})})]})})]}):(0,s.jsx)(T.Z,{pageTitle:"Modbus TCP Client",contentIsLoading:!0})}function ModbusTcpClientStatus(e){let{settings:t,status:n,mutate:o,onSettingsUpdate:c}=e,[x,m]=(0,p.useState)(!1);return(0,s.jsx)(q.Z,{name:"".concat(t.ip,":").concat(t.port),icon:(null==n?void 0:n.info.status)==="connected"?(0,s.jsx)(N.Z,{}):(0,s.jsx)(I.Z,{}),status:(null==n?void 0:n.info.status)==="connected"?"connected":(null==n?void 0:n.info.status)==="disconnected"?"disconnected":"disabled",settings:{title:"Modbus TCP client settings: ".concat(t.ip,":").concat(t.port),form:ModbusTcpClientSettingsForm,useSettings:()=>({data:{...t,formMode:"update"},error:void 0,isValidating:!1,isLoading:!1,mutate:async()=>void 0}),save:update,onSettingsUpdate:c},addElRight:(0,s.jsx)(_.Z,{title:"Delete conection",description:'Are you sure you want to delete the connection "'.concat(t.ip,":").concat(t.port,'"?'),buttonText:"Delete",children:(0,s.jsx)(l.A,{color:"red",onClick:()=>{(0,M.Mx)(()=>o(remove(t.ip,t.port),{optimisticData:e=>e.filter(e=>e.ip!==t.ip&&e.port!==t.port)}))},children:(0,s.jsx)(E.Z,{size:18})})}),children:n?(0,s.jsxs)(i.K,{spacing:0,children:["connected"===n.info.status?(0,s.jsxs)(a.Z,{align:"start",p:"sm",children:[(0,s.jsx)(D.Z,{name:"Connected as",nameColor:"green",mainVal:"Modbus TCP Master",subVal:(0,R.o0)(n.info.connectedOn,!0)}),(0,s.jsx)(D.Z,{name:"Routes",mainVal:n.mode.routes}),(0,s.jsx)(B.Z,{bytes:n.info.rxtx.rxTotalBytes,lastBytesSinceSec:n.info.rxtx.rxLastBytesSinceSec,speed:n.info.rxtx.rxSpeedBytesPerSec,oneline:!1}),(0,s.jsx)(B.Z,{bytes:n.info.rxtx.txTotalBytes,lastBytesSinceSec:n.info.rxtx.txLastBytesSinceSec,speed:n.info.rxtx.txSpeedBytesPerSec,tx:!0,oneline:!1})]}):"disconnected"===n.info.status?(0,s.jsxs)(a.Z,{align:"start",p:"sm",children:[(0,s.jsx)(D.Z,{name:"Connecting as",nameColor:"red",mainVal:"Modbus TCP Master",subVal:n.info.lastConnectionOn?"Last connected: "+(0,R.o0)(n.info.lastConnectionOn,!0):void 0}),(0,s.jsx)(D.Z,{name:"Error",nameColor:"red",mainVal:n.info.lastError||"-",subVal:"Attempt: ".concat(n.info.attemptsNum)})]}):(0,s.jsx)(A.Z,{text:"Connection disabled in settings."}),"connected"===n.info.status&&(0,s.jsxs)(i.K,{bg:"gray.0",sx:e=>({borderTop:"1px solid ".concat(e.colors.gray[3])}),p:2,spacing:0,children:[(0,s.jsx)(a.Z,{children:x?(0,s.jsx)(r.z,{variant:"subtle",compact:!0,leftIcon:(0,s.jsx)(y.Z,{size:14}),size:"xs",onClick:()=>m(!1),children:"Hide debug tools"}):(0,s.jsx)(r.z,{variant:"subtle",compact:!0,leftIcon:(0,s.jsx)(S.Z,{size:14}),size:"xs",onClick:()=>m(!0),children:"Show debug tools"})}),(0,s.jsx)(d.U,{in:x,transitionDuration:100,children:(0,s.jsx)(V.Z,{dst:"MTC-".concat(t.ip,":").concat(t.port),mode:"tcp",isMaster:!0})})]})]}):(0,s.jsxs)(a.Z,{p:"xs",spacing:"xs",children:[(0,s.jsx)(u.O,{width:100,height:70,radius:"sm"}),(0,s.jsx)(u.O,{width:100,height:70,radius:"sm"}),(0,s.jsx)(u.O,{width:200,height:70,radius:"sm"})]})})}}},function(e){e.O(0,[217,666,161,427,420,467,94,593,633,774,888,179],function(){return e(e.s=3279)}),_N_E=e.O()}]);