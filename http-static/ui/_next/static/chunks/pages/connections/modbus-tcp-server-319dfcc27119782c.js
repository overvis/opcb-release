(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[662],{5897:function(e,s,t){"use strict";t.d(s,{Z:function(){return n}});var n=(0,t(4397).Z)("info-circle","IconInfoCircle",[["path",{d:"M3 12a9 9 0 1 0 18 0a9 9 0 0 0 -18 0",key:"svg-0"}],["path",{d:"M12 9h.01",key:"svg-1"}],["path",{d:"M11 12h1v4h1",key:"svg-2"}]])},6502:function(e,s,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/connections/modbus-tcp-server",function(){return t(7674)}])},4045:function(e,s,t){"use strict";t.d(s,{Z:function(){return HexNumberInput}});var n=t(966),r=t(8393);function HexNumberInput(e){let{hex:s,...t}={...e};return s?(0,n.jsx)(InternalHexNumberInput,{...t}):(0,n.jsx)(r.Y,{...t})}function InternalHexNumberInput(e){return(0,n.jsx)(r.Y,{...e,formatter:e=>{let s=parseInt(e,10);return Number.isNaN(s)?"0x":"0x".concat(s.toString(16).toUpperCase())},parser:e=>e?parseInt(e.replace("0x",""),16).toString():""})}},29:function(e,s,t){"use strict";t.d(s,{Z:function(){return InputWithHelp}});var n=t(966),r=t(7344),i=t(9956),a=t(8255),o=t(8482),l=t(5897),c=t(3900);function InputWithHelp(e){let{children:s}=e,[t,u]=(0,c.useState)(!1);return(0,n.jsx)(s.type,{...Object.fromEntries(Object.entries(s.props)),labelProps:{display:"block"},label:(0,n.jsxs)(r.Z,{mb:"4px",spacing:5,children:[s.props.label,(0,n.jsx)(i.x,{children:(s.props.withAsterisk||s.props.required)&&(0,n.jsx)(i.x,{span:!0,color:"red","aria-hidden":!0,children:" *"})}),(0,n.jsx)(i.x,{ml:"auto",color:"blue",sx:{cursor:"pointer"},onClick:e=>{u(!t),e.preventDefault()},children:(0,n.jsx)(a.M,{children:(0,n.jsx)(l.Z,{size:14,stroke:1.5})})})]}),description:(0,n.jsx)(o.U,{in:t,transitionDuration:100,children:(0,n.jsx)(i.x,{size:"xs",color:"gray.6",lh:"14px",children:s.props.description})}),withAsterisk:!1})}},1921:function(e,s,t){"use strict";t.d(s,{Z:function(){return ModbusDebugTools}});var n=t(966),r=t(3127),i=t(5782),a=t(462),o=t(7344),l=t(9956),c=t(8482),u=t(2701),d=t(3283),x=t(3063),p=t(7673),m=t(3900),h=t(52),g=t(9342),b=t(8431),v=t(7452),j=t(6078),f=t(5041),S=t(6886),y=t(9724),C=t(9561),T=t(4045);function ModbusRequestGenerator(e){let{mode:s,onSubmit:t}=e,r=(0,y.c)({initialValues:{useHex:!0,deviceId:1,funcCode:"3",funcCodeCustom:1,address:0,quantity:1,value:0,subFunction:0,payload:""},validate:{deviceId:(0,C.m)({min:0,max:255},"Must be in range 0-255"),funcCodeCustom:(0,C.m)({min:0,max:255},"Must be in range 0-255"),address:(0,C.m)({min:0,max:65535},"Must be in range 0-65535"),quantity:(0,C.m)({min:0,max:2e3},"Must be in range 0-2000"),value:(0,C.m)({min:0,max:65535},"Must be in range 0-65535"),payload:e=>{let s=(0,b.uv)(e||"");return s.length%2!=0?"Payload must be even number of bytes":s.length>504?"Payload length must be not longer than 252 bytes":/^[0-9A-F]*$/.test(s)?void 0:"Payload must be in HEX format"}},validateInputOnBlur:!0}),i=g.eq.map(e=>({value:e.code.toString(),label:"".concat(r.values.useHex?"0x".concat(e.code.toString(16).toUpperCase().padStart(2,"0")):e.code.toString(10).padStart(2,"0")," (").concat(e.name,")")}));i.push({value:"custom",label:"Custom"});let o=(0,n.jsx)(n.Fragment,{children:(0,n.jsx)(j.o,{label:"Payload (HEX, without CRC):",placeholder:"00 20 00 0C",...r.getInputProps("payload")})}),l=r.values.funcCode;"custom"===l?o=(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(T.Z,{hex:r.values.useHex,label:"Function code:",min:0,max:128,...r.getInputProps("funcCodeCustom")}),(0,n.jsx)(j.o,{label:"Payload (HEX, without CRC):",placeholder:"00 20 00 0C",...r.getInputProps("payload")})]}):"1"===l||"2"===l||"3"===l||"4"===l?o=(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(T.Z,{hex:r.values.useHex,label:"Starting address:",min:0,max:65535,...r.getInputProps("address")}),(0,n.jsx)(T.Z,{hex:r.values.useHex,label:"Quantity:",min:0,max:2e3,...r.getInputProps("quantity")})]}):"5"===l||"6"===l?o=(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(T.Z,{hex:r.values.useHex,label:"Address:",min:0,max:65535,...r.getInputProps("address")}),(0,n.jsx)(T.Z,{hex:r.values.useHex,label:"Value:",...r.getInputProps("value")})]}):"7"===l||"11"===l||"12"===l||"17"===l?o=(0,n.jsx)(n.Fragment,{}):"8"===l?o=(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(T.Z,{hex:r.values.useHex,label:"Sub-function:",...r.getInputProps("subFunction")}),(0,n.jsx)(j.o,{label:"Data (HEX):",placeholder:"12 34 AB CD",...r.getInputProps("payload")})]}):("15"===l||"16"==l)&&(o=(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(T.Z,{hex:r.values.useHex,label:"Starting address:",min:0,max:65535,...r.getInputProps("address")}),(0,n.jsx)(T.Z,{hex:r.values.useHex,label:"Quantity:",min:0,max:2e3,...r.getInputProps("quantity")}),(0,n.jsx)(j.o,{label:"Values (HEX):",placeholder:"12 34 AB CD",...r.getInputProps("payload")})]}));let c="";return"rtu"===s?c=(0,g.aL)(getRequestData(r.values))[2]:"ascii"===s&&(c=(0,g.gY)(getRequestData(r.values))[1]),(0,n.jsx)("form",{onSubmit:r.onSubmit(()=>{t("rtu"===s?(0,g.aL)(getRequestData(r.values))[0]:"ascii"===s?(0,g.gY)(getRequestData(r.values))[0]:(0,g.nM)(getRequestData(r.values))[0])}),children:(0,n.jsxs)(a.K,{spacing:"xs",children:[(0,n.jsx)(f.r,{label:"Use HEX",onLabel:"HEX",offLabel:"DEC",checked:r.values.useHex,...r.getInputProps("useHex")}),(0,n.jsx)(T.Z,{hex:r.values.useHex,label:"Device ID:",min:0,max:255,...r.getInputProps("deviceId")}),(0,n.jsx)(S.Ph,{withinPortal:!0,label:"Function:",data:i,...r.getInputProps("funcCode")}),o,"tcp"!==s&&(0,n.jsx)(j.o,{label:"rtu"===s?"CRC:":"LRC:",value:(0,b.zF)(c),disabled:!0}),(0,n.jsx)(d.z,{type:"submit",children:"Add request"})]})})}function getRequestData(e){return{deviceId:e.deviceId,funcCode:"custom"===e.funcCode?e.funcCodeCustom:parseInt(e.funcCode,10),customPayload:"custom"===e.funcCode,address:e.address,quantity:e.quantity,value:e.value,subFunction:e.subFunction,payload:(0,b.uv)(e.payload||"")}}var I=t(4101);function ModbusDebugTools(e){let{mode:s,dst:t,isMaster:j}=e,[f,S]=(0,m.useState)(!1),[y,C]=(0,m.useState)(""),{token:T}=(0,h.pk)(),[Z,P]=(0,m.useState)(!1),[M,q]=(0,m.useState)("");return(0,n.jsx)(r.x,{w:"100%",children:(0,n.jsxs)(i.r,{p:"xs",maw:914,children:[(0,n.jsx)(i.r.Col,{sm:j?8:12,children:(0,n.jsx)(I.Z,{mode:s,streamName:t})}),j&&(0,n.jsx)(i.r.Col,{sm:4,children:(0,n.jsxs)(a.K,{spacing:0,children:[(0,n.jsx)(o.Z,{sx:e=>({borderBottom:"1px solid ".concat(e.colors.gray[3])}),py:"xs",children:(0,n.jsx)(l.x,{size:"sm",transform:"uppercase",weight:700,color:"gray.9",children:"Send request"})}),(0,n.jsxs)(a.K,{pt:"xs",spacing:"xs",children:[(0,n.jsx)(c.U,{in:!f,children:(0,n.jsxs)(a.K,{spacing:"xs",children:[(0,n.jsx)(u.g,{fz:"xs",autosize:!0,minRows:8,maxRows:15,placeholder:"Write Modbus RTU in HEX.\nSeparate multiple requests by newline.\n\nE.g.\n02 01 00 20 00 0C 3D F6\n01 03 00 00 00 01 84 0A\n...",value:y,onChange:e=>C(e.target.value),styles:{root:{flexGrow:1},input:{fontFamily:"monospace"}}}),(0,n.jsx)(v.Z,{inProgress:Z,onClick:async()=>{T&&(q("Preparing."),P(!0),await (0,g.PW)(T,t,y,!0,q),P(!1))},children:"Send"})]})}),(0,n.jsx)(c.U,{in:f,children:(0,n.jsx)(ModbusRequestGenerator,{mode:s,onSubmit:e=>{let s=y;s.trim().length>0&&!s.endsWith("\n")&&(s+="\n"),C(s+(e=(0,b.zF)(e))+"\n"),S(!1)}})}),(0,n.jsx)(d.z,{compact:!0,size:"xs",variant:"subtle",onClick:()=>S(!f),children:f?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(x.Z,{size:12,style:{marginRight:5}}),"Write request manually"]}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(p.Z,{size:12,style:{marginRight:5}}),"Show request generator"]})}),M&&(0,n.jsx)(r.x,{sx:{overflow:"scroll"},w:"100%",mah:200,children:(0,n.jsx)(l.x,{c:"orange",fz:12,ff:"monospace",sx:{whiteSpace:"pre"},children:M})})]})]})})]})})}},477:function(e,s,t){"use strict";t.d(s,{Z:function(){return RxTxDisplay}});var n=t(966),r=t(1949),i=t(4137),a=t(2242),o=t(8431),l=t(3610);function RxTxDisplay(e){let{bytes:s,lastBytesSinceSec:t,speed:c,tx:u,oneline:d=!0}=e,x=(0,r.rZ)(),p=void 0!==t&&t<=2?x.colors.green[6]:x.colors.gray[6];return(0,n.jsx)(l.Z,{icon:u?(0,n.jsx)(i.Z,{stroke:1,height:15,color:p}):(0,n.jsx)(a.Z,{stroke:1,height:15,color:p}),name:u?"TX":"RX",nameColor:p,mainVal:(0,o.td)(s),subVal:{level:void 0!==t&&t<=2?"good":"dimmed",value:"".concat((0,o.td)(c),"/s")},oneline:d})}},2323:function(e,s,t){"use strict";t.d(s,{Z:function(){return StatusInfo}});var n=t(966),r=t(1949),i=t(7344),a=t(3624),o=t(462),l=t(9956),c=t(4351),u=t(4418),d=t(2922);function StatusInfo(e){let{iface:s,children:t,dest:x,text:p,error:m,ok:h,dhcpEnabled:g,attemptNum:b}=e,v=(0,r.rZ)();return(0,n.jsxs)(i.Z,{align:"start",spacing:"sm",noWrap:!0,p:"xs",children:[h?(0,n.jsx)(d.Z,{color:v.colors.green[6]}):(0,n.jsx)(a.a,{mt:9,size:22,color:"dark"}),(0,n.jsxs)(o.K,{spacing:"xs",children:[(0,n.jsxs)(o.K,{spacing:0,children:[(0,n.jsxs)(l.x,{color:h?"green":"dark",children:[p||(h?"Connected":"Connecting"),x&&(0,n.jsxs)(n.Fragment,{children:[" ","to ",(0,n.jsx)("b",{children:x})]}),b&&(0,n.jsxs)(n.Fragment,{children:[" ",(0,n.jsxs)(l.x,{color:"dimmed",size:"xs",span:!0,children:["(attempt ",b,")"]})]})]}),(0,n.jsxs)(i.Z,{spacing:"sm",children:[(0,n.jsx)(l.x,{color:"dimmed",size:"sm",lh:1,children:s}),void 0!==g&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(c.i,{orientation:"vertical",my:1}),(0,n.jsx)(l.x,{size:"sm",c:"dimmed",lh:1,children:g?"DHCP enabled":"DHCP disabled"})]})]})]}),m&&(0,n.jsx)(l.x,{size:"sm",c:"red",children:m}),t&&(0,n.jsx)(u.X,{bg:"gray.0",p:"xs",ml:"-xs",children:(0,n.jsx)(i.Z,{align:"start",position:"left",children:t})})]})]})}},7674:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return Page}});var n=t(966),r=t(462),i=t(3127),a=t(9956),o=t(1949),l=t(7344),c=t(3283),u=t(8482),d=t(9640),x=t(4397),p=(0,x.Z)("server-off","IconServerOff",[["path",{d:"M12 12h-6a3 3 0 0 1 -3 -3v-2c0 -1.083 .574 -2.033 1.435 -2.56m3.565 -.44h10a3 3 0 0 1 3 3v2a3 3 0 0 1 -3 3h-2",key:"svg-0"}],["path",{d:"M16 12h2a3 3 0 0 1 3 3v2m-1.448 2.568a2.986 2.986 0 0 1 -1.552 .432h-12a3 3 0 0 1 -3 -3v-2a3 3 0 0 1 3 -3h6",key:"svg-1"}],["path",{d:"M7 8v.01",key:"svg-2"}],["path",{d:"M7 16v.01",key:"svg-3"}],["path",{d:"M3 3l18 18",key:"svg-4"}]]),m=(0,x.Z)("circle-arrow-right","IconCircleArrowRight",[["path",{d:"M12 3a9 9 0 1 0 0 18a9 9 0 0 0 0 -18",key:"svg-0"}],["path",{d:"M16 12l-4 -4",key:"svg-1"}],["path",{d:"M16 12h-8",key:"svg-2"}],["path",{d:"M12 16l4 -4",key:"svg-3"}]]),h=t(7147),g=t(3174),b=t(3900),v=t(6435),j=t(5451),f=t(1921),S=t(7723),y=t(6886),C=t(8393),T=t(9724),I=t(7452),Z=t(7219),P=t(29);function ModbusTcpServerSettingsForm(e){let{initialValues:s,onSubmit:t,saving:i}=e,a=(0,T.c)({initialValues:s,validate:{}}),{classes:o}=(0,S.Z)(),l=(0,Z.u)(a,o.dirtyInput),[d,x]=(0,b.useState)(!1);return(0,n.jsx)("form",{onSubmit:a.onSubmit(async e=>{let s=await t(e);s&&a.resetDirty()}),children:(0,n.jsxs)(r.K,{children:[(0,n.jsx)(y.Ph,{label:"Listen to interface:",withinPortal:!0,data:[{value:"any",label:"All interfaces"},{value:"elan",label:"ELAN only"},{value:"wlan",label:"WLAN only"},{value:"disabled",label:"Disable server"}],...l("interface")}),(0,n.jsx)(u.U,{in:"disabled"!==a.values.interface,transitionDuration:100,children:(0,n.jsxs)(r.K,{children:[(0,n.jsx)(C.Y,{label:"Listen to port:",min:1,max:65535,required:!0,...l("port"),hideControls:!0}),d?(0,n.jsx)(c.z,{variant:"subtle",compact:!0,leftIcon:(0,n.jsx)(h.Z,{size:14}),size:"xs",onClick:()=>x(!1),children:"Hide advanced settings"}):(0,n.jsx)(c.z,{variant:"subtle",compact:!0,leftIcon:(0,n.jsx)(g.Z,{size:14}),size:"xs",onClick:()=>x(!0),children:"Show advanced settings"}),(0,n.jsx)(u.U,{in:d,transitionDuration:100,children:(0,n.jsxs)(r.K,{children:[(0,n.jsx)(P.Z,{children:(0,n.jsx)(C.Y,{label:"Max connections:",description:"Maximum number of supported incoming client connections.",min:1,max:20,required:!0,...l("maxClients")})}),(0,n.jsx)(P.Z,{children:(0,n.jsx)(C.Y,{label:"Client alive timeout (sec):",description:"Client TCP connection will be dropped after this period of inactivity.",min:15,max:3600,required:!0,...l("clientAliveTimeoutSec")})}),(0,n.jsx)(P.Z,{children:(0,n.jsx)(C.Y,{label:"Response timeout (ms):",description:"The number of milliseconds to wait for an internal routing to respond to an incoming client's request. After this timeout is reached, the server will respond to a client with 0x0b (timeout error) Modbus error.",min:1,max:6e4,required:!0,...l("responseTimeoutMs")})}),(0,n.jsx)(P.Z,{children:(0,n.jsx)(C.Y,{label:"Simultaneous requests per client:",description:"Number of simultaneously processed parallel requests incoming from one client. Set to 1 to process all requests sequentially. Requests from different clients are always processed in parallel.",min:1,max:20,required:!0,...l("parallelRequestsNum")})})]})})]})}),(0,n.jsx)(I.Z,{type:"submit",inProgress:i,children:"Save"})]})})}var M=t(2094),q=t(477),w=t(5465),k=t(2323),z=t(9804),R=t(52),H=t(3738);async function settingsFetcher(e){let[s,t]=e,n=await (0,H.wv)(t,["modbusTcpServer:interface","modbusTcpServer:port","modbusTcpServer:maxClients","modbusTcpServer:clientAliveTimeoutSec","modbusTcpServer:responseTimeoutMs","modbusTcpServer:parallelRequestsNum","modbusTcpServer:portOpenRetryPeriodSec","modbusTcpServer:broadcastIsEnabled"]);return{interface:n["modbusTcpServer:interface"]||"any",port:parseInt(n["modbusTcpServer:port"]||"502",10),maxClients:parseInt(n["modbusTcpServer:maxClients"]||"4",10),clientAliveTimeoutSec:parseInt(n["modbusTcpServer:clientAliveTimeoutSec"]||"60",10),responseTimeoutMs:parseInt(n["modbusTcpServer:responseTimeoutMs"]||"1500",10),parallelRequestsNum:parseInt(n["modbusTcpServer:parallelRequestsNum"]||"1",10),portOpenRetryPeriodSec:parseInt(n["modbusTcpServer:portOpenRetryPeriodSec"]||"5",10),broadcastIsEnabled:"true"===n["modbusTcpServer:broadcastIsEnabled"]}}async function saveSettings(e){let s={"modbusTcpServer:interface":e.interface,"modbusTcpServer:port":e.port.toString(),"modbusTcpServer:maxClients":e.maxClients.toString(),"modbusTcpServer:clientAliveTimeoutSec":e.clientAliveTimeoutSec.toString(),"modbusTcpServer:responseTimeoutMs":e.responseTimeoutMs.toString(),"modbusTcpServer:parallelRequestsNum":e.parallelRequestsNum.toString(),"modbusTcpServer:portOpenRetryPeriodSec":e.portOpenRetryPeriodSec.toString(),"modbusTcpServer:broadcastIsEnabled":e.broadcastIsEnabled?"true":"false"};return(0,H.NC)(s)}var F=t(2967);function Page(){let e=function(){let e=(0,R.tQ)("modbus-tcp-server-settings",settingsFetcher);return{...e}}(),s=(0,F.$z)(),t=e.data,o=s.data;return t&&o?(0,n.jsx)(v.Z,{pageId:"modbus-tcp-server",title:"Modbus TCP Server",children:(0,n.jsx)(r.K,{children:(0,n.jsx)(w.Z,{name:"Modbus TCP Server",icon:"disabled"!==o.status?(0,n.jsx)(d.Z,{}):(0,n.jsx)(p,{}),status:"disabled"===o.status?"disabled":"connected",settings:{title:"Modbus TCP Server settings",form:ModbusTcpServerSettingsForm,useSettings:()=>({data:{...t},error:void 0,isValidating:!1,isLoading:!1,mutate:async()=>void 0}),save:saveSettings,onSettingsUpdate:()=>{e.mutate()}},children:"disabled"===o.status?(0,n.jsx)(j.Z,{icon:(0,n.jsx)(p,{}),text:"Modbus TCP server is disabled in settings."}):(0,n.jsxs)(r.K,{spacing:0,children:[(0,n.jsx)(k.Z,{text:"Listening on ".concat(o.listenIp,":").concat(o.listenPort),ok:!0,iface:"any"===o.interface?"all interfaces":o.interface}),0===o.clients.length?(0,n.jsx)(i.x,{p:"xs",sx:e=>({borderTop:"1px solid ".concat(e.colors.gray[3]),backgroundColor:e.colors.gray[0]}),children:(0,n.jsx)(a.x,{fz:"sm",pl:36,color:"gray.6",children:"No clients connected."})}):(0,n.jsx)(r.K,{mt:"xs",spacing:0,children:o.clients.map(e=>(0,n.jsx)(ModbusTcpServerClientInfo,{client:e},e.address))})]})})})}):(0,n.jsx)(M.Z,{pageTitle:"Modbus TCP Server",contentIsLoading:!0})}function ModbusTcpServerClientInfo(e){let{client:s}=e,t=(0,o.rZ)(),[d,x]=(0,b.useState)(!1);return(0,n.jsxs)(r.K,{p:"xs",sx:e=>({borderTop:"1px solid ".concat(e.colors.gray[3]),backgroundColor:e.colors.gray[0]}),spacing:"xs",children:[(0,n.jsxs)(l.Z,{spacing:"sm",align:"start",children:[(0,n.jsx)(m,{color:t.colors.green[6]}),(0,n.jsxs)(r.K,{spacing:0,children:[(0,n.jsxs)(a.x,{weight:"bold",size:"sm",color:"gray.7",transform:"uppercase",mt:1,children:[(0,n.jsx)(a.x,{span:!0,color:"gray.6",children:"Connection from"})," ",s.address]}),(0,n.jsxs)(a.x,{color:"dimmed",size:"xs",lh:1,children:["Connected since ",(0,z.o0)(s.connectedOn,!0)," on ",s.iface]})]}),(0,n.jsx)(i.x,{mt:1,children:(0,n.jsx)(q.Z,{bytes:s.rxtx.rxTotalBytes,lastBytesSinceSec:s.rxtx.rxLastBytesSinceSec,speed:s.rxtx.rxSpeedBytesPerSec,oneline:!0})}),(0,n.jsx)(i.x,{mt:1,children:(0,n.jsx)(q.Z,{bytes:s.rxtx.txTotalBytes,lastBytesSinceSec:s.rxtx.txLastBytesSinceSec,speed:s.rxtx.txSpeedBytesPerSec,tx:!0,oneline:!0})})]}),(0,n.jsx)(l.Z,{children:d?(0,n.jsx)(c.z,{variant:"subtle",compact:!0,leftIcon:(0,n.jsx)(h.Z,{size:14}),size:"xs",onClick:()=>x(!1),children:"Hide transfer log"}):(0,n.jsx)(c.z,{variant:"subtle",compact:!0,leftIcon:(0,n.jsx)(g.Z,{size:14}),size:"xs",onClick:()=>x(!0),children:"Show transfer log"})}),(0,n.jsx)(u.U,{in:d,transitionDuration:100,children:(0,n.jsx)(f.Z,{dst:"MTS-".concat(s.address),mode:"tcp",isMaster:!1})})]})}}},function(e){e.O(0,[217,666,388,924,27,401,94,874,774,888,179],function(){return e(e.s=6502)}),_N_E=e.O()}]);