(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[662],{2701:function(e,t,r){"use strict";r.d(t,{g:function(){return T}});var s=r(3900),n=r(1401),a=r(1156),i=s.useLayoutEffect,useLatest=function(e){var t=s.useRef(e);return i(function(){t.current=e}),t},updateRef=function(e,t){if("function"==typeof e){e(t);return}e.current=t},use_composed_ref_esm=function(e,t){var r=(0,s.useRef)();return(0,s.useCallback)(function(s){e.current=s,r.current&&updateRef(r.current,null),r.current=t,t&&updateRef(t,s)},[t])},o={"min-height":"0","max-height":"none",height:"0",visibility:"hidden",overflow:"hidden",position:"absolute","z-index":"-1000",top:"0",right:"0"},forceHiddenStyles=function(e){Object.keys(o).forEach(function(t){e.style.setProperty(t,o[t],"important")})},l=null,getHeight=function(e,t){var r=e.scrollHeight;return"border-box"===t.sizingStyle.boxSizing?r+t.borderSize:r-t.paddingSize},noop=function(){},c=["borderBottomWidth","borderLeftWidth","borderRightWidth","borderTopWidth","boxSizing","fontFamily","fontSize","fontStyle","fontWeight","letterSpacing","lineHeight","paddingBottom","paddingLeft","paddingRight","paddingTop","tabSize","textIndent","textRendering","textTransform","width","wordBreak"],d=!!document.documentElement.currentStyle,getSizingData=function(e){var t=window.getComputedStyle(e);if(null===t)return null;var r=c.reduce(function(e,r){return e[r]=t[r],e},{}),s=r.boxSizing;if(""===s)return null;d&&"border-box"===s&&(r.width=parseFloat(r.width)+parseFloat(r.borderRightWidth)+parseFloat(r.borderLeftWidth)+parseFloat(r.paddingRight)+parseFloat(r.paddingLeft)+"px");var n=parseFloat(r.paddingBottom)+parseFloat(r.paddingTop),a=parseFloat(r.borderBottomWidth)+parseFloat(r.borderTopWidth);return{sizingStyle:r,paddingSize:n,borderSize:a}},useWindowResizeListener=function(e){var t=useLatest(e);(0,s.useLayoutEffect)(function(){var handler=function(e){t.current(e)};return window.addEventListener("resize",handler),function(){window.removeEventListener("resize",handler)}},[])},u=(0,s.forwardRef)(function(e,t){var r=e.cacheMeasurements,i=e.maxRows,o=e.minRows,c=e.onChange,d=void 0===c?noop:c,u=e.onHeightChange,p=void 0===u?noop:u,x=(0,a.Z)(e,["cacheMeasurements","maxRows","minRows","onChange","onHeightChange"]),m=void 0!==x.value,h=(0,s.useRef)(null),g=use_composed_ref_esm(h,t),v=(0,s.useRef)(0),b=(0,s.useRef)(),resizeTextarea=function(){var e,t,s,n,a,c,d,u,x,m,g,f=h.current,j=r&&b.current?b.current:getSizingData(f);if(j){b.current=j;var y=(e=f.value||f.placeholder||"x",void 0===(t=o)&&(t=1),void 0===(s=i)&&(s=1/0),l||((l=document.createElement("textarea")).setAttribute("tabindex","-1"),l.setAttribute("aria-hidden","true"),forceHiddenStyles(l)),null===l.parentNode&&document.body.appendChild(l),n=j.paddingSize,a=j.borderSize,d=(c=j.sizingStyle).boxSizing,Object.keys(c).forEach(function(e){l.style[e]=c[e]}),forceHiddenStyles(l),l.value=e,u=getHeight(l,j),l.value="x",m=(x=l.scrollHeight-n)*t,"border-box"===d&&(m=m+n+a),u=Math.max(m,u),g=x*s,"border-box"===d&&(g=g+n+a),[u=Math.min(g,u),x]),S=y[0],C=y[1];v.current!==S&&(v.current=S,f.style.setProperty("height",S+"px","important"),p(S,{rowHeight:C}))}};return(0,s.useLayoutEffect)(resizeTextarea),useWindowResizeListener(resizeTextarea),(0,s.createElement)("textarea",(0,n.Z)({},x,{onChange:function(e){m||resizeTextarea(),d(e)},ref:g}))}),p=r(6131),x=r(1949),m=(0,r(9025).k)(e=>({input:{paddingTop:e.spacing.xs,paddingBottom:e.spacing.xs}})),h=r(1397),g=r(1482),v=Object.defineProperty,b=Object.defineProperties,f=Object.getOwnPropertyDescriptors,j=Object.getOwnPropertySymbols,y=Object.prototype.hasOwnProperty,S=Object.prototype.propertyIsEnumerable,__defNormalProp=(e,t,r)=>t in e?v(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,__spreadValues=(e,t)=>{for(var r in t||(t={}))y.call(t,r)&&__defNormalProp(e,r,t[r]);if(j)for(var r of j(t))S.call(t,r)&&__defNormalProp(e,r,t[r]);return e},__spreadProps=(e,t)=>b(e,f(t)),__objRest=(e,t)=>{var r={};for(var s in e)y.call(e,s)&&0>t.indexOf(s)&&(r[s]=e[s]);if(null!=e&&j)for(var s of j(e))0>t.indexOf(s)&&S.call(e,s)&&(r[s]=e[s]);return r};let C={autosize:!1,size:"sm",__staticSelector:"Textarea"},T=(0,s.forwardRef)((e,t)=>{let r=(0,x.N4)("Textarea",C,e),{autosize:n,maxRows:a,minRows:i,label:o,error:l,description:c,id:d,className:v,required:b,style:f,wrapperProps:j,classNames:y,styles:S,size:T,__staticSelector:w,sx:I,errorProps:P,descriptionProps:z,labelProps:M,inputWrapperOrder:Z,inputContainer:R,unstyled:k,withAsterisk:_,variant:H}=r,q=__objRest(r,["autosize","maxRows","minRows","label","error","description","id","className","required","style","wrapperProps","classNames","styles","size","__staticSelector","sx","errorProps","descriptionProps","labelProps","inputWrapperOrder","inputContainer","unstyled","withAsterisk","variant"]),F=(0,p.M)(d),{classes:E,cx:N}=m(),{systemStyles:D,rest:L}=(0,h.x)(q),O=__spreadValues({required:b,ref:t,error:l,id:F,classNames:__spreadProps(__spreadValues({},y),{input:N(E.input,null==y?void 0:y.input)}),styles:S,__staticSelector:w,size:T,multiline:!0,unstyled:k,variant:H},L);return s.createElement(g.I.Wrapper,__spreadValues(__spreadValues({label:o,error:l,id:F,description:c,required:b,style:f,className:v,classNames:y,styles:S,size:T,__staticSelector:w,sx:I,errorProps:P,labelProps:M,descriptionProps:z,inputContainer:R,inputWrapperOrder:Z,unstyled:k,withAsterisk:_,variant:H},D),j),n?s.createElement(g.I,__spreadProps(__spreadValues({},O),{component:u,maxRows:a,minRows:i})):s.createElement(g.I,__spreadProps(__spreadValues({},O),{component:"textarea",rows:i})))});T.displayName="@mantine/core/Textarea"},7673:function(e,t,r){"use strict";r.d(t,{Z:function(){return s}});var s=(0,r(4397).Z)("adjustments","IconAdjustments",[["path",{d:"M4 10a2 2 0 1 0 4 0a2 2 0 0 0 -4 0",key:"svg-0"}],["path",{d:"M6 4v4",key:"svg-1"}],["path",{d:"M6 12v8",key:"svg-2"}],["path",{d:"M10 16a2 2 0 1 0 4 0a2 2 0 0 0 -4 0",key:"svg-3"}],["path",{d:"M12 4v10",key:"svg-4"}],["path",{d:"M12 18v2",key:"svg-5"}],["path",{d:"M16 7a2 2 0 1 0 4 0a2 2 0 0 0 -4 0",key:"svg-6"}],["path",{d:"M18 4v1",key:"svg-7"}],["path",{d:"M18 9v11",key:"svg-8"}]])},2242:function(e,t,r){"use strict";r.d(t,{Z:function(){return s}});var s=(0,r(4397).Z)("download","IconDownload",[["path",{d:"M4 17v2a2 2 0 0 0 2 2h12a2 2 0 0 0 2 -2v-2",key:"svg-0"}],["path",{d:"M7 11l5 5l5 -5",key:"svg-1"}],["path",{d:"M12 4l0 12",key:"svg-2"}]])},5897:function(e,t,r){"use strict";r.d(t,{Z:function(){return s}});var s=(0,r(4397).Z)("info-circle","IconInfoCircle",[["path",{d:"M3 12a9 9 0 1 0 18 0a9 9 0 0 0 -18 0",key:"svg-0"}],["path",{d:"M12 9h.01",key:"svg-1"}],["path",{d:"M11 12h1v4h1",key:"svg-2"}]])},4137:function(e,t,r){"use strict";r.d(t,{Z:function(){return s}});var s=(0,r(4397).Z)("upload","IconUpload",[["path",{d:"M4 17v2a2 2 0 0 0 2 2h12a2 2 0 0 0 2 -2v-2",key:"svg-0"}],["path",{d:"M7 9l5 -5l5 5",key:"svg-1"}],["path",{d:"M12 4l0 12",key:"svg-2"}]])},6502:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/connections/modbus-tcp-server",function(){return r(7674)}])},4045:function(e,t,r){"use strict";r.d(t,{Z:function(){return HexNumberInput}});var s=r(966),n=r(8393);function HexNumberInput(e){let{hex:t,...r}={...e};return t?(0,s.jsx)(InternalHexNumberInput,{...r}):(0,s.jsx)(n.Y,{...r})}function InternalHexNumberInput(e){return(0,s.jsx)(n.Y,{...e,formatter:e=>{let t=parseInt(e,10);return Number.isNaN(t)?"0x":"0x".concat(t.toString(16).toUpperCase())},parser:e=>e?parseInt(e.replace("0x",""),16).toString():""})}},29:function(e,t,r){"use strict";r.d(t,{Z:function(){return InputWithHelp}});var s=r(966),n=r(7344),a=r(9956),i=r(8255),o=r(8482),l=r(5897),c=r(3900);function InputWithHelp(e){let{children:t}=e,[r,d]=(0,c.useState)(!1);return(0,s.jsx)(t.type,{...Object.fromEntries(Object.entries(t.props)),labelProps:{display:"block"},label:(0,s.jsxs)(n.Z,{mb:"4px",spacing:5,children:[t.props.label,(0,s.jsx)(a.x,{children:(t.props.withAsterisk||t.props.required)&&(0,s.jsx)(a.x,{span:!0,color:"red","aria-hidden":!0,children:" *"})}),(0,s.jsx)(a.x,{ml:"auto",color:"blue",sx:{cursor:"pointer"},onClick:e=>{d(!r),e.preventDefault()},children:(0,s.jsx)(i.M,{children:(0,s.jsx)(l.Z,{size:14,stroke:1.5})})})]}),description:(0,s.jsx)(o.U,{in:r,transitionDuration:100,children:(0,s.jsx)(a.x,{size:"xs",color:"gray.6",lh:"14px",children:t.props.description})}),withAsterisk:!1})}},1921:function(e,t,r){"use strict";r.d(t,{Z:function(){return ModbusDebugTools}});var s=r(966),n=r(3127),a=r(5782),i=r(462),o=r(7344),l=r(9956),c=r(8482),d=r(2701),u=r(3283),p=r(3063),x=r(7673),m=r(3900),h=r(52),g=r(9342),v=r(8431),b=r(7452),f=r(6078),j=r(5041),y=r(6886),S=r(9724),C=r(9561),T=r(4045);function ModbusRequestGenerator(e){let{mode:t,onSubmit:r}=e,n=(0,S.c)({initialValues:{useHex:!0,deviceId:1,funcCode:"3",funcCodeCustom:1,address:0,quantity:1,value:0,subFunction:0,payload:""},validate:{deviceId:(0,C.m)({min:0,max:255},"Must be in range 0-255"),funcCodeCustom:(0,C.m)({min:0,max:255},"Must be in range 0-255"),address:(0,C.m)({min:0,max:65535},"Must be in range 0-65535"),quantity:(0,C.m)({min:0,max:2e3},"Must be in range 0-2000"),value:(0,C.m)({min:0,max:65535},"Must be in range 0-65535"),payload:e=>{let t=(0,v.uv)(e||"");return t.length%2!=0?"Payload must be even number of bytes":t.length>504?"Payload length must be not longer than 252 bytes":/^[0-9A-F]*$/.test(t)?void 0:"Payload must be in HEX format"}},validateInputOnBlur:!0}),a=g.eq.map(e=>({value:e.code.toString(),label:"".concat(n.values.useHex?"0x".concat(e.code.toString(16).toUpperCase().padStart(2,"0")):e.code.toString(10).padStart(2,"0")," (").concat(e.name,")")}));a.push({value:"custom",label:"Custom"});let o=(0,s.jsx)(s.Fragment,{children:(0,s.jsx)(f.o,{label:"Payload (HEX, without CRC):",placeholder:"00 20 00 0C",...n.getInputProps("payload")})}),l=n.values.funcCode;"custom"===l?o=(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(T.Z,{hex:n.values.useHex,label:"Function code:",min:0,max:128,...n.getInputProps("funcCodeCustom")}),(0,s.jsx)(f.o,{label:"Payload (HEX, without CRC):",placeholder:"00 20 00 0C",...n.getInputProps("payload")})]}):"1"===l||"2"===l||"3"===l||"4"===l?o=(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(T.Z,{hex:n.values.useHex,label:"Starting address:",min:0,max:65535,...n.getInputProps("address")}),(0,s.jsx)(T.Z,{hex:n.values.useHex,label:"Quantity:",min:0,max:2e3,...n.getInputProps("quantity")})]}):"5"===l||"6"===l?o=(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(T.Z,{hex:n.values.useHex,label:"Address:",min:0,max:65535,...n.getInputProps("address")}),(0,s.jsx)(T.Z,{hex:n.values.useHex,label:"Value:",...n.getInputProps("value")})]}):"7"===l||"11"===l||"12"===l||"17"===l?o=(0,s.jsx)(s.Fragment,{}):"8"===l?o=(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(T.Z,{hex:n.values.useHex,label:"Sub-function:",...n.getInputProps("subFunction")}),(0,s.jsx)(f.o,{label:"Data (HEX):",placeholder:"12 34 AB CD",...n.getInputProps("payload")})]}):("15"===l||"16"==l)&&(o=(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(T.Z,{hex:n.values.useHex,label:"Starting address:",min:0,max:65535,...n.getInputProps("address")}),(0,s.jsx)(T.Z,{hex:n.values.useHex,label:"Quantity:",min:0,max:2e3,...n.getInputProps("quantity")}),(0,s.jsx)(f.o,{label:"Values (HEX):",placeholder:"12 34 AB CD",...n.getInputProps("payload")})]}));let c="";return"rtu"===t?c=(0,g.aL)(getRequestData(n.values))[2]:"ascii"===t&&(c=(0,g.gY)(getRequestData(n.values))[1]),(0,s.jsx)("form",{onSubmit:n.onSubmit(()=>{r("rtu"===t?(0,g.aL)(getRequestData(n.values))[0]:"ascii"===t?(0,g.gY)(getRequestData(n.values))[0]:(0,g.nM)(getRequestData(n.values))[0])}),children:(0,s.jsxs)(i.K,{spacing:"xs",children:[(0,s.jsx)(j.r,{label:"Use HEX",onLabel:"HEX",offLabel:"DEC",checked:n.values.useHex,...n.getInputProps("useHex")}),(0,s.jsx)(T.Z,{hex:n.values.useHex,label:"Device ID:",min:0,max:255,...n.getInputProps("deviceId")}),(0,s.jsx)(y.Ph,{withinPortal:!0,label:"Function:",data:a,...n.getInputProps("funcCode")}),o,"tcp"!==t&&(0,s.jsx)(f.o,{label:"rtu"===t?"CRC:":"LRC:",value:(0,v.zF)(c),disabled:!0}),(0,s.jsx)(u.z,{type:"submit",children:"Add request"})]})})}function getRequestData(e){return{deviceId:e.deviceId,funcCode:"custom"===e.funcCode?e.funcCodeCustom:parseInt(e.funcCode,10),customPayload:"custom"===e.funcCode,address:e.address,quantity:e.quantity,value:e.value,subFunction:e.subFunction,payload:(0,v.uv)(e.payload||"")}}var w=r(4101);function ModbusDebugTools(e){let{mode:t,dst:r,isMaster:f}=e,[j,y]=(0,m.useState)(!1),[S,C]=(0,m.useState)(""),{token:T}=(0,h.pk)(),[I,P]=(0,m.useState)(!1),[z,M]=(0,m.useState)("");return(0,s.jsx)(n.x,{w:"100%",children:(0,s.jsxs)(a.r,{p:"xs",maw:914,children:[(0,s.jsx)(a.r.Col,{sm:f?8:12,children:(0,s.jsx)(w.Z,{mode:t,streamName:r})}),f&&(0,s.jsx)(a.r.Col,{sm:4,children:(0,s.jsxs)(i.K,{spacing:0,children:[(0,s.jsx)(o.Z,{sx:e=>({borderBottom:"1px solid ".concat(e.colors.gray[3])}),py:"xs",children:(0,s.jsx)(l.x,{size:"sm",transform:"uppercase",weight:700,color:"gray.9",children:"Send request"})}),(0,s.jsxs)(i.K,{pt:"xs",spacing:"xs",children:[(0,s.jsx)(c.U,{in:!j,children:(0,s.jsxs)(i.K,{spacing:"xs",children:[(0,s.jsx)(d.g,{fz:"xs",autosize:!0,minRows:8,maxRows:15,placeholder:"Write Modbus RTU in HEX.\nSeparate multiple requests by newline.\n\nE.g.\n02 01 00 20 00 0C 3D F6\n01 03 00 00 00 01 84 0A\n...",value:S,onChange:e=>C(e.target.value),styles:{root:{flexGrow:1},input:{fontFamily:"monospace"}}}),(0,s.jsx)(b.Z,{inProgress:I,onClick:async()=>{T&&(M("Preparing."),P(!0),await (0,g.PW)(T,r,S,!0,M),P(!1))},children:"Send"})]})}),(0,s.jsx)(c.U,{in:j,children:(0,s.jsx)(ModbusRequestGenerator,{mode:t,onSubmit:e=>{let t=S;t.trim().length>0&&!t.endsWith("\n")&&(t+="\n"),C(t+(e=(0,v.zF)(e))+"\n"),y(!1)}})}),(0,s.jsx)(u.z,{compact:!0,size:"xs",variant:"subtle",onClick:()=>y(!j),children:j?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(p.Z,{size:12,style:{marginRight:5}}),"Write request manually"]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(x.Z,{size:12,style:{marginRight:5}}),"Show request generator"]})}),z&&(0,s.jsx)(n.x,{sx:{overflow:"scroll"},w:"100%",mah:200,children:(0,s.jsx)(l.x,{c:"orange",fz:12,ff:"monospace",sx:{whiteSpace:"pre"},children:z})})]})]})})]})})}},477:function(e,t,r){"use strict";r.d(t,{Z:function(){return RxTxDisplay}});var s=r(966),n=r(1949),a=r(4137),i=r(2242),o=r(8431),l=r(3610);function RxTxDisplay(e){let{bytes:t,lastBytesSinceSec:r,speed:c,dbm:d,tx:u,oneline:p=!0}=e,x=(0,n.rZ)(),m=void 0!==r&&r<=2?x.colors.green[6]:x.colors.gray[6];return(0,s.jsx)(l.Z,{icon:u?(0,s.jsx)(a.Z,{stroke:1,height:15,color:m}):(0,s.jsx)(i.Z,{stroke:1,height:15,color:m}),name:u?"TX":"RX",subNameVal:d?"".concat(d," dBm"):void 0,nameColor:m,mainVal:(0,o.td)(t),subVal:{level:void 0!==r&&r<=2?"good":"dimmed",value:"".concat((0,o.td)(c),"/s")},oneline:p})}},2323:function(e,t,r){"use strict";r.d(t,{Z:function(){return StatusInfo}});var s=r(966),n=r(1949),a=r(7344),i=r(3624),o=r(462),l=r(9956),c=r(4351),d=r(4418),u=r(2922);function StatusInfo(e){let{iface:t,children:r,dest:p,text:x,error:m,ok:h,dhcpEnabled:g,attemptNum:v}=e,b=(0,n.rZ)();return(0,s.jsxs)(a.Z,{align:"start",spacing:"sm",noWrap:!0,p:"xs",children:[h?(0,s.jsx)(u.Z,{color:b.colors.green[6]}):(0,s.jsx)(i.a,{mt:9,size:22,color:"dark"}),(0,s.jsxs)(o.K,{spacing:"xs",children:[(0,s.jsxs)(o.K,{spacing:0,children:[(0,s.jsxs)(l.x,{color:h?"green":"dark",children:[x||(h?"Connected":"Connecting"),p&&(0,s.jsxs)(s.Fragment,{children:[" ","to ",(0,s.jsx)("b",{children:p})]}),v&&(0,s.jsxs)(s.Fragment,{children:[" ",(0,s.jsxs)(l.x,{color:"dimmed",size:"xs",span:!0,children:["(attempt ",v,")"]})]})]}),(0,s.jsxs)(a.Z,{spacing:"sm",children:[(0,s.jsx)(l.x,{color:"dimmed",size:"sm",lh:1,children:t}),void 0!==g&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(c.i,{orientation:"vertical",my:1}),(0,s.jsx)(l.x,{size:"sm",c:"dimmed",lh:1,children:g?"DHCP enabled":"DHCP disabled"})]})]})]}),m&&(0,s.jsx)(l.x,{size:"sm",c:"red",children:m}),r&&(0,s.jsx)(d.X,{bg:"gray.0",p:"xs",ml:"-xs",mb:"md",children:(0,s.jsx)(a.Z,{align:"start",position:"left",children:r})})]})]})}},7674:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return Page}});var s=r(966),n=r(462),a=r(3127),i=r(9956),o=r(1949),l=r(7344),c=r(3283),d=r(8482),u=r(9640),p=r(4397),x=(0,p.Z)("server-off","IconServerOff",[["path",{d:"M12 12h-6a3 3 0 0 1 -3 -3v-2c0 -1.083 .574 -2.033 1.435 -2.56m3.565 -.44h10a3 3 0 0 1 3 3v2a3 3 0 0 1 -3 3h-2",key:"svg-0"}],["path",{d:"M16 12h2a3 3 0 0 1 3 3v2m-1.448 2.568a2.986 2.986 0 0 1 -1.552 .432h-12a3 3 0 0 1 -3 -3v-2a3 3 0 0 1 3 -3h6",key:"svg-1"}],["path",{d:"M7 8v.01",key:"svg-2"}],["path",{d:"M7 16v.01",key:"svg-3"}],["path",{d:"M3 3l18 18",key:"svg-4"}]]),m=(0,p.Z)("circle-arrow-right","IconCircleArrowRight",[["path",{d:"M12 3a9 9 0 1 0 0 18a9 9 0 0 0 0 -18",key:"svg-0"}],["path",{d:"M16 12l-4 -4",key:"svg-1"}],["path",{d:"M16 12h-8",key:"svg-2"}],["path",{d:"M12 16l4 -4",key:"svg-3"}]]),h=r(7147),g=r(3174),v=r(3900),b=r(6435),f=r(5451),j=r(1921),y=r(7723),S=r(6886),C=r(8393),T=r(9724),w=r(7452),I=r(7219),P=r(29);function ModbusTcpServerSettingsForm(e){let{initialValues:t,onSubmit:r,saving:a}=e,i=(0,T.c)({initialValues:t,validate:{}}),{classes:o}=(0,y.Z)(),l=(0,I.uA)(i,o.dirtyInput),[u,p]=(0,v.useState)(!1);return(0,s.jsx)("form",{onSubmit:i.onSubmit(async e=>{let t=await r(e);t&&i.resetDirty()}),children:(0,s.jsxs)(n.K,{children:[(0,s.jsx)(S.Ph,{label:"Listen to interface:",withinPortal:!0,data:[{value:"any",label:"All interfaces"},{value:"elan",label:"ELAN only"},{value:"wlan",label:"WLAN only"},{value:"disabled",label:"Disable server"}],...l("interface")}),(0,s.jsx)(d.U,{in:"disabled"!==i.values.interface,transitionDuration:100,children:(0,s.jsxs)(n.K,{children:[(0,s.jsx)(C.Y,{label:"Listen to port:",min:1,max:65535,required:!0,...l("port"),hideControls:!0}),u?(0,s.jsx)(c.z,{variant:"subtle",compact:!0,leftIcon:(0,s.jsx)(h.Z,{size:14}),size:"xs",onClick:()=>p(!1),children:"Hide advanced settings"}):(0,s.jsx)(c.z,{variant:"subtle",compact:!0,leftIcon:(0,s.jsx)(g.Z,{size:14}),size:"xs",onClick:()=>p(!0),children:"Show advanced settings"}),(0,s.jsx)(d.U,{in:u,transitionDuration:100,children:(0,s.jsxs)(n.K,{children:[(0,s.jsx)(P.Z,{children:(0,s.jsx)(C.Y,{label:"Max connections:",description:"Maximum number of supported incoming client connections.",min:1,max:20,required:!0,...l("maxClients")})}),(0,s.jsx)(P.Z,{children:(0,s.jsx)(C.Y,{label:"Client alive timeout (sec):",description:"Client TCP connection will be dropped after this period of inactivity.",min:15,max:3600,required:!0,...l("clientAliveTimeoutSec")})}),(0,s.jsx)(P.Z,{children:(0,s.jsx)(C.Y,{label:"Response timeout (ms):",description:"The number of milliseconds to wait for an internal routing to respond to an incoming client's request. After this timeout is reached, the server will respond to a client with 0x0b (timeout error) Modbus error.",min:1,max:6e4,required:!0,...l("responseTimeoutMs")})}),(0,s.jsx)(P.Z,{children:(0,s.jsx)(C.Y,{label:"Simultaneous requests per client:",description:"Number of simultaneously processed parallel requests incoming from one client. Set to 1 to process all requests sequentially. Requests from different clients are always processed in parallel.",min:1,max:20,required:!0,...l("parallelRequestsNum")})})]})})]})}),(0,s.jsx)(w.Z,{type:"submit",inProgress:a,children:"Save"})]})})}var z=r(2094),M=r(477),Z=r(169),R=r(2323),k=r(9804),_=r(52),H=r(3738);async function settingsFetcher(e){let[t,r]=e,s=await (0,H.wv)(r,["modbusTcpServer:interface","modbusTcpServer:port","modbusTcpServer:maxClients","modbusTcpServer:clientAliveTimeoutSec","modbusTcpServer:responseTimeoutMs","modbusTcpServer:parallelRequestsNum","modbusTcpServer:portOpenRetryPeriodSec","modbusTcpServer:broadcastIsEnabled"]);return{interface:s["modbusTcpServer:interface"]||"any",port:parseInt(s["modbusTcpServer:port"]||"502",10),maxClients:parseInt(s["modbusTcpServer:maxClients"]||"4",10),clientAliveTimeoutSec:parseInt(s["modbusTcpServer:clientAliveTimeoutSec"]||"60",10),responseTimeoutMs:parseInt(s["modbusTcpServer:responseTimeoutMs"]||"1500",10),parallelRequestsNum:parseInt(s["modbusTcpServer:parallelRequestsNum"]||"1",10),portOpenRetryPeriodSec:parseInt(s["modbusTcpServer:portOpenRetryPeriodSec"]||"5",10),broadcastIsEnabled:"true"===s["modbusTcpServer:broadcastIsEnabled"]}}async function saveSettings(e){let t={"modbusTcpServer:interface":e.interface,"modbusTcpServer:port":e.port.toString(),"modbusTcpServer:maxClients":e.maxClients.toString(),"modbusTcpServer:clientAliveTimeoutSec":e.clientAliveTimeoutSec.toString(),"modbusTcpServer:responseTimeoutMs":e.responseTimeoutMs.toString(),"modbusTcpServer:parallelRequestsNum":e.parallelRequestsNum.toString(),"modbusTcpServer:portOpenRetryPeriodSec":e.portOpenRetryPeriodSec.toString(),"modbusTcpServer:broadcastIsEnabled":e.broadcastIsEnabled?"true":"false"};return(0,H.NC)(t)}var q=r(2967);function Page(){let e=function(){let e=(0,_.tQ)("modbus-tcp-server-settings",settingsFetcher);return{...e}}(),t=(0,q.$z)(),r=e.data,o=t.data;return r&&o?(0,s.jsx)(b.Z,{pageId:"modbus-tcp-server",title:"Modbus TCP Server",children:(0,s.jsx)(n.K,{children:(0,s.jsx)(Z.Z,{name:"Modbus TCP Server",icon:"disabled"!==o.status?(0,s.jsx)(u.Z,{}):(0,s.jsx)(x,{}),status:"disabled"===o.status?"disabled":"connected",settings:{title:"Modbus TCP Server settings",form:ModbusTcpServerSettingsForm,useSettings:()=>({data:{...r},error:void 0,isValidating:!1,isLoading:!1,mutate:async()=>void 0}),save:saveSettings,onSettingsUpdate:()=>{e.mutate()}},children:"disabled"===o.status?(0,s.jsx)(f.Z,{icon:(0,s.jsx)(x,{}),text:"Modbus TCP server is disabled in settings."}):(0,s.jsxs)(n.K,{spacing:0,children:[(0,s.jsx)(R.Z,{text:"Listening on ".concat(o.listenIp,":").concat(o.listenPort),ok:!0,iface:"any"===o.interface?"all interfaces":o.interface}),0===o.clients.length?(0,s.jsx)(a.x,{p:"xs",sx:e=>({borderTop:"1px solid ".concat(e.colors.gray[3]),backgroundColor:e.colors.gray[0]}),children:(0,s.jsx)(i.x,{fz:"sm",pl:36,color:"gray.6",children:"No clients connected."})}):(0,s.jsx)(n.K,{mt:"xs",spacing:0,children:o.clients.map(e=>(0,s.jsx)(ModbusTcpServerClientInfo,{client:e},e.address))})]})})})}):(0,s.jsx)(z.Z,{pageTitle:"Modbus TCP Server",contentIsLoading:!0})}function ModbusTcpServerClientInfo(e){let{client:t}=e,r=(0,o.rZ)(),[u,p]=(0,v.useState)(!1);return(0,s.jsxs)(n.K,{p:"xs",sx:e=>({borderTop:"1px solid ".concat(e.colors.gray[3]),backgroundColor:e.colors.gray[0]}),spacing:"xs",children:[(0,s.jsxs)(l.Z,{spacing:"sm",align:"start",children:[(0,s.jsx)(m,{color:r.colors.green[6]}),(0,s.jsxs)(n.K,{spacing:0,children:[(0,s.jsxs)(i.x,{weight:"bold",size:"sm",color:"gray.7",transform:"uppercase",mt:1,children:[(0,s.jsx)(i.x,{span:!0,color:"gray.6",children:"Connection from"})," ",t.address]}),(0,s.jsxs)(i.x,{color:"dimmed",size:"xs",lh:1,children:["Connected since ",(0,k.o0)(t.connectedOn,!0)," on ",t.iface]})]}),(0,s.jsx)(a.x,{mt:1,children:(0,s.jsx)(M.Z,{bytes:t.rxtx.rxTotalBytes,lastBytesSinceSec:t.rxtx.rxLastBytesSinceSec,speed:t.rxtx.rxSpeedBytesPerSec,oneline:!0})}),(0,s.jsx)(a.x,{mt:1,children:(0,s.jsx)(M.Z,{bytes:t.rxtx.txTotalBytes,lastBytesSinceSec:t.rxtx.txLastBytesSinceSec,speed:t.rxtx.txSpeedBytesPerSec,tx:!0,oneline:!0})})]}),(0,s.jsx)(l.Z,{children:u?(0,s.jsx)(c.z,{variant:"subtle",compact:!0,leftIcon:(0,s.jsx)(h.Z,{size:14}),size:"xs",onClick:()=>p(!1),children:"Hide transfer log"}):(0,s.jsx)(c.z,{variant:"subtle",compact:!0,leftIcon:(0,s.jsx)(g.Z,{size:14}),size:"xs",onClick:()=>p(!0),children:"Show transfer log"})}),(0,s.jsx)(d.U,{in:u,transitionDuration:100,children:(0,s.jsx)(j.Z,{dst:"MTS-".concat(t.address),mode:"tcp",isMaster:!1})})]})}}},function(e){e.O(0,[217,666,161,427,420,94,593,774,888,179],function(){return e(e.s=6502)}),_N_E=e.O()}]);