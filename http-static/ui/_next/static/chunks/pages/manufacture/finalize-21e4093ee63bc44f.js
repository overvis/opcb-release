(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[636],{8418:function(e,n,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/manufacture/finalize",function(){return t(5053)}])},735:function(e,n,t){"use strict";t.d(n,{Z:function(){return ManufactureLayout}});var i=t(966),r=t(9025),a=t(7344),c=t(2671),s=t(6849),o=t(7579),l=t(2767),u=t(7992),d=t(4736),f=t(5807),h=t(1149),g=t(6446),m=t(8410),x=t(2094);let p=(0,r.k)(e=>({tabsList:{borderBottom:"1px solid ".concat(e.colors.gray[4])},tab:{color:e.colors.blue[6],textTransform:"uppercase",fontSize:e.fontSizes.xs,"&:hover":{backgroundColor:"transparent",border:"transparent",color:e.colors.dark},"&[data-active]":{borderBottom:"2px solid #000",pointerEvents:"none"}}}));function ManufactureLayout(e){let{children:n,title:t,id:r}=e,j=(0,m.H)(),{classes:b}=p(),w=(0,g.useRouter)();if(!j.data)return(0,i.jsx)(x.Z,{pageTitle:"Manufacturing",contentIsLoading:!0});let y=j.data.internetConnected,v=j.data.wireguardConnected;return(0,i.jsxs)(x.Z,{pageTitle:"Manufacture :: ".concat(t),children:[v&&(0,i.jsx)(a.Z,{position:"center",children:(0,i.jsx)("a",{href:"/dyn-media/label.png",target:"_blank",children:(0,i.jsx)(c.E,{src:"/dyn-media/label.png",alt:"OPCB VPN information label.",maw:"260px"})})}),("restore"===r||"register"===r)&&(0,i.jsxs)(i.Fragment,{children:[v&&(0,i.jsx)(s.b,{my:"lg",icon:(0,i.jsx)(l.Z,{}),title:"Already authenticated.",color:"yellow",children:"This device is already authenticated on the remote server and has an access. By submitting this form you may lose the access or change the device's identity."}),!y&&(0,i.jsx)(s.b,{my:"lg",icon:(0,i.jsx)(l.Z,{}),title:"No internet access.",color:"yellow",children:"Active internet connection is required to restore the device's identity. Please check the device's settings."})]}),"test"===r&&!y&&(0,i.jsx)(s.b,{my:"lg",icon:(0,i.jsx)(l.Z,{}),title:"No internet access.",color:"red",children:"Active internet connection is required to run the tests."}),(0,i.jsxs)(o.m,{color:"dark",value:r,variant:"default",classNames:{tabsList:b.tabsList,tab:b.tab},onTabChange:e=>w.push("/manufacture/".concat(e)),children:[(0,i.jsxs)(o.m.List,{mb:"lg",children:[(0,i.jsx)(o.m.Tab,{value:"restore",icon:(0,i.jsx)(u.Z,{size:16}),children:"Restore identity"}),(0,i.jsx)(o.m.Tab,{value:"register",icon:(0,i.jsx)(d.Z,{size:16}),children:"Register"}),(0,i.jsx)(o.m.Tab,{value:"test",icon:(0,i.jsx)(f.Z,{size:16}),children:"Test"}),(0,i.jsx)(o.m.Tab,{value:"finalize",icon:(0,i.jsx)(h.Z,{size:16}),children:"Finalize"})]}),(0,i.jsx)(o.m.Panel,{value:r,children:n})]})]})}},829:function(e,n,t){"use strict";t.d(n,{Z:function(){return WithConfirmation}});var i=t(966),r=t(2638),a=t(462),c=t(9956),s=t(7344),o=t(3283),l=t(3900);function WithConfirmation(e){let{children:n,title:t,description:u,buttonText:d}=e,[f,h]=(0,l.useState)(!1);return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(r.u,{opened:f,onClose:()=>h(!1),withCloseButton:!1,children:(0,i.jsxs)(a.K,{children:[(0,i.jsx)(c.x,{fz:"md",weight:500,align:"center",children:t}),(0,i.jsx)(c.x,{fz:"sm",c:"gray.7",align:"center",children:u}),(0,i.jsxs)(s.Z,{position:"center",children:[(0,i.jsx)(o.z,{color:"orange",onClick:()=>{n.props.onClick(),h(!1)},children:d}),(0,i.jsx)(o.z,{color:"green",onClick:()=>h(!1),children:"Cancel"})]})]})}),(0,i.jsx)(n.type,{...n.props,onClick:()=>h(!0)})]})}},8410:function(e,n,t){"use strict";t.d(n,{H:function(){return useManufacturerStatus}});var i=t(52),r=t(3738);async function manufacturerFetcher(e){let[n,t]=e,i=await (0,r.UK)(t,["wg:ping","wg:pubkey","inet:ping","wg:ping","overvisRc:mac","manufacturer:modeEnabled","manufacturer:licenseUuid","manufacturer:licensePassword","manufacturer:batchDescription"]),a=await (0,r.wv)(t,["overvisVpn:wireguard:privateKey"]),c={internetConnected:!1,wireguardConnected:!1,pubkey:i["wg:pubkey"],mac:i["overvisRc:mac"],manufacturerModeEnabled:!!i["manufacturer:modeEnabled"],licenseUuid:i["manufacturer:licenseUuid"],licensePassword:i["manufacturer:licensePassword"],batchDescription:i["manufacturer:batchDescription"],privateKey:a["overvisVpn:wireguard:privateKey"]},s=i["wg:ping"];s&&"unreachable"!==s&&(c.wireguardConnected=!0);let o=i["inet:ping"];return o&&"unreachable"!==o&&(c.internetConnected=!0),c}function useManufacturerStatus(){return(0,i.tQ)("manufacturer-status",manufacturerFetcher)}},5053:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return Page}});var i,r,a=t(966),c=t(8255),s=t(462),o=t(3624),l=t(2763),u=t(9956),d=t(7344),f=t(3283),h=t(6680),g=t(7017),m=t(3900),x=t(735),p=t(2094),j=t(829),b=t(52);function Page(){let[e,n]=(0,m.useState)(0),{token:t}=(0,b.pk)();return(0,a.jsx)(a.Fragment,{children:t?(0,a.jsx)(a.Fragment,{children:0===e&&(0,a.jsx)(x.Z,{id:"finalize",title:"Finalize manufacturing",children:(0,a.jsx)(Finalize,{token:t,setState:n})})||(0,a.jsx)(c.M,{w:"100%",mih:"100vh",children:(0,a.jsx)(s.K,{align:"center",maw:"500px",children:1===e&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(o.a,{size:48}),(0,a.jsx)(l.D,{order:2,children:"Finishing manufacturing process..."}),(0,a.jsx)(u.x,{align:"center",children:"Restoring and applying factory configuration."})]})||(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(l.D,{order:2,children:"Manufacturing process is complete"}),(0,a.jsx)(u.x,{align:"center",c:"green",fz:"sm",children:"Device has been restored to the factory configuration, with saved registration information. The new admin user and WiFi password has been applied."}),(0,a.jsx)(u.x,{align:"center",fz:"sm",children:"To log into the device again, reconnect to the device's WiFi Access Point, using the password from the sticker."})]})})})}):(0,a.jsx)(p.Z,{pageTitle:"Finalize manufacturing",contentIsLoading:!0})})}function Finalize(e){let{token:n,setState:t}=e,finalizeManufacturing=async()=>{t(1);try{await (0,b.ri)(n,"/api/manufacture/finalize/",{method:"POST",body:JSON.stringify({})})}catch(e){(0,h.c0)({id:"finalize-failed",loading:!1,withCloseButton:!0,autoClose:!1,color:"red",icon:(0,a.jsx)(g.Z,{}),title:"Manufacturing finalize failed.",message:e.message}),t(0);return}await new Promise(e=>setTimeout(e,1e4)),t(2)};return(0,a.jsxs)(s.K,{h:"100%",children:[(0,a.jsx)(u.x,{fz:"xs",c:"gray",children:"The following action will finalize the manufacturing process and will restore the interface to the default user-mode. To restore the manufacturer's interface, put empty MANUFACTURER_LICENSE file in the root directory of device's SD card."}),(0,a.jsx)(d.Z,{children:(0,a.jsx)(j.Z,{title:"Finalize manufacturing",description:"Are you sure you want to finalize manufacturing?",buttonText:"Finalize",children:(0,a.jsx)(f.z,{color:"orange",onClick:async()=>{await finalizeManufacturing()},children:"Finalize manufacturing"})})})]})}(i=r||(r={}))[i.Idle=0]="Idle",i[i.Finalizing=1]="Finalizing",i[i.Success=2]="Success"}},function(e){e.O(0,[217,666,388,767,94,774,888,179],function(){return e(e.s=8418)}),_N_E=e.O()}]);