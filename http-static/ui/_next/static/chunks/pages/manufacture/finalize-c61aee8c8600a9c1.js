(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[636],{5658:function(e,n,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/manufacture/finalize",function(){return t(1296)}])},9121:function(e,n,t){"use strict";t.d(n,{Z:function(){return b}});var i=t(6521),r=t(2104),a=t(1876),s=t(4894),c=t(899),o=t(5263),l=t(5750),u=t(4572),d=t(8584),f=t(9114),h=t(3073),m=t(4130),g=t(4559),x=t(9296);let p=(0,r.k)(e=>({tabsList:{borderBottom:"1px solid ".concat(e.colors.gray[4])},tab:{color:e.colors.blue[6],textTransform:"uppercase",fontSize:e.fontSizes.xs,"&:hover":{backgroundColor:"transparent",border:"transparent",color:e.colors.dark},"&[data-active]":{borderBottom:"2px solid #000",pointerEvents:"none"}}}));function b(e){let{children:n,title:t,id:r}=e,b=(0,g.H)(),{classes:j}=p(),v=(0,m.useRouter)();if(!b.data)return(0,i.jsx)(x.Z,{pageTitle:"Manufacturing",contentIsLoading:!0});let y=b.data.internetConnected,w=b.data.wireguardConnected;return(0,i.jsxs)(x.Z,{pageTitle:"Manufacture :: ".concat(t),children:[w&&(0,i.jsx)(a.Z,{position:"center",children:(0,i.jsx)("a",{href:"/dyn-media/label.png",target:"_blank",children:(0,i.jsx)(s.E,{src:"/dyn-media/label.png",alt:"OPCB VPN information label.",maw:"260px"})})}),("restore"===r||"register"===r)&&(0,i.jsxs)(i.Fragment,{children:[w&&(0,i.jsx)(c.b,{my:"lg",icon:(0,i.jsx)(l.Z,{}),title:"Already authenticated.",color:"yellow",children:"This device is already authenticated on the remote server and has an access. By submitting this form you may lose the access or change the device's identity."}),!y&&(0,i.jsx)(c.b,{my:"lg",icon:(0,i.jsx)(l.Z,{}),title:"No internet access.",color:"yellow",children:"Active internet connection is required to restore the device's identity. Please check the device's settings."})]}),"test"===r&&!y&&(0,i.jsx)(c.b,{my:"lg",icon:(0,i.jsx)(l.Z,{}),title:"No internet access.",color:"red",children:"Active internet connection is required to run the tests."}),(0,i.jsxs)(o.m,{color:"dark",value:r,variant:"default",classNames:{tabsList:j.tabsList,tab:j.tab},onTabChange:e=>v.push("/manufacture/".concat(e)),children:[(0,i.jsxs)(o.m.List,{mb:"lg",children:[(0,i.jsx)(o.m.Tab,{value:"restore",icon:(0,i.jsx)(u.Z,{size:16}),children:"Restore identity"}),(0,i.jsx)(o.m.Tab,{value:"register",icon:(0,i.jsx)(d.Z,{size:16}),children:"Register"}),(0,i.jsx)(o.m.Tab,{value:"test",icon:(0,i.jsx)(f.Z,{size:16}),children:"Test"}),(0,i.jsx)(o.m.Tab,{value:"finalize",icon:(0,i.jsx)(h.Z,{size:16}),children:"Finalize"})]}),(0,i.jsx)(o.m.Panel,{value:r,children:n})]})]})}},3611:function(e,n,t){"use strict";t.d(n,{Z:function(){return u}});var i=t(6521),r=t(5400),a=t(5388),s=t(8202),c=t(1876),o=t(5885),l=t(5721);function u(e){let{children:n,title:t,description:u,buttonText:d}=e,[f,h]=(0,l.useState)(!1);return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(r.u,{opened:f,onClose:()=>h(!1),withCloseButton:!1,children:(0,i.jsxs)(a.K,{children:[(0,i.jsx)(s.x,{fz:"md",weight:500,align:"center",children:t}),(0,i.jsx)(s.x,{fz:"sm",c:"gray.7",align:"center",children:u}),(0,i.jsxs)(c.Z,{position:"center",children:[(0,i.jsx)(o.z,{color:"orange",onClick:()=>{n.props.onClick(),h(!1)},children:d}),(0,i.jsx)(o.z,{color:"green",onClick:()=>h(!1),children:"Cancel"})]})]})}),(0,i.jsx)(n.type,{...n.props,onClick:()=>h(!0)})]})}},4559:function(e,n,t){"use strict";t.d(n,{H:function(){return s}});var i=t(4579),r=t(4911);async function a(e){let[n,t]=e,i=await (0,r.UK)(t,["wg:ping","wg:pubkey","inet:ping","wg:ping","overvisRc:mac","manufacturer:modeEnabled","manufacturer:licenseUuid","manufacturer:licensePassword","manufacturer:batchDescription"]),a=await (0,r.wv)(t,["overvisVpn:wireguard:privateKey"]),s={internetConnected:!1,wireguardConnected:!1,pubkey:i["wg:pubkey"],mac:i["overvisRc:mac"],manufacturerModeEnabled:!!i["manufacturer:modeEnabled"],licenseUuid:i["manufacturer:licenseUuid"],licensePassword:i["manufacturer:licensePassword"],batchDescription:i["manufacturer:batchDescription"],privateKey:a["overvisVpn:wireguard:privateKey"]},c=i["wg:ping"];c&&"unreachable"!==c&&(s.wireguardConnected=!0);let o=i["inet:ping"];return o&&"unreachable"!==o&&(s.internetConnected=!0),s}function s(){return(0,i.tQ)("manufacturer-status",a)}},1296:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return f}});var i=t(6521),r=t(5388),a=t(8202),s=t(1876),c=t(5885),o=t(8519),l=t(9121),u=t(3611),d=t(4579);function f(){return(0,i.jsx)(l.Z,{id:"finalize",title:"Finalize manufacturing",children:(0,i.jsx)(h,{})})}function h(){let{actionHandler:e}=(0,o.vu)(),n=async()=>{let e=(0,d.bH)(),n=await (0,d.ri)(e,"/api/manufacture/finalize/",{method:"POST",body:JSON.stringify({})});if((null==n?void 0:n.status)!==200)throw Error("request failed with status "+(null==n?void 0:n.status))};return(0,i.jsxs)(r.K,{h:"100%",children:[(0,i.jsx)(a.x,{fz:"xs",c:"gray",children:"The following action will finalize the manufacturing process and will restore the interface to default user-mode. To restore the manufacturer's interface, put empty MANUFACTURER_LICENSE file in the root directory of device's SD card."}),(0,i.jsx)(s.Z,{children:(0,i.jsx)(u.Z,{title:"Finalize manufacturing",description:"Are you sure you want to finalize manufacturing?",buttonText:"Finalize",children:(0,i.jsx)(c.z,{color:"orange",onClick:()=>{e({actionProcess:n,title:"Finalize manufacturing",failedTitle:"Finalize failed.",failedId:"finalize-failed",startActionText:"Sending the command to the device...",afterActionText:"Finalizing the manufacturing process...",successId:"finalize-success",successTitle:"Manufacturing process has been finalized.",successMessage:"Operation completed successfully..",redirectToDashboardAfterAction:!0,delayBeforeDeviceWait:5e3})},children:"Finalize manufacturing"})})})]})}}},function(e){e.O(0,[634,558,210,125,296,774,888,179],function(){return e(e.s=5658)}),_N_E=e.O()}]);