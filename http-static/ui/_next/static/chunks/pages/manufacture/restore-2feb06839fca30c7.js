(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[687],{3765:function(e,t,r){"use strict";r.d(t,{Z:function(){return i}});var i=(0,r(2516).Z)("edit-circle","IconEditCircle",[["path",{d:"M12 15l8.385 -8.415a2.1 2.1 0 0 0 -2.97 -2.97l-8.415 8.385v3h3z",key:"svg-0"}],["path",{d:"M16 5l3 3",key:"svg-1"}],["path",{d:"M9 7.07a7 7 0 0 0 1 13.93a7 7 0 0 0 6.929 -6",key:"svg-2"}]])},8236:function(e,t,r){"use strict";r.d(t,{Z:function(){return i}});var i=(0,r(2516).Z)("hammer","IconHammer",[["path",{d:"M11.414 10l-7.383 7.418a2.091 2.091 0 0 0 0 2.967a2.11 2.11 0 0 0 2.976 0l7.407 -7.385",key:"svg-0"}],["path",{d:"M18.121 15.293l2.586 -2.586a1 1 0 0 0 0 -1.414l-7.586 -7.586a1 1 0 0 0 -1.414 0l-2.586 2.586a1 1 0 0 0 0 1.414l7.586 7.586a1 1 0 0 0 1.414 0z",key:"svg-1"}]])},2996:function(e,t,r){"use strict";r.d(t,{Z:function(){return i}});var i=(0,r(2516).Z)("signature","IconSignature",[["path",{d:"M3 17c3.333 -3.333 5 -6 5 -8c0 -3 -1 -3 -2 -3s-2.032 1.085 -2 3c.034 2.048 1.658 4.877 2.5 6c1.5 2 2.5 2.5 3.5 1l2 -3c.333 2.667 1.333 4 3 4c.53 0 2.639 -2 3 -2c.517 0 1.517 .667 3 2",key:"svg-0"}]])},1863:function(e,t,r){"use strict";r.d(t,{Z:function(){return i}});var i=(0,r(2516).Z)("test-pipe","IconTestPipe",[["path",{d:"M20 8.04l-12.122 12.124a2.857 2.857 0 1 1 -4.041 -4.04l12.122 -12.124",key:"svg-0"}],["path",{d:"M7 13h8",key:"svg-1"}],["path",{d:"M19 15l1.5 1.6a2 2 0 1 1 -3 0l1.5 -1.6z",key:"svg-2"}],["path",{d:"M15 3l6 6",key:"svg-3"}]])},3508:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/manufacture/restore",function(){return r(7281)}])},8435:function(e,t,r){"use strict";r.d(t,{Z:function(){return m}});var i=r(6521),n=r(3497),a=r(8481),s=r(6007),c=r(4432),o=r(8236),u=r(3765),l=r(1863),d=r(2996),h=r(7280),v=r(9266);let f=(0,n.k)(e=>({tabsList:{borderBottom:"1px solid ".concat(e.colors.gray[4])},tab:{color:e.colors.blue[6],textTransform:"uppercase",fontSize:e.fontSizes.xs,"&:hover":{backgroundColor:"transparent",border:"transparent",color:e.colors.dark},"&[data-active]":{borderBottom:"2px solid #000",pointerEvents:"none"}}}));function m(e){let{children:t,title:r,id:n,wireguardConnected:m,internetConnected:p}=e,{classes:g}=f(),y=(0,h.useRouter)();return(0,i.jsxs)(v.Z,{pageTitle:"Manufacture :: ".concat(r),children:[("restore"===n||"register"===n)&&(0,i.jsxs)(i.Fragment,{children:[m&&(0,i.jsx)(a.b,{my:"lg",icon:(0,i.jsx)(c.Z,{}),title:"Already authenticated.",color:"yellow",children:"This device is already authenticated on the remote server and has an access. By submitting this form you may lose the access or change the device's identity."}),!p&&(0,i.jsx)(a.b,{my:"lg",icon:(0,i.jsx)(c.Z,{}),title:"No internet access.",color:"yellow",children:"Active internet connection is required to restore the device's identity. Please check the device's settings."})]}),(0,i.jsxs)(s.m,{color:"dark",value:n,variant:"default",classNames:{tabsList:g.tabsList,tab:g.tab},onTabChange:e=>y.push("/manufacture/".concat(e)),children:[(0,i.jsxs)(s.m.List,{mb:"lg",children:[(0,i.jsx)(s.m.Tab,{value:"restore",icon:(0,i.jsx)(o.Z,{size:16}),children:"Restore identity"}),(0,i.jsx)(s.m.Tab,{value:"register",icon:(0,i.jsx)(u.Z,{size:16}),children:"Register"}),(0,i.jsx)(s.m.Tab,{value:"test",icon:(0,i.jsx)(l.Z,{size:16}),children:"Test"}),(0,i.jsx)(s.m.Tab,{value:"finalize",icon:(0,i.jsx)(d.Z,{size:16}),children:"Finalize"})]}),(0,i.jsx)(s.m.Panel,{value:n,children:t})]})]})}},7845:function(e,t,r){"use strict";r.d(t,{H:function(){return s}});var i=r(4893),n=r(1904);async function a(e){let[t,r]=e,i=await (0,n.UK)(r,["wg:ping","wg:pubkey","inet:ping","overvisRc:mac","manufacturer:modeEnabled","manufacturer:licenseUuid","manufacturer:licensePassword","manufacturer:batchDescription"]),a=await (0,n.wv)(r,["overvisVpn:wireguard:privateKey"]),s={internetConnected:!1,wireguardConnected:!1,pubkey:i["wg:pubkey"],mac:i["overvisRc:mac"],manufacturerModeEnabled:Boolean(i["manufacturer:modeEnabled"]),licenseUuid:i["manufacturer:licenseUuid"],licensePassword:i["manufacturer:licensePassword"],batchDescription:i["manufacturer:batchDescription"],privateKey:a["overvisVpn:wireguard:privateKey"]},c=i["inet:ping"];c&&"unreachable"!==c&&(s.wireguardConnected=!0);let o=i["inet:ping"];return o&&"unreachable"!==o&&(s.internetConnected=!0),s}function s(){return(0,i.tQ)("manufacturer-status",a)}},7281:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return m}});var i=r(6521),n=r(9626),a=r(3685),s=r(9458),c=r(2715),o=r(9400),u=r(6765),l=r(4091),d=r(8435),h=r(9266),v=r(4893),f=r(7845);function m(){let e=(0,f.H)();return e.data?(0,i.jsx)(d.Z,{id:"restore",title:"Restore identity",internetConnected:e.data.internetConnected,wireguardConnected:e.data.wireguardConnected,children:(0,i.jsx)(p,{privateKey:e.data.privateKey})}):(0,i.jsx)(h.Z,{pageTitle:"LAN/Internet",contentIsLoading:!0})}function p(e){let{privateKey:t}=e,{actionHandler:r}=(0,l.vu)(),d=(0,u.c)({initialValues:{privateKey:t}}),h=async()=>{let e=(0,v.bH)(),t=await (0,v.ri)(e,"/api/manufacture/restore/",{method:"POST",body:JSON.stringify({privateKey:d.values.privateKey})});if((null==t?void 0:t.status)!==200)throw Error("request failed with status "+(null==t?void 0:t.status))};return(0,i.jsxs)(n.K,{h:"100%",children:[(0,i.jsx)(a.x,{fz:"xs",c:"gray",children:"Warning! This will not change the local operations, but the device will acquire other device's identity on remote servers. This operation will communicate with remote server to register the identity of the device. Only do this if you have lost the device with specified private key or have restored its firmware to the factory firmware. Two devices with the same identity will conflict and will not be able to communicate with remote servers."}),(0,i.jsx)("form",{onSubmit:d.onSubmit(()=>{r({actionProcess:h,title:"Restoring OPCB",failedTitle:"Restore failed.",failedId:"restore-failed",startActionText:"Sending the data to the server...",afterActionText:"Restoring the device...",successId:"restore-success",successTitle:"OPCB has been restored.",successMessage:"Restore the device, completed successfully."})}),children:(0,i.jsxs)(n.K,{h:"100%",children:[(0,i.jsx)(s.o,{maw:"500px",label:"Enter the private key from the label to restore device registration:",...d.getInputProps("privateKey"),required:!0}),(0,i.jsx)(c.Z,{children:(0,i.jsx)(o.z,{type:"submit",children:"Restore"})})]})})]})}}},function(e){e.O(0,[473,13,7,266,774,888,179],function(){return e(e.s=3508)}),_N_E=e.O()}]);