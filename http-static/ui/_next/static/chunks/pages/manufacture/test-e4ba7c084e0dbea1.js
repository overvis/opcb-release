(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[411],{6386:function(e,t,r){"use strict";r.d(t,{k:function(){return C}});var n=r(5721),s=r(2251),i=r(9928),a=r(2104),o=r(5580),l=Object.defineProperty,c=Object.defineProperties,d=Object.getOwnPropertyDescriptors,u=Object.getOwnPropertySymbols,f=Object.prototype.hasOwnProperty,p=Object.prototype.propertyIsEnumerable,h=(e,t,r)=>t in e?l(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,m=(e,t)=>{for(var r in t||(t={}))f.call(t,r)&&h(e,r,t[r]);if(u)for(var r of u(t))p.call(t,r)&&h(e,r,t[r]);return e},y=(e,t)=>c(e,d(t));let g={xs:(0,i.h)(16),sm:(0,i.h)(20),md:(0,i.h)(26),lg:(0,i.h)(32),xl:(0,i.h)(40)},b=["filled","light","gradient","outline","default"];var x=(0,a.k)((e,{color:t,radius:r,gradient:n},{variant:s,size:a})=>{let l=(0,o.a)({size:a,sizes:g});return{root:m(y(m({},e.fn.fontStyles()),{display:"inline-flex",alignItems:"center",justifyContent:"center",boxSizing:"border-box",width:l,height:l,minWidth:l,minHeight:l,borderRadius:e.fn.radius(r)}),function({theme:e,variant:t,color:r,gradient:n}){if(!b.includes(t))return null;let s=e.fn.variant({variant:t,color:r||e.primaryColor,gradient:n,primaryFallback:!1});return{backgroundColor:s.background,color:s.color,backgroundImage:"gradient"===t?s.background:void 0,border:`${(0,i.h)("gradient"===t?0:1)} solid ${s.border}`}}({theme:e,variant:s,gradient:n,color:t}))}}),v=r(5570),j=Object.defineProperty,w=Object.getOwnPropertySymbols,O=Object.prototype.hasOwnProperty,k=Object.prototype.propertyIsEnumerable,z=(e,t,r)=>t in e?j(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,P=(e,t)=>{for(var r in t||(t={}))O.call(t,r)&&z(e,r,t[r]);if(w)for(var r of w(t))k.call(t,r)&&z(e,r,t[r]);return e},T=(e,t)=>{var r={};for(var n in e)O.call(e,n)&&0>t.indexOf(n)&&(r[n]=e[n]);if(null!=e&&w)for(var n of w(e))0>t.indexOf(n)&&k.call(e,n)&&(r[n]=e[n]);return r};let S={size:"md",variant:"filled"},C=(0,n.forwardRef)((e,t)=>{let r=(0,s.N4)("ThemeIcon",S,e),{className:i,size:a,radius:o,variant:l,color:c,children:d,gradient:u,unstyled:f}=r,p=T(r,["className","size","radius","variant","color","children","gradient","unstyled"]),{classes:h,cx:m}=x({variant:l,radius:o,color:c,gradient:u},{name:"ThemeIcon",unstyled:f,variant:l,size:a});return n.createElement(v.x,P({className:m(h.root,i),ref:t},p),d)});C.displayName="@mantine/core/ThemeIcon"},4616:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/manufacture/test",function(){return r(677)}])},9121:function(e,t,r){"use strict";r.d(t,{Z:function(){return b}});var n=r(6521),s=r(2104),i=r(1876),a=r(4894),o=r(899),l=r(5263),c=r(5750),d=r(4572),u=r(8584),f=r(9114),p=r(3073),h=r(4130),m=r(4559),y=r(9296);let g=(0,s.k)(e=>({tabsList:{borderBottom:"1px solid ".concat(e.colors.gray[4])},tab:{color:e.colors.blue[6],textTransform:"uppercase",fontSize:e.fontSizes.xs,"&:hover":{backgroundColor:"transparent",border:"transparent",color:e.colors.dark},"&[data-active]":{borderBottom:"2px solid #000",pointerEvents:"none"}}}));function b(e){let{children:t,title:r,id:s}=e,b=(0,m.H)(),{classes:x}=g(),v=(0,h.useRouter)();if(!b.data)return(0,n.jsx)(y.Z,{pageTitle:"Manufacturing",contentIsLoading:!0});let j=b.data.internetConnected,w=b.data.wireguardConnected;return(0,n.jsxs)(y.Z,{pageTitle:"Manufacture :: ".concat(r),children:[w&&(0,n.jsx)(i.Z,{position:"center",children:(0,n.jsx)("a",{href:"/dyn-media/label.png",target:"_blank",children:(0,n.jsx)(a.E,{src:"/dyn-media/label.png",alt:"OPCB VPN information label.",maw:"260px"})})}),("restore"===s||"register"===s)&&(0,n.jsxs)(n.Fragment,{children:[w&&(0,n.jsx)(o.b,{my:"lg",icon:(0,n.jsx)(c.Z,{}),title:"Already authenticated.",color:"yellow",children:"This device is already authenticated on the remote server and has an access. By submitting this form you may lose the access or change the device's identity."}),!j&&(0,n.jsx)(o.b,{my:"lg",icon:(0,n.jsx)(c.Z,{}),title:"No internet access.",color:"yellow",children:"Active internet connection is required to restore the device's identity. Please check the device's settings."})]}),"test"===s&&!j&&(0,n.jsx)(o.b,{my:"lg",icon:(0,n.jsx)(c.Z,{}),title:"No internet access.",color:"red",children:"Active internet connection is required to run the tests."}),(0,n.jsxs)(l.m,{color:"dark",value:s,variant:"default",classNames:{tabsList:x.tabsList,tab:x.tab},onTabChange:e=>v.push("/manufacture/".concat(e)),children:[(0,n.jsxs)(l.m.List,{mb:"lg",children:[(0,n.jsx)(l.m.Tab,{value:"restore",icon:(0,n.jsx)(d.Z,{size:16}),children:"Restore identity"}),(0,n.jsx)(l.m.Tab,{value:"register",icon:(0,n.jsx)(u.Z,{size:16}),children:"Register"}),(0,n.jsx)(l.m.Tab,{value:"test",icon:(0,n.jsx)(f.Z,{size:16}),children:"Test"}),(0,n.jsx)(l.m.Tab,{value:"finalize",icon:(0,n.jsx)(p.Z,{size:16}),children:"Finalize"})]}),(0,n.jsx)(l.m.Panel,{value:s,children:t})]})]})}},4559:function(e,t,r){"use strict";r.d(t,{H:function(){return a}});var n=r(4579),s=r(4911);async function i(e){let[t,r]=e,n=await (0,s.UK)(r,["wg:ping","wg:pubkey","inet:ping","wg:ping","overvisRc:mac","manufacturer:modeEnabled","manufacturer:licenseUuid","manufacturer:licensePassword","manufacturer:batchDescription"]),i=await (0,s.wv)(r,["overvisVpn:wireguard:privateKey"]),a={internetConnected:!1,wireguardConnected:!1,pubkey:n["wg:pubkey"],mac:n["overvisRc:mac"],manufacturerModeEnabled:!!n["manufacturer:modeEnabled"],licenseUuid:n["manufacturer:licenseUuid"],licensePassword:n["manufacturer:licensePassword"],batchDescription:n["manufacturer:batchDescription"],privateKey:i["overvisVpn:wireguard:privateKey"]},o=n["wg:ping"];o&&"unreachable"!==o&&(a.wireguardConnected=!0);let l=n["inet:ping"];return l&&"unreachable"!==l&&(a.internetConnected=!0),a}function a(){return(0,n.tQ)("manufacturer-status",i)}},677:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return eh}});var n=r(6521),s=r(5388),i=r(899),a=r(8202),o=r(1876),l=r(5885),c=r(641),d=r(5721),u=r(2251),f=r(7486);let[p,h]=(0,f.R)("List component was not found in tree");var m=r(2104),y=r(5082),g=r(5580),b=(0,m.k)((e,{spacing:t,center:r})=>({itemWrapper:{ref:(0,y.A)("itemWrapper"),display:"inline-flex",flexDirection:"column",whiteSpace:"normal"},item:{whiteSpace:"nowrap",lineHeight:r?1:e.lineHeight,"&:not(:first-of-type)":{marginTop:(0,g.a)({size:t,sizes:e.spacing})},"&[data-with-icon]":{listStyle:"none",[`& .${(0,y.A)("itemWrapper")}`]:{display:"inline-flex",alignItems:r?"center":"flex-start",flexDirection:"row"}}},itemIcon:{display:"inline-block",verticalAlign:"middle",marginRight:e.spacing.sm}})),x=r(5570),v=Object.defineProperty,j=Object.getOwnPropertySymbols,w=Object.prototype.hasOwnProperty,O=Object.prototype.propertyIsEnumerable,k=(e,t,r)=>t in e?v(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,z=(e,t)=>{for(var r in t||(t={}))w.call(t,r)&&k(e,r,t[r]);if(j)for(var r of j(t))O.call(t,r)&&k(e,r,t[r]);return e},P=(e,t)=>{var r={};for(var n in e)w.call(e,n)&&0>t.indexOf(n)&&(r[n]=e[n]);if(null!=e&&j)for(var n of j(e))0>t.indexOf(n)&&O.call(e,n)&&(r[n]=e[n]);return r};let T={},S=(0,d.forwardRef)((e,t)=>{let r=(0,u.N4)("ListItem",T,e),{className:n,children:s,icon:i}=r,a=P(r,["className","children","icon"]),{icon:o,spacing:l,center:c,listStyleType:f,size:p,withPadding:m,classNames:y,styles:g,unstyled:v,variant:j}=h(),w=i||o,{classes:O,cx:k}=b({withPadding:m,listStyleType:f,center:c,spacing:l},{classNames:y,styles:g,unstyled:v,name:"List",variant:j,size:p});return d.createElement(x.x,z({component:"li",className:k(O.item,n),"data-with-icon":!!w||void 0,ref:t},a),d.createElement("div",{className:O.itemWrapper},w&&d.createElement("span",{className:O.itemIcon},w),d.createElement("span",null,s)))});S.displayName="@mantine/core/ListItem";var C=Object.defineProperty,N=Object.defineProperties,I=Object.getOwnPropertyDescriptors,E=Object.getOwnPropertySymbols,Z=Object.prototype.hasOwnProperty,M=Object.prototype.propertyIsEnumerable,R=(e,t,r)=>t in e?C(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,L=(e,t)=>{for(var r in t||(t={}))Z.call(t,r)&&R(e,r,t[r]);if(E)for(var r of E(t))M.call(t,r)&&R(e,r,t[r]);return e},_=(e,t)=>N(e,I(t)),A=(0,m.k)((e,{withPadding:t,listStyleType:r},{size:n})=>({root:_(L({},e.fn.fontStyles()),{listStyleType:r,color:"dark"===e.colorScheme?e.colors.dark[0]:e.black,fontSize:(0,g.a)({size:n,sizes:e.fontSizes}),lineHeight:e.lineHeight,margin:0,paddingLeft:t?e.spacing.xl:0,listStylePosition:"inside"})})),H=Object.defineProperty,B=Object.getOwnPropertySymbols,F=Object.prototype.hasOwnProperty,D=Object.prototype.propertyIsEnumerable,K=(e,t,r)=>t in e?H(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,U=(e,t)=>{for(var r in t||(t={}))F.call(t,r)&&K(e,r,t[r]);if(B)for(var r of B(t))D.call(t,r)&&K(e,r,t[r]);return e},W=(e,t)=>{var r={};for(var n in e)F.call(e,n)&&0>t.indexOf(n)&&(r[n]=e[n]);if(null!=e&&B)for(var n of B(e))0>t.indexOf(n)&&D.call(e,n)&&(r[n]=e[n]);return r};let q={type:"unordered",size:"md",spacing:0},V=(0,d.forwardRef)((e,t)=>{let r=(0,u.N4)("List",q,e),{children:n,type:s,size:i,listStyleType:a,withPadding:o,center:l,spacing:c,icon:f,className:h,styles:m,classNames:y,unstyled:g,variant:b}=r,v=W(r,["children","type","size","listStyleType","withPadding","center","spacing","icon","className","styles","classNames","unstyled","variant"]),{classes:j,cx:w}=A({withPadding:o,listStyleType:a,center:l,spacing:c},{classNames:y,styles:m,name:"List",unstyled:g,size:i,variant:b});return d.createElement(p,{value:{spacing:c,center:l,icon:f,listStyleType:a,size:i,withPadding:o,classNames:y,styles:m,unstyled:g,variant:b}},d.createElement(x.x,U({component:"unordered"===s?"ul":"ol",className:w(j.root,h),ref:t},v),n))});V.Item=S,V.displayName="@mantine/core/List";var $=r(6386),J=r(367),X=r(4239),G=r(5750),Q=r(3299),Y=r(7557),ee=(0,Y.Z)("loader","IconLoader",[["path",{d:"M12 6l0 -3",key:"svg-0"}],["path",{d:"M16.25 7.75l2.15 -2.15",key:"svg-1"}],["path",{d:"M18 12l3 0",key:"svg-2"}],["path",{d:"M16.25 16.25l2.15 2.15",key:"svg-3"}],["path",{d:"M12 18l0 3",key:"svg-4"}],["path",{d:"M7.75 16.25l-2.15 2.15",key:"svg-5"}],["path",{d:"M6 12l-3 0",key:"svg-6"}],["path",{d:"M7.75 7.75l-2.15 -2.15",key:"svg-7"}]]),et=(0,Y.Z)("circle-dashed","IconCircleDashed",[["path",{d:"M8.56 3.69a9 9 0 0 0 -2.92 1.95",key:"svg-0"}],["path",{d:"M3.69 8.56a9 9 0 0 0 -.69 3.44",key:"svg-1"}],["path",{d:"M3.69 15.44a9 9 0 0 0 1.95 2.92",key:"svg-2"}],["path",{d:"M8.56 20.31a9 9 0 0 0 3.44 .69",key:"svg-3"}],["path",{d:"M15.44 20.31a9 9 0 0 0 2.92 -1.95",key:"svg-4"}],["path",{d:"M20.31 15.44a9 9 0 0 0 .69 -3.44",key:"svg-5"}],["path",{d:"M20.31 8.56a9 9 0 0 0 -1.95 -2.92",key:"svg-6"}],["path",{d:"M15.44 3.69a9 9 0 0 0 -3.44 -.69",key:"svg-7"}]]),er=(0,Y.Z)("circle-minus","IconCircleMinus",[["path",{d:"M12 12m-9 0a9 9 0 1 0 18 0a9 9 0 1 0 -18 0",key:"svg-0"}],["path",{d:"M9 12l6 0",key:"svg-1"}]]),en=r(218),es=r(4911),ei=r(4579);async function ea(){let e=(0,ei.bH)(),t=await (0,ei.ri)(e,"/api/manufacture/tests/run/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({})}),{testRunId:r}=await t.json();return r}async function eo(e){let t=(0,ei.bH)();await (0,ei.ri)(t,"/api/manufacture/tests/abort/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({testRunId:e})})}async function el(e){let t=(0,ei.bH)(),r=await (0,ei.ri)(t,"/api/manufacture/tests/check/?testRunId=".concat(e),{method:"GET",headers:{"Content-Type":"application/json"}}),n=await r.json();return n}function ec(e){let{internetConnected:t}=e,[r,u]=(0,d.useState)(!1),[f,p]=(0,d.useState)(void 0),[h,m]=(0,d.useState)([]),[y,g]=(0,d.useState)(void 0);(0,d.useEffect)(()=>{if(!f)return;let e=async()=>{let e;try{e=await el(f)}catch(e){(0,J.c0)({title:"Failed to check tests status",message:"Failed tests. Please start tests again.",withCloseButton:!0,color:"red",autoClose:5e3,icon:(0,n.jsx)(X.Z,{})}),t(),p(void 0),u(!1);return}if(m([...e.tests]),e.wasAborted)g({status:"aborted",startedOn:e.startedOn,finishedOn:e.finishedOn}),t(),p(void 0),u(!1);else if(e.finishedOn){let r=e.tests.some(e=>"failed"===e.result.status);g({status:r?"failed":"passed",startedOn:e.startedOn,finishedOn:e.finishedOn}),t(),p(void 0),u(!1)}},t=(0,es.As)(e,1e3);return()=>{t(),p(void 0),u(!1)}},[f]);let b=h.map((e,t)=>(0,n.jsx)(ed,{test:e},t));return(0,n.jsxs)(s.K,{spacing:"xl",h:"100%",children:[y&&"failed"===y.status&&(0,n.jsx)(i.b,{icon:(0,n.jsx)(G.Z,{size:"1rem"}),title:"Tests failed",color:"red",children:"Test execution completed unsuccessfully. Please check errors in the individual tests results below."}),y&&"passed"===y.status&&(0,n.jsx)(i.b,{icon:(0,n.jsx)(Q.Z,{size:"1rem"}),title:"Tests completed successfully",color:"green",children:"Test execution completed successfully. You can finalize the manufacturing process now."}),y&&"aborted"===y.status&&(0,n.jsx)(i.b,{icon:(0,n.jsx)(G.Z,{size:"1rem"}),title:"Tests aborted",color:"orange",children:"Test execution was aborted. Please restart."}),(0,n.jsx)(a.x,{fz:"xs",c:"gray",children:"This action will request the remote server to send a suit of testing commands to the device's API."}),(0,n.jsx)(a.x,{fz:"xs",fw:"bold",children:"To run tests successfully it is required to have Novatek-Electro OB-215 connected to OPCB through USB-RS485. OB-215 should have factory settings."}),(0,n.jsxs)(o.Z,{children:[r?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(l.z,{color:"orange",onClick:async()=>{f&&(await eo(f),p(void 0))},children:"Abort tests"}),(0,n.jsx)(c.a,{})]}):(0,n.jsx)(l.z,{onClick:async()=>{let e;u(!0),m([]),g(void 0);try{e=await ea()}catch(e){(0,J.c0)({title:"Failed to start tests",message:"Failed to start tests. Please try again.",withCloseButton:!0,color:"red",autoClose:5e3,icon:(0,n.jsx)(X.Z,{})}),u(!1);return}p(e)},disabled:!t,children:"Run tests"}),y&&(0,n.jsxs)(a.x,{fz:"xs",c:"dimmed",children:["Run started: ",(0,en.o0)(y.startedOn,!0,!0),","]}),y&&y.finishedOn&&(0,n.jsxs)(a.x,{fz:"xs",c:"dimmed",children:["Run finished: ",(0,en.o0)(y.finishedOn,!0,!0),","]})]}),(0,n.jsx)(V,{spacing:"md",size:"sm",children:b})]})}function ed(e){let{test:t}=e;return(0,n.jsxs)(V.Item,{icon:"waiting"===t.result.status&&(0,n.jsx)($.k,{color:"grey",size:20,radius:"xl",p:"0",children:(0,n.jsx)(ee,{size:"1rem"})})||"running"===t.result.status&&(0,n.jsx)($.k,{color:"blue",size:20,radius:"xl",p:"0",children:(0,n.jsx)(et,{size:"1rem"})})||"aborted"===t.result.status&&(0,n.jsx)($.k,{color:"grey",size:20,radius:"xl",p:"0",children:(0,n.jsx)(er,{size:"1rem"})})||"passed"===t.result.status&&(0,n.jsx)($.k,{color:"teal",size:20,radius:"xl",p:"0",children:(0,n.jsx)(Q.Z,{size:"1rem"})})||"failed"===t.result.status&&(0,n.jsx)($.k,{color:"red",size:20,radius:"xl",p:"0",children:(0,n.jsx)(G.Z,{size:"1rem"})}),children:[(0,n.jsxs)(o.Z,{children:[(0,n.jsx)(a.x,{children:t.name}),"startedOn"in t.result&&(0,n.jsxs)(a.x,{c:"gray",children:["Started: ",(0,en.o0)(t.result.startedOn,!0,!0)]}),"finishedOn"in t.result&&(0,n.jsxs)(a.x,{c:"gray",children:["Finished: ",(0,en.o0)(t.result.finishedOn,!0,!0)]})]}),(0,n.jsxs)(V,{listStyleType:"inherit",children:[(0,n.jsx)(V.Item,{children:(0,n.jsx)(a.x,{fz:"xs",c:"grey",children:t.description})}),"error"in t.result&&(0,n.jsx)(V.Item,{children:(0,n.jsxs)(a.x,{fz:"xs",c:"red",children:["error: ",t.result.error]})})]})]})}var eu=r(9121),ef=r(9296),ep=r(4559);function eh(){let e=(0,ep.H)();return e.data?(0,n.jsx)(eu.Z,{id:"test",title:"Automated testing",children:(0,n.jsx)(ec,{internetConnected:e.data.internetConnected})}):(0,n.jsx)(ef.Z,{pageTitle:"Manufacturing tests",contentIsLoading:!0})}}},function(e){e.O(0,[634,558,210,125,296,774,888,179],function(){return e(e.s=4616)}),_N_E=e.O()}]);