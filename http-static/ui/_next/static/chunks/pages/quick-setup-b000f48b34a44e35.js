(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[181],{2671:function(e,t,a){"use strict";a.d(t,{E:function(){return O}});var r=a(3900),n=a(1949),o=a(5728),i=a(3602),s=Object.defineProperty,l=Object.getOwnPropertySymbols,u=Object.prototype.hasOwnProperty,c=Object.prototype.propertyIsEnumerable,__defNormalProp=(e,t,a)=>t in e?s(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a,__spreadValues=(e,t)=>{for(var a in t||(t={}))u.call(t,a)&&__defNormalProp(e,a,t[a]);if(l)for(var a of l(t))c.call(t,a)&&__defNormalProp(e,a,t[a]);return e},__objRest=(e,t)=>{var a={};for(var r in e)u.call(e,r)&&0>t.indexOf(r)&&(a[r]=e[r]);if(null!=e&&l)for(var r of l(e))0>t.indexOf(r)&&c.call(e,r)&&(a[r]=e[r]);return a};function ImageIcon(e){let{width:t,height:a,style:n}=e,o=__objRest(e,["width","height","style"]);return r.createElement("svg",__spreadValues({viewBox:"0 0 15 15",fill:"none",xmlns:"http://www.w3.org/2000/svg",style:__spreadValues({width:t,height:a},n)},o),r.createElement("path",{d:"M2.5 1H12.5C13.3284 1 14 1.67157 14 2.5V12.5C14 13.3284 13.3284 14 12.5 14H2.5C1.67157 14 1 13.3284 1 12.5V2.5C1 1.67157 1.67157 1 2.5 1ZM2.5 2C2.22386 2 2 2.22386 2 2.5V8.3636L3.6818 6.6818C3.76809 6.59551 3.88572 6.54797 4.00774 6.55007C4.12975 6.55216 4.24568 6.60372 4.32895 6.69293L7.87355 10.4901L10.6818 7.6818C10.8575 7.50607 11.1425 7.50607 11.3182 7.6818L13 9.3636V2.5C13 2.22386 12.7761 2 12.5 2H2.5ZM2 12.5V9.6364L3.98887 7.64753L7.5311 11.4421L8.94113 13H2.5C2.22386 13 2 12.7761 2 12.5ZM12.5 13H10.155L8.48336 11.153L11 8.6364L13 10.6364V12.5C13 12.7761 12.7761 13 12.5 13ZM6.64922 5.5C6.64922 5.03013 7.03013 4.64922 7.5 4.64922C7.96987 4.64922 8.35078 5.03013 8.35078 5.5C8.35078 5.96987 7.96987 6.35078 7.5 6.35078C7.03013 6.35078 6.64922 5.96987 6.64922 5.5ZM7.5 3.74922C6.53307 3.74922 5.74922 4.53307 5.74922 5.5C5.74922 6.46693 6.53307 7.25078 7.5 7.25078C8.46693 7.25078 9.25078 6.46693 9.25078 5.5C9.25078 4.53307 8.46693 3.74922 7.5 3.74922Z",fill:"currentColor",fillRule:"evenodd",clipRule:"evenodd"}))}var d=a(9025),m=Object.defineProperty,p=Object.defineProperties,f=Object.getOwnPropertyDescriptors,g=Object.getOwnPropertySymbols,h=Object.prototype.hasOwnProperty,v=Object.prototype.propertyIsEnumerable,Image_styles_defNormalProp=(e,t,a)=>t in e?m(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a,Image_styles_spreadValues=(e,t)=>{for(var a in t||(t={}))h.call(t,a)&&Image_styles_defNormalProp(e,a,t[a]);if(g)for(var a of g(t))v.call(t,a)&&Image_styles_defNormalProp(e,a,t[a]);return e},__spreadProps=(e,t)=>p(e,f(t)),b=(0,d.k)((e,{radius:t})=>({root:{},imageWrapper:{position:"relative"},figure:{margin:0},image:__spreadProps(Image_styles_spreadValues({},e.fn.fontStyles()),{display:"block",width:"100%",height:"100%",border:0,borderRadius:e.fn.radius(t)}),caption:{color:"dark"===e.colorScheme?e.colors.dark[2]:e.colors.gray[7],marginTop:e.spacing.xs},placeholder:__spreadProps(Image_styles_spreadValues({},e.fn.cover()),{display:"flex",alignItems:"center",justifyContent:"center",color:"dark"===e.colorScheme?e.colors.dark[2]:e.colors.gray[6],backgroundColor:"dark"===e.colorScheme?e.colors.dark[8]:e.colors.gray[0],borderRadius:e.fn.radius(t)})})),S=a(3127),y=a(9956),w=Object.defineProperty,j=Object.defineProperties,_=Object.getOwnPropertyDescriptors,P=Object.getOwnPropertySymbols,x=Object.prototype.hasOwnProperty,k=Object.prototype.propertyIsEnumerable,Image_defNormalProp=(e,t,a)=>t in e?w(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a,Image_spreadValues=(e,t)=>{for(var a in t||(t={}))x.call(t,a)&&Image_defNormalProp(e,a,t[a]);if(P)for(var a of P(t))k.call(t,a)&&Image_defNormalProp(e,a,t[a]);return e},Image_spreadProps=(e,t)=>j(e,_(t)),Image_objRest=(e,t)=>{var a={};for(var r in e)x.call(e,r)&&0>t.indexOf(r)&&(a[r]=e[r]);if(null!=e&&P)for(var r of P(e))0>t.indexOf(r)&&k.call(e,r)&&(a[r]=e[r]);return a};let C={fit:"cover",width:"100%",height:"auto",radius:0},O=(0,r.forwardRef)((e,t)=>{let a=(0,n.N4)("Image",C,e),{className:s,alt:l,src:u,fit:c,width:d,height:m,radius:p,imageProps:f,withPlaceholder:g,placeholder:h,imageRef:v,classNames:w,styles:j,caption:_,unstyled:P,style:x,variant:k}=a,O=Image_objRest(a,["className","alt","src","fit","width","height","radius","imageProps","withPlaceholder","placeholder","imageRef","classNames","styles","caption","unstyled","style","variant"]),{classes:N,cx:I}=b({radius:p},{classNames:w,styles:j,unstyled:P,name:"Image",variant:k}),[E,M]=(0,r.useState)(!u),R=g&&E;return(0,i.l)(()=>{M(!u)},[u]),r.createElement(S.x,Image_spreadValues({className:I(N.root,s),style:Image_spreadValues({width:(0,o.h)(d)},x),ref:t},O),r.createElement("figure",{className:N.figure},r.createElement("div",{className:N.imageWrapper},r.createElement("img",Image_spreadProps(Image_spreadValues({src:u,alt:l,ref:v},f),{className:I(N.image,null==f?void 0:f.className),onError:e=>{M(!0),"function"==typeof(null==f?void 0:f.onError)&&f.onError(e)},style:Image_spreadValues(Image_spreadValues({objectFit:c,width:(0,o.h)(d),height:(0,o.h)(m)},R&&{overflow:"hidden"}),null==f?void 0:f.style)})),R&&r.createElement("div",{className:N.placeholder,title:l},h||r.createElement("div",null,r.createElement(ImageIcon,{width:(0,o.h)(40),height:(0,o.h)(40)})))),!!_&&r.createElement(y.x,{component:"figcaption",size:"sm",align:"center",className:N.caption},_)))});O.displayName="@mantine/core/Image"},2968:function(e,t,a){"use strict";a.d(t,{Z:function(){return r}});var r=(0,a(4397).Z)("refresh","IconRefresh",[["path",{d:"M20 11a8.1 8.1 0 0 0 -15.5 -2m-.5 -4v4h4",key:"svg-0"}],["path",{d:"M4 13a8.1 8.1 0 0 0 15.5 2m.5 4v-4h-4",key:"svg-1"}]])},6876:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/quick-setup",function(){return a(6946)}])},4665:function(e,t,a){"use strict";a.d(t,{s:function(){return MainLoader}});var r=a(966),n=a(8070),o=a(2489),i=a(6446),s=a(3900);function MainLoader(e){let t=(0,i.useRouter)(),[a,l]=(0,s.useState)(!0);return(0,s.useEffect)(()=>{let handleStart=()=>{l(!1)},handleStop=()=>{l(!0)};return t.events.on("routeChangeStart",handleStart),t.events.on("routeChangeComplete",handleStop),t.events.on("routeChangeError",handleStop),()=>{t.events.off("routeChangeStart",handleStart),t.events.off("routeChangeComplete",handleStop),t.events.off("routeChangeError",handleStop)}},[t]),(0,s.useEffect)(()=>{e.dataLoaded&&a||e.dataErrored?!a||e.dataLoaded||e.dataErrored?(0,n.We)():(0,n.fD)(50):(0,n.QT)()},[e.dataLoaded,e.dataErrored,a]),(0,r.jsx)(o.V,{autoReset:!0})}},9804:function(e,t,a){"use strict";a.d(t,{LU:function(){return formatDuration},k6:function(){return localTimeString},o0:function(){return formatDateTime}});var r=a(9089),n=a.n(r),o=a(3572),i=a.n(o);function formatDateTime(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=a?"YYYY-MM-DD HH:mm:ss":"YYYY-MM-DD HH:mm";return t?n()(e).format(r):n()(e).utc().format(r)}function localTimeString(e){return"".concat(e.toLocaleTimeString(),".").concat(e.getMilliseconds().toString().padStart(3,"0"))}function formatDuration(e){let t=Math.floor(e/36e5),a=Math.floor((e-36e5*t)/6e4),r=Math.floor((e-36e5*t-6e4*a)/1e3);return"".concat(t,"h ").concat(a,"m ").concat(r,"s")}n().extend(i())},8575:function(e,t,a){"use strict";a.d(t,{$b:function(){return useRs485Settings},Cu:function(){return deleteRs485},Mn:function(){return updateRs485},tz:function(){return o},v4:function(){return createRs485}});var r=a(52),n=a(3738);function useRs485Settings(){return(0,r.tQ)("/api/rs485-connections/",n.ph)}async function updateRs485(e){let t=(0,r.bH)();await (0,r.ri)(t,"/api/rs485-connection/".concat(e.deviceName,"/update/"),{method:"POST",body:JSON.stringify(e),timeoutMs:3e4})}async function createRs485(e){let t=(0,r.bH)();await (0,r.ri)(t,"/api/rs485-connections/create/",{method:"POST",body:JSON.stringify(e),timeoutMs:3e4})}async function deleteRs485(e){let t=(0,r.bH)();return await (0,r.ri)(t,"/api/rs485-connection/".concat(e,"/remove/"),{method:"POST",body:JSON.stringify({}),timeoutMs:3e4}),(0,n.ph)(["/api/rs485-connections/",t])}let o={deviceName:"ttyUSB0",mode:"rtu-master",uidRange:"1-255",responseTimeoutMs:300,baudRate:9600,stopAndParityBits:"2N",broadcastIsEnabled:!0,isEnabled:!0,gatewayGeneratedExceptions:{pathUnavalableCode:1,targetDeviceFailedToRespondCode:2},portOpenRetryPeriod:5}},1260:function(e,t,a){"use strict";a.d(t,{cH:function(){return makeTimezoneRecord},rV:function(){return useSettings},zQ:function(){return saveSettings}});var r=a(52),n=a(3738);async function settingsFetcher(e){var t;let[a,r]=e,o=await (0,n.wv)(r,["global:time:timezone","global:time:useNtp"]),i=await (0,n.vn)(r,"/api/state/?keys=".concat("time:timezones"));return{timezone:o["global:time:timezone"]||"Etc/UTC",useNtp:"true"===o["global:time:useNtp"],timezonesList:(null===(t=i["time:timezones"])||void 0===t?void 0:t.split("\n"))||[],setTime:new Date}}function useSettings(){let e=(0,r.tQ)("time-settings",settingsFetcher);return{...e}}function makeTimezoneRecord(e){let t={"global:time:timezone":e.timezone,"global:time:useNtp":e.useNtp?"true":"false"};return t}async function saveSettings(e){let t=(0,r.bH)(),a=makeTimezoneRecord(e);if(await (0,r.ri)(t,"/api/confs/set/",{method:"POST",body:JSON.stringify(a),timeoutMs:3e4}),!e.useNtp&&e.setTime){let a=e.setTime;await (0,r.ri)(t,"/api/set-time/",{method:"POST",body:JSON.stringify({time:a.toISOString()}),timeoutMs:3e4})}}},1827:function(e,t,a){"use strict";a.d(t,{A:function(){return useBasicSettings}});var r=a(52),n=a(3738);async function basicSettingsFetcher(e){let[t,a]=e,r="global:modelName,global:userProvidedDeviceName,global:quickSetupIsDone",o=await (0,n.vn)(a,"/api/confs/?keys=".concat(r));r="release:date,release:version,release:updateState,release:latestPatch:version,release:latestMinor:version,release:latestMajor:version,release:scheduledUpgradeToTag,release:lastSuccessfulUpgradeRef,manufacturer:modeEnabled";let i=await (0,n.vn)(a,"/api/state/?keys=".concat(r)),s="no-update";if(i["release:scheduledUpgradeToTag"]){let e=i["release:scheduledUpgradeToTag"],t=e.split("/");t.length>1&&(e=t[1]),s={kind:"scheduled",version:e}}else"disabled"===i["release:updateState"]?s="disabled":"no-repo"===i["release:updateState"]?s="no-repo":"dirty-repo"===i["release:updateState"]?s="dirty-repo":"broken-repo"===i["release:updateState"]?s="broken-repo":"available-update-patch"===i["release:updateState"]?s={kind:"available",version:i["release:latestPatch:version"]||"unknown version"}:"available-update-minor"===i["release:updateState"]?s={kind:"available",version:i["release:latestMinor:version"]||"unknown version"}:"available-update-major"===i["release:updateState"]?s={kind:"available",version:i["release:latestMajor:version"]||"unknown version"}:"imminent-upgrade"===i["release:updateState"]&&(s="upgrading");return{userProvidedName:o["global:userProvidedDeviceName"]||void 0,modelName:o["global:modelName"]||"OPCB",quickSetupIsDone:"true"===o["global:quickSetupIsDone"],manufacturerModeEnabled:"true"===i["manufacturer:modeEnabled"],firmwareVersion:i["release:version"]||"unknown",firmwareDate:i["release:date"]||"-",updateState:s,lastSuccessfulUpgradeRef:i["release:lastSuccessfulUpgradeRef"]||void 0}}function useBasicSettings(){return(0,r.tQ)("basic-settings",basicSettingsFetcher)}},8431:function(e,t,a){"use strict";function formatBytes(e){if(0===e)return"0 B";let t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(2))+" "+["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"][t]}function sinceString(e){let t=0;e>59&&(t=Math.floor(e/60),e%=60);let a=0;t>59&&(a=Math.floor(t/60),t%=60);let r=0;a>23&&(r=Math.floor(a/24),a%=24);let n=[];return r>0&&n.push(r+"d"),(a>0||n.length>0)&&n.push(a+"h"),(t>0||n.length>0)&&n.push(t+"m"),n.push(e+"s"),n.join(" ")}function getPingLevel(e){return e<100?"good":e<200?"medium":"bad"}function formatHexStringInput(e){return e.replace(/[\s-:]/g,"").toLowerCase().trim()}function formatHexStringOutput(e){return e.trim().toLowerCase().match(/.{1,2}/g).join(" ")}a.d(t,{Ch:function(){return sinceString},k:function(){return getPingLevel},td:function(){return formatBytes},uv:function(){return formatHexStringInput},zF:function(){return formatHexStringOutput}})},6946:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return Page}});var r=a(966),n=a(7696),o=a(7344),i=a(3624),s=a(462),l=a(2671),u=a(2763),c=a(480),d=a(9025),m=a(7432),p=a(6886),f=a(3283),g=a(9724),h=(0,a(4397).Z)("corner-down-right","IconCornerDownRight",[["path",{d:"M6 6v6a3 3 0 0 0 3 3h10l-4 -4m0 8l4 -4",key:"svg-0"}]]),v=a(717),b=a.n(v),S=a(6446),y=a(3900),w=a(4708),j=a(7219),_=a(7132),P=a(4665),x=a(4080),k=a(52),C=a(8512),O=a(3738),N=a(9342),I=a(4859),E=a(8575),M=a(1260),R=a(281),T=a(1827);function Page(){let e=I.rV(),t=R.rV(),a=M.rV(),d=(0,k.pk)(),m=(0,T.A)(),[p,f]=(0,y.useState)(!1),g=(0,S.useRouter)();return(0,y.useEffect)(()=>{f("true"===g.query.standalone)},[g.query.standalone]),e.data&&t.data&&a.data&&m.data?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(P.s,{dataLoaded:!0,dataErrored:!1}),(0,r.jsx)(b(),{children:(0,r.jsx)("title",{children:"OPCB :: Quick Setup"})}),(0,r.jsx)(n.W,{size:420,my:40,mih:"950px",children:(0,r.jsxs)(s.K,{align:"center",children:[(0,r.jsx)(l.E,{src:"/media/opcb-top.png",width:150,height:150,alt:"OPCB"}),(0,r.jsx)(u.D,{align:"center",children:"OPCB :: Quick Setup"}),(0,r.jsx)(QuickSetupForm,{lanSettings:e,wifiSettings:t,timeSettings:a,basicSettings:m,isStandalone:p}),!p&&(0,r.jsxs)(c.e,{href:"/",onClick:()=>{d.token&&d.setToken({...d.token,skipQuickSetup:!0})},children:[(0,r.jsx)(h,{size:14,style:{marginRight:"5px"}}),"Skip and proceed to full interface"]})]})})]}):(0,r.jsx)(n.W,{size:"lg",mih:400,py:"lg",children:(0,r.jsx)(o.Z,{position:"center",p:"xl",children:(0,r.jsx)(i.a,{})})})}let z=(0,d.k)(()=>({form:{width:"100%"}}));function QuickSetupForm(e){let{lanSettings:t,wifiSettings:a,timeSettings:n,basicSettings:o,isStandalone:i}=e;if(!t.data||!a.data||!n.data)throw Error("Data is required for QuickSetupForm.");let{classes:l}=z(),c=i?n.data.timezone:(0,C.X6)(),{actionHandler:d}=(0,w.vu)(),[h,v]=(0,y.useState)("elan"),b=(0,g.c)({initialValues:{elan:{...t.data},wlan:{...a.data},time:{...n.data,timezone:c},rs485:{...E.tz}},validate:{elan:{...I.Rx},wlan:{...R.Rx}}}),S=(0,j.uA)(b),submitHandler=async()=>{await (0,O.NC)({...I.Up(b.values.elan),...R.Up(b.values.wlan),...M.cH(b.values.time),"global:quickSetupIsDone":"true"});try{await E.v4(b.values.rs485)}catch(e){await E.Mn(b.values.rs485)}await t.mutate(b.values.elan),await a.mutate(b.values.wlan),await n.mutate(b.values.time),await o.mutate()};return(0,r.jsx)("form",{className:l.form,onSubmit:b.onSubmit(async()=>{d({actionProcess:submitHandler,title:"Applying settings",failedTitle:"Setup failed.",failedId:"quick-setup-failed",startActionText:"Sending the settings to the device...",afterActionText:"Saving the settings...",successId:"quick-setup-success",successTitle:"Settings applied.",successMessage:"Internet connection, timezone and RS-485 connection saved in the device.",messageAfterDeviceWaitTimeout:(0,r.jsx)(w.zU,{}),redirectToDashboardAfterAction:!i,delayBeforeDeviceWait:5e3})}),children:(0,r.jsxs)(s.K,{spacing:"lg",children:[(0,r.jsxs)(s.K,{children:[(0,r.jsx)(u.D,{order:3,align:"center",children:"Internet Connection"}),(0,r.jsx)(m.s,{fullWidth:!0,data:[{value:"elan",label:"Ethernet"},{value:"wlan",label:"Wi-Fi"}],value:h,onChange:v}),"elan"===h?(0,r.jsx)(_.Z,{form:b}):(0,r.jsx)(x.Z,{form:b})]}),(0,r.jsxs)(s.K,{children:[(0,r.jsx)(u.D,{order:3,align:"center",children:"Timezone"}),(0,r.jsx)(p.Ph,{label:"Timezone:",data:b.values.time.timezonesList,...S("time.timezone"),searchable:!0})]}),(0,r.jsxs)(s.K,{children:[(0,r.jsx)(u.D,{order:3,align:"center",children:"RS-485"}),(0,r.jsx)(p.Ph,{label:"Mode:",data:N.EH,...S("rs485.mode")}),(0,r.jsx)(p.Ph,{label:"Baud rate:",data:N._.map(e=>({value:e.toString(),label:e.toString()})),...S("rs485.baudRate"),value:b.values.rs485.baudRate.toString(),onChange:e=>{b.setFieldValue("rs485.baudRate",parseInt(e||"9600",10))}}),(0,r.jsx)(p.Ph,{label:"Stop and parity bits:",data:N.J4,...S("rs485.stopAndParityBits")})]}),i?(0,r.jsx)(f.z,{type:"submit",variant:"outline",radius:"xl",children:"Save OPCB settings"}):(0,r.jsx)(f.z,{type:"submit",children:"Save"})]})})}}},function(e){e.O(0,[217,666,351,886,811,927,774,888,179],function(){return e(e.s=6876)}),_N_E=e.O()}]);