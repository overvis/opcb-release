(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[181],{3914:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/quick-setup",function(){return n(743)}])},7741:function(e,t,n){"use strict";n.d(t,{Z:function(){return r}});var a=n(6521),i=n(3685);function r(){return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(i.x,{align:"center",fz:"xs",children:"Device has probably lost its network connection or its IP address has changed."}),(0,a.jsx)(i.x,{weight:700,align:"center",fz:"xs",children:'Try to connect to the OPCB Wi-Fi Access Point ("OPCB_XXXXXX") and access the default URL in your browser: http://setup.overvis.com/'})]})}},15:function(e,t,n){"use strict";n.d(t,{M:function(){return c},u:function(){return s}});var a=n(6521),i=n(2766),r=n(9445),o=n(8342);async function c(e){(0,i.yK)("settings-save"),(0,i.c0)({id:"settings-save",disallowClose:!0,autoClose:!1,loading:!0,icon:null,color:"orange",title:"Saving settings...",message:"Please wait while the new settings are applied..."});try{await e()}catch(e){(0,i.wD)({id:"settings-save",loading:!1,disallowClose:!1,color:"red",icon:(0,a.jsx)(r.Z,{}),title:"Error saving settings",message:"There was an error saving settings. Please check form data and try again."}),console.error(e);return}(0,i.wD)({id:"settings-save",loading:!1,disallowClose:!1,autoClose:1e3,color:"green",icon:(0,a.jsx)(o.Z,{}),title:"Settings saved",message:"Settings were saved and applied successfully."})}function s(e,t,n){return function(a){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"input";return function(e,t,n,a){let i=e.getInputProps(t,n);return{...i,classNames:{input:e.isDirty(t)&&a||void 0}}}(e,a,{...n,type:i},t)}}},212:function(e,t,n){"use strict";n.d(t,{$b:function(){return h},EH:function(){return l},Gt:function(){return v},J4:function(){return d},PW:function(){return f},_:function(){return s},aL:function(){return u},eq:function(){return o},gY:function(){return g},nM:function(){return p}});var a=n(4893),i=n(3071),r=n(3370).Buffer;let o=[{code:1,name:"Read Coils"},{code:2,name:"Read Discrete Inputs"},{code:3,name:"Read Holding Registers"},{code:4,name:"Read Input Registers"},{code:5,name:"Write Single Coil"},{code:6,name:"Write Single Register"},{code:7,name:"Read Exception Status"},{code:8,name:"Diagnostics"},{code:11,name:"Get Comm Event Counter"},{code:12,name:"Get Comm Event Log"},{code:15,name:"Write Multiple Coils"},{code:16,name:"Write Multiple Registers"},{code:17,name:"Report Server ID"},{code:20,name:"Read File Record"},{code:21,name:"Write File Record"},{code:22,name:"Mask Write Register"},{code:23,name:"Read/Write Multiple Registers"},{code:24,name:"Read FIFO Queue"},{code:43,name:"Read Device Identification"}],c=new Int32Array([0,49345,49537,320,49921,960,640,49729,50689,1728,1920,51009,1280,50625,50305,1088,52225,3264,3456,52545,3840,53185,52865,3648,2560,51905,52097,2880,51457,2496,2176,51265,55297,6336,6528,55617,6912,56257,55937,6720,7680,57025,57217,8e3,56577,7616,7296,56385,5120,54465,54657,5440,55041,6080,5760,54849,53761,4800,4992,54081,4352,53697,53377,4160,61441,12480,12672,61761,13056,62401,62081,12864,13824,63169,63361,14144,62721,13760,13440,62529,15360,64705,64897,15680,65281,16320,16e3,65089,64001,15040,15232,64321,14592,63937,63617,14400,10240,59585,59777,10560,60161,11200,10880,59969,60929,11968,12160,61249,11520,60865,60545,11328,58369,9408,9600,58689,9984,59329,59009,9792,8704,58049,58241,9024,57601,8640,8320,57409,40961,24768,24960,41281,25344,41921,41601,25152,26112,42689,42881,26432,42241,26048,25728,42049,27648,44225,44417,27968,44801,28608,28288,44609,43521,27328,27520,43841,26880,43457,43137,26688,30720,47297,47489,31040,47873,31680,31360,47681,48641,32448,32640,48961,32e3,48577,48257,31808,46081,29888,30080,46401,30464,47041,46721,30272,29184,45761,45953,29504,45313,29120,28800,45121,20480,37057,37249,20800,37633,21440,21120,37441,38401,22208,22400,38721,21760,38337,38017,21568,39937,23744,23936,40257,24320,40897,40577,24128,23040,39617,39809,23360,39169,22976,22656,38977,34817,18624,18816,35137,19200,35777,35457,19008,19968,36545,36737,20288,36097,19904,19584,35905,17408,33985,34177,17728,34561,18368,18048,34369,33281,17088,17280,33601,16640,33217,32897,16448]),s=[50,75,110,134,150,200,300,600,1200,1800,2400,4800,9600,19200,38400,57600,115200,230400,460800,5e5,576e3,921600,1e6,1152e3,15e5,2e6,25e5,3e6,35e5,4e6],l=[{label:"RTU slave",value:"rtu-slave"},{label:"ASCII slave",value:"ascii-slave"},{label:"RTU master",value:"rtu-master"},{label:"ASCII master",value:"ascii-master"}],d=[{label:"1N - 1 stop bit, no parity",value:"1N"},{label:"1E - 1 stop bit, even parity",value:"1E"},{label:"1O - 1 stop bit, odd parity",value:"1O"},{label:"2N - 2 stop bits, no parity",value:"2N"}];function u(e){let{deviceId:t,funcCode:n,customPayload:a,address:o,quantity:s,value:l,subFunction:d,payload:u}=e,p="".concat(t.toString(16).padStart(2,"0"));if(a)p+="".concat(n.toString(16).padStart(2,"0"))+"".concat((0,i.uv)(u||""));else switch(p+="".concat(n.toString(16).padStart(2,"0")),n){case 1:case 2:case 3:case 4:p+="".concat((o||0).toString(16).padStart(4,"0"))+"".concat((s||0).toString(16).padStart(4,"0"));break;case 5:case 6:p+="".concat((o||0).toString(16).padStart(4,"0"))+"".concat((l||0).toString(16).padStart(4,"0"));break;case 7:case 11:case 12:case 17:break;case 8:p+="".concat((d||0).toString(16).padStart(2,"0"))+"".concat((0,i.uv)(u||""));break;case 15:p+="".concat((o||0).toString(16).padStart(4,"0"))+"".concat((s||0).toString(16).padStart(4,"0"))+"".concat(Math.ceil((u||"").length/4).toString(16).padStart(2,"0"))+"".concat((0,i.uv)(u||""));break;case 16:p+="".concat((o||0).toString(16).padStart(4,"0"))+"".concat((s||0).toString(16).padStart(4,"0"))+"".concat(Math.ceil((u||"").length/2).toString(16).padStart(2,"0"))+"".concat((0,i.uv)(u||""));break;default:p+="".concat((0,i.uv)(u||""))}let g=function(e){let t=65535;for(let n=0;n<e.length;n++)t=(c[(t^e[n])&255]^t>>8)&65535;return t<<8&65535|t>>8}(r.from(p,"hex")),f=g.toString(16).padStart(4,"0"),h=p;return[h+f,h,f]}function p(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=t.toString(16).padStart(4,"0"),[a,i,r]=u(e),o=Math.ceil(i.length/2).toString(16).padStart(4,"0");return["".concat(n,"0000").concat(o).concat(i),r]}function g(e){let[t,n]=u(e),a=n.toUpperCase().split("").map(e=>e.charCodeAt(0).toString(16).padStart(2,"0")).join(""),i=function(e){let t=0;for(let n=0;n<e.length;n++)t+=255&e[n];return(255^t)+1&255}(r.from(n,"hex")),o=i.toString(16).toUpperCase().split("").map(e=>e.charCodeAt(0).toString(16).padStart(2,"0")).join("");return["3A".concat(a).concat(o,"0D0A"),o]}async function f(e,t,n,o,c){let s=n.trim().toLowerCase().split("\n").map(e=>e.trim()),l=[],d=0,u=0,p=0,g=()=>{c&&c("Requests sent: ".concat(d,"\nResponses: ").concat(u,"\nErrors: ").concat(p))};for(let n of s){if(n.startsWith("#")||0===n.length)continue;let c=(0,i.uv)(n),s={dataB64:r.from(c,"hex").toString("base64"),asIs:o,dst:t};d++,g();let f=await (0,a.ri)(e,"/api/modbus/send-request/",{method:"POST",body:JSON.stringify(s)}),h=await f.json();h.dataB64?u++:p++,g(),l.push({request:c,response:h.dataB64?r.from(h.dataB64,"base64").toString("hex"):"Error: ".concat(h.modbusErrorCode)})}let f="";for(let e of l)f+="> ".concat(e.request,"\n< ").concat(e.response,"\n");return c&&c(f),l}async function h(e,t,n,a,i){let r=[],o=a,c=n;for(;o>0;){let n=Math.min(o,125),a=await m(e,t,c,n,i);r.push(...a),o-=n,c+=n}return r}async function m(e,t,n,a,i){let[r,o,c]=u({deviceId:i,funcCode:"holding"===t?3:4,address:n,quantity:a}),s=(await f(e,"VIR",o,!1))[0].response,l=[];for(let e=0;e<a;e++)l.push(parseInt(s.slice(6+4*e,10+4*e),16));return l}function v(e,t){let n;let[a,i,...r]=e.split(" "),o=new Date(a),c="".concat(o.toLocaleTimeString(),".").concat(o.getMilliseconds().toString().padStart(3,"0")),s="<"!==i&&">"!==i?"#":i,l=r.join(" ");if("#"===s)return{date:c,type:"#",content:{kind:"raw",payload:l}};let d=Array.from(l.match(/.{1,2}/g));if(l.length%2!=0||"rtu"===t&&(l.length<8||l.length>254)||"ascii"===t&&(l.length<18||"3a"!==d[0]||"0d"!==d[d.length-2]||"0a"!==d[d.length-1])||"tcp"===t&&l.length<16)return{date:c,type:s,content:{kind:"error",payload:d.join(" ")}};if("rtu"===t){let e=d.splice(-2).join(" ");n=Object.assign(S(d,s),{crc:e})}else if("ascii"===t){let e=parseInt(d.slice(3,5).map(e=>String.fromCharCode(parseInt(e,16))).join(""),16);n={kind:"correct",prefix:d[0],deviceId:d.slice(1,3).join(" "),functionCode:d.slice(3,5).join(" "),errorFunctionCode:e>=128,payload:d.slice(6,-4).join(" "),crc:d.slice(-4).join(" "),description:d.slice(1,-4).map(e=>String.fromCharCode(parseInt(e,16))).join("")}}else if("rtu-no-crc"===t)n=S(d,s);else{let e=parseInt(d[8],16);n={kind:"correct",prefix:d.slice(0,6).join(" "),deviceId:d[6],functionCode:d[7],errorFunctionCode:e>=128,payload:d.slice(8).join(" ")}}return{date:c,type:s,content:n}}function S(e,t){let n=parseInt(e[1],16),a={kind:"correct",deviceId:e[0],functionCode:e[1],errorFunctionCode:n>=128,payload:e.slice(2).join(" ")};if(">"===t&&(3===n||4===n)){let t=parseInt(e.slice(2,4).join(""),16),i=parseInt(e.slice(4,6).join(""),16),r=3===n?"holding":"input";i>1?a.description="Read ".concat(r," ").concat(t,"-").concat(t+i-1):a.description="Read ".concat(r," ").concat(t)}if("<"===t&&(3===n||4===n)){let t=e.slice(3).join(""),n=t.match(/.{1,4}/g);if(n){let e=Array.from(n).map(e=>parseInt(e,16));a.description=e.join(", ")}}return a}},6273:function(e,t,n){"use strict";n.d(t,{$b:function(){return r},Cu:function(){return s},Mn:function(){return o},tz:function(){return l},v4:function(){return c}});var a=n(4893),i=n(1904);function r(){return(0,a.tQ)("/api/rs485-connections/",i.ph)}async function o(e){let t=(0,a.bH)();await (0,a.ri)(t,"/api/rs485-connection/".concat(e.deviceName,"/update/"),{method:"POST",body:JSON.stringify(e)})}async function c(e){let t=(0,a.bH)();await (0,a.ri)(t,"/api/rs485-connections/create/",{method:"POST",body:JSON.stringify(e)})}async function s(e){let t=(0,a.bH)();return await (0,a.ri)(t,"/api/rs485-connection/".concat(e,"/remove/"),{method:"POST",body:JSON.stringify({})}),(0,i.ph)(["/api/rs485-connections/",t])}let l={deviceName:"ttyS0",mode:"rtu-master",uidRange:"1-255",responseTimeoutMs:300,baudRate:9600,stopAndParityBits:"2N",broadcastIsEnabled:!0,isEnabled:!0,gatewayGeneratedExceptions:{pathUnavalableCode:1,targetDeviceFailedToRespondCode:2},portOpenRetryPeriod:5}},743:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return O}});var a=n(6521),i=n(1352),r=n(9626),o=n(5051),c=n(6479),s=n(7744),l=n(3497),d=n(5295),u=n(6215),p=n(9400),g=n(6765),f=(0,n(2516).Z)("corner-down-right","IconCornerDownRight",[["path",{d:"M6 6v6a3 3 0 0 0 3 3h10l-4 -4m0 8l4 -4",key:"svg-0"}]]),h=n(9609),m=n.n(h),v=n(5721),S=n(706),b=n(3301),j=n(9266),w=n(4908),x=n(482),y=n(5766),C=n(1643),R=n(6273),I=n(9242),k=n(7741),P=n(15),E=n(212),T=n(4091);function O(){let e=x.rV(),t=y.rV(),n=C.r();return e.data&&t.data&&n.data?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(b.s,{dataLoaded:!0,dataErrored:!1}),(0,a.jsx)(m(),{children:(0,a.jsx)("title",{children:"OPCB :: Sign In"})}),(0,a.jsx)(i.W,{size:420,my:40,children:(0,a.jsxs)(r.K,{align:"center",children:[(0,a.jsx)(o.E,{src:"/media/opcb-top.png",width:150,height:150,alt:"OPCB"}),(0,a.jsx)(c.D,{align:"center",children:"OPCB :: Quick Setup"}),(0,a.jsx)(N,{lanSettings:e,wifiSettings:t,timeSettings:n}),(0,a.jsxs)(s.e,{href:"/",children:[(0,a.jsx)(f,{size:14,style:{marginRight:"5px"}}),"Skip and proceed to full interface"]})]})})]}):(0,a.jsx)(j.Z,{pageTitle:"LAN/Internet",contentIsLoading:!0})}let D=(0,l.k)(()=>({form:{width:"100%"}}));function N(e){var t;let{lanSettings:n,wifiSettings:i,timeSettings:o}=e;if(!n.data||!i.data||!o.data)throw Error("Data is required for QuickSetupForm.");let{classes:s}=D(),l="true"===(null===(t=document.cookie.split("; ").find(e=>e.startsWith("".concat("proxy","="))))||void 0===t?void 0:t.split("=")[1]),f=l?o.data.timezone:(0,I.X6)(),{actionHandler:h}=(0,T.vu)(),[m,b]=(0,v.useState)("elan"),j=(0,g.c)({initialValues:{elan:{...n.data},wlan:{...i.data},time:{...o.data,timezone:f},rs485:{...R.tz}},validate:{elan:{...x.Rx},wlan:{...y.Rx}}}),O=(0,P.u)(j),N=async()=>{await x.zQ(j.values.elan),await n.mutate(j.values.elan),await y.zQ(j.values.wlan),await i.mutate(j.values.wlan),await C.z(j.values.time),await o.mutate(j.values.time);try{await R.v4(j.values.rs485)}catch(e){await R.Mn(j.values.rs485)}};return(0,a.jsx)("form",{className:s.form,onSubmit:j.onSubmit(async()=>{h({actionProcess:N,title:"Saving the quick setup",failedTitle:"Quick setup failed.",failedId:"quick-setup-failed",startActionText:"Sending the settings to the device...",afterActionText:"Saving the settings...",successId:"quick-setup-success",successTitle:"Quick setup saved.",successMessage:"Internet connection, timezone and RS-485 connection saved in the device.",messageAfterDeviceWaitTimeout:(0,a.jsx)(k.Z,{}),redirectToDashboardAfterAction:!l})}),children:(0,a.jsxs)(r.K,{spacing:"lg",children:[(0,a.jsxs)(r.K,{children:[(0,a.jsx)(c.D,{order:3,align:"center",children:"Internet Connection"}),(0,a.jsx)(d.s,{fullWidth:!0,data:[{value:"elan",label:"Ethernet"},{value:"wlan",label:"Wi-Fi"}],value:m,onChange:b}),"elan"===m?(0,a.jsx)(S.Z,{form:j}):(0,a.jsx)(w.Z,{form:j})]}),(0,a.jsxs)(r.K,{children:[(0,a.jsx)(c.D,{order:3,align:"center",children:"Timezone"}),(0,a.jsx)(u.Ph,{label:"Timezone:",data:j.values.time.timezonesList,...O("time.timezone"),searchable:!0})]}),(0,a.jsxs)(r.K,{children:[(0,a.jsx)(c.D,{order:3,align:"center",children:"RS-485"}),(0,a.jsx)(u.Ph,{label:"Mode:",data:E.EH,...O("rs485.mode")}),(0,a.jsx)(u.Ph,{label:"Baud rate:",data:E._.map(e=>({value:e.toString(),label:e.toString()})),...O("rs485.baudRate"),value:j.values.rs485.baudRate.toString(),onChange:e=>{j.setFieldValue("rs485.baudRate",parseInt(e||"9600",10))}}),(0,a.jsx)(u.Ph,{label:"Stop and parity bits:",data:E.J4,...O("rs485.stopAndParityBits")})]}),(0,a.jsx)(p.z,{type:"submit",children:"Save"})]})})}}},function(e){e.O(0,[473,13,370,167,266,810,774,888,179],function(){return e(e.s=3914)}),_N_E=e.O()}]);