"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.createFinalizeManufacturingHandler = void 0;
const tslib_1 = require("tslib");
const opcb_ts_shared_1 = require("@overvis/opcb-ts-shared");
const fs_1 = tslib_1.__importDefault(require("fs"));
const __1 = require("..");
function createFinalizeManufacturingHandler(manufacturingFilePath, bus) {
    return async (_cmd) => {
        __1.logger.debug("Got finalize manufacturing command.");
        __1.logger.info(`Finalizing manufacturing by deleting ${manufacturingFilePath}`);
        try {
            await fs_1.default.promises.unlink(manufacturingFilePath);
        }
        catch (e) {
            if (e && e.code !== "ENOENT") {
                throw e;
            }
        }
        await bus.sendRequest(new opcb_ts_shared_1.redisBus.ResetConfig());
        return new opcb_ts_shared_1.redisBus.Done();
    };
}
exports.createFinalizeManufacturingHandler = createFinalizeManufacturingHandler;
//# sourceMappingURL=fin-mf.js.map