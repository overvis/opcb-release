"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.createGenPubKeyHandler = void 0;
const opcb_ts_shared_1 = require("@overvis/opcb-ts-shared");
const __1 = require("..");
const exec_1 = require("../exec");
function createGenPubKeyHandler() {
    return async (cmd) => {
        __1.logger.debug("Got gen pub key command.");
        const [out, code, err] = await (0, exec_1.execCmd)(`echo "${cmd.privateKey}" | wg pubkey`);
        if (code) {
            __1.logger.error(`wg pubkey returned error code ${code}:\n${out}\n${err}`);
            return new opcb_ts_shared_1.redisBus.GenPubKeyResponse({
                error: `wg pubkey returned error code: ${code}`,
            });
        }
        const key = out.trim();
        return new opcb_ts_shared_1.redisBus.GenPubKeyResponse({ publicKey: key });
    };
}
exports.createGenPubKeyHandler = createGenPubKeyHandler;
//# sourceMappingURL=gen-pub-key.js.map