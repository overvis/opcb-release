"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.ensureTmReportDiagnosticIsUninstalled = exports.ensureTmReportDiagnosticIsInstalled = void 0;
const __1 = require("..");
const exec_1 = require("../exec");
async function ensureTmReportDiagnosticIsInstalled(serverApiUrl, periodMin, data) {
    __1.logger.debug("Ensuring TM Report Diagnostic is installed...");
    // Convert data object to Json string, and escape double quotes for TS and Bash
    const jsonData = JSON.stringify(data).replaceAll('"', '\\"');
    const tmCronFileContents = `*/${periodMin} * * * * root /bin/bash -c "curl -s -d '${jsonData}' -H 'Content-Type: application/json' '${serverApiUrl}/tm-report-diagnostic/'"\n`;
    await (0, exec_1.ensureFileContents)("/etc/cron.d/tm-report-diagnostic", tmCronFileContents);
}
exports.ensureTmReportDiagnosticIsInstalled = ensureTmReportDiagnosticIsInstalled;
async function ensureTmReportDiagnosticIsUninstalled() {
    __1.logger.debug("Ensuring TM Report Diagnostic is uninstalled...");
    await (0, exec_1.ensureFileOrDirectoryIsRemoved)("/etc/cron.d/tm-report-diagnostic");
}
exports.ensureTmReportDiagnosticIsUninstalled = ensureTmReportDiagnosticIsUninstalled;
//# sourceMappingURL=telemetry.js.map