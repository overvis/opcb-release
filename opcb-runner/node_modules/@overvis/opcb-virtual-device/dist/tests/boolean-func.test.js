"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const opcb_ts_shared_1 = require("@overvis/opcb-ts-shared");
const utils_1 = require("./utils");
describe("virtual device", function () {
    it("should correctly read boolean parameters", async () => {
        const [bus, stop] = await (0, utils_1.runVirtDevice)(true);
        await bus.setConfs({
            // Bool - id: 1120
            "elan:dhcpIsEnabled": "true",
        });
        // Bool - id: 1120
        expect((await bus.sendRequest(new opcb_ts_shared_1.redisCmd.ModbusRequest((0, utils_1.makeReadRequest)(111, 1120, 1, 0x03), "rtu-no-crc"))).data.readUint16BE(3)).toBe(1);
        stop();
    });
    it("should correctly write single boolean parameters", async () => {
        const [bus, stop] = await (0, utils_1.runVirtDevice)(true);
        // Bool - id: 1120
        await bus.sendMsg(new opcb_ts_shared_1.redisCmd.ModbusRequest((0, utils_1.makeWriteSingleRequest)(111, 1120, 0), "rtu-no-crc"));
        expect(await bus.waitForNextMsg(await bus.getLastMsgId())).toMatchObject({
            cmd: "set-config",
            values: { "elan:dhcpIsEnabled": "false" },
        });
        // incorrect value
        // Bool - id: 1120
        await bus.sendMsg(new opcb_ts_shared_1.redisCmd.ModbusRequest((0, utils_1.makeWriteSingleRequest)(111, 1120, 2), "rtu-no-crc"));
        expect(await bus.waitForNextMsg(await bus.getLastMsgId())).toMatchObject({
            cmd: "modbus-resp",
            data: Buffer.from("6f8603", "hex"),
        });
        stop();
    });
});
//# sourceMappingURL=boolean-func.test.js.map