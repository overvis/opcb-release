"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const opcb_ts_shared_1 = require("@overvis/opcb-ts-shared");
const utils_1 = require("./utils");
describe("virtual device", function () {
    it("should correctly read enum parameters", async () => {
        const [bus, stop] = await (0, utils_1.runVirtDevice)(true);
        await bus.setConfs({
            "wlan:mode": "ap",
        });
        // Enum - id: 1220
        expect((await bus.sendRequest(new opcb_ts_shared_1.redisCmd.ModbusRequest((0, utils_1.makeReadRequest)(111, 1220, 1, 0x03), "rtu-no-crc"))).data.readUint16BE(3)).toBe(0);
        stop();
    });
    it("should correctly write single enum parameter", async () => {
        const [bus, stop] = await (0, utils_1.runVirtDevice)(true);
        // Enum - id: 1220
        await bus.sendMsg(new opcb_ts_shared_1.redisCmd.ModbusRequest((0, utils_1.makeWriteSingleRequest)(111, 1220, 1), "rtu-no-crc"));
        expect(await bus.waitForNextMsg(await bus.getLastMsgId())).toMatchObject({
            cmd: "set-config",
            values: { "wlan:mode": "station" },
        });
        // incorrect value
        // Enum - id: 1220
        await bus.sendMsg(new opcb_ts_shared_1.redisCmd.ModbusRequest((0, utils_1.makeWriteSingleRequest)(111, 1220, 2), "rtu-no-crc"));
        expect(await bus.waitForNextMsg(await bus.getLastMsgId())).toMatchObject({
            cmd: "modbus-resp",
            data: Buffer.from("6f8603", "hex"),
        });
        stop();
    });
});
//# sourceMappingURL=enum-func.test.js.map